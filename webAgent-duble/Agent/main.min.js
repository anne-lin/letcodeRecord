/**
 * Created by panfei on 2016/8/29.
 */
define('jquery',[], function() {return window.jQuery});

/*!
 * Knockout JavaScript library v3.4.0
 * (c) Steven Sanderson - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */

(function() {(function(n){var x=this||(0,eval)("this"),u=x.document,M=x.navigator,v=x.jQuery,F=x.JSON;(function(n){"function"===typeof define&&define.amd?define('knockout',["exports","require"],n):"object"===typeof exports&&"object"===typeof module?n(module.exports||exports):n(x.ko={})})(function(N,O){function J(a,c){return null===a||typeof a in T?a===c:!1}function U(b,c){var d;return function(){d||(d=a.a.setTimeout(function(){d=n;b()},c))}}function V(b,c){var d;return function(){clearTimeout(d);d=a.a.setTimeout(b,c)}}function W(a,
c){c&&c!==I?"beforeChange"===c?this.Kb(a):this.Ha(a,c):this.Lb(a)}function X(a,c){null!==c&&c.k&&c.k()}function Y(a,c){var d=this.Hc,e=d[s];e.R||(this.lb&&this.Ma[c]?(d.Pb(c,a,this.Ma[c]),this.Ma[c]=null,--this.lb):e.r[c]||d.Pb(c,a,e.s?{ia:a}:d.uc(a)))}function K(b,c,d,e){a.d[b]={init:function(b,g,k,l,m){var h,r;a.m(function(){var q=a.a.c(g()),p=!d!==!q,A=!r;if(A||c||p!==h)A&&a.va.Aa()&&(r=a.a.ua(a.f.childNodes(b),!0)),p?(A||a.f.da(b,a.a.ua(r)),a.eb(e?e(m,q):m,b)):a.f.xa(b),h=p},null,{i:b});return{controlsDescendantBindings:!0}}};
a.h.ta[b]=!1;a.f.Z[b]=!0}var a="undefined"!==typeof N?N:{};a.b=function(b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++)e=e[d[f]];e[d[d.length-1]]=c};a.G=function(a,c,d){a[c]=d};a.version="3.4.0";a.b("version",a.version);a.options={deferUpdates:!1,useOnlyNativeEvents:!1};a.a=function(){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function c(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a,b){a.__proto__=b;return a}function e(b,c,d,e){var h=b[c].match(r)||
[];a.a.q(d.match(r),function(b){a.a.pa(h,b,e)});b[c]=h.join(" ")}var f={__proto__:[]}instanceof Array,g="function"===typeof Symbol,k={},l={};k[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];k.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");b(k,function(a,b){if(b.length)for(var c=0,d=b.length;c<d;c++)l[b[c]]=a});var m={propertychange:!0},h=u&&function(){for(var a=3,b=u.createElement("div"),c=
b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",c[0];);return 4<a?a:n}(),r=/\S+/g;return{cc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},o:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},Sb:function(a,b,c){for(var d=0,e=a.length;d<e;d++)if(b.call(c,a[d],d))return a[d];
return null},La:function(b,c){var d=a.a.o(b,c);0<d?b.splice(d,1):0===d&&b.shift()},Tb:function(b){b=b||[];for(var c=[],d=0,e=b.length;d<e;d++)0>a.a.o(c,b[d])&&c.push(b[d]);return c},fb:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)c.push(b(a[d],d));return c},Ka:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)b(a[d],d)&&c.push(a[d]);return c},ra:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;c<d;c++)a.push(b[c]);return a},pa:function(b,c,d){var e=
a.a.o(a.a.zb(b),c);0>e?d&&b.push(c):d||b.splice(e,1)},ka:f,extend:c,Xa:d,Ya:f?d:c,D:b,Ca:function(a,b){if(!a)return a;var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},ob:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},jc:function(b){b=a.a.V(b);for(var c=(b[0]&&b[0].ownerDocument||u).createElement("div"),d=0,e=b.length;d<e;d++)c.appendChild(a.$(b[d]));return c},ua:function(b,c){for(var d=0,e=b.length,h=[];d<e;d++){var m=b[d].cloneNode(!0);h.push(c?a.$(m):m)}return h},
da:function(b,c){a.a.ob(b);if(c)for(var d=0,e=c.length;d<e;d++)b.appendChild(c[d])},qc:function(b,c){var d=b.nodeType?[b]:b;if(0<d.length){for(var e=d[0],h=e.parentNode,m=0,l=c.length;m<l;m++)h.insertBefore(c[m],e);m=0;for(l=d.length;m<l;m++)a.removeNode(d[m])}},za:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);for(;1<a.length&&a[a.length-1].parentNode!==b;)a.length--;if(1<a.length){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)a.push(c),
c=c.nextSibling;a.push(d)}}return a},sc:function(a,b){7>h?a.setAttribute("selected",b):a.selected=b},$a:function(a){return null===a||a===n?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},nd:function(a,b){a=a||"";return b.length>a.length?!1:a.substring(0,b.length)===b},Mc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(b.compareDocumentPosition(a)&16);for(;a&&a!=
b;)a=a.parentNode;return!!a},nb:function(b){return a.a.Mc(b,b.ownerDocument.documentElement)},Qb:function(b){return!!a.a.Sb(b,a.a.nb)},A:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},Wb:function(b){return a.onError?function(){try{return b.apply(this,arguments)}catch(c){throw a.onError&&a.onError(c),c;}}:b},setTimeout:function(b,c){return setTimeout(a.a.Wb(b),c)},$b:function(b){setTimeout(function(){a.onError&&a.onError(b);throw b;},0)},p:function(b,c,d){var e=a.a.Wb(d);d=h&&m[c];if(a.options.useOnlyNativeEvents||
d||!v)if(d||"function"!=typeof b.addEventListener)if("undefined"!=typeof b.attachEvent){var l=function(a){e.call(b,a)},f="on"+c;b.attachEvent(f,l);a.a.F.oa(b,function(){b.detachEvent(f,l)})}else throw Error("Browser doesn't support addEventListener or attachEvent");else b.addEventListener(c,e,!1);else v(b).bind(c,e)},Da:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var d;"input"===a.a.A(b)&&b.type&&"click"==c.toLowerCase()?(d=b.type,d="checkbox"==
d||"radio"==d):d=!1;if(a.options.useOnlyNativeEvents||!v||d)if("function"==typeof u.createEvent)if("function"==typeof b.dispatchEvent)d=u.createEvent(l[c]||"HTMLEvents"),d.initEvent(c,!0,!0,x,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(d);else throw Error("The supplied element doesn't support dispatchEvent");else if(d&&b.click)b.click();else if("undefined"!=typeof b.fireEvent)b.fireEvent("on"+c);else throw Error("Browser doesn't support triggering events");else v(b).trigger(c)},c:function(b){return a.H(b)?
b():b},zb:function(b){return a.H(b)?b.t():b},bb:function(b,c,d){var h;c&&("object"===typeof b.classList?(h=b.classList[d?"add":"remove"],a.a.q(c.match(r),function(a){h.call(b.classList,a)})):"string"===typeof b.className.baseVal?e(b.className,"baseVal",c,d):e(b,"className",c,d))},Za:function(b,c){var d=a.a.c(c);if(null===d||d===n)d="";var e=a.f.firstChild(b);!e||3!=e.nodeType||a.f.nextSibling(e)?a.f.da(b,[b.ownerDocument.createTextNode(d)]):e.data=d;a.a.Rc(b)},rc:function(a,b){a.name=b;if(7>=h)try{a.mergeAttributes(u.createElement("<input name='"+
a.name+"'/>"),!1)}catch(c){}},Rc:function(a){9<=h&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},Nc:function(a){if(h){var b=a.style.width;a.style.width=0;a.style.width=b}},hd:function(b,c){b=a.a.c(b);c=a.a.c(c);for(var d=[],e=b;e<=c;e++)d.push(e);return d},V:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b},Yb:function(a){return g?Symbol(a):a},rd:6===h,sd:7===h,C:h,ec:function(b,c){for(var d=a.a.V(b.getElementsByTagName("input")).concat(a.a.V(b.getElementsByTagName("textarea"))),
e="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)},h=[],m=d.length-1;0<=m;m--)e(d[m])&&h.push(d[m]);return h},ed:function(b){return"string"==typeof b&&(b=a.a.$a(b))?F&&F.parse?F.parse(b):(new Function("return "+b))():null},Eb:function(b,c,d){if(!F||!F.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");
return F.stringify(a.a.c(b),c,d)},fd:function(c,d,e){e=e||{};var h=e.params||{},m=e.includeFields||this.cc,l=c;if("object"==typeof c&&"form"===a.a.A(c))for(var l=c.action,f=m.length-1;0<=f;f--)for(var g=a.a.ec(c,m[f]),k=g.length-1;0<=k;k--)h[g[k].name]=g[k].value;d=a.a.c(d);var r=u.createElement("form");r.style.display="none";r.action=l;r.method="post";for(var n in d)c=u.createElement("input"),c.type="hidden",c.name=n,c.value=a.a.Eb(a.a.c(d[n])),r.appendChild(c);b(h,function(a,b){var c=u.createElement("input");
c.type="hidden";c.name=a;c.value=b;r.appendChild(c)});u.body.appendChild(r);e.submitter?e.submitter(r):r.submit();setTimeout(function(){r.parentNode.removeChild(r)},0)}}}();a.b("utils",a.a);a.b("utils.arrayForEach",a.a.q);a.b("utils.arrayFirst",a.a.Sb);a.b("utils.arrayFilter",a.a.Ka);a.b("utils.arrayGetDistinctValues",a.a.Tb);a.b("utils.arrayIndexOf",a.a.o);a.b("utils.arrayMap",a.a.fb);a.b("utils.arrayPushAll",a.a.ra);a.b("utils.arrayRemoveItem",a.a.La);a.b("utils.extend",a.a.extend);a.b("utils.fieldsIncludedWithJsonPost",
a.a.cc);a.b("utils.getFormFields",a.a.ec);a.b("utils.peekObservable",a.a.zb);a.b("utils.postJson",a.a.fd);a.b("utils.parseJson",a.a.ed);a.b("utils.registerEventHandler",a.a.p);a.b("utils.stringifyJson",a.a.Eb);a.b("utils.range",a.a.hd);a.b("utils.toggleDomNodeCssClass",a.a.bb);a.b("utils.triggerEvent",a.a.Da);a.b("utils.unwrapObservable",a.a.c);a.b("utils.objectForEach",a.a.D);a.b("utils.addOrRemoveItem",a.a.pa);a.b("utils.setTextContent",a.a.Za);a.b("unwrap",a.a.c);Function.prototype.bind||(Function.prototype.bind=
function(a){var c=this;if(1===arguments.length)return function(){return c.apply(a,arguments)};var d=Array.prototype.slice.call(arguments,1);return function(){var e=d.slice(0);e.push.apply(e,arguments);return c.apply(a,e)}});a.a.e=new function(){function a(b,g){var k=b[d];if(!k||"null"===k||!e[k]){if(!g)return n;k=b[d]="ko"+c++;e[k]={}}return e[k]}var c=0,d="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===n?n:e[d]},set:function(c,d,e){if(e!==n||a(c,!1)!==n)a(c,!0)[d]=
e},clear:function(a){var b=a[d];return b?(delete e[b],a[d]=null,!0):!1},I:function(){return c++ +d}}};a.b("utils.domData",a.a.e);a.b("utils.domData.clear",a.a.e.clear);a.a.F=new function(){function b(b,c){var e=a.a.e.get(b,d);e===n&&c&&(e=[],a.a.e.set(b,d,e));return e}function c(d){var e=b(d,!1);if(e)for(var e=e.slice(0),l=0;l<e.length;l++)e[l](d);a.a.e.clear(d);a.a.F.cleanExternalData(d);if(f[d.nodeType])for(e=d.firstChild;d=e;)e=d.nextSibling,8===d.nodeType&&c(d)}var d=a.a.e.I(),e={1:!0,8:!0,9:!0},
f={1:!0,9:!0};return{oa:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},pc:function(c,e){var l=b(c,!1);l&&(a.a.La(l,e),0==l.length&&a.a.e.set(c,d,n))},$:function(b){if(e[b.nodeType]&&(c(b),f[b.nodeType])){var d=[];a.a.ra(d,b.getElementsByTagName("*"));for(var l=0,m=d.length;l<m;l++)c(d[l])}return b},removeNode:function(b){a.$(b);b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){v&&"function"==typeof v.cleanData&&v.cleanData([a])}}};
a.$=a.a.F.$;a.removeNode=a.a.F.removeNode;a.b("cleanNode",a.$);a.b("removeNode",a.removeNode);a.b("utils.domNodeDisposal",a.a.F);a.b("utils.domNodeDisposal.addDisposeCallback",a.a.F.oa);a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.F.pc);(function(){var b=[0,"",""],c=[1,"<table>","</table>"],d=[3,"<table><tbody><tr>","</tr></tbody></table>"],e=[1,"<select multiple='multiple'>","</select>"],f={thead:c,tbody:c,tfoot:c,tr:[2,"<table><tbody>","</tbody></table>"],td:d,th:d,option:e,optgroup:e},
g=8>=a.a.C;a.a.ma=function(c,d){var e;if(v)if(v.parseHTML)e=v.parseHTML(c,d)||[];else{if((e=v.clean([c],d))&&e[0]){for(var h=e[0];h.parentNode&&11!==h.parentNode.nodeType;)h=h.parentNode;h.parentNode&&h.parentNode.removeChild(h)}}else{(e=d)||(e=u);var h=e.parentWindow||e.defaultView||x,r=a.a.$a(c).toLowerCase(),q=e.createElement("div"),p;p=(r=r.match(/^<([a-z]+)[ >]/))&&f[r[1]]||b;r=p[0];p="ignored<div>"+p[1]+c+p[2]+"</div>";"function"==typeof h.innerShiv?q.appendChild(h.innerShiv(p)):(g&&e.appendChild(q),
q.innerHTML=p,g&&q.parentNode.removeChild(q));for(;r--;)q=q.lastChild;e=a.a.V(q.lastChild.childNodes)}return e};a.a.Cb=function(b,c){a.a.ob(b);c=a.a.c(c);if(null!==c&&c!==n)if("string"!=typeof c&&(c=c.toString()),v)v(b).html(c);else for(var d=a.a.ma(c,b.ownerDocument),e=0;e<d.length;e++)b.appendChild(d[e])}})();a.b("utils.parseHtmlFragment",a.a.ma);a.b("utils.setHtml",a.a.Cb);a.M=function(){function b(c,e){if(c)if(8==c.nodeType){var f=a.M.lc(c.nodeValue);null!=f&&e.push({Lc:c,cd:f})}else if(1==c.nodeType)for(var f=
0,g=c.childNodes,k=g.length;f<k;f++)b(g[f],e)}var c={};return{wb:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);c[b]=a;return"\x3c!--[ko_memo:"+b+"]--\x3e"},xc:function(a,b){var f=c[a];if(f===n)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return f.apply(null,b||[]),
!0}finally{delete c[a]}},yc:function(c,e){var f=[];b(c,f);for(var g=0,k=f.length;g<k;g++){var l=f[g].Lc,m=[l];e&&a.a.ra(m,e);a.M.xc(f[g].cd,m);l.nodeValue="";l.parentNode&&l.parentNode.removeChild(l)}},lc:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}();a.b("memoization",a.M);a.b("memoization.memoize",a.M.wb);a.b("memoization.unmemoize",a.M.xc);a.b("memoization.parseMemoText",a.M.lc);a.b("memoization.unmemoizeDomNodeAndDescendants",a.M.yc);a.Y=function(){function b(){if(e)for(var b=
e,c=0,m;g<e;)if(m=d[g++]){if(g>b){if(5E3<=++c){g=e;a.a.$b(Error("'Too much recursion' after processing "+c+" task groups."));break}b=e}try{m()}catch(h){a.a.$b(h)}}}function c(){b();g=e=d.length=0}var d=[],e=0,f=1,g=0;return{scheduler:x.MutationObserver?function(a){var b=u.createElement("div");(new MutationObserver(a)).observe(b,{attributes:!0});return function(){b.classList.toggle("foo")}}(c):u&&"onreadystatechange"in u.createElement("script")?function(a){var b=u.createElement("script");b.onreadystatechange=
function(){b.onreadystatechange=null;u.documentElement.removeChild(b);b=null;a()};u.documentElement.appendChild(b)}:function(a){setTimeout(a,0)},Wa:function(b){e||a.Y.scheduler(c);d[e++]=b;return f++},cancel:function(a){a-=f-e;a>=g&&a<e&&(d[a]=null)},resetForTesting:function(){var a=e-g;g=e=d.length=0;return a},md:b}}();a.b("tasks",a.Y);a.b("tasks.schedule",a.Y.Wa);a.b("tasks.runEarly",a.Y.md);a.ya={throttle:function(b,c){b.throttleEvaluation=c;var d=null;return a.B({read:b,write:function(e){clearTimeout(d);
d=a.a.setTimeout(function(){b(e)},c)}})},rateLimit:function(a,c){var d,e,f;"number"==typeof c?d=c:(d=c.timeout,e=c.method);a.cb=!1;f="notifyWhenChangesStop"==e?V:U;a.Ta(function(a){return f(a,d)})},deferred:function(b,c){if(!0!==c)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");b.cb||(b.cb=!0,b.Ta(function(c){var e;return function(){a.Y.cancel(e);e=a.Y.Wa(c);b.notifySubscribers(n,"dirty")}}))},notify:function(a,c){a.equalityComparer=
"always"==c?null:J}};var T={undefined:1,"boolean":1,number:1,string:1};a.b("extenders",a.ya);a.vc=function(b,c,d){this.ia=b;this.gb=c;this.Kc=d;this.R=!1;a.G(this,"dispose",this.k)};a.vc.prototype.k=function(){this.R=!0;this.Kc()};a.J=function(){a.a.Ya(this,D);D.rb(this)};var I="change",D={rb:function(a){a.K={};a.Nb=1},X:function(b,c,d){var e=this;d=d||I;var f=new a.vc(e,c?b.bind(c):b,function(){a.a.La(e.K[d],f);e.Ia&&e.Ia(d)});e.sa&&e.sa(d);e.K[d]||(e.K[d]=[]);e.K[d].push(f);return f},notifySubscribers:function(b,
c){c=c||I;c===I&&this.zc();if(this.Pa(c))try{a.l.Ub();for(var d=this.K[c].slice(0),e=0,f;f=d[e];++e)f.R||f.gb(b)}finally{a.l.end()}},Na:function(){return this.Nb},Uc:function(a){return this.Na()!==a},zc:function(){++this.Nb},Ta:function(b){var c=this,d=a.H(c),e,f,g;c.Ha||(c.Ha=c.notifySubscribers,c.notifySubscribers=W);var k=b(function(){c.Mb=!1;d&&g===c&&(g=c());e=!1;c.tb(f,g)&&c.Ha(f=g)});c.Lb=function(a){c.Mb=e=!0;g=a;k()};c.Kb=function(a){e||(f=a,c.Ha(a,"beforeChange"))}},Pa:function(a){return this.K[a]&&
this.K[a].length},Sc:function(b){if(b)return this.K[b]&&this.K[b].length||0;var c=0;a.a.D(this.K,function(a,b){"dirty"!==a&&(c+=b.length)});return c},tb:function(a,c){return!this.equalityComparer||!this.equalityComparer(a,c)},extend:function(b){var c=this;b&&a.a.D(b,function(b,e){var f=a.ya[b];"function"==typeof f&&(c=f(c,e)||c)});return c}};a.G(D,"subscribe",D.X);a.G(D,"extend",D.extend);a.G(D,"getSubscriptionsCount",D.Sc);a.a.ka&&a.a.Xa(D,Function.prototype);a.J.fn=D;a.hc=function(a){return null!=
a&&"function"==typeof a.X&&"function"==typeof a.notifySubscribers};a.b("subscribable",a.J);a.b("isSubscribable",a.hc);a.va=a.l=function(){function b(a){d.push(e);e=a}function c(){e=d.pop()}var d=[],e,f=0;return{Ub:b,end:c,oc:function(b){if(e){if(!a.hc(b))throw Error("Only subscribable things can act as dependencies");e.gb.call(e.Gc,b,b.Cc||(b.Cc=++f))}},w:function(a,d,e){try{return b(),a.apply(d,e||[])}finally{c()}},Aa:function(){if(e)return e.m.Aa()},Sa:function(){if(e)return e.Sa}}}();a.b("computedContext",
a.va);a.b("computedContext.getDependenciesCount",a.va.Aa);a.b("computedContext.isInitial",a.va.Sa);a.b("ignoreDependencies",a.qd=a.l.w);var E=a.a.Yb("_latestValue");a.N=function(b){function c(){if(0<arguments.length)return c.tb(c[E],arguments[0])&&(c.ga(),c[E]=arguments[0],c.fa()),this;a.l.oc(c);return c[E]}c[E]=b;a.a.ka||a.a.extend(c,a.J.fn);a.J.fn.rb(c);a.a.Ya(c,B);a.options.deferUpdates&&a.ya.deferred(c,!0);return c};var B={equalityComparer:J,t:function(){return this[E]},fa:function(){this.notifySubscribers(this[E])},
ga:function(){this.notifySubscribers(this[E],"beforeChange")}};a.a.ka&&a.a.Xa(B,a.J.fn);var H=a.N.gd="__ko_proto__";B[H]=a.N;a.Oa=function(b,c){return null===b||b===n||b[H]===n?!1:b[H]===c?!0:a.Oa(b[H],c)};a.H=function(b){return a.Oa(b,a.N)};a.Ba=function(b){return"function"==typeof b&&b[H]===a.N||"function"==typeof b&&b[H]===a.B&&b.Vc?!0:!1};a.b("observable",a.N);a.b("isObservable",a.H);a.b("isWriteableObservable",a.Ba);a.b("isWritableObservable",a.Ba);a.b("observable.fn",B);a.G(B,"peek",B.t);a.G(B,
"valueHasMutated",B.fa);a.G(B,"valueWillMutate",B.ga);a.la=function(b){b=b||[];if("object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");b=a.N(b);a.a.Ya(b,a.la.fn);return b.extend({trackArrayChanges:!0})};a.la.fn={remove:function(b){for(var c=this.t(),d=[],e="function"!=typeof b||a.H(b)?function(a){return a===b}:b,f=0;f<c.length;f++){var g=c[f];e(g)&&(0===d.length&&this.ga(),d.push(g),c.splice(f,1),f--)}d.length&&
this.fa();return d},removeAll:function(b){if(b===n){var c=this.t(),d=c.slice(0);this.ga();c.splice(0,c.length);this.fa();return d}return b?this.remove(function(c){return 0<=a.a.o(b,c)}):[]},destroy:function(b){var c=this.t(),d="function"!=typeof b||a.H(b)?function(a){return a===b}:b;this.ga();for(var e=c.length-1;0<=e;e--)d(c[e])&&(c[e]._destroy=!0);this.fa()},destroyAll:function(b){return b===n?this.destroy(function(){return!0}):b?this.destroy(function(c){return 0<=a.a.o(b,c)}):[]},indexOf:function(b){var c=
this();return a.a.o(c,b)},replace:function(a,c){var d=this.indexOf(a);0<=d&&(this.ga(),this.t()[d]=c,this.fa())}};a.a.ka&&a.a.Xa(a.la.fn,a.N.fn);a.a.q("pop push reverse shift sort splice unshift".split(" "),function(b){a.la.fn[b]=function(){var a=this.t();this.ga();this.Vb(a,b,arguments);var d=a[b].apply(a,arguments);this.fa();return d===a?this:d}});a.a.q(["slice"],function(b){a.la.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}});a.b("observableArray",a.la);a.ya.trackArrayChanges=function(b,
c){function d(){if(!e){e=!0;var c=b.notifySubscribers;b.notifySubscribers=function(a,b){b&&b!==I||++k;return c.apply(this,arguments)};var d=[].concat(b.t()||[]);f=null;g=b.X(function(c){c=[].concat(c||[]);if(b.Pa("arrayChange")){var e;if(!f||1<k)f=a.a.ib(d,c,b.hb);e=f}d=c;f=null;k=0;e&&e.length&&b.notifySubscribers(e,"arrayChange")})}}b.hb={};c&&"object"==typeof c&&a.a.extend(b.hb,c);b.hb.sparse=!0;if(!b.Vb){var e=!1,f=null,g,k=0,l=b.sa,m=b.Ia;b.sa=function(a){l&&l.call(b,a);"arrayChange"===a&&d()};
b.Ia=function(a){m&&m.call(b,a);"arrayChange"!==a||b.Pa("arrayChange")||(g.k(),e=!1)};b.Vb=function(b,c,d){function m(a,b,c){return l[l.length]={status:a,value:b,index:c}}if(e&&!k){var l=[],g=b.length,t=d.length,G=0;switch(c){case "push":G=g;case "unshift":for(c=0;c<t;c++)m("added",d[c],G+c);break;case "pop":G=g-1;case "shift":g&&m("deleted",b[G],G);break;case "splice":c=Math.min(Math.max(0,0>d[0]?g+d[0]:d[0]),g);for(var g=1===t?g:Math.min(c+(d[1]||0),g),t=c+t-2,G=Math.max(g,t),P=[],n=[],Q=2;c<G;++c,
++Q)c<g&&n.push(m("deleted",b[c],c)),c<t&&P.push(m("added",d[Q],c));a.a.dc(n,P);break;default:return}f=l}}}};var s=a.a.Yb("_state");a.m=a.B=function(b,c,d){function e(){if(0<arguments.length){if("function"===typeof f)f.apply(g.pb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}a.l.oc(e);(g.S||g.s&&e.Qa())&&e.aa();return g.T}"object"===typeof b?d=b:(d=d||{},b&&(d.read=
b));if("function"!=typeof d.read)throw Error("Pass a function that returns the value of the ko.computed");var f=d.write,g={T:n,S:!0,Ra:!1,Fb:!1,R:!1,Va:!1,s:!1,jd:d.read,pb:c||d.owner,i:d.disposeWhenNodeIsRemoved||d.i||null,wa:d.disposeWhen||d.wa,mb:null,r:{},L:0,bc:null};e[s]=g;e.Vc="function"===typeof f;a.a.ka||a.a.extend(e,a.J.fn);a.J.fn.rb(e);a.a.Ya(e,z);d.pure?(g.Va=!0,g.s=!0,a.a.extend(e,$)):d.deferEvaluation&&a.a.extend(e,aa);a.options.deferUpdates&&a.ya.deferred(e,!0);g.i&&(g.Fb=!0,g.i.nodeType||
(g.i=null));g.s||d.deferEvaluation||e.aa();g.i&&e.ba()&&a.a.F.oa(g.i,g.mb=function(){e.k()});return e};var z={equalityComparer:J,Aa:function(){return this[s].L},Pb:function(a,c,d){if(this[s].Va&&c===this)throw Error("A 'pure' computed must not be called recursively");this[s].r[a]=d;d.Ga=this[s].L++;d.na=c.Na()},Qa:function(){var a,c,d=this[s].r;for(a in d)if(d.hasOwnProperty(a)&&(c=d[a],c.ia.Uc(c.na)))return!0},bd:function(){this.Fa&&!this[s].Ra&&this.Fa()},ba:function(){return this[s].S||0<this[s].L},
ld:function(){this.Mb||this.ac()},uc:function(a){if(a.cb&&!this[s].i){var c=a.X(this.bd,this,"dirty"),d=a.X(this.ld,this);return{ia:a,k:function(){c.k();d.k()}}}return a.X(this.ac,this)},ac:function(){var b=this,c=b.throttleEvaluation;c&&0<=c?(clearTimeout(this[s].bc),this[s].bc=a.a.setTimeout(function(){b.aa(!0)},c)):b.Fa?b.Fa():b.aa(!0)},aa:function(b){var c=this[s],d=c.wa;if(!c.Ra&&!c.R){if(c.i&&!a.a.nb(c.i)||d&&d()){if(!c.Fb){this.k();return}}else c.Fb=!1;c.Ra=!0;try{this.Qc(b)}finally{c.Ra=!1}c.L||
this.k()}},Qc:function(b){var c=this[s],d=c.Va?n:!c.L,e={Hc:this,Ma:c.r,lb:c.L};a.l.Ub({Gc:e,gb:Y,m:this,Sa:d});c.r={};c.L=0;e=this.Pc(c,e);this.tb(c.T,e)&&(c.s||this.notifySubscribers(c.T,"beforeChange"),c.T=e,c.s?this.zc():b&&this.notifySubscribers(c.T));d&&this.notifySubscribers(c.T,"awake")},Pc:function(b,c){try{var d=b.jd;return b.pb?d.call(b.pb):d()}finally{a.l.end(),c.lb&&!b.s&&a.a.D(c.Ma,X),b.S=!1}},t:function(){var a=this[s];(a.S&&!a.L||a.s&&this.Qa())&&this.aa();return a.T},Ta:function(b){a.J.fn.Ta.call(this,
b);this.Fa=function(){this.Kb(this[s].T);this[s].S=!0;this.Lb(this)}},k:function(){var b=this[s];!b.s&&b.r&&a.a.D(b.r,function(a,b){b.k&&b.k()});b.i&&b.mb&&a.a.F.pc(b.i,b.mb);b.r=null;b.L=0;b.R=!0;b.S=!1;b.s=!1;b.i=null}},$={sa:function(b){var c=this,d=c[s];if(!d.R&&d.s&&"change"==b){d.s=!1;if(d.S||c.Qa())d.r=null,d.L=0,d.S=!0,c.aa();else{var e=[];a.a.D(d.r,function(a,b){e[b.Ga]=a});a.a.q(e,function(a,b){var e=d.r[a],l=c.uc(e.ia);l.Ga=b;l.na=e.na;d.r[a]=l})}d.R||c.notifySubscribers(d.T,"awake")}},
Ia:function(b){var c=this[s];c.R||"change"!=b||this.Pa("change")||(a.a.D(c.r,function(a,b){b.k&&(c.r[a]={ia:b.ia,Ga:b.Ga,na:b.na},b.k())}),c.s=!0,this.notifySubscribers(n,"asleep"))},Na:function(){var b=this[s];b.s&&(b.S||this.Qa())&&this.aa();return a.J.fn.Na.call(this)}},aa={sa:function(a){"change"!=a&&"beforeChange"!=a||this.t()}};a.a.ka&&a.a.Xa(z,a.J.fn);var R=a.N.gd;a.m[R]=a.N;z[R]=a.m;a.Xc=function(b){return a.Oa(b,a.m)};a.Yc=function(b){return a.Oa(b,a.m)&&b[s]&&b[s].Va};a.b("computed",a.m);
a.b("dependentObservable",a.m);a.b("isComputed",a.Xc);a.b("isPureComputed",a.Yc);a.b("computed.fn",z);a.G(z,"peek",z.t);a.G(z,"dispose",z.k);a.G(z,"isActive",z.ba);a.G(z,"getDependenciesCount",z.Aa);a.nc=function(b,c){if("function"===typeof b)return a.m(b,c,{pure:!0});b=a.a.extend({},b);b.pure=!0;return a.m(b,c)};a.b("pureComputed",a.nc);(function(){function b(a,f,g){g=g||new d;a=f(a);if("object"!=typeof a||null===a||a===n||a instanceof RegExp||a instanceof Date||a instanceof String||a instanceof
Number||a instanceof Boolean)return a;var k=a instanceof Array?[]:{};g.save(a,k);c(a,function(c){var d=f(a[c]);switch(typeof d){case "boolean":case "number":case "string":case "function":k[c]=d;break;case "object":case "undefined":var h=g.get(d);k[c]=h!==n?h:b(d,f,g)}});return k}function c(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function d(){this.keys=[];this.Ib=[]}a.wc=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");
return b(c,function(b){for(var c=0;a.H(b)&&10>c;c++)b=b();return b})};a.toJSON=function(b,c,d){b=a.wc(b);return a.a.Eb(b,c,d)};d.prototype={save:function(b,c){var d=a.a.o(this.keys,b);0<=d?this.Ib[d]=c:(this.keys.push(b),this.Ib.push(c))},get:function(b){b=a.a.o(this.keys,b);return 0<=b?this.Ib[b]:n}}})();a.b("toJS",a.wc);a.b("toJSON",a.toJSON);(function(){a.j={u:function(b){switch(a.a.A(b)){case "option":return!0===b.__ko__hasDomDataOptionValue__?a.a.e.get(b,a.d.options.xb):7>=a.a.C?b.getAttributeNode("value")&&
b.getAttributeNode("value").specified?b.value:b.text:b.value;case "select":return 0<=b.selectedIndex?a.j.u(b.options[b.selectedIndex]):n;default:return b.value}},ha:function(b,c,d){switch(a.a.A(b)){case "option":switch(typeof c){case "string":a.a.e.set(b,a.d.options.xb,n);"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__;b.value=c;break;default:a.a.e.set(b,a.d.options.xb,c),b.__ko__hasDomDataOptionValue__=!0,b.value="number"===typeof c?c:""}break;case "select":if(""===c||
null===c)c=n;for(var e=-1,f=0,g=b.options.length,k;f<g;++f)if(k=a.j.u(b.options[f]),k==c||""==k&&c===n){e=f;break}if(d||0<=e||c===n&&1<b.size)b.selectedIndex=e;break;default:if(null===c||c===n)c="";b.value=c}}}})();a.b("selectExtensions",a.j);a.b("selectExtensions.readValue",a.j.u);a.b("selectExtensions.writeValue",a.j.ha);a.h=function(){function b(b){b=a.a.$a(b);123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c=[],d=b.match(e),r,k=[],p=0;if(d){d.push(",");for(var A=0,y;y=d[A];++A){var t=y.charCodeAt(0);
if(44===t){if(0>=p){c.push(r&&k.length?{key:r,value:k.join("")}:{unknown:r||k.join("")});r=p=0;k=[];continue}}else if(58===t){if(!p&&!r&&1===k.length){r=k.pop();continue}}else 47===t&&A&&1<y.length?(t=d[A-1].match(f))&&!g[t[0]]&&(b=b.substr(b.indexOf(y)+1),d=b.match(e),d.push(","),A=-1,y="/"):40===t||123===t||91===t?++p:41===t||125===t||93===t?--p:r||k.length||34!==t&&39!==t||(y=y.slice(1,-1));k.push(y)}}return c}var c=["true","false","null","undefined"],d=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,
e=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,g={"in":1,"return":1,"typeof":1},k={};return{ta:[],ea:k,yb:b,Ua:function(e,m){function h(b,e){var m;if(!A){var l=a.getBindingHandler(b);if(l&&l.preprocess&&!(e=l.preprocess(e,b,h)))return;if(l=k[b])m=e,0<=a.a.o(c,m)?m=!1:(l=m.match(d),m=null===l?!1:l[1]?"Object("+l[1]+")"+l[2]:m),l=m;l&&g.push("'"+b+"':function(_z){"+m+"=_z}")}p&&(e=
"function(){return "+e+" }");f.push("'"+b+"':"+e)}m=m||{};var f=[],g=[],p=m.valueAccessors,A=m.bindingParams,y="string"===typeof e?b(e):e;a.a.q(y,function(a){h(a.key||a.unknown,a.value)});g.length&&h("_ko_property_writers","{"+g.join(",")+" }");return f.join(",")},ad:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},Ea:function(b,c,d,e,f){if(b&&a.H(b))!a.Ba(b)||f&&b.t()===e||b(e);else if((b=c.get("_ko_property_writers"))&&b[d])b[d](e)}}}();a.b("expressionRewriting",a.h);a.b("expressionRewriting.bindingRewriteValidators",
a.h.ta);a.b("expressionRewriting.parseObjectLiteral",a.h.yb);a.b("expressionRewriting.preProcessBindings",a.h.Ua);a.b("expressionRewriting._twoWayBindings",a.h.ea);a.b("jsonExpressionRewriting",a.h);a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.Ua);(function(){function b(a){return 8==a.nodeType&&g.test(f?a.text:a.nodeValue)}function c(a){return 8==a.nodeType&&k.test(f?a.text:a.nodeValue)}function d(a,d){for(var e=a,f=1,l=[];e=e.nextSibling;){if(c(e)&&(f--,0===f))return l;l.push(e);
b(e)&&f++}if(!d)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function e(a,b){var c=d(a,b);return c?0<c.length?c[c.length-1].nextSibling:a.nextSibling:null}var f=u&&"\x3c!--test--\x3e"===u.createComment("test").text,g=f?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,k=f?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0};a.f={Z:{},childNodes:function(a){return b(a)?d(a):a.childNodes},xa:function(c){if(b(c)){c=a.f.childNodes(c);for(var d=
0,e=c.length;d<e;d++)a.removeNode(c[d])}else a.a.ob(c)},da:function(c,d){if(b(c)){a.f.xa(c);for(var e=c.nextSibling,f=0,l=d.length;f<l;f++)e.parentNode.insertBefore(d[f],e)}else a.a.da(c,d)},mc:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},gc:function(c,d,e){e?b(c)?c.parentNode.insertBefore(d,e.nextSibling):e.nextSibling?c.insertBefore(d,e.nextSibling):c.appendChild(d):a.f.mc(c,d)},firstChild:function(a){return b(a)?!a.nextSibling||
c(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){b(a)&&(a=e(a));return a.nextSibling&&c(a.nextSibling)?null:a.nextSibling},Tc:b,pd:function(a){return(a=(f?a.text:a.nodeValue).match(g))?a[1]:null},kc:function(d){if(l[a.a.A(d)]){var h=d.firstChild;if(h){do if(1===h.nodeType){var f;f=h.firstChild;var g=null;if(f){do if(g)g.push(f);else if(b(f)){var k=e(f,!0);k?f=k:g=[f]}else c(f)&&(g=[f]);while(f=f.nextSibling)}if(f=g)for(g=h.nextSibling,k=0;k<f.length;k++)g?d.insertBefore(f[k],
g):d.appendChild(f[k])}while(h=h.nextSibling)}}}}})();a.b("virtualElements",a.f);a.b("virtualElements.allowedBindings",a.f.Z);a.b("virtualElements.emptyNode",a.f.xa);a.b("virtualElements.insertAfter",a.f.gc);a.b("virtualElements.prepend",a.f.mc);a.b("virtualElements.setDomNodeChildren",a.f.da);(function(){a.Q=function(){this.Fc={}};a.a.extend(a.Q.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);case 8:return a.f.Tc(b);
default:return!1}},getBindings:function(b,c){var d=this.getBindingsString(b,c),d=d?this.parseBindingsString(d,c,b):null;return a.g.Ob(d,b,c,!1)},getBindingAccessors:function(b,c){var d=this.getBindingsString(b,c),d=d?this.parseBindingsString(d,c,b,{valueAccessors:!0}):null;return a.g.Ob(d,b,c,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.f.pd(b);default:return null}},parseBindingsString:function(b,c,d,e){try{var f=this.Fc,g=b+(e&&e.valueAccessors||
""),k;if(!(k=f[g])){var l,m="with($context){with($data||{}){return{"+a.h.Ua(b,e)+"}}}";l=new Function("$context","$element",m);k=f[g]=l}return k(c,d)}catch(h){throw h.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+h.message,h;}}});a.Q.instance=new a.Q})();a.b("bindingProvider",a.Q);(function(){function b(a){return function(){return a}}function c(a){return a()}function d(b){return a.a.Ca(a.l.w(b),function(a,c){return function(){return b()[c]}})}function e(c,e,h){return"function"===
typeof c?d(c.bind(null,e,h)):a.a.Ca(c,b)}function f(a,b){return d(this.getBindings.bind(this,a,b))}function g(b,c,d){var e,h=a.f.firstChild(c),f=a.Q.instance,m=f.preprocessNode;if(m){for(;e=h;)h=a.f.nextSibling(e),m.call(f,e);h=a.f.firstChild(c)}for(;e=h;)h=a.f.nextSibling(e),k(b,e,d)}function k(b,c,d){var e=!0,h=1===c.nodeType;h&&a.f.kc(c);if(h&&d||a.Q.instance.nodeHasBindings(c))e=m(c,null,b,d).shouldBindDescendants;e&&!r[a.a.A(c)]&&g(b,c,!h)}function l(b){var c=[],d={},e=[];a.a.D(b,function Z(h){if(!d[h]){var f=
a.getBindingHandler(h);f&&(f.after&&(e.push(h),a.a.q(f.after,function(c){if(b[c]){if(-1!==a.a.o(e,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+e.join(", "));Z(c)}}),e.length--),c.push({key:h,fc:f}));d[h]=!0}});return c}function m(b,d,e,h){var m=a.a.e.get(b,q);if(!d){if(m)throw Error("You cannot apply bindings multiple times to the same element.");a.a.e.set(b,q,!0)}!m&&h&&a.tc(b,e);var g;if(d&&"function"!==typeof d)g=d;else{var k=a.Q.instance,r=k.getBindingAccessors||
f,p=a.B(function(){(g=d?d(e,b):r.call(k,b,e))&&e.P&&e.P();return g},null,{i:b});g&&p.ba()||(p=null)}var u;if(g){var v=p?function(a){return function(){return c(p()[a])}}:function(a){return g[a]},s=function(){return a.a.Ca(p?p():g,c)};s.get=function(a){return g[a]&&c(v(a))};s.has=function(a){return a in g};h=l(g);a.a.q(h,function(c){var d=c.fc.init,h=c.fc.update,f=c.key;if(8===b.nodeType&&!a.f.Z[f])throw Error("The binding '"+f+"' cannot be used with virtual elements");try{"function"==typeof d&&a.l.w(function(){var a=
d(b,v(f),s,e.$data,e);if(a&&a.controlsDescendantBindings){if(u!==n)throw Error("Multiple bindings ("+u+" and "+f+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");u=f}}),"function"==typeof h&&a.B(function(){h(b,v(f),s,e.$data,e)},null,{i:b})}catch(m){throw m.message='Unable to process binding "'+f+": "+g[f]+'"\nMessage: '+m.message,m;}})}return{shouldBindDescendants:u===n}}function h(b){return b&&b instanceof a.U?b:new a.U(b)}
a.d={};var r={script:!0,textarea:!0,template:!0};a.getBindingHandler=function(b){return a.d[b]};a.U=function(b,c,d,e){var h=this,f="function"==typeof b&&!a.H(b),m,g=a.B(function(){var m=f?b():b,l=a.a.c(m);c?(c.P&&c.P(),a.a.extend(h,c),g&&(h.P=g)):(h.$parents=[],h.$root=l,h.ko=a);h.$rawData=m;h.$data=l;d&&(h[d]=l);e&&e(h,c,l);return h.$data},null,{wa:function(){return m&&!a.a.Qb(m)},i:!0});g.ba()&&(h.P=g,g.equalityComparer=null,m=[],g.Ac=function(b){m.push(b);a.a.F.oa(b,function(b){a.a.La(m,b);m.length||
(g.k(),h.P=g=n)})})};a.U.prototype.createChildContext=function(b,c,d){return new a.U(b,this,c,function(a,b){a.$parentContext=b;a.$parent=b.$data;a.$parents=(b.$parents||[]).slice(0);a.$parents.unshift(a.$parent);d&&d(a)})};a.U.prototype.extend=function(b){return new a.U(this.P||this.$data,this,null,function(c,d){c.$rawData=d.$rawData;a.a.extend(c,"function"==typeof b?b():b)})};var q=a.a.e.I(),p=a.a.e.I();a.tc=function(b,c){if(2==arguments.length)a.a.e.set(b,p,c),c.P&&c.P.Ac(b);else return a.a.e.get(b,
p)};a.Ja=function(b,c,d){1===b.nodeType&&a.f.kc(b);return m(b,c,h(d),!0)};a.Dc=function(b,c,d){d=h(d);return a.Ja(b,e(c,d,b),d)};a.eb=function(a,b){1!==b.nodeType&&8!==b.nodeType||g(h(a),b,!0)};a.Rb=function(a,b){!v&&x.jQuery&&(v=x.jQuery);if(b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||x.document.body;k(h(a),b,!0)};a.kb=function(b){switch(b.nodeType){case 1:case 8:var c=a.tc(b);if(c)return c;
if(b.parentNode)return a.kb(b.parentNode)}return n};a.Jc=function(b){return(b=a.kb(b))?b.$data:n};a.b("bindingHandlers",a.d);a.b("applyBindings",a.Rb);a.b("applyBindingsToDescendants",a.eb);a.b("applyBindingAccessorsToNode",a.Ja);a.b("applyBindingsToNode",a.Dc);a.b("contextFor",a.kb);a.b("dataFor",a.Jc)})();(function(b){function c(c,e){var m=f.hasOwnProperty(c)?f[c]:b,h;m?m.X(e):(m=f[c]=new a.J,m.X(e),d(c,function(b,d){var e=!(!d||!d.synchronous);g[c]={definition:b,Zc:e};delete f[c];h||e?m.notifySubscribers(b):
a.Y.Wa(function(){m.notifySubscribers(b)})}),h=!0)}function d(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a,c)}):b(null,null)})}function e(c,d,f,h){h||(h=a.g.loaders.slice(0));var g=h.shift();if(g){var q=g[c];if(q){var p=!1;if(q.apply(g,d.concat(function(a){p?f(null):null!==a?f(a):e(c,d,f,h)}))!==b&&(p=!0,!g.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.");}else e(c,d,f,h)}else f(null)}
var f={},g={};a.g={get:function(d,e){var f=g.hasOwnProperty(d)?g[d]:b;f?f.Zc?a.l.w(function(){e(f.definition)}):a.Y.Wa(function(){e(f.definition)}):c(d,e)},Xb:function(a){delete g[a]},Jb:e};a.g.loaders=[];a.b("components",a.g);a.b("components.get",a.g.get);a.b("components.clearCachedDefinition",a.g.Xb)})();(function(){function b(b,c,d,e){function g(){0===--y&&e(k)}var k={},y=2,t=d.template;d=d.viewModel;t?f(c,t,function(c){a.g.Jb("loadTemplate",[b,c],function(a){k.template=a;g()})}):g();d?f(c,d,function(c){a.g.Jb("loadViewModel",
[b,c],function(a){k[l]=a;g()})}):g()}function c(a,b,d){if("function"===typeof b)d(function(a){return new b(a)});else if("function"===typeof b[l])d(b[l]);else if("instance"in b){var e=b.instance;d(function(){return e})}else"viewModel"in b?c(a,b.viewModel,d):a("Unknown viewModel value: "+b)}function d(b){switch(a.a.A(b)){case "script":return a.a.ma(b.text);case "textarea":return a.a.ma(b.value);case "template":if(e(b.content))return a.a.ua(b.content.childNodes)}return a.a.ua(b.childNodes)}function e(a){return x.DocumentFragment?
a instanceof DocumentFragment:a&&11===a.nodeType}function f(a,b,c){"string"===typeof b.require?O||x.require?(O||x.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function g(a){return function(b){throw Error("Component '"+a+"': "+b);}}var k={};a.g.register=function(b,c){if(!c)throw Error("Invalid configuration for "+b);if(a.g.ub(b))throw Error("Component "+b+" is already registered");k[b]=c};a.g.ub=function(a){return k.hasOwnProperty(a)};a.g.od=function(b){delete k[b];
a.g.Xb(b)};a.g.Zb={getConfig:function(a,b){b(k.hasOwnProperty(a)?k[a]:null)},loadComponent:function(a,c,d){var e=g(a);f(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,c,f){b=g(b);if("string"===typeof c)f(a.a.ma(c));else if(c instanceof Array)f(c);else if(e(c))f(a.a.V(c.childNodes));else if(c.element)if(c=c.element,x.HTMLElement?c instanceof HTMLElement:c&&c.tagName&&1===c.nodeType)f(d(c));else if("string"===typeof c){var l=u.getElementById(c);l?f(d(l)):b("Cannot find element with ID "+c)}else b("Unknown element type: "+
c);else b("Unknown template value: "+c)},loadViewModel:function(a,b,d){c(g(a),b,d)}};var l="createViewModel";a.b("components.register",a.g.register);a.b("components.isRegistered",a.g.ub);a.b("components.unregister",a.g.od);a.b("components.defaultLoader",a.g.Zb);a.g.loaders.push(a.g.Zb);a.g.Bc=k})();(function(){function b(b,e){var f=b.getAttribute("params");if(f){var f=c.parseBindingsString(f,e,b,{valueAccessors:!0,bindingParams:!0}),f=a.a.Ca(f,function(c){return a.m(c,null,{i:b})}),g=a.a.Ca(f,function(c){var e=
c.t();return c.ba()?a.m({read:function(){return a.a.c(c())},write:a.Ba(e)&&function(a){c()(a)},i:b}):e});g.hasOwnProperty("$raw")||(g.$raw=f);return g}return{$raw:{}}}a.g.getComponentNameForNode=function(b){var c=a.a.A(b);if(a.g.ub(c)&&(-1!=c.indexOf("-")||"[object HTMLUnknownElement]"==""+b||8>=a.a.C&&b.tagName===c))return c};a.g.Ob=function(c,e,f,g){if(1===e.nodeType){var k=a.g.getComponentNameForNode(e);if(k){c=c||{};if(c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');
var l={name:k,params:b(e,f)};c.component=g?function(){return l}:l}}return c};var c=new a.Q;9>a.a.C&&(a.g.register=function(a){return function(b){u.createElement(b);return a.apply(this,arguments)}}(a.g.register),u.createDocumentFragment=function(b){return function(){var c=b(),f=a.g.Bc,g;for(g in f)f.hasOwnProperty(g)&&c.createElement(g);return c}}(u.createDocumentFragment))})();(function(b){function c(b,c,d){c=c.template;if(!c)throw Error("Component '"+b+"' has no template");b=a.a.ua(c);a.f.da(d,b)}
function d(a,b,c,d){var e=a.createViewModel;return e?e.call(a,d,{element:b,templateNodes:c}):d}var e=0;a.d.component={init:function(f,g,k,l,m){function h(){var a=r&&r.dispose;"function"===typeof a&&a.call(r);q=r=null}var r,q,p=a.a.V(a.f.childNodes(f));a.a.F.oa(f,h);a.m(function(){var l=a.a.c(g()),k,t;"string"===typeof l?k=l:(k=a.a.c(l.name),t=a.a.c(l.params));if(!k)throw Error("No component name specified");var n=q=++e;a.g.get(k,function(e){if(q===n){h();if(!e)throw Error("Unknown component '"+k+
"'");c(k,e,f);var g=d(e,f,p,t);e=m.createChildContext(g,b,function(a){a.$component=g;a.$componentTemplateNodes=p});r=g;a.eb(e,f)}})},null,{i:f});return{controlsDescendantBindings:!0}}};a.f.Z.component=!0})();var S={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,c){var d=a.a.c(c())||{};a.a.D(d,function(c,d){d=a.a.c(d);var g=!1===d||null===d||d===n;g&&b.removeAttribute(c);8>=a.a.C&&c in S?(c=S[c],g?b.removeAttribute(c):b[c]=d):g||b.setAttribute(c,d.toString());"name"===c&&a.a.rc(b,
g?"":d.toString())})}};(function(){a.d.checked={after:["value","attr"],init:function(b,c,d){function e(){var e=b.checked,f=p?g():e;if(!a.va.Sa()&&(!l||e)){var m=a.l.w(c);if(h){var k=r?m.t():m;q!==f?(e&&(a.a.pa(k,f,!0),a.a.pa(k,q,!1)),q=f):a.a.pa(k,f,e);r&&a.Ba(m)&&m(k)}else a.h.Ea(m,d,"checked",f,!0)}}function f(){var d=a.a.c(c());b.checked=h?0<=a.a.o(d,g()):k?d:g()===d}var g=a.nc(function(){return d.has("checkedValue")?a.a.c(d.get("checkedValue")):d.has("value")?a.a.c(d.get("value")):b.value}),k=
"checkbox"==b.type,l="radio"==b.type;if(k||l){var m=c(),h=k&&a.a.c(m)instanceof Array,r=!(h&&m.push&&m.splice),q=h?g():n,p=l||h;l&&!b.name&&a.d.uniqueName.init(b,function(){return!0});a.m(e,null,{i:b});a.a.p(b,"click",e);a.m(f,null,{i:b});m=n}}};a.h.ea.checked=!0;a.d.checkedValue={update:function(b,c){b.value=a.a.c(c())}}})();a.d.css={update:function(b,c){var d=a.a.c(c());null!==d&&"object"==typeof d?a.a.D(d,function(c,d){d=a.a.c(d);a.a.bb(b,c,d)}):(d=a.a.$a(String(d||"")),a.a.bb(b,b.__ko__cssValue,
!1),b.__ko__cssValue=d,a.a.bb(b,d,!0))}};a.d.enable={update:function(b,c){var d=a.a.c(c());d&&b.disabled?b.removeAttribute("disabled"):d||b.disabled||(b.disabled=!0)}};a.d.disable={update:function(b,c){a.d.enable.update(b,function(){return!a.a.c(c())})}};a.d.event={init:function(b,c,d,e,f){var g=c()||{};a.a.D(g,function(g){"string"==typeof g&&a.a.p(b,g,function(b){var m,h=c()[g];if(h){try{var r=a.a.V(arguments);e=f.$data;r.unshift(e);m=h.apply(e,r)}finally{!0!==m&&(b.preventDefault?b.preventDefault():
b.returnValue=!1)}!1===d.get(g+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}};a.d.foreach={ic:function(b){return function(){var c=b(),d=a.a.zb(c);if(!d||"number"==typeof d.length)return{foreach:c,templateEngine:a.W.sb};a.a.c(c);return{foreach:d.data,as:d.as,includeDestroyed:d.includeDestroyed,afterAdd:d.afterAdd,beforeRemove:d.beforeRemove,afterRender:d.afterRender,beforeMove:d.beforeMove,afterMove:d.afterMove,templateEngine:a.W.sb}}},init:function(b,c){return a.d.template.init(b,
a.d.foreach.ic(c))},update:function(b,c,d,e,f){return a.d.template.update(b,a.d.foreach.ic(c),d,e,f)}};a.h.ta.foreach=!1;a.f.Z.foreach=!0;a.d.hasfocus={init:function(b,c,d){function e(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(h){g=f.body}e=g===b}f=c();a.h.Ea(f,d,"hasfocus",e,!0);b.__ko_hasfocusLastValue=e;b.__ko_hasfocusUpdating=!1}var f=e.bind(null,!0),g=e.bind(null,!1);a.a.p(b,"focus",f);a.a.p(b,"focusin",f);a.a.p(b,"blur",g);a.a.p(b,
"focusout",g)},update:function(b,c){var d=!!a.a.c(c());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===d||(d?b.focus():b.blur(),!d&&b.__ko_hasfocusLastValue&&b.ownerDocument.body.focus(),a.l.w(a.a.Da,null,[b,d?"focusin":"focusout"]))}};a.h.ea.hasfocus=!0;a.d.hasFocus=a.d.hasfocus;a.h.ea.hasFocus=!0;a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Cb(b,c())}};K("if");K("ifnot",!1,!0);K("with",!0,!1,function(a,c){return a.createChildContext(c)});var L={};
a.d.options={init:function(b){if("select"!==a.a.A(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,c,d){function e(){return a.a.Ka(b.options,function(a){return a.selected})}function f(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function g(c,e){if(A&&h)a.j.ha(b,a.a.c(d.get("value")),!0);else if(p.length){var f=0<=a.a.o(p,a.j.u(e[0]));a.a.sc(e[0],f);A&&!f&&a.l.w(a.a.Da,null,[b,
"change"])}}var k=b.multiple,l=0!=b.length&&k?b.scrollTop:null,m=a.a.c(c()),h=d.get("valueAllowUnset")&&d.has("value"),r=d.get("optionsIncludeDestroyed");c={};var q,p=[];h||(k?p=a.a.fb(e(),a.j.u):0<=b.selectedIndex&&p.push(a.j.u(b.options[b.selectedIndex])));m&&("undefined"==typeof m.length&&(m=[m]),q=a.a.Ka(m,function(b){return r||b===n||null===b||!a.a.c(b._destroy)}),d.has("optionsCaption")&&(m=a.a.c(d.get("optionsCaption")),null!==m&&m!==n&&q.unshift(L)));var A=!1;c.beforeRemove=function(a){b.removeChild(a)};
m=g;d.has("optionsAfterRender")&&"function"==typeof d.get("optionsAfterRender")&&(m=function(b,c){g(0,c);a.l.w(d.get("optionsAfterRender"),null,[c[0],b!==L?b:n])});a.a.Bb(b,q,function(c,e,g){g.length&&(p=!h&&g[0].selected?[a.j.u(g[0])]:[],A=!0);e=b.ownerDocument.createElement("option");c===L?(a.a.Za(e,d.get("optionsCaption")),a.j.ha(e,n)):(g=f(c,d.get("optionsValue"),c),a.j.ha(e,a.a.c(g)),c=f(c,d.get("optionsText"),g),a.a.Za(e,c));return[e]},c,m);a.l.w(function(){h?a.j.ha(b,a.a.c(d.get("value")),
!0):(k?p.length&&e().length<p.length:p.length&&0<=b.selectedIndex?a.j.u(b.options[b.selectedIndex])!==p[0]:p.length||0<=b.selectedIndex)&&a.a.Da(b,"change")});a.a.Nc(b);l&&20<Math.abs(l-b.scrollTop)&&(b.scrollTop=l)}};a.d.options.xb=a.a.e.I();a.d.selectedOptions={after:["options","foreach"],init:function(b,c,d){a.a.p(b,"change",function(){var e=c(),f=[];a.a.q(b.getElementsByTagName("option"),function(b){b.selected&&f.push(a.j.u(b))});a.h.Ea(e,d,"selectedOptions",f)})},update:function(b,c){if("select"!=
a.a.A(b))throw Error("values binding applies only to SELECT elements");var d=a.a.c(c()),e=b.scrollTop;d&&"number"==typeof d.length&&a.a.q(b.getElementsByTagName("option"),function(b){var c=0<=a.a.o(d,a.j.u(b));b.selected!=c&&a.a.sc(b,c)});b.scrollTop=e}};a.h.ea.selectedOptions=!0;a.d.style={update:function(b,c){var d=a.a.c(c()||{});a.a.D(d,function(c,d){d=a.a.c(d);if(null===d||d===n||!1===d)d="";b.style[c]=d})}};a.d.submit={init:function(b,c,d,e,f){if("function"!=typeof c())throw Error("The value for a submit binding must be a function");
a.a.p(b,"submit",function(a){var d,e=c();try{d=e.call(f.$data,b)}finally{!0!==d&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}};a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Za(b,c())}};a.f.Z.text=!0;(function(){if(x&&x.navigator)var b=function(a){if(a)return parseFloat(a[1])},c=x.opera&&x.opera.version&&parseInt(x.opera.version()),d=x.navigator.userAgent,e=b(d.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),f=b(d.match(/Firefox\/([^ ]*)/));
if(10>a.a.C)var g=a.a.e.I(),k=a.a.e.I(),l=function(b){var c=this.activeElement;(c=c&&a.a.e.get(c,k))&&c(b)},m=function(b,c){var d=b.ownerDocument;a.a.e.get(d,g)||(a.a.e.set(d,g,!0),a.a.p(d,"selectionchange",l));a.a.e.set(b,k,c)};a.d.textInput={init:function(b,d,g){function l(c,d){a.a.p(b,c,d)}function k(){var c=a.a.c(d());if(null===c||c===n)c="";v!==n&&c===v?a.a.setTimeout(k,4):b.value!==c&&(u=c,b.value=c)}function y(){s||(v=b.value,s=a.a.setTimeout(t,4))}function t(){clearTimeout(s);v=s=n;var c=
b.value;u!==c&&(u=c,a.h.Ea(d(),g,"textInput",c))}var u=b.value,s,v,x=9==a.a.C?y:t;10>a.a.C?(l("propertychange",function(a){"value"===a.propertyName&&x(a)}),8==a.a.C&&(l("keyup",t),l("keydown",t)),8<=a.a.C&&(m(b,x),l("dragend",y))):(l("input",t),5>e&&"textarea"===a.a.A(b)?(l("keydown",y),l("paste",y),l("cut",y)):11>c?l("keydown",y):4>f&&(l("DOMAutoComplete",t),l("dragdrop",t),l("drop",t)));l("change",t);a.m(k,null,{i:b})}};a.h.ea.textInput=!0;a.d.textinput={preprocess:function(a,b,c){c("textInput",
a)}}})();a.d.uniqueName={init:function(b,c){if(c()){var d="ko_unique_"+ ++a.d.uniqueName.Ic;a.a.rc(b,d)}}};a.d.uniqueName.Ic=0;a.d.value={after:["options","foreach"],init:function(b,c,d){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e=["change"],f=d.get("valueUpdate"),g=!1,k=null;f&&("string"==typeof f&&(f=[f]),a.a.ra(e,f),e=a.a.Tb(e));var l=function(){k=null;g=!1;var e=c(),f=a.j.u(b);a.h.Ea(e,d,"value",f)};!a.a.C||"input"!=b.tagName.toLowerCase()||"text"!=b.type||
"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.o(e,"propertychange")||(a.a.p(b,"propertychange",function(){g=!0}),a.a.p(b,"focus",function(){g=!1}),a.a.p(b,"blur",function(){g&&l()}));a.a.q(e,function(c){var d=l;a.a.nd(c,"after")&&(d=function(){k=a.j.u(b);a.a.setTimeout(l,0)},c=c.substring(5));a.a.p(b,c,d)});var m=function(){var e=a.a.c(c()),f=a.j.u(b);if(null!==k&&e===k)a.a.setTimeout(m,0);else if(e!==f)if("select"===a.a.A(b)){var g=d.get("valueAllowUnset"),f=function(){a.j.ha(b,
e,g)};f();g||e===a.j.u(b)?a.a.setTimeout(f,0):a.l.w(a.a.Da,null,[b,"change"])}else a.j.ha(b,e)};a.m(m,null,{i:b})}else a.Ja(b,{checkedValue:c})},update:function(){}};a.h.ea.value=!0;a.d.visible={update:function(b,c){var d=a.a.c(c()),e="none"!=b.style.display;d&&!e?b.style.display="":!d&&e&&(b.style.display="none")}};(function(b){a.d[b]={init:function(c,d,e,f,g){return a.d.event.init.call(this,c,function(){var a={};a[b]=d();return a},e,f,g)}}})("click");a.O=function(){};a.O.prototype.renderTemplateSource=
function(){throw Error("Override renderTemplateSource");};a.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};a.O.prototype.makeTemplateSource=function(b,c){if("string"==typeof b){c=c||u;var d=c.getElementById(b);if(!d)throw Error("Cannot find template with ID "+b);return new a.v.n(d)}if(1==b.nodeType||8==b.nodeType)return new a.v.qa(b);throw Error("Unknown template type: "+b);};a.O.prototype.renderTemplate=function(a,c,d,e){a=this.makeTemplateSource(a,
e);return this.renderTemplateSource(a,c,d,e)};a.O.prototype.isTemplateRewritten=function(a,c){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,c).data("isRewritten")};a.O.prototype.rewriteTemplate=function(a,c,d){a=this.makeTemplateSource(a,d);c=c(a.text());a.text(c);a.data("isRewritten",!0)};a.b("templateEngine",a.O);a.Gb=function(){function b(b,c,d,k){b=a.h.yb(b);for(var l=a.h.ta,m=0;m<b.length;m++){var h=b[m].key;if(l.hasOwnProperty(h)){var r=l[h];if("function"===typeof r){if(h=
r(b[m].value))throw Error(h);}else if(!r)throw Error("This template engine does not support the '"+h+"' binding within its templates");}}d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.Ua(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')";return k.createJavaScriptEvaluatorBlock(d)+c}var c=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,d=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Oc:function(b,
c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.Gb.dd(b,c)},d)},dd:function(a,f){return a.replace(c,function(a,c,d,e,h){return b(h,c,d,f)}).replace(d,function(a,c){return b(c,"\x3c!-- ko --\x3e","#comment",f)})},Ec:function(b,c){return a.M.wb(function(d,k){var l=d.nextSibling;l&&l.nodeName.toLowerCase()===c&&a.Ja(l,b,k)})}}}();a.b("__tr_ambtns",a.Gb.Ec);(function(){a.v={};a.v.n=function(b){if(this.n=b){var c=a.a.A(b);this.ab="script"===c?1:"textarea"===c?2:"template"==c&&
b.content&&11===b.content.nodeType?3:4}};a.v.n.prototype.text=function(){var b=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[b];var c=arguments[0];"innerHTML"===b?a.a.Cb(this.n,c):this.n[b]=c};var b=a.a.e.I()+"_";a.v.n.prototype.data=function(c){if(1===arguments.length)return a.a.e.get(this.n,b+c);a.a.e.set(this.n,b+c,arguments[1])};var c=a.a.e.I();a.v.n.prototype.nodes=function(){var b=this.n;if(0==arguments.length)return(a.a.e.get(b,c)||{}).jb||(3===this.ab?
b.content:4===this.ab?b:n);a.a.e.set(b,c,{jb:arguments[0]})};a.v.qa=function(a){this.n=a};a.v.qa.prototype=new a.v.n;a.v.qa.prototype.text=function(){if(0==arguments.length){var b=a.a.e.get(this.n,c)||{};b.Hb===n&&b.jb&&(b.Hb=b.jb.innerHTML);return b.Hb}a.a.e.set(this.n,c,{Hb:arguments[0]})};a.b("templateSources",a.v);a.b("templateSources.domElement",a.v.n);a.b("templateSources.anonymousTemplate",a.v.qa)})();(function(){function b(b,c,d){var e;for(c=a.f.nextSibling(c);b&&(e=b)!==c;)b=a.f.nextSibling(e),
d(e,b)}function c(c,d){if(c.length){var e=c[0],f=c[c.length-1],g=e.parentNode,k=a.Q.instance,n=k.preprocessNode;if(n){b(e,f,function(a,b){var c=a.previousSibling,d=n.call(k,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))});c.length=0;if(!e)return;e===f?c.push(e):(c.push(e,f),a.a.za(c,g))}b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.Rb(d,b)});b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.M.yc(b,[d])});a.a.za(c,g)}}function d(a){return a.nodeType?a:0<a.length?a[0]:null}function e(b,
e,f,k,q){q=q||{};var p=(b&&d(b)||f||{}).ownerDocument,n=q.templateEngine||g;a.Gb.Oc(f,n,p);f=n.renderTemplate(f,k,q,p);if("number"!=typeof f.length||0<f.length&&"number"!=typeof f[0].nodeType)throw Error("Template engine must return an array of DOM nodes");p=!1;switch(e){case "replaceChildren":a.f.da(b,f);p=!0;break;case "replaceNode":a.a.qc(b,f);p=!0;break;case "ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e);}p&&(c(f,k),q.afterRender&&a.l.w(q.afterRender,null,[f,k.$data]));
return f}function f(b,c,d){return a.H(b)?b():"function"===typeof b?b(c,d):b}var g;a.Db=function(b){if(b!=n&&!(b instanceof a.O))throw Error("templateEngine must inherit from ko.templateEngine");g=b};a.Ab=function(b,c,h,k,q){h=h||{};if((h.templateEngine||g)==n)throw Error("Set a template engine before calling renderTemplate");q=q||"replaceChildren";if(k){var p=d(k);return a.B(function(){var g=c&&c instanceof a.U?c:new a.U(a.a.c(c)),n=f(b,g.$data,g),g=e(k,q,n,g,h);"replaceNode"==q&&(k=g,p=d(k))},null,
{wa:function(){return!p||!a.a.nb(p)},i:p&&"replaceNode"==q?p.parentNode:p})}return a.M.wb(function(d){a.Ab(b,c,h,d,"replaceNode")})};a.kd=function(b,d,g,k,q){function p(a,b){c(b,s);g.afterRender&&g.afterRender(b,a);s=null}function u(a,c){s=q.createChildContext(a,g.as,function(a){a.$index=c});var d=f(b,a,s);return e(null,"ignoreTargetNode",d,s,g)}var s;return a.B(function(){var b=a.a.c(d)||[];"undefined"==typeof b.length&&(b=[b]);b=a.a.Ka(b,function(b){return g.includeDestroyed||b===n||null===b||!a.a.c(b._destroy)});
a.l.w(a.a.Bb,null,[k,b,u,g,p])},null,{i:k})};var k=a.a.e.I();a.d.template={init:function(b,c){var d=a.a.c(c());if("string"==typeof d||d.name)a.f.xa(b);else{if("nodes"in d){if(d=d.nodes||[],a.H(d))throw Error('The "nodes" option must be a plain, non-observable array.');}else d=a.f.childNodes(b);d=a.a.jc(d);(new a.v.qa(b)).nodes(d)}return{controlsDescendantBindings:!0}},update:function(b,c,d,e,f){var g=c(),s;c=a.a.c(g);d=!0;e=null;"string"==typeof c?c={}:(g=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in
c&&(d=!a.a.c(c.ifnot)),s=a.a.c(c.data));"foreach"in c?e=a.kd(g||b,d&&c.foreach||[],c,b,f):d?(f="data"in c?f.createChildContext(s,c.as):f,e=a.Ab(g||b,f,c,b)):a.f.xa(b);f=e;(s=a.a.e.get(b,k))&&"function"==typeof s.k&&s.k();a.a.e.set(b,k,f&&f.ba()?f:n)}};a.h.ta.template=function(b){b=a.h.yb(b);return 1==b.length&&b[0].unknown||a.h.ad(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"};a.f.Z.template=!0})();a.b("setTemplateEngine",a.Db);a.b("renderTemplate",
a.Ab);a.a.dc=function(a,c,d){if(a.length&&c.length){var e,f,g,k,l;for(e=f=0;(!d||e<d)&&(k=a[f]);++f){for(g=0;l=c[g];++g)if(k.value===l.value){k.moved=l.multiChannelNew;l.moved=k.multiChannelNew;c.splice(g,1);e=g=0;break}e+=g}}};a.a.ib=function(){function b(b, d, e, f, g){var k=Math.min,l=Math.max,m=[],h,n=b.length,q,p=d.length,s=p-n||1,u=n+p+1,t,v,x;for(h=0; h<=n; h++)for(v=t,m.push(t=[]),x=k(p,h+s),q=l(0,h-1); q<=x; q++)t[q]=q?h?b[h-1]===d[q-1]?v[q-1]:k(v[q]||u,t[q-1]||u)+1:q+1:h+1;k=[];l=[];s=[];h=n;for(q=p; h||q;)p=m[h][q]-
1,q&&p===m[h][q-1]?l.push(k[k.length]={status:e,value:d[--q],index:q}):h&&p===m[h-1][q]?s.push(k[k.length]={status:f,value:b[--h],index:h}):(--q,--h,g.sparse||k.push({status:"retained",value:d[q]}));a.a.dc(s,l,!g.dontLimitMoves&&10*n);return k.reverse()}return function(a,d,e){e="boolean"===typeof e?{dontLimitMoves:e}:e||{};a=a||[];d=d||[];return a.length<d.length?b(a,d,"added","deleted",e):b(d,a,"deleted","added",e)}}();a.b("utils.compareArrays",a.a.ib);(function(){function b(b,c,d,k,l){var m=[],
h=a.B(function(){var h=c(d,l,a.a.za(m,b))||[];0<m.length&&(a.a.qc(m,h),k&&a.l.w(k,null,[d,h,l]));m.length=0;a.a.ra(m,h)},null,{i:b,wa:function(){return!a.a.Qb(m)}});return{ca:m,B:h.ba()?h:n}}var c=a.a.e.I(),d=a.a.e.I();a.a.Bb=function(e,f,g,k,l){function m(b,c){w=q[c];v!==c&&(D[b]=w);w.qb(v++);a.a.za(w.ca,e);u.push(w);z.push(w)}function h(b,c){if(b)for(var d=0,e=c.length;d<e;d++)c[d]&&a.a.q(c[d].ca,function(a){b(a,d,c[d].ja)})}f=f||[];k=k||{};var r=a.a.e.get(e,c)===n,q=a.a.e.get(e,c)||[],p=a.a.fb(q,
function(a){return a.ja}),s=a.a.ib(p,f,k.dontLimitMoves),u=[],t=0,v=0,x=[],z=[];f=[];for(var D=[],p=[],w,C=0,B,E;B=s[C];C++)switch(E=B.moved,B.status){case "deleted":E===n&&(w=q[t],w.B&&(w.B.k(),w.B=n),a.a.za(w.ca,e).length&&(k.beforeRemove&&(u.push(w),z.push(w),w.ja===d?w=null:f[C]=w),w&&x.push.apply(x,w.ca)));t++;break;case "retained":m(C,t++);break;case "added":E!==n?m(C,E):(w={ja:B.value,qb:a.N(v++)},u.push(w),z.push(w),r||(p[C]=w))}a.a.e.set(e,c,u);h(k.beforeMove,D);a.a.q(x,k.beforeRemove?a.$:
a.removeNode);for(var C=0,r=a.f.firstChild(e),F;w=z[C];C++){w.ca||a.a.extend(w,b(e,g,w.ja,l,w.qb));for(t=0;s=w.ca[t];r=s.nextSibling,F=s,t++)s!==r&&a.f.gc(e,s,F);!w.Wc&&l&&(l(w.ja,w.ca,w.qb),w.Wc=!0)}h(k.beforeRemove,f);for(C=0;C<f.length;++C)f[C]&&(f[C].ja=d);h(k.afterMove,D);h(k.afterAdd,p)}})();a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.Bb);a.W=function(){this.allowTemplateRewriting=!1};a.W.prototype=new a.O;a.W.prototype.renderTemplateSource=function(b,c,d,e){if(c=(9>a.a.C?0:b.nodes)?
b.nodes():null)return a.a.V(c.cloneNode(!0).childNodes);b=b.text();return a.a.ma(b,e)};a.W.sb=new a.W;a.Db(a.W.sb);a.b("nativeTemplateEngine",a.W);(function(){a.vb=function(){var a=this.$c=function(){if(!v||!v.tmpl)return 0;try{if(0<=v.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,f,g){g=g||u;f=f||{};if(2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var k=b.data("precompiled");
k||(k=b.text()||"",k=v.template(null,"{{ko_with $item.koBindingContext}}"+k+"{{/ko_with}}"),b.data("precompiled",k));b=[e.$data];e=v.extend({koBindingContext:e},f.templateOptions);e=v.tmpl(k,b,e);e.appendTo(g.createElement("div"));v.fragments={};return e};this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"};this.addTemplate=function(a,b){u.write("<script type='text/html' id='"+a+"'>"+b+"\x3c/script>")};0<a&&(v.tmpl.tag.ko_code={open:"__.push($1 || '');"},
v.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};a.vb.prototype=new a.O;var b=new a.vb;0<b.$c&&a.Db(b);a.b("jqueryTmplTemplateEngine",a.vb)})()})})();})();

/**
 * Created by Yuan on 2016/12/23.
 */
define('util',["jquery"], function ($) {
    function AjaxHelper() {
        this.ajax = function (url, type, dataType, data, callback, isLocal) {
            $.ajax({
                url: isLocal ? "../../src/json" : url,
                //url: (isLocal ? "../../src/json" : WebAgent.config.quickSmartReplyPath_sensitive) + url,
                traditional: true,
                type: type,
                dataType: dataType,
                data: data,
                global: false,
                //xhrFields: {
                //    withCredentials: true
                //},
                success: callback,
                error: function (xhr, errorType, error) {
                    console.log("Ajax request error,errorType: " + errorType + ",error: " + error);
                    console.log(xhr);
                }
            })
        }
    }

    AjaxHelper.prototype.get = function (url, data, callback, isLocal) {
        this.ajax(url, "GET", "json", data, callback, isLocal);
    };
    AjaxHelper.prototype.post = function (url, data, callback) {
        this.ajax(url, "POST", "json", data, callback);
    };
    AjaxHelper.prototype.put = function (url, data, callback) {
        this.ajax(url, "PUT", "json", data, callback);
    };
    AjaxHelper.prototype.delete = function (url, data, callback) {
        this.ajax(url, "DELETE", 'json', data, callback);
    };
    AjaxHelper.prototype.jsonp = function (url, data, callback) {
        console.log(data);
        this.ajax(url, "GET", "jsonp", data, callback);
    };
    AjaxHelper.prototype.constructor = AjaxHelper;

    var ajaxHelper = new AjaxHelper();

    /**
     * 跨浏览器的事件对象
     */
    var EventUtil = {
        addHandler: function (element, type, handler) {

        },
        getEvent: function (event) {
            return event ? event : window.event;
        },
        getTarget: function (event) {
            return event.target || event.srcElement;
        },
        preventDefault: function (event) {
            if (event.preventDefault) {
                event.preventDefault();
            } else {
                event.returnValue = false;
            }
        },
        removeHandler: function () {

        },
        stopPropagation: function (event) {
            if (event.stopPropagation) {
                event.stopPropagation();
            } else {
                event.cancelBubble = true;
            }
        }
    };

    /**
     * 转换时间为yy-mm-dd hh:mm:ss格式
     * @param date
     * @returns {string}
     */
    var FormatDate = function(dates) {
        var year = dates.getFullYear();
        var month = (dates.getMonth() + 1) < 10 ? "0" + (dates.getMonth() + 1) : (dates.getMonth() + 1);
        var date = dates.getDate();
        var hour = dates.getHours() < 10 ? "0" + dates.getHours() : dates.getHours();
        var minutes = dates.getMinutes() < 10 ? "0" + dates.getMinutes() : dates.getMinutes();
        var seconds = dates.getSeconds() < 10 ? "0" + dates.getSeconds() : dates.getSeconds();

        return  year + "-" + month + "-" + date + " " + hour + ":" + minutes + ":" + seconds;
    };

    //滚动条滚动到底部
    var ScrollToBottom = function () {
        if ($('.scrollToBottom').length) {
            $('.scrollToBottom').scrollTop($('.scrollToBottom')[0].scrollHeight);
        }
    };

    /**
     * 配置是否开启隐藏日志
     * @param level
     * @param message
     * @constructor
     */
    var Log = function(level, message) {
        if (window.console && window.console[level] ) {
            window.console[level]("[webAgent-IM]",new Date().toLocaleString() + message);
            if(WebAgent.canWriteLog){
                WebAgent.ButelAjax && WebAgent.ButelAjax.ajaxFunc("WriteLogToLocal", "writeLogToLocal", "&loglevel=" + level + "&logmsg=[webAgent-IM]" + message);

            }
        }
    };

    return {
        ajaxHelper: ajaxHelper,
        EventUtil: EventUtil,
        FormatDate: FormatDate,
        ScrollToBottom: ScrollToBottom,
        Log: Log
    };
});



/*
 * css.normalize.js
 *
 * CSS Normalization
 *
 * CSS paths are normalized based on an optional basePath and the RequireJS config
 *
 * Usage:
 *   normalize(css, fromBasePath, toBasePath);
 *
 * css: the stylesheet content to normalize
 * fromBasePath: the absolute base path of the css relative to any root (but without ../ backtracking)
 * toBasePath: the absolute new base path of the css relative to the same root
 *
 * Absolute dependencies are left untouched.
 *
 * Urls in the CSS are picked up by regular expressions.
 * These will catch all statements of the form:
 *
 * url(*)
 * url('*')
 * url("*")
 *
 * @import '*'
 * @import "*"
 *
 * (and so also @import url(*) variations)
 *
 * For urls needing normalization
 *
 */

define('normalize',[],function() {
  
  // regular expression for removing double slashes
  // eg http://www.example.com//my///url/here -> http://www.example.com/my/url/here
  var slashes = /([^:])\/+/g
  var removeDoubleSlashes = function(uri) {
    return uri.replace(slashes, '$1/');
  }

  // given a relative URI, and two absolute base URIs, convert it from one base to another
  var protocolRegEx = /[^\:\/]*:\/\/([^\/])*/;
  var absUrlRegEx = /^(\/|data:)/;
  function convertURIBase(uri, fromBase, toBase) {
    if (uri.match(absUrlRegEx) || uri.match(protocolRegEx))
      return uri;
    uri = removeDoubleSlashes(uri);
    // if toBase specifies a protocol path, ensure this is the same protocol as fromBase, if not
    // use absolute path at fromBase
    var toBaseProtocol = toBase.match(protocolRegEx);
    var fromBaseProtocol = fromBase.match(protocolRegEx);
    if (fromBaseProtocol && (!toBaseProtocol || toBaseProtocol[1] != fromBaseProtocol[1] || toBaseProtocol[2] != fromBaseProtocol[2]))
      return absoluteURI(uri, fromBase);
    
    else {
      return relativeURI(absoluteURI(uri, fromBase), toBase);
    }
  };
  
  // given a relative URI, calculate the absolute URI
  function absoluteURI(uri, base) {
    if (uri.substr(0, 2) == './')
      uri = uri.substr(2);

    // absolute urls are left in tact
    if (uri.match(absUrlRegEx) || uri.match(protocolRegEx))
      return uri;
    
    var baseParts = base.split('/');
    var uriParts = uri.split('/');
    
    baseParts.pop();
    
    while (curPart = uriParts.shift())
      if (curPart == '..')
        baseParts.pop();
      else
        baseParts.push(curPart);
    
    return baseParts.join('/');
  };


  // given an absolute URI, calculate the relative URI
  function relativeURI(uri, base) {
    
    // reduce base and uri strings to just their difference string
    var baseParts = base.split('/');
    baseParts.pop();
    base = baseParts.join('/') + '/';
    i = 0;
    while (base.substr(i, 1) == uri.substr(i, 1))
      i++;
    while (base.substr(i, 1) != '/')
      i--;
    base = base.substr(i + 1);
    uri = uri.substr(i + 1);

    // each base folder difference is thus a backtrack
    baseParts = base.split('/');
    var uriParts = uri.split('/');
    out = '';
    while (baseParts.shift())
      out += '../';
    
    // finally add uri parts
    while (curPart = uriParts.shift())
      out += curPart + '/';
    
    return out.substr(0, out.length - 1);
  };
  
  var normalizeCSS = function(source, fromBase, toBase) {

    fromBase = removeDoubleSlashes(fromBase);
    toBase = removeDoubleSlashes(toBase);

    var urlRegEx = /@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig;
    var result, url, source;

    while (result = urlRegEx.exec(source)) {
      url = result[3] || result[2] || result[5] || result[6] || result[4];
      var newUrl;
      newUrl = convertURIBase(url, fromBase, toBase);
      var quoteLen = result[5] || result[6] ? 1 : 0;
      source = source.substr(0, urlRegEx.lastIndex - url.length - quoteLen - 1) + newUrl + source.substr(urlRegEx.lastIndex - quoteLen - 1);
      urlRegEx.lastIndex = urlRegEx.lastIndex + (newUrl.length - url.length);
    }
    
    return source;
  };
  
  normalizeCSS.convertURIBase = convertURIBase;
  normalizeCSS.absoluteURI = absoluteURI;
  normalizeCSS.relativeURI = relativeURI;
  
  return normalizeCSS;
});
;
define('css',[],function(){if("undefined"==typeof window)return{load:function(e,t,n){n()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,n=!1,r=!0;t[1]||t[7]?n=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]||t[8]?r=!1:t[4]&&(n=parseInt(t[4])<18);var o={};o.pluginBuilder="./css-builder";var a,i,s,l=function(){a=document.createElement("style"),e.appendChild(a),i=a.styleSheet||a.sheet},u=0,d=[],c=function(e){u++,32==u&&(l(),u=0),i.addImport(e),a.onload=function(){f()}},f=function(){s();var e=d.shift();return e?(s=e[1],void c(e[0])):void(s=null)},h=function(e, t){if(i&&i.addImport||l(),i&&i.addImport)s?d.push([e,t]):(c(e),s=t);else{a.textContent='@import "'+e+'";';var n=setInterval(function(){try{a.sheet.cssRules,clearInterval(n),t()}catch(e){}},10)}},p=function(t, n){var o=document.createElement("link");if(o.type="text/css",o.rel="stylesheet",r)o.onload=function(){o.onload=function(){},setTimeout(n,7)};else var a=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];if(t.href==o.href)return clearInterval(a),n()}},10);o.href=t,e.appendChild(o)};return o.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)},o.load=function(e,t,r){(n?h:p)(t.toUrl(e+".css"),r)},o});


define('css!weixinEmojiC',[],function(){});
//@author: qpwoeiru96 <https://github.com/qpwoeiru96/weixinEmoji>
var WeixinEmoji = (function() {
    var charset = [0x2600,0x2601,0x2614,0x26c4,0x26a1,0x1f300,0x1f301,0x1f302,0x1f303,0x1f304,0x1f305,0x1f306,0x1f307,0x1f308,0x2744,0x26c5,0x1f309,0x1f30a,0x1f30b,0x1f30c,0x1f30f,0x1f311,0x1f314,0x1f313,0x1f319,0x1f315,0x1f31b,0x1f31f,0x1f320,0x1f550,0x1f551,0x1f552,0x1f553,0x1f554,0x1f555,0x1f556,0x1f557,0x1f558,0x1f559,0x1f55a,0x1f55b,0x231a,0x231b,0x23f0,0x23f3,0x2648,0x2649,0x264a,0x264b,0x264c,0x264d,0x264e,0x264f,0x2650,0x2651,0x2652,0x2653,0x26ce,0x1f340,0x1f337,0x1f331,0x1f341,0x1f338,0x1f339,0x1f342,0x1f343,0x1f33a,0x1f33b,0x1f334,0x1f335,0x1f33e,0x1f33d,0x1f344,0x1f330,0x1f33c,0x1f33f,0x1f352,0x1f34c,0x1f34e,0x1f34a,0x1f353,0x1f349,0x1f345,0x1f346,0x1f348,0x1f34d,0x1f347,0x1f351,0x1f34f,0x1f440,0x1f442,0x1f443,0x1f444,0x1f445,0x1f484,0x1f485,0x1f486,0x1f487,0x1f488,0x1f464,0x1f466,0x1f467,0x1f468,0x1f469,0x1f46a,0x1f46b,0x1f46e,0x1f46f,0x1f470,0x1f471,0x1f472,0x1f473,0x1f474,0x1f475,0x1f476,0x1f477,0x1f478,0x1f479,0x1f47a,0x1f47b,0x1f47c,0x1f47d,0x1f47e,0x1f47f,0x1f480,0x1f481,0x1f482,0x1f483,0x1f40c,0x1f40d,0x1f40e,0x1f414,0x1f417,0x1f42b,0x1f418,0x1f428,0x1f412,0x1f411,0x1f419,0x1f41a,0x1f41b,0x1f41c,0x1f41d,0x1f41e,0x1f420,0x1f421,0x1f422,0x1f424,0x1f425,0x1f426,0x1f423,0x1f427,0x1f429,0x1f41f,0x1f42c,0x1f42d,0x1f42f,0x1f431,0x1f433,0x1f434,0x1f435,0x1f436,0x1f437,0x1f43b,0x1f439,0x1f43a,0x1f42e,0x1f430,0x1f438,0x1f43e,0x1f432,0x1f43c,0x1f43d,0x1f620,0x1f629,0x1f632,0x1f61e,0x1f635,0x1f630,0x1f612,0x1f60d,0x1f624,0x1f61c,0x1f61d,0x1f60b,0x1f618,0x1f61a,0x1f637,0x1f633,0x1f603,0x1f605,0x1f606,0x1f601,0x1f602,0x1f60a,0x263a,0x1f604,0x1f622,0x1f62d,0x1f628,0x1f623,0x1f621,0x1f60c,0x1f616,0x1f614,0x1f631,0x1f62a,0x1f60f,0x1f613,0x1f625,0x1f62b,0x1f609,0x1f63a,0x1f638,0x1f639,0x1f63d,0x1f63b,0x1f63f,0x1f63e,0x1f63c,0x1f640,0x1f645,0x1f646,0x1f647,0x1f648,0x1f64a,0x1f649,0x1f64b,0x1f64c,0x1f64d,0x1f64e,0x1f64f,0x1f3e0,0x1f3e1,0x1f3e2,0x1f3e3,0x1f3e5,0x1f3e6,0x1f3e7,0x1f3e8,0x1f3e9,0x1f3ea,0x1f3eb,0x26ea,0x26f2,0x1f3ec,0x1f3ef,0x1f3f0,0x1f3ed,0x2693,0x1f3ee,0x1f5fb,0x1f5fc,0x1f5fd,0x1f5fe,0x1f5ff,0x1f45e,0x1f45f,0x1f460,0x1f461,0x1f462,0x1f463,0x1f453,0x1f455,0x1f456,0x1f451,0x1f454,0x1f452,0x1f457,0x1f458,0x1f459,0x1f45a,0x1f45b,0x1f45c,0x1f45d,0x1f4b0,0x1f4b1,0x1f4b9,0x1f4b2,0x1f4b3,0x1f4b4,0x1f4b5,0x1f4b8,0x1f1e81f1f3,0x1f1e91f1ea,0x1f1ea1f1f8,0x1f1eb1f1f7,0x1f1ec1f1e7,0x1f1ee1f1f9,0x1f1ef1f1f5,0x1f1f01f1f7,0x1f1f71f1fa,0x1f1fa1f1f8,0x1f525,0x1f526,0x1f527,0x1f528,0x1f529,0x1f52a,0x1f52b,0x1f52e,0x1f52f,0x1f530,0x1f531,0x1f489,0x1f48a,0x1f170,0x1f171,0x1f18e,0x1f17e,0x1f380,0x1f381,0x1f382,0x1f384,0x1f385,0x1f38c,0x1f386,0x1f388,0x1f389,0x1f38d,0x1f38e,0x1f393,0x1f392,0x1f38f,0x1f387,0x1f390,0x1f383,0x1f38a,0x1f38b,0x1f391,0x1f4df,0x260e,0x1f4de,0x1f4f1,0x1f4f2,0x1f4dd,0x1f4e0,0x2709,0x1f4e8,0x1f4e9,0x1f4ea,0x1f4eb,0x1f4ee,0x1f4f0,0x1f4e2,0x1f4e3,0x1f4e1,0x1f4e4,0x1f4e5,0x1f4e6,0x1f4e7,0x1f520,0x1f521,0x1f522,0x1f523,0x1f524,0x2712,0x1f4ba,0x1f4bb,0x270f,0x1f4ce,0x1f4bc,0x1f4bd,0x1f4be,0x1f4bf,0x1f4c0,0x2702,0x1f4cd,0x1f4c3,0x1f4c4,0x1f4c5,0x1f4c1,0x1f4c2,0x1f4d3,0x1f4d6,0x1f4d4,0x1f4d5,0x1f4d7,0x1f4d8,0x1f4d9,0x1f4da,0x1f4db,0x1f4dc,0x1f4cb,0x1f4c6,0x1f4ca,0x1f4c8,0x1f4c9,0x1f4c7,0x1f4cc,0x1f4d2,0x1f4cf,0x1f4d0,0x1f4d1,0x1f3bd,0x26be,0x26f3,0x1f3be,0x26bd,0x1f3bf,0x1f3c0,0x1f3c1,0x1f3c2,0x1f3c3,0x1f3c4,0x1f3c6,0x1f3c8,0x1f3ca,0x1f683,0x1f687,0x24c2,0x1f684,0x1f685,0x1f697,0x1f699,0x1f68c,0x1f68f,0x1f6a2,0x2708,0x26f5,0x1f689,0x1f680,0x1f6a4,0x1f695,0x1f69a,0x1f692,0x1f691,0x1f693,0x26fd,0x1f17f,0x1f6a5,0x1f6a7,0x1f6a8,0x2668,0x26fa,0x1f3a0,0x1f3a1,0x1f3a2,0x1f3a3,0x1f3a4,0x1f3a5,0x1f3a6,0x1f3a7,0x1f3a8,0x1f3a9,0x1f3aa,0x1f3ab,0x1f3ac,0x1f3ad,0x1f3ae,0x1f004,0x1f3af,0x1f3b0,0x1f3b1,0x1f3b2,0x1f3b3,0x1f3b4,0x1f0cf,0x1f3b5,0x1f3b6,0x1f3b7,0x1f3b8,0x1f3b9,0x1f3ba,0x1f3bb,0x1f3bc,0x303d,0x1f4f7,0x1f4f9,0x1f4fa,0x1f4fb,0x1f4fc,0x1f48b,0x1f48c,0x1f48d,0x1f48e,0x1f48f,0x1f490,0x1f491,0x1f492,0x1f51e,0xa9,0xae,0x2122,0x2139,0x2320e3,0x3120e3,0x3220e3,0x3320e3,0x3420e3,0x3520e3,0x3620e3,0x3720e3,0x3820e3,0x3920e3,0x3020e3,0x1f51f,0x1f4f6,0x1f4f3,0x1f4f4,0x1f354,0x1f359,0x1f370,0x1f35c,0x1f35e,0x1f373,0x1f366,0x1f35f,0x1f361,0x1f358,0x1f35a,0x1f35d,0x1f35b,0x1f362,0x1f363,0x1f371,0x1f372,0x1f367,0x1f356,0x1f365,0x1f360,0x1f355,0x1f357,0x1f368,0x1f369,0x1f36a,0x1f36b,0x1f36c,0x1f36d,0x1f36e,0x1f36f,0x1f364,0x1f374,0x2615,0x1f378,0x1f37a,0x1f375,0x1f376,0x1f377,0x1f37b,0x1f379,0x2197,0x2198,0x2196,0x2199,0x2934,0x2935,0x2194,0x2195,0x2b06,0x2b07,0x27a1,0x2b05,0x25b6,0x25c0,0x23e9,0x23ea,0x23eb,0x23ec,0x1f53a,0x1f53b,0x1f53c,0x1f53d,0x2b55,0x274c,0x274e,0x2757,0x2049,0x203c,0x2753,0x2754,0x2755,0x3030,0x27b0,0x27bf,0x2764,0x1f493,0x1f494,0x1f495,0x1f496,0x1f497,0x1f498,0x1f499,0x1f49a,0x1f49b,0x1f49c,0x1f49d,0x1f49e,0x1f49f,0x2665,0x2660,0x2666,0x2663,0x1f6ac,0x1f6ad,0x267f,0x1f6a9,0x26a0,0x26d4,0x267b,0x1f6b2,0x1f6b6,0x1f6b9,0x1f6ba,0x1f6c0,0x1f6bb,0x1f6bd,0x1f6be,0x1f6bc,0x1f6aa,0x1f6ab,0x2714,0x1f191,0x1f192,0x1f193,0x1f194,0x1f195,0x1f196,0x1f197,0x1f198,0x1f199,0x1f19a,0x1f201,0x1f202,0x1f232,0x1f233,0x1f234,0x1f235,0x1f236,0x1f21a,0x1f237,0x1f238,0x1f239,0x1f22f,0x1f23a,0x3299,0x3297,0x1f250,0x1f251,0x2795,0x2796,0x2716,0x2797,0x1f4a0,0x1f4a1,0x1f4a2,0x1f4a3,0x1f4a4,0x1f4a5,0x1f4a6,0x1f4a7,0x1f4a8,0x1f4a9,0x1f4aa,0x1f4ab,0x1f4ac,0x2728,0x2734,0x2733,0x26aa,0x26ab,0x1f534,0x1f535,0x1f532,0x1f533,0x2b50,0x2b1c,0x2b1b,0x25ab,0x25aa,0x25fd,0x25fe,0x25fb,0x25fc,0x1f536,0x1f537,0x1f538,0x1f539,0x2747,0x1f4ae,0x1f4af,0x21a9,0x21aa,0x1f503,0x1f50a,0x1f50b,0x1f50c,0x1f50d,0x1f50e,0x1f512,0x1f513,0x1f50f,0x1f510,0x1f511,0x1f514,0x2611,0x1f518,0x1f516,0x1f517,0x1f519,0x1f51a,0x1f51b,0x1f51c,0x1f51d,0x2003,0x2002,0x2005,0x2705,0x270a,0x270b,0x270c,0x1f44a,0x1f44d,0x261d,0x1f446,0x1f447,0x1f448,0x1f449,0x1f44b,0x1f44f,0x1f44c,0x1f44e,0x1f450];

    var hash = {};

    for(var i = charset.length - 1; i >= 0; i--)
        hash[charset[i]] = true;

    var ucs2unicode = function (ch, cl) {
        return (ch << 10) + cl - 0x35FDC00;
    }

    var replace = function (str) {
    
        var length   = str.length,
            index    = -1,
            charCode = 0,
            char     = '',
            result   = [];

        while (++index < length) {

            char     = str.charAt(index);
            charCode = str.charCodeAt(index);

            if (charCode >= 0xD800 && charCode <= 0xDBFF) {
                char += str.charAt(++index);
                charCode = ucs2unicode(charCode, str.charCodeAt(index));
            }

            if(hash[charCode])
                result.push('<i class="weixinEmoji weixinEmoji-' + charCode.toString(16) + '"></i>');
            else
                result.push(char);
        }

        return result.join('');
    }

    //@tips:XSS
    return {
        replace: replace
    };

})();

define("weixinEmojiJ", function(){});

//@author: qpwoeiru96 <https://github.com/qpwoeiru96/weixinEmoji>
var WeixinEmojiExtend = (function() {

    //var emojiTable = {
    //    "☀": "2600",
    //    "☁": "2601",
    //    "☔": "2614",
    //    "⛄": "26c4",
    //    "⚡": "26a1",
    //    "🌀": "1f300",
    //    "🌁": "1f301",
    //    "🌂": "1f302",
    //    "🌃": "1f303",
    //    "🌄": "1f304",
    //    "🌅": "1f305",
    //    "🌆": "1f306",
    //    "🌇": "1f307",
    //    "🌈": "1f308",
    //    "❄": "2744",
    //    "⛅": "26c5",
    //    "🌉": "1f309",
    //    "🌊": "1f30a",
    //    "🌋": "1f30b",
    //    "🌌": "1f30c",
    //    "🌏": "1f30f",
    //    "🌑": "1f311",
    //    "🌔": "1f314",
    //    "🌓": "1f313",
    //    "🌙": "1f319",
    //    "🌕": "1f315",
    //    "🌛": "1f31b",
    //    "🌟": "1f31f",
    //    "🌠": "1f320",
    //    "🕐": "1f550",
    //    "🕑": "1f551",
    //    "🕒": "1f552",
    //    "🕓": "1f553",
    //    "🕔": "1f554",
    //    "🕕": "1f555",
    //    "🕖": "1f556",
    //    "🕗": "1f557",
    //    "🕘": "1f558",
    //    "🕙": "1f559",
    //    "🕚": "1f55a",
    //    "🕛": "1f55b",
    //    "⌚": "231a",
    //    "⌛": "231b",
    //    "⏰": "23f0",
    //    "⏳": "23f3",
    //    "♈": "2648",
    //    "♉": "2649",
    //    "♊": "264a",
    //    "♋": "264b",
    //    "♌": "264c",
    //    "♍": "264d",
    //    "♎": "264e",
    //    "♏": "264f",
    //    "♐": "2650",
    //    "♑": "2651",
    //    "♒": "2652",
    //    "♓": "2653",
    //    "⛎": "26ce",
    //    "🍀": "1f340",
    //    "🌷": "1f337",
    //    "🌱": "1f331",
    //    "🍁": "1f341",
    //    "🌸": "1f338",
    //    "🌹": "1f339",
    //    "🍂": "1f342",
    //    "🍃": "1f343",
    //    "🌺": "1f33a",
    //    "🌻": "1f33b",
    //    "🌴": "1f334",
    //    "🌵": "1f335",
    //    "🌾": "1f33e",
    //    "🌽": "1f33d",
    //    "🍄": "1f344",
    //    "🌰": "1f330",
    //    "🌼": "1f33c",
    //    "🌿": "1f33f",
    //    "🍒": "1f352",
    //    "🍌": "1f34c",
    //    "🍎": "1f34e",
    //    "🍊": "1f34a",
    //    "🍓": "1f353",
    //    "🍉": "1f349",
    //    "🍅": "1f345",
    //    "🍆": "1f346",
    //    "🍈": "1f348",
    //    "🍍": "1f34d",
    //    "🍇": "1f347",
    //    "🍑": "1f351",
    //    "🍏": "1f34f",
    //    "👀": "1f440",
    //    "👂": "1f442",
    //    "👃": "1f443",
    //    "👄": "1f444",
    //    "👅": "1f445",
    //    "💄": "1f484",
    //    "💅": "1f485",
    //    "💆": "1f486",
    //    "💇": "1f487",
    //    "💈": "1f488",
    //    "👤": "1f464",
    //    "👦": "1f466",
    //    "👧": "1f467",
    //    "👨": "1f468",
    //    "👩": "1f469",
    //    "👪": "1f46a",
    //    "👫": "1f46b",
    //    "👮": "1f46e",
    //    "👯": "1f46f",
    //    "👰": "1f470",
    //    "👱": "1f471",
    //    "👲": "1f472",
    //    "👳": "1f473",
    //    "👴": "1f474",
    //    "👵": "1f475",
    //    "👶": "1f476",
    //    "👷": "1f477",
    //    "👸": "1f478",
    //    "👹": "1f479",
    //    "👺": "1f47a",
    //    "👻": "1f47b",
    //    "👼": "1f47c",
    //    "👽": "1f47d",
    //    "👾": "1f47e",
    //    "👿": "1f47f",
    //    "💀": "1f480",
    //    "💁": "1f481",
    //    "💂": "1f482",
    //    "💃": "1f483",
    //    "🐌": "1f40c",
    //    "🐍": "1f40d",
    //    "🐎": "1f40e",
    //    "🐔": "1f414",
    //    "🐗": "1f417",
    //    "🐫": "1f42b",
    //    "🐘": "1f418",
    //    "🐨": "1f428",
    //    "🐒": "1f412",
    //    "🐑": "1f411",
    //    "🐙": "1f419",
    //    "🐚": "1f41a",
    //    "🐛": "1f41b",
    //    "🐜": "1f41c",
    //    "🐝": "1f41d",
    //    "🐞": "1f41e",
    //    "🐠": "1f420",
    //    "🐡": "1f421",
    //    "🐢": "1f422",
    //    "🐤": "1f424",
    //    "🐥": "1f425",
    //    "🐦": "1f426",
    //    "🐣": "1f423",
    //    "🐧": "1f427",
    //    "🐩": "1f429",
    //    "🐟": "1f41f",
    //    "🐬": "1f42c",
    //    "🐭": "1f42d",
    //    "🐯": "1f42f",
    //    "🐱": "1f431",
    //    "🐳": "1f433",
    //    "🐴": "1f434",
    //    "🐵": "1f435",
    //    "🐶": "1f436",
    //    "🐷": "1f437",
    //    "🐻": "1f43b",
    //    "🐹": "1f439",
    //    "🐺": "1f43a",
    //    "🐮": "1f42e",
    //    "🐰": "1f430",
    //    "🐸": "1f438",
    //    "🐾": "1f43e",
    //    "🐲": "1f432",
    //    "🐼": "1f43c",
    //    "🐽": "1f43d",
    //    "😠": "1f620",
    //    "😩": "1f629",
    //    "😲": "1f632",
    //    "😞": "1f61e",
    //    "😵": "1f635",
    //    "😰": "1f630",
    //    "😒": "1f612",
    //    "😍": "1f60d",
    //    "😤": "1f624",
    //    "😜": "1f61c",
    //    "😝": "1f61d",
    //    "😋": "1f60b",
    //    "😘": "1f618",
    //    "😚": "1f61a",
    //    "😷": "1f637",
    //    "😳": "1f633",
    //    "😃": "1f603",
    //    "😅": "1f605",
    //    "😆": "1f606",
    //    "😁": "1f601",
    //    "😂": "1f602",
    //    "😊": "1f60a",
    //    "☺": "263a",
    //    "😄": "1f604",
    //    "😢": "1f622",
    //    "😭": "1f62d",
    //    "😨": "1f628",
    //    "😣": "1f623",
    //    "😡": "1f621",
    //    "😌": "1f60c",
    //    "😖": "1f616",
    //    "😔": "1f614",
    //    "😱": "1f631",
    //    "😪": "1f62a",
    //    "😏": "1f60f",
    //    "😓": "1f613",
    //    "😥": "1f625",
    //    "😫": "1f62b",
    //    "😉": "1f609",
    //    "😺": "1f63a",
    //    "😸": "1f638",
    //    "😹": "1f639",
    //    "😽": "1f63d",
    //    "😻": "1f63b",
    //    "😿": "1f63f",
    //    "😾": "1f63e",
    //    "😼": "1f63c",
    //    "🙀": "1f640",
    //    "🙅": "1f645",
    //    "🙆": "1f646",
    //    "🙇": "1f647",
    //    "🙈": "1f648",
    //    "🙊": "1f64a",
    //    "🙉": "1f649",
    //    "🙋": "1f64b",
    //    "🙌": "1f64c",
    //    "🙍": "1f64d",
    //    "🙎": "1f64e",
    //    "🙏": "1f64f",
    //    "🏠": "1f3e0",
    //    "🏡": "1f3e1",
    //    "🏢": "1f3e2",
    //    "🏣": "1f3e3",
    //    "🏥": "1f3e5",
    //    "🏦": "1f3e6",
    //    "🏧": "1f3e7",
    //    "🏨": "1f3e8",
    //    "🏩": "1f3e9",
    //    "🏪": "1f3ea",
    //    "🏫": "1f3eb",
    //    "⛪": "26ea",
    //    "⛲": "26f2",
    //    "🏬": "1f3ec",
    //    "🏯": "1f3ef",
    //    "🏰": "1f3f0",
    //    "🏭": "1f3ed",
    //    "⚓": "2693",
    //    "🏮": "1f3ee",
    //    "🗻": "1f5fb",
    //    "🗼": "1f5fc",
    //    "🗽": "1f5fd",
    //    "🗾": "1f5fe",
    //    "🗿": "1f5ff",
    //    "👞": "1f45e",
    //    "👟": "1f45f",
    //    "👠": "1f460",
    //    "👡": "1f461",
    //    "👢": "1f462",
    //    "👣": "1f463",
    //    "👓": "1f453",
    //    "👕": "1f455",
    //    "👖": "1f456",
    //    "👑": "1f451",
    //    "👔": "1f454",
    //    "👒": "1f452",
    //    "👗": "1f457",
    //    "👘": "1f458",
    //    "👙": "1f459",
    //    "👚": "1f45a",
    //    "👛": "1f45b",
    //    "👜": "1f45c",
    //    "👝": "1f45d",
    //    "💰": "1f4b0",
    //    "💱": "1f4b1",
    //    "💹": "1f4b9",
    //    "💲": "1f4b2",
    //    "💳": "1f4b3",
    //    "💴": "1f4b4",
    //    "💵": "1f4b5",
    //    "💸": "1f4b8",
    //    "🇨🇳": "1f1e81f1f3",
    //    "🇩🇪": "1f1e91f1ea",
    //    "🇪🇸": "1f1ea1f1f8",
    //    "🇫🇷": "1f1eb1f1f7",
    //    "🇬🇧": "1f1ec1f1e7",
    //    "🇮🇹": "1f1ee1f1f9",
    //    "🇯🇵": "1f1ef1f1f5",
    //    "🇰🇷": "1f1f01f1f7",
    //    "🇷🇺": "1f1f71f1fa",
    //    "🇺🇸": "1f1fa1f1f8",
    //    "🔥": "1f525",
    //    "🔦": "1f526",
    //    "🔧": "1f527",
    //    "🔨": "1f528",
    //    "🔩": "1f529",
    //    "🔪": "1f52a",
    //    "🔫": "1f52b",
    //    "🔮": "1f52e",
    //    "🔯": "1f52f",
    //    "🔰": "1f530",
    //    "🔱": "1f531",
    //    "💉": "1f489",
    //    "💊": "1f48a",
    //    "🅰": "1f170",
    //    "🅱": "1f171",
    //    "🆎": "1f18e",
    //    "🅾": "1f17e",
    //    "🎀": "1f380",
    //    "🎁": "1f381",
    //    "🎂": "1f382",
    //    "🎄": "1f384",
    //    "🎅": "1f385",
    //    "🎌": "1f38c",
    //    "🎆": "1f386",
    //    "🎈": "1f388",
    //    "🎉": "1f389",
    //    "🎍": "1f38d",
    //    "🎎": "1f38e",
    //    "🎓": "1f393",
    //    "🎒": "1f392",
    //    "🎏": "1f38f",
    //    "🎇": "1f387",
    //    "🎐": "1f390",
    //    "🎃": "1f383",
    //    "🎊": "1f38a",
    //    "🎋": "1f38b",
    //    "🎑": "1f391",
    //    "📟": "1f4df",
    //    "☎": "260e",
    //    "📞": "1f4de",
    //    "📱": "1f4f1",
    //    "📲": "1f4f2",
    //    "📝": "1f4dd",
    //    "📠": "1f4e0",
    //    "✉": "2709",
    //    "📨": "1f4e8",
    //    "📩": "1f4e9",
    //    "📪": "1f4ea",
    //    "📫": "1f4eb",
    //    "📮": "1f4ee",
    //    "📰": "1f4f0",
    //    "📢": "1f4e2",
    //    "📣": "1f4e3",
    //    "📡": "1f4e1",
    //    "📤": "1f4e4",
    //    "📥": "1f4e5",
    //    "📦": "1f4e6",
    //    "📧": "1f4e7",
    //    "🔠": "1f520",
    //    "🔡": "1f521",
    //    "🔢": "1f522",
    //    "🔣": "1f523",
    //    "🔤": "1f524",
    //    "✒": "2712",
    //    "💺": "1f4ba",
    //    "💻": "1f4bb",
    //    "✏": "270f",
    //    "📎": "1f4ce",
    //    "💼": "1f4bc",
    //    "💽": "1f4bd",
    //    "💾": "1f4be",
    //    "💿": "1f4bf",
    //    "📀": "1f4c0",
    //    "✂": "2702",
    //    "📍": "1f4cd",
    //    "📃": "1f4c3",
    //    "📄": "1f4c4",
    //    "📅": "1f4c5",
    //    "📁": "1f4c1",
    //    "📂": "1f4c2",
    //    "📓": "1f4d3",
    //    "📖": "1f4d6",
    //    "📔": "1f4d4",
    //    "📕": "1f4d5",
    //    "📗": "1f4d7",
    //    "📘": "1f4d8",
    //    "📙": "1f4d9",
    //    "📚": "1f4da",
    //    "📛": "1f4db",
    //    "📜": "1f4dc",
    //    "📋": "1f4cb",
    //    "📆": "1f4c6",
    //    "📊": "1f4ca",
    //    "📈": "1f4c8",
    //    "📉": "1f4c9",
    //    "📇": "1f4c7",
    //    "📌": "1f4cc",
    //    "📒": "1f4d2",
    //    "📏": "1f4cf",
    //    "📐": "1f4d0",
    //    "📑": "1f4d1",
    //    "🎽": "1f3bd",
    //    "⚾": "26be",
    //    "⛳": "26f3",
    //    "🎾": "1f3be",
    //    "⚽": "26bd",
    //    "🎿": "1f3bf",
    //    "🏀": "1f3c0",
    //    "🏁": "1f3c1",
    //    "🏂": "1f3c2",
    //    "🏃": "1f3c3",
    //    "🏄": "1f3c4",
    //    "🏆": "1f3c6",
    //    "🏈": "1f3c8",
    //    "🏊": "1f3ca",
    //    "🚃": "1f683",
    //    "🚇": "1f687",
    //    "Ⓜ": "24c2",
    //    "🚄": "1f684",
    //    "🚅": "1f685",
    //    "🚗": "1f697",
    //    "🚙": "1f699",
    //    "🚌": "1f68c",
    //    "🚏": "1f68f",
    //    "🚢": "1f6a2",
    //    "✈": "2708",
    //    "⛵": "26f5",
    //    "🚉": "1f689",
    //    "🚀": "1f680",
    //    "🚤": "1f6a4",
    //    "🚕": "1f695",
    //    "🚚": "1f69a",
    //    "🚒": "1f692",
    //    "🚑": "1f691",
    //    "🚓": "1f693",
    //    "⛽": "26fd",
    //    "🅿": "1f17f",
    //    "🚥": "1f6a5",
    //    "🚧": "1f6a7",
    //    "🚨": "1f6a8",
    //    "♨": "2668",
    //    "⛺": "26fa",
    //    "🎠": "1f3a0",
    //    "🎡": "1f3a1",
    //    "🎢": "1f3a2",
    //    "🎣": "1f3a3",
    //    "🎤": "1f3a4",
    //    "🎥": "1f3a5",
    //    "🎦": "1f3a6",
    //    "🎧": "1f3a7",
    //    "🎨": "1f3a8",
    //    "🎩": "1f3a9",
    //    "🎪": "1f3aa",
    //    "🎫": "1f3ab",
    //    "🎬": "1f3ac",
    //    "🎭": "1f3ad",
    //    "🎮": "1f3ae",
    //    "🀄": "1f004",
    //    "🎯": "1f3af",
    //    "🎰": "1f3b0",
    //    "🎱": "1f3b1",
    //    "🎲": "1f3b2",
    //    "🎳": "1f3b3",
    //    "🎴": "1f3b4",
    //    "🃏": "1f0cf",
    //    "🎵": "1f3b5",
    //    "🎶": "1f3b6",
    //    "🎷": "1f3b7",
    //    "🎸": "1f3b8",
    //    "🎹": "1f3b9",
    //    "🎺": "1f3ba",
    //    "🎻": "1f3bb",
    //    "🎼": "1f3bc",
    //    "〽": "303d",
    //    "📷": "1f4f7",
    //    "📹": "1f4f9",
    //    "📺": "1f4fa",
    //    "📻": "1f4fb",
    //    "📼": "1f4fc",
    //    "💋": "1f48b",
    //    "💌": "1f48c",
    //    "💍": "1f48d",
    //    "💎": "1f48e",
    //    "💏": "1f48f",
    //    "💐": "1f490",
    //    "💑": "1f491",
    //    "💒": "1f492",
    //    "🔞": "1f51e",
    //    "©": "a9",
    //    "®": "ae",
    //    "™": "2122",
    //    "ℹ": "2139",
    //    "#⃣": "2320e3",
    //    "1⃣": "3120e3",
    //    "2⃣": "3220e3",
    //    "3⃣": "3320e3",
    //    "4⃣": "3420e3",
    //    "5⃣": "3520e3",
    //    "6⃣": "3620e3",
    //    "7⃣": "3720e3",
    //    "8⃣": "3820e3",
    //    "9⃣": "3920e3",
    //    "0⃣": "3020e3",
    //    "🔟": "1f51f",
    //    "📶": "1f4f6",
    //    "📳": "1f4f3",
    //    "📴": "1f4f4",
    //    "🍔": "1f354",
    //    "🍙": "1f359",
    //    "🍰": "1f370",
    //    "🍜": "1f35c",
    //    "🍞": "1f35e",
    //    "🍳": "1f373",
    //    "🍦": "1f366",
    //    "🍟": "1f35f",
    //    "🍡": "1f361",
    //    "🍘": "1f358",
    //    "🍚": "1f35a",
    //    "🍝": "1f35d",
    //    "🍛": "1f35b",
    //    "🍢": "1f362",
    //    "🍣": "1f363",
    //    "🍱": "1f371",
    //    "🍲": "1f372",
    //    "🍧": "1f367",
    //    "🍖": "1f356",
    //    "🍥": "1f365",
    //    "🍠": "1f360",
    //    "🍕": "1f355",
    //    "🍗": "1f357",
    //    "🍨": "1f368",
    //    "🍩": "1f369",
    //    "🍪": "1f36a",
    //    "🍫": "1f36b",
    //    "🍬": "1f36c",
    //    "🍭": "1f36d",
    //    "🍮": "1f36e",
    //    "🍯": "1f36f",
    //    "🍤": "1f364",
    //    "🍴": "1f374",
    //    "☕": "2615",
    //    "🍸": "1f378",
    //    "🍺": "1f37a",
    //    "🍵": "1f375",
    //    "🍶": "1f376",
    //    "🍷": "1f377",
    //    "🍻": "1f37b",
    //    "🍹": "1f379",
    //    "↗": "2197",
    //    "↘": "2198",
    //    "↖": "2196",
    //    "↙": "2199",
    //    "⤴": "2934",
    //    "⤵": "2935",
    //    "↔": "2194",
    //    "↕": "2195",
    //    "⬆": "2b06",
    //    "⬇": "2b07",
    //    "➡": "27a1",
    //    "⬅": "2b05",
    //    "▶": "25b6",
    //    "◀": "25c0",
    //    "⏩": "23e9",
    //    "⏪": "23ea",
    //    "⏫": "23eb",
    //    "⏬": "23ec",
    //    "🔺": "1f53a",
    //    "🔻": "1f53b",
    //    "🔼": "1f53c",
    //    "🔽": "1f53d",
    //    "⭕": "2b55",
    //    "❌": "274c",
    //    "❎": "274e",
    //    "❗": "2757",
    //    "⁉": "2049",
    //    "‼": "203c",
    //    "❓": "2753",
    //    "❔": "2754",
    //    "❕": "2755",
    //    "〰": "3030",
    //    "➰": "27b0",
    //    "➿": "27bf",
    //    "❤": "2764",
    //    "💓": "1f493",
    //    "💔": "1f494",
    //    "💕": "1f495",
    //    "💖": "1f496",
    //    "💗": "1f497",
    //    "💘": "1f498",
    //    "💙": "1f499",
    //    "💚": "1f49a",
    //    "💛": "1f49b",
    //    "💜": "1f49c",
    //    "💝": "1f49d",
    //    "💞": "1f49e",
    //    "💟": "1f49f",
    //    "♥": "2665",
    //    "♠": "2660",
    //    "♦": "2666",
    //    "♣": "2663",
    //    "🚬": "1f6ac",
    //    "🚭": "1f6ad",
    //    "♿": "267f",
    //    "🚩": "1f6a9",
    //    "⚠": "26a0",
    //    "⛔": "26d4",
    //    "♻": "267b",
    //    "🚲": "1f6b2",
    //    "🚶": "1f6b6",
    //    "🚹": "1f6b9",
    //    "🚺": "1f6ba",
    //    "🛀": "1f6c0",
    //    "🚻": "1f6bb",
    //    "🚽": "1f6bd",
    //    "🚾": "1f6be",
    //    "🚼": "1f6bc",
    //    "🚪": "1f6aa",
    //    "🚫": "1f6ab",
    //    "✔": "2714",
    //    "🆑": "1f191",
    //    "🆒": "1f192",
    //    "🆓": "1f193",
    //    "🆔": "1f194",
    //    "🆕": "1f195",
    //    "🆖": "1f196",
    //    "🆗": "1f197",
    //    "🆘": "1f198",
    //    "🆙": "1f199",
    //    "🆚": "1f19a",
    //    "🈁": "1f201",
    //    "🈂": "1f202",
    //    "🈲": "1f232",
    //    "🈳": "1f233",
    //    "🈴": "1f234",
    //    "🈵": "1f235",
    //    "🈶": "1f236",
    //    "🈚": "1f21a",
    //    "🈷": "1f237",
    //    "🈸": "1f238",
    //    "🈹": "1f239",
    //    "🈯": "1f22f",
    //    "🈺": "1f23a",
    //    "㊙": "3299",
    //    "㊗": "3297",
    //    "🉐": "1f250",
    //    "🉑": "1f251",
    //    "➕": "2795",
    //    "➖": "2796",
    //    "✖": "2716",
    //    "➗": "2797",
    //    "💠": "1f4a0",
    //    "💡": "1f4a1",
    //    "💢": "1f4a2",
    //    "💣": "1f4a3",
    //    "💤": "1f4a4",
    //    "💥": "1f4a5",
    //    "💦": "1f4a6",
    //    "💧": "1f4a7",
    //    "💨": "1f4a8",
    //    "💩": "1f4a9",
    //    "💪": "1f4aa",
    //    "💫": "1f4ab",
    //    "💬": "1f4ac",
    //    "✨": "2728",
    //    "✴": "2734",
    //    "✳": "2733",
    //    "⚪": "26aa",
    //    "⚫": "26ab",
    //    "🔴": "1f534",
    //    "🔵": "1f535",
    //    "🔲": "1f532",
    //    "🔳": "1f533",
    //    "⭐": "2b50",
    //    "⬜": "2b1c",
    //    "⬛": "2b1b",
    //    "▫": "25ab",
    //    "▪": "25aa",
    //    "◽": "25fd",
    //    "◾": "25fe",
    //    "◻": "25fb",
    //    "◼": "25fc",
    //    "🔶": "1f536",
    //    "🔷": "1f537",
    //    "🔸": "1f538",
    //    "🔹": "1f539",
    //    "❇": "2747",
    //    "💮": "1f4ae",
    //    "💯": "1f4af",
    //    "↩": "21a9",
    //    "↪": "21aa",
    //    "🔃": "1f503",
    //    "🔊": "1f50a",
    //    "🔋": "1f50b",
    //    "🔌": "1f50c",
    //    "🔍": "1f50d",
    //    "🔎": "1f50e",
    //    "🔒": "1f512",
    //    "🔓": "1f513",
    //    "🔏": "1f50f",
    //    "🔐": "1f510",
    //    "🔑": "1f511",
    //    "🔔": "1f514",
    //    "☑": "2611",
    //    "🔘": "1f518",
    //    "🔖": "1f516",
    //    "🔗": "1f517",
    //    "🔙": "1f519",
    //    "🔚": "1f51a",
    //    "🔛": "1f51b",
    //    "🔜": "1f51c",
    //    "🔝": "1f51d",
    //    " ": "2003",
    //    " ": "2002",
    //    " ": "2005",
    //    "✅": "2705",
    //    "✊": "270a",
    //    "✋": "270b",
    //    "✌": "270c",
    //    "👊": "1f44a",
    //    "👍": "1f44d",
    //    "☝": "261d",
    //    "👆": "1f446",
    //    "👇": "1f447",
    //    "👈": "1f448",
    //    "👉": "1f449",
    //    "👋": "1f44b",
    //    "👏": "1f44f",
    //    "👌": "1f44c",
    //    "👎": "1f44e",
    //    "👐": "1f450",
    //    "": "2600",
    //    "": "2601",
    //    "": "2614",
    //    "": "26c4",
    //    "": "26a1",
    //    "": "1f300",
    //    "[霧]": "1f301",
    //    "": "1f302",
    //    "": "1f30c",
    //    "": "1f304",
    //    "": "1f305",
    //    "": "1f306",
    //    "": "1f307",
    //    "": "1f308",
    //    "[雪結晶]": "2744",
    //    "": "26c5",
    //    "": "1f30a",
    //    "[火山]": "1f30b",
    //    "[地球]": "1f30f",
    //    "●": "1f311",
    //    "": "1f31b",
    //    "○": "1f315",
    //    "": "1f31f",
    //    "☆彡": "1f320",
    //    "": "1f550",
    //    "": "1f551",
    //    "": "1f552",
    //    "": "1f553",
    //    "": "1f554",
    //    "": "1f555",
    //    "": "1f556",
    //    "": "1f557",
    //    "": "1f558",
    //    "": "23f0",
    //    "": "1f55a",
    //    "": "1f55b",
    //    "[腕時計]": "231a",
    //    "[砂時計]": "23f3",
    //    "": "2648",
    //    "": "2649",
    //    "": "264a",
    //    "": "264b",
    //    "": "264c",
    //    "": "264d",
    //    "": "264e",
    //    "": "264f",
    //    "": "2650",
    //    "": "2651",
    //    "": "2652",
    //    "": "2653",
    //    "": "26ce",
    //    "": "1f33f",
    //    "": "1f337",
    //    "": "1f341",
    //    "": "1f338",
    //    "": "1f339",
    //    "": "1f342",
    //    "": "1f343",
    //    "": "1f33a",
    //    "": "1f33c",
    //    "": "1f334",
    //    "": "1f335",
    //    "": "1f33e",
    //    "[とうもろこし]": "1f33d",
    //    "[キノコ]": "1f344",
    //    "[栗]": "1f330",
    //    "[さくらんぼ]": "1f352",
    //    "[バナナ]": "1f34c",
    //    "": "1f34f",
    //    "": "1f34a",
    //    "": "1f353",
    //    "": "1f349",
    //    "": "1f345",
    //    "": "1f346",
    //    "[メロン]": "1f348",
    //    "[パイナップル]": "1f34d",
    //    "[ブドウ]": "1f347",
    //    "[モモ]": "1f351",
    //    "": "1f440",
    //    "": "1f442",
    //    "": "1f443",
    //    "": "1f444",
    //    "": "1f61d",
    //    "": "1f484",
    //    "": "1f485",
    //    "": "1f486",
    //    "": "1f487",
    //    "": "1f488",
    //    "〓": "2005",
    //    "": "1f466",
    //    "": "1f467",
    //    "": "1f468",
    //    "": "1f469",
    //    "[家族]": "1f46a",
    //    "": "1f46b",
    //    "": "1f46e",
    //    "": "1f46f",
    //    "[花嫁]": "1f470",
    //    "": "1f471",
    //    "": "1f472",
    //    "": "1f473",
    //    "": "1f474",
    //    "": "1f475",
    //    "": "1f476",
    //    "": "1f477",
    //    "": "1f478",
    //    "[なまはげ]": "1f479",
    //    "[天狗]": "1f47a",
    //    "": "1f47b",
    //    "": "1f47c",
    //    "": "1f47d",
    //    "": "1f47e",
    //    "": "1f47f",
    //    "": "1f480",
    //    "": "1f481",
    //    "": "1f482",
    //    "": "1f483",
    //    "[カタツムリ]": "1f40c",
    //    "": "1f40d",
    //    "": "1f40e",
    //    "": "1f414",
    //    "": "1f417",
    //    "": "1f42b",
    //    "": "1f418",
    //    "": "1f428",
    //    "": "1f412",
    //    "": "1f411",
    //    "": "1f419",
    //    "": "1f41a",
    //    "": "1f41b",
    //    "[アリ]": "1f41c",
    //    "[ミツバチ]": "1f41d",
    //    "[てんとう虫]": "1f41e",
    //    "": "1f420",
    //    "": "1f3a3",
    //    "[カメ]": "1f422",
    //    "": "1f423",
    //    "": "1f426",
    //    "": "1f427",
    //    "": "1f436",
    //    "": "1f42c",
    //    "": "1f42d",
    //    "": "1f42f",
    //    "": "1f431",
    //    "": "1f433",
    //    "": "1f434",
    //    "": "1f435",
    //    "": "1f43d",
    //    "": "1f43b",
    //    "": "1f439",
    //    "": "1f43a",
    //    "": "1f42e",
    //    "": "1f430",
    //    "": "1f438",
    //    "": "1f463",
    //    "[辰]": "1f432",
    //    "[パンダ]": "1f43c",
    //    "": "1f620",
    //    "": "1f64d",
    //    "": "1f632",
    //    "": "1f61e",
    //    "": "1f62b",
    //    "": "1f630",
    //    "": "1f612",
    //    "": "1f63b",
    //    "": "1f63c",
    //    "": "1f61c",
    //    "": "1f60a",
    //    "": "1f63d",
    //    "": "1f61a",
    //    "": "1f637",
    //    "": "1f633",
    //    "": "1f63a",
    //    "": "1f605",
    //    "": "1f60c",
    //    "": "1f639",
    //    "": "263a",
    //    "": "1f604",
    //    "": "1f63f",
    //    "": "1f62d",
    //    "": "1f628",
    //    "": "1f64e",
    //    "": "1f4ab",
    //    "": "1f631",
    //    "": "1f62a",
    //    "": "1f60f",
    //    "": "1f613",
    //    "": "1f625",
    //    "": "1f609",
    //    "": "1f645",
    //    "": "1f646",
    //    "": "1f647",
    //    "(/_＼)": "1f648",
    //    "(・×・)": "1f64a",
    //    "|(・×・)|": "1f649",
    //    "": "270b",
    //    "": "1f64c",
    //    "": "1f64f",
    //    "": "1f3e1",
    //    "": "1f3e2",
    //    "": "1f3e3",
    //    "": "1f3e5",
    //    "": "1f3e6",
    //    "": "1f3e7",
    //    "": "1f3e8",
    //    "": "1f3e9",
    //    "": "1f3ea",
    //    "": "1f3eb",
    //    "": "26ea",
    //    "": "26f2",
    //    "": "1f3ec",
    //    "": "1f3ef",
    //    "": "1f3f0",
    //    "": "1f3ed",
    //    "": "1f6a2",
    //    "": "1f376",
    //    "": "1f5fb",
    //    "": "1f5fc",
    //    "": "1f5fd",
    //    "[日本地図]": "1f5fe",
    //    "[モアイ]": "1f5ff",
    //    "": "1f45f",
    //    "": "1f460",
    //    "": "1f461",
    //    "": "1f462",
    //    "[メガネ]": "1f453",
    //    "": "1f45a",
    //    "[ジーンズ]": "1f456",
    //    "": "1f451",
    //    "": "1f454",
    //    "": "1f452",
    //    "": "1f457",
    //    "": "1f458",
    //    "": "1f459",
    //    "[財布]": "1f45b",
    //    "": "1f45c",
    //    "[ふくろ]": "1f45d",
    //    "": "1f4b5",
    //    "": "1f4b1",
    //    "": "1f4c8",
    //    "[カード]": "1f4b3",
    //    "￥": "1f4b4",
    //    "[飛んでいくお金]": "1f4b8",
    //    "": "1f1e81f1f3",
    //    "": "1f1e91f1ea",
    //    "": "1f1ea1f1f8",
    //    "": "1f1eb1f1f7",
    //    "": "1f1ec1f1e7",
    //    "": "1f1ee1f1f9",
    //    "": "1f1ef1f1f5",
    //    "": "1f1f01f1f7",
    //    "": "1f1f71f1fa",
    //    "": "1f1fa1f1f8",
    //    "": "1f525",
    //    "[懐中電灯]": "1f526",
    //    "[レンチ]": "1f527",
    //    "": "1f528",
    //    "[ネジ]": "1f529",
    //    "[包丁]": "1f52a",
    //    "": "1f52b",
    //    "": "1f52f",
    //    "": "1f530",
    //    "": "1f531",
    //    "": "1f489",
    //    "": "1f48a",
    //    "": "1f170",
    //    "": "1f171",
    //    "": "1f18e",
    //    "": "1f17e",
    //    "": "1f380",
    //    "": "1f4e6",
    //    "": "1f382",
    //    "": "1f384",
    //    "": "1f385",
    //    "": "1f38c",
    //    "": "1f386",
    //    "": "1f388",
    //    "": "1f389",
    //    "": "1f38d",
    //    "": "1f38e",
    //    "": "1f393",
    //    "": "1f392",
    //    "": "1f38f",
    //    "": "1f387",
    //    "": "1f390",
    //    "": "1f383",
    //    "[オメデトウ]": "1f38a",
    //    "[七夕]": "1f38b",
    //    "": "1f391",
    //    "[ポケベル]": "1f4df",
    //    "": "1f4de",
    //    "": "1f4f1",
    //    "": "1f4f2",
    //    "": "1f4d1",
    //    "": "1f4e0",
    //    "": "1f4e7",
    //    "": "1f4eb",
    //    "": "1f4ee",
    //    "[新聞]": "1f4f0",
    //    "": "1f4e2",
    //    "": "1f4e3",
    //    "": "1f4e1",
    //    "[送信BOX]": "1f4e4",
    //    "[受信BOX]": "1f4e5",
    //    "[ABCD]": "1f520",
    //    "[abcd]": "1f521",
    //    "[1234]": "1f522",
    //    "[記号]": "1f523",
    //    "[ABC]": "1f524",
    //    "[ペン]": "2712",
    //    "": "1f4ba",
    //    "": "1f4bb",
    //    "[クリップ]": "1f4ce",
    //    "": "1f4bc",
    //    "": "1f4be",
    //    "": "1f4bf",
    //    "": "1f4c0",
    //    "": "2702",
    //    "[画びょう]": "1f4cc",
    //    "[カレンダー]": "1f4c6",
    //    "[フォルダ]": "1f4c2",
    //    "": "1f4d2",
    //    "[名札]": "1f4db",
    //    "[スクロール]": "1f4dc",
    //    "[グラフ]": "1f4c9",
    //    "[定規]": "1f4cf",
    //    "[三角定規]": "1f4d0",
    //    "": "26be",
    //    "": "26f3",
    //    "": "1f3be",
    //    "": "26bd",
    //    "": "1f3bf",
    //    "": "1f3c0",
    //    "": "1f3c1",
    //    "[スノボ]": "1f3c2",
    //    "": "1f3c3",
    //    "": "1f3c4",
    //    "": "1f3c6",
    //    "": "1f3c8",
    //    "": "1f3ca",
    //    "": "1f683",
    //    "": "24c2",
    //    "": "1f684",
    //    "": "1f685",
    //    "": "1f697",
    //    "": "1f699",
    //    "": "1f68c",
    //    "": "1f68f",
    //    "": "2708",
    //    "": "26f5",
    //    "": "1f689",
    //    "": "1f680",
    //    "": "1f6a4",
    //    "": "1f695",
    //    "": "1f69a",
    //    "": "1f692",
    //    "": "1f691",
    //    "": "1f6a8",
    //    "": "26fd",
    //    "": "1f17f",
    //    "": "1f6a5",
    //    "": "26d4",
    //    "": "2668",
    //    "": "26fa",
    //    "": "1f3a1",
    //    "": "1f3a2",
    //    "": "1f3a4",
    //    "": "1f4f9",
    //    "": "1f3a6",
    //    "": "1f3a7",
    //    "": "1f3a8",
    //    "": "1f3ad",
    //    "[イベント]": "1f3aa",
    //    "": "1f3ab",
    //    "": "1f3ac",
    //    "[ゲーム]": "1f3ae",
    //    "": "1f004",
    //    "": "1f3af",
    //    "": "1f3b0",
    //    "": "1f3b1",
    //    "[サイコロ]": "1f3b2",
    //    "[ボーリング]": "1f3b3",
    //    "[花札]": "1f3b4",
    //    "[ジョーカー]": "1f0cf",
    //    "": "1f3b5",
    //    "": "1f3bc",
    //    "": "1f3b7",
    //    "": "1f3b8",
    //    "[ピアノ]": "1f3b9",
    //    "": "1f3ba",
    //    "[バイオリン]": "1f3bb",
    //    "": "303d",
    //    "": "1f4f7",
    //    "": "1f4fa",
    //    "": "1f4fb",
    //    "": "1f4fc",
    //    "": "1f48b",
    //    "": "1f48c",
    //    "": "1f48d",
    //    "": "1f48e",
    //    "": "1f48f",
    //    "": "1f490",
    //    "": "1f491",
    //    "": "1f492",
    //    "": "1f51e",
    //    "": "a9",
    //    "": "ae",
    //    "": "2122",
    //    "[ｉ]": "2139",
    //    "": "2320e3",
    //    "": "3120e3",
    //    "": "3220e3",
    //    "": "3320e3",
    //    "": "3420e3",
    //    "": "3520e3",
    //    "": "3620e3",
    //    "": "3720e3",
    //    "": "3820e3",
    //    "": "3920e3",
    //    "": "3020e3",
    //    "[10]": "1f51f",
    //    "": "1f4f6",
    //    "": "1f4f3",
    //    "": "1f4f4",
    //    "": "1f354",
    //    "": "1f359",
    //    "": "1f370",
    //    "": "1f35c",
    //    "": "1f35e",
    //    "": "1f373",
    //    "": "1f366",
    //    "": "1f35f",
    //    "": "1f361",
    //    "": "1f358",
    //    "": "1f35a",
    //    "": "1f35d",
    //    "": "1f35b",
    //    "": "1f362",
    //    "": "1f363",
    //    "": "1f371",
    //    "": "1f372",
    //    "": "1f367",
    //    "[肉]": "1f356",
    //    "[なると]": "1f365",
    //    "[やきいも]": "1f360",
    //    "[ピザ]": "1f355",
    //    "[チキン]": "1f357",
    //    "[アイスクリーム]": "1f368",
    //    "[ドーナツ]": "1f369",
    //    "[クッキー]": "1f36a",
    //    "[チョコ]": "1f36b",
    //    "[キャンディ]": "1f36d",
    //    "[プリン]": "1f36e",
    //    "[ハチミツ]": "1f36f",
    //    "[エビフライ]": "1f364",
    //    "": "1f374",
    //    "": "2615",
    //    "": "1f379",
    //    "": "1f37a",
    //    "": "1f375",
    //    "": "1f37b",
    //    "": "2934",
    //    "": "2935",
    //    "": "2196",
    //    "": "2199",
    //    "⇔": "2194",
    //    "↑↓": "1f503",
    //    "": "2b06",
    //    "": "2b07",
    //    "": "27a1",
    //    "": "1f519",
    //    "": "25b6",
    //    "": "25c0",
    //    "": "23e9",
    //    "": "23ea",
    //    "▲": "1f53c",
    //    "▼": "1f53d",
    //    "": "2b55",
    //    "": "2716",
    //    "": "2757",
    //    "！？": "2049",
    //    "！！": "203c",
    //    "": "2753",
    //    "": "2754",
    //    "": "2755",
    //    "～": "27b0",
    //    "": "27bf",
    //    "": "2764",
    //    "": "1f49e",
    //    "": "1f494",
    //    "": "1f497",
    //    "": "1f498",
    //    "": "1f499",
    //    "": "1f49a",
    //    "": "1f49b",
    //    "": "1f49c",
    //    "": "1f49d",
    //    "": "1f49f",
    //    "": "2665",
    //    "": "2660",
    //    "": "2666",
    //    "": "2663",
    //    "": "1f6ac",
    //    "": "1f6ad",
    //    "": "267f",
    //    "[旗]": "1f6a9",
    //    "": "26a0",
    //    "": "1f6b2",
    //    "": "1f6b6",
    //    "": "1f6b9",
    //    "": "1f6ba",
    //    "": "1f6c0",
    //    "": "1f6bb",
    //    "": "1f6bd",
    //    "": "1f6be",
    //    "": "1f6bc",
    //    "[ドア]": "1f6aa",
    //    "[禁止]": "1f6ab",
    //    "[チェックマーク]": "2705",
    //    "[CL]": "1f191",
    //    "": "1f192",
    //    "[FREE]": "1f193",
    //    "": "1f194",
    //    "": "1f195",
    //    "[NG]": "1f196",
    //    "": "1f197",
    //    "[SOS]": "1f198",
    //    "": "1f199",
    //    "": "1f19a",
    //    "": "1f201",
    //    "": "1f202",
    //    "[禁]": "1f232",
    //    "": "1f233",
    //    "[合]": "1f234",
    //    "": "1f235",
    //    "": "1f236",
    //    "": "1f21a",
    //    "": "1f237",
    //    "": "1f238",
    //    "": "1f239",
    //    "": "1f22f",
    //    "": "1f23a",
    //    "": "3299",
    //    "": "3297",
    //    "": "1f250",
    //    "[可]": "1f251",
    //    "[＋]": "2795",
    //    "[－]": "2796",
    //    "[÷]": "2797",
    //    "": "1f4a1",
    //    "": "1f4a2",
    //    "": "1f4a3",
    //    "": "1f4a4",
    //    "[ドンッ]": "1f4a5",
    //    "": "1f4a7",
    //    "": "1f4a8",
    //    "": "1f4a9",
    //    "": "1f4aa",
    //    "[フキダシ]": "1f4ac",
    //    "": "2747",
    //    "": "2734",
    //    "": "2733",
    //    "": "1f534",
    //    "": "25fc",
    //    "": "1f539",
    //    "": "2b50",
    //    "[花丸]": "1f4ae",
    //    "[100点]": "1f4af",
    //    "←┘": "21a9",
    //    "└→": "21aa",
    //    "": "1f50a",
    //    "[電池]": "1f50b",
    //    "[コンセント]": "1f50c",
    //    "": "1f50e",
    //    "": "1f510",
    //    "": "1f513",
    //    "": "1f511",
    //    "": "1f514",
    //    "[ラジオボタン]": "1f518",
    //    "[ブックマーク]": "1f516",
    //    "[リンク]": "1f517",
    //    "[end]": "1f51a",
    //    "[ON]": "1f51b",
    //    "[SOON]": "1f51c",
    //    "": "1f51d",
    //    "": "270a",
    //    "": "270c",
    //    "": "1f44a",
    //    "": "1f44d",
    //    "": "261d",
    //    "": "1f446",
    //    "": "1f447",
    //    "": "1f448",
    //    "": "1f449",
    //    "": "1f44b",
    //    "": "1f44f",
    //    "": "1f44c",
    //    "": "1f44e",
    //    "": "1f450"
    //    },

    var emotionTable = {
        "/::)": "0",
        "/::~": "1",
        "/::B": "2",
        "/::|": "3",
        "/:8-)": "4",
        "/::<": "5",
        "/::&lt;": "5",
        "/::$": "6",
        "/::X": "7",
        "/::Z": "8",
        "/::'(": "9",
        "/::-|": "10",
        "/::@": "11",
        "/::P": "12",
        "/::D": "13",
        "/::O": "14",
        "/::(": "15",
        "/::+": "16",
        "/:--b": "17",
        "/::Q": "18",
        "/::T": "19",
        "/:,@P": "20",
        "/:,@-D": "21",
        "/::d": "22",
        "/:,@o": "23",
        "/::g": "24",
        "/:|-)": "25",
        "/::!": "26",
        "/::L": "27",
        "/::>": "28",
        "/::&gt;": "28",
        "/::,@": "29",
        "/:,@f": "30",
        "/::-S": "31",
        "/:?": "32",
        "/:,@x": "33",
        "/:,@@": "34",
        "/::8": "35",
        "/:,@!": "36",
        "/:!!!": "37",
        "/:xx": "38",
        "/:bye": "39",
        "/:wipe": "40",
        "/:dig": "41",
        "/:handclap": "42",
        "/:&-(": "43",
        "/:&amp;-(": "43",
        "/:B-)": "44",
        "/:<@": "45",
        "/:&lt;@": "45",
        "/:@>": "46",
        "/:@&gt;": "46",
        "/::-O": "47",
        "/:>-|": "48",
        "/:&gt;-|": "48",
        "/:P-(": "49",
        "/::'|": "50",
        "/:X-)": "51",
        "/::*": "52",
        "/:@x": "53",
        "/:8*": "54",
        "/:pd": "55",
        "/:<W>": "56",
        "/:&lt;W&gt;": "56",
        "/:beer": "57",
        "/:basketb": "58",
        "/:oo": "59",
        "/:coffee": "60",
        "/:eat": "61",
        "/:pig": "62",
        "/:rose": "63",
        "/:fade": "64",
        "/:showlove": "65",
        "/:heart": "66",
        "/:break": "67",
        "/:cake": "68",
        "/:li": "69",
        "/:bome": "70",
        "/:kn": "71",
        "/:footb": "72",
        "/:ladybug": "73",
        "/:shit": "74",
        "/:moon": "75",
        "/:sun": "76",
        "/:gift": "77",
        "/:hug": "78",
        "/:strong": "79",
        "/:weak": "80",
        "/:share": "81",
        "/:v": "82",
        "/:@)": "83",
        "/:jj": "84",
        "/:@@": "85",
        "/:bad": "86",
        "/:lvu": "87",
        "/:no": "88",
        "/:ok": "89",
        "/:love": "90",
        "/:<L>": "91",
        "/:&lt;L&gt;": "91",
        "/:jump": "92",
        "/:shake": "93",
        "/:<O>": "94",
        "/:&lt;O&gt;": "94",
        "/:circle": "95",
        "/:kotow": "96",
        "/:turn": "97",
        "/:skip": "98",
        "/:oY": "99",
        "/:#-0": "100",
        "/:hiphot": "101",
        "/:kiss": "102",
        "/:<&": "103",
        "/:&lt;&amp;": "103",
        "/:&>": "104",
        "/:&amp;&gt;": "104"
    },

    inverseTable = {
        "0":"/::)",
        "1":"/::~",
        "2":"/::B",
        "3":"/::|",
        "5":"/::<",
        "6":"/::$",
        "7":"/::X",
        "8":"/::Z",
        "11":"/::@",
        "12":"/::P",
        "13":"/::D",
        "14":"/::O",
        "15":"/::(",
        "16":"/::+",
        "22":"/::d",
        "18":"/::Q",
        "19":"/::T",
        "24":"/::g",
        "35":"/::8",
        "26":"/::!",
        "27":"/::L",
        "38":"/:xx",
        "28":"/::>",
        "4":"/:8-)",
        "9":"/::'(",
        "10":"/::-|",
        "20":"/:,@P",
        "17":"/:--b",
        "23":"/:,@o",
        "25":"/:|-)",
        "29":"/::,@",
        "30":"/:,@f",
        "31":"/::-S",
        "33":"/:,@x",
        "34":"/:,@@",
        "47":"/::-O",
        "48":"/:>-|",
        "49":"/:P-(",
        "50":"/::'|",
        "51":"/:X-)",
        "36":"/:,@!",
        "37":"/:!!!",
        "39":"/:bye",
        "45":"/:<@",
        "46":"/:@>",
        "52":"/::*",
        "53":"/:@x",
        "54":"/:8*",
        "55":"/:pd",
        "32":"/:?",
        "21":"/:,@-D",
        "40":"/:wipe",
        "41":"/:dig",
        "42":"/:handclap",
        "43":"/:&-(",
        "44":"/:B-)",
        "56":"/:<W>",
        "59":"/:oo",
        "69":"/:li",
        "83":"/:@)",
        "84":"/:jj",
        "85":"/:@@",
        "71":"/:kn",
        "88":"/:no",
        "89":"/:ok",
        "99":"/:oY",
        "61":"/:eat",
        "62":"/:pig",
        "76":"/:sun",
        "91":"/:<L>",
        "94":"/:<O>",
        "78":"/:hug",
        "86":"/:bad",
        "87":"/:lvu",
        "68":"/:cake",
        "74":"/:shit",
        "75":"/:moon",
        "70":"/:bome",
        "63":"/:rose",
        "77":"/:gift",
        "80":"/:weak",
        "64":"/:fade",
        "57":"/:beer",
        "97":"/:turn",
        "98":"/:skip",
        "90":"/:love",
        "92":"/:jump",
        "66":"/:heart",
        "67":"/:break",
        "81":"/:share",
        "72":"/:footb",
        "96":"/:kotow",
        "93":"/:shake",
        "60":"/:coffee",
        "79":"/:strong",
        "95":"/:circle",
        "58":"/:basketb",
        "73":"/:ladybug",
        "65":"/:showlove",
        "82":"/:v",
        "100":"/:#-0",
        "101":"/:hiphot",
        "102":"/:kiss",
        "103":"/:<&",
        "104":"/:&>"
    },

    emojiStringA = '<span class="weixinEmoji weixinEmoji-',
    emojiStringB = '"></span>';
    //emotionUrl = "https://res.wx.qq.com/mpres/htmledition/images/icon/emotion/",
    emotionUrl = WebAgent.config.weixinEmojiPath,
    emotionStringA = '<img src="' + emotionUrl;
    emotionStringB = '.gif" width="24" height="24">';

    var replace = function(str) {
        //for (var t in emojiTable) while (-1 != str.indexOf(t)) str = str.replace(t, emojiStringA + emojiTable[t]+ emojiStringB);

        for (var t in emotionTable) while (-1 != str.indexOf(t)) str = str.replace(t, emotionStringA + emotionTable[t] + emotionStringB);
        return str;
    };

    var getInverseStr = function(str) {
        return inverseTable[str]
    };

    return {
        replace: replace,
        getInverseStr: getInverseStr
    }
})();
define("weixinEmojiExtend", function(){});

/**
 * Created by mengchen on 2015/11/23.
 */

define('Message',["knockout", "util", "css!weixinEmojiC", "weixinEmojiJ", "weixinEmojiExtend"], function(ko, util) {
    return function(text, direction, type, dates,name) {
        var DIRECTION = {
            SEND : "send",
            RECV : "recv",
            TIP :  "tip"
        };

        //转义特殊字符
        if(type == "text") {
/*            if(direction == DIRECTION.SEND) {
                    text = text.replace(/&/g,"&amp;")
                     .replace(/</g,"&lt;")
                     .replace(/>/g,"&gt;")
                     .replace(/\"/g,"&quot;");
                }
                text = WeixinEmojiExtend.replace(require("Vm").checkUrl(text));

            }*/

            text = text && text.replace(/\n/g,"<br/>");
            //else {
            //    text = require("Vm").checkUrl(text);
            //}
        }

        this.text = text;
        this.direction = (direction || DIRECTION.RECV);
        this.type = type;
        //this.dateObj = dates;

        //获取聊天记录里的时间不需要转换，实时发送的消息需要转换
        if(dates instanceof Date) {
            this.time = function() {
               return util.FormatDate(dates);
            }
        } else {
            this.time = ko.observable(dates);
        }

        this.name = name;
    };
});
/**
 * Created by panfei on 2015/12/29.
 */
define('RegisterEvent',[], function() {
    var eventName = {
        updateOrAddUser: "updateOrAddUser",
        kchartCreate: "kchartCreate",
        getButelState: "getButelState",
        busyCallback: "busyCallback",
        readyCallback: "readyCallback",
        loginCallback: "loginCallback",
        loginFailCallback: "loginFailCallback",
        logOutCallback: "logOutCallback",
        selectUser: "selectUser",
        sessionQuit: "sessionQuit",
        newCustomInter: "newCustomInter",
        timeOutTip: "timeOutTip",
        unReadMsgNum: "unReadMsgNum",
        openfireDisconnect: "openfireDisconnect",
        butelAjaxError: "butelAjaxError",
        callIn: "callIn",
        autoMatchCallback: "autoMatchCallback" ,//开启自动匹配，切换到常用语界面
        openIntellCallback: "openIntellCallback" //智能协作，切换到智能协作界面
    }

    var event = {};

    /**
     * 注册事件监听
     * @param name
     * @param handler
     */
    function registerEvent(name, handler) {
        if(typeof event[name] === "undefined") {
            event[name] = [];
        }
        if(typeof handler === "function") {
            event[name].push(handler);
        }
    }

    /**
     * 移除事件监听
     * @param name
     * @param handler
     */
    function removeEvent(name, handler) {
        if(!event[name]) {
            return;
        }
        if (!handler) {
            event[name] = [];
            return;
        }
        for(var i = 0; i < event[name].length; i++) {
            //if(event[name][i] === handler) {
            if(event[name][i].name && (event[name][i].name === handler.name)) {
                event[name].splice(i,1);
                break;
            }
        }
    }

    /**
     * 触发事件监听
     * @param name
     * @param data
     */
    function trigger(name, data) {
        if(!event[name]) {
            return;
        }
        for(var i = 0; i < event[name].length; i++) {
            event[name][i](data);
        }
    }

    return{
        registerEvent: registerEvent,
        removeEvent: removeEvent,
        updateOrAddUser: function(data) {
            trigger(eventName.updateOrAddUser, data);
        },
        kchartCreate: function(data) {
            trigger(eventName.kchartCreate, data);
        },
        getButelState: function(data) {
            trigger(eventName.getButelState, data);
        },
        busyCallback: function(data) {
            trigger(eventName.busyCallback, data);
        },
        readyCallback: function(data) {
            trigger(eventName.readyCallback, data);
        },
        loginCallback: function(data) {
            trigger(eventName.loginCallback, data);
        },
        loginFailCallback: function(data) {
            trigger(eventName.loginFailCallback, data);
        },
        logOutCallback: function(data) {
            trigger(eventName.logOutCallback, data);
        },
        selectUser: function(data) {
            trigger(eventName.selectUser, data);
        },
        sessionQuit: function(data) {
            trigger(eventName.sessionQuit, data);
        },
        newCustomInter: function(data) {
            trigger(eventName.newCustomInter, data);
        },
        timeOutTip: function(data) {
            trigger(eventName.timeOutTip, data);
        },
        unReadMsgNum: function(data) {
            trigger(eventName.unReadMsgNum, data);
        },
        openfireDisconnect: function() {
            trigger(eventName.openfireDisconnect);
        },
        butelAjaxError: function(data) {
            trigger(eventName.butelAjaxError, data);
        },
        autoMatchCallback: function(data) {
            trigger(eventName.autoMatchCallback, data);
        },
        openIntellCallback: function (data) {
            trigger(eventName.openIntellCallback, data);
        },
        callIn: function (data) {
            trigger(eventName.callIn, data);
        }
    }
})
;
/**
 * Created by panfei on 2015/11/23.
 */

define('User',["knockout", "require", "Message", "util", "RegisterEvent"], function (ko, require, Message, util, registerEvent) {
    
    return function (name, ent, channel="webim", sessionId="",chatBoxType="custom-chat") {
        var self = this;
        var msgDirec; //消息方向
        var msgSource; //消息来源
        var t = null; //计时器
        var sessionT = null; // 会话时长计时器

        //标识与客户的当前这通会话
        this.sessionId = sessionId;
        /**
         * 聊天框类型
         * 与客户聊天框：custom-chat
         * 与坐席聊天框：agent-chat
         * 与客户群聊框：custom-group
         * 与坐席群聊框：agent-group
         */
        this.chatBoxType = ko.observable(chatBoxType);
        
        this.chatBoxNum = 2;
        //是否对该用户主动发送了请求评价
        this.hasSendEvalRequest = ko.observable(true);

        this.isSendEvalRequestBtnShow = ko.computed(function(){
            return self.chatBoxType() == "custom-chat" && self.hasSendEvalRequest();
        });
        //转接坐席按钮是否显示
        this.isTransferAgentBtnShow = ko.computed(function(){
            return self.chatBoxType() == "custom-chat"
        });
        //添加坐席按钮是否显示
        this.isAddAgentBtnShow =  ko.computed(function(){
            return self.chatBoxType() !== "custom-group"
        });
        this.serviceVideo = ko.observable(false);
        this.serviceAduio = ko.observable(false);
        this.isNewUser = ko.observable(true);//标识是否是新客户
        this.memberNum="";
        this.beInvited="";
        this.members=ko.observableArray([]);
        this.membersAgentIdList=[];
        
        this.name = name;
        this.ent = ent;
        this.channel = channel;
        
        this.nickName = ko.observable(""); //客户姓名
        
        this.resource = "";
        
        this.inputText = ko.observable();
        
        this.msgNumber = ko.observable(0);
        this.messages = ko.observableArray();
        
        this.webrtcNum = ko.observable("");
        this.chatType = ko.observable("chat");
        
        
        //this.lastMsg = ko.observable();
        this.visitorInfo = ko.observable({
            workOrderName: ko.observable(self.name && self.name.substring(0, 10)),
            workOrderEmail: ko.observable(),
            workOrderPhone: ko.observable()
        });
        this.visitInfo = ko.observable({
            sessionAntecedents: ko.observable(),
            geoLocation: ko.observable(),
            ipAddress: ko.observable(),
            browserType: ko.observable(),
            operatingSystem: ko.observable()
        });
        this.workOrder = ko.observableArray();
        
        this.online = ko.observable(true);
        this.skillGroupId = ko.observable();   //接入客户的技能组id
        this.skillName = "";   //接入客户的技能组名称
        
        this.isCalling = false;
        
        this.kickOff = function () {
            self.online(false);
        };
        
        //是否显示更多消息记录
        this.hasMoreHistory = ko.observable(false);
        
        //获取下一页消息记录开始时间
        this.getHistoryStartTime = "";
        
        //获取下一页消息记录开始sessionId
        this.historySessionId = "";
        
        // 当前user的会话时长
        this.sessionTime = ko.observable(0);
        this.showSessionTime = ko.observable('');
        
        this.addMessage = function (text, direction, type, time, name, source, isMoreMsg) {
            //self.messages.push(new Message(text, direction, type, time, name));
            
            if (source == "history") { //获取到的消息记录是倒序
                self.messages.unshift(new Message(text, direction, type, time, name));
            } else { //正常发送接收消息数据是正序
                self.messages.push(new Message(text, direction, type, time, name));
            }
            
            //不是更多消息时滚动条滚到底部
            if (!isMoreMsg) {
                //由于图片加载有延迟，滚动条滚动时图片还没加载完，导致无法滚动到底部，等图片加载完再执行滚动条滚动
                if (type == "image") {
                    var image = new Image();
                    image.onload = function () {
                        util.ScrollToBottom();
                    };
                    image.src = text.zoom || text.original;
                } else {
                    util.ScrollToBottom();
                }
                
            }
            
            msgDirec = direction;
            msgSource = source;
            
            //客户在未超时情况下发送消息，执行计时函数
            if (direction == 'recv' && !self.isTiming && self.online() && msgSource != "history") {
                self.chatBoxType()== "custom-chat" && self.agentTimeoutReply();
            }
            
            if (direction == "send" && msgSource != "history") {
                self.timeOutBack() != 'blue' ? self.timeOutBack('blue') : '';
                self.isTiming = false;
                self.isFirstTiming = false;
                self.isSecondTiming = false;
            }
            
            //if(!isMoreMsg){ //不是更多消息时滚动条滚到底部
            //    //由于图片加载有延迟，滚动条滚动时图片还没加载完，导致无法滚动到底部，等图片加载完再执行滚动条滚动
            //    if(type == "image") {
            //        var imgLen = $(".chat-send-recv-img").length;
            //        $(".chat-send-recv-img")[imgLen - 1].onload = function() {
            //            util.ScrollToBottom();
            //        };
            //    } else {
            //        util.ScrollToBottom();
            //    }
            //}
        };
        /**
         * 获取最后一条数据的方向和时间
         */
        this.getLastMessage = function () {
            var self = this;
            var result = {};
            if (self.messages().length) {
                result.previousTime = self.messages()[self.messages().length - 1].time();
                result.previousDirection = self.messages()[self.messages().length - 1].direction;
            }
            return result;
        };
        
        //最后一条消息
        this.lastMsg = ko.computed(function () {
            var self = this;
            
            if (self.messages().length) {
                var type = self.messages()[self.messages().length - 1].type;
                var text = self.messages()[self.messages().length - 1].text;
                
                switch ( type ) {
                    case "image":
                        return "[图片]";
                    case "file":
                        return "[文件]";
                    case "voice":
                        return "[语音]";
                    case "shortvideo":
                        return "[视频]";
                    default :
                        if (text && (text.indexOf("<br/>") != -1)) {
                            return (text.split("<br/>")[0] + "...");
                        } else {
                            return text;
                        }
                    //if (text && text.split("<br/>")[0]) {
                    //    return (text.split("<br/>")[0] + "...");
                    //} else {
                    //    return text;
                    //}
                    
                }
            }
        }, this);
        
        this.timeOutBack = ko.observable('blue');   //图标正常、超时、严重超时颜色
        this.timeOut1 = null;   //第一次超时时间
        this.timeOut2 = null;   //第二次超时时间
        this.isTiming = false;  //超时标志
        this.isFirstTiming = false; //第一次超时标志
        this.isSecondTiming = false; //第二次超时标志
        
        this.timing = ko.observable(0); //超时时间
        
        /**
         * 将秒转换成时分秒
         * @param timing
         */
        var formatTiming = function (timing) {
            if (timing < 60) {
                if (timing < 10) {
                    return "00:0" + timing;
                } else {
                    return "00:" + timing;
                }
            } else {
                var min = parseInt(timing / 60);
                var sec = timing % 60;
                
                if (min < 10) {
                    if (sec < 10) {
                        return "0" + min + ":0" + sec;
                    } else {
                        return "0" + min + ":" + sec;
                    }
                } else {
                    if (sec < 10) {
                        return min + ":0" + sec;
                    } else {
                        return min + ":" + sec;
                    }
                }
            }
        };
        
        // 计算时分秒
        var formatSeconds = function (value) {
            var result = parseInt(value);
            var h = Math.floor(result / 3600) < 10 ? '0' + Math.floor(result / 3600) : Math.floor(result / 3600);
            var m = Math.floor((result / 60 % 60)) < 10 ? '0' + Math.floor((result / 60 % 60)) : Math.floor((result / 60 % 60));
            var s = Math.floor((result % 60)) < 10 ? '0' + Math.floor((result % 60)) : Math.floor((result % 60));
            var res = '';
            if (h !== '00') res += h +':';
            res += m + ':';
            res += s;
            return res;
        };
        
        // 修改会话时长 type = open / close
        this.changeSessionTime = function (type) {
            if (type === 'open') {
                self.sessionT = setInterval(function () {
                    self.sessionTime(self.sessionTime() + 1);
                    self.showSessionTime(formatSeconds(self.sessionTime()));
                }, 1000);
            } else {
                clearInterval(self.sessionT);
                self.sessionTime(0);
                self.showSessionTime(formatSeconds(self.sessionTime()));
            }
        };
        
        /**
         * 坐席超时未回复
         */
        this.agentTimeoutReply = function () {
            //var t = null;
            var firstMsgTime = new Date().getTime();  //计时的开始时间
            var timing = 0;  //计时时间
            
            if (t) {
                clearInterval(t);
                //return;
            }
            t = setInterval(function () {
                
                timing = parseInt((new Date().getTime() - firstMsgTime) / 1000);
                self.timing(formatTiming(timing));
                
                //客户下线不再计时，关闭提醒
                if (!self.online()) {
                    self.timeOutBack('');
                    timing = 0;
                    self.timing(0);
                    self.isTiming = false;
                    self.isFirstTiming = false;
                    self.isSecondTiming = false;
                    clearInterval(t);
                    t = null;
                    //require("Vm").messageTip().close();
                    return;
                }
                
                //坐席回复消息后清除计时器
                if (msgDirec == "send" && msgSource != "history") {
                    timing = 0;
                    self.timing(0);
                    self.isTiming = false;
                    self.isFirstTiming = false;
                    self.isSecondTiming = false;
                    clearInterval(t);
                    t = null;
                    return;
                }
                
                //到达第一次超时时间，提醒坐席
                if (timing >= self.timeOut1 && !self.isFirstTiming) {
                    //旧弹出框--消息提醒
                    /* self.msgTip(self.timeOut1 / 60 + "分钟未回复" + self.name.substring(0, 10));*/
                    
                    
                    registerEvent.timeOutTip({
                        "timeout": self.timeOut1 / 60,
                        "name": self.nickName() ? self.nickName() : self.name.substring(0, 10)
                    });
                    self.isFirstTiming = true;
                    self.isTiming = true;
                    self.timeOutBack('yellow');
                    return;
                }
                
                // console.log("timeOut1:",self.timeOut2);
                
                //到达第二次超时时间，提醒坐席
                if (timing >= self.timeOut2 && !self.isSecondTiming) {
                    //旧弹出框--消息提醒
                    /* self.msgTip(self.timeOut2 / 60 + "分钟未回复" + self.name.substring(0, 10));*/
                    
                    //clearInterval(t);
                    //t = null;
                    self.isSecondTiming = true;
                    self.isTiming = true;
                    self.timeOutBack('red');
                    registerEvent.timeOutTip({
                        "timeout": self.timeOut2 / 60,
                        "name": self.nickName() ? self.nickName() : self.name.substring(0, 10)
                    });
                }
                
                //一小时未回复停止计时
                if (timing > 60 * 60 * 59) {
                    clearInterval(t);
                    t = null;
                }
                
            }, 1000);
        };
    };
});

/**
 * Created by mengchen on 2015/3/14.
 */
define('Drag',["jquery"], function($) {
    var KS = {};
    KS.dragElement = function(draggableElement, movableElement, containerElement) {

        var startMove = false;
        var pos = {
            x : 0,
            y : 0
        };

        $(draggableElement).bind("mousedown", function(event) {
            pos.x = event.clientX;
            pos.y = event.clientY;
            startMove = true;

            event.preventDefault ? event.preventDefault() : event.returnValue = false;
        });

        $(document).bind("mousemove", function(event) {
            if (!startMove) {
                return;
            }

            var clientX = event.clientX;
            var clientY = event.clientY;

            var diffX = clientX - pos.x;
            var diffY = clientY - pos.y;


            movableElement.style.left = movableElement.offsetLeft + diffX + "px";
            movableElement.style.top = movableElement.offsetTop + diffY + "px";

            if(containerElement) {
                var left = parseInt(movableElement.style.left);
                var top = parseInt(movableElement.style.top);
                var containerWidth = containerElement.offsetWidth;
                var containerHeight = containerElement.offsetHeight;
                var movableElementWidth = movableElement.offsetWidth;
                var movableElementHeight = movableElement.offsetHeight;
                var widthReduce = containerWidth - movableElementWidth;
                var heightReduce = containerHeight - movableElementHeight;

                widthReduce >= 0 ? imgWidthLt() : imgWidthGt();
                heightReduce >= 0 ? imgHeightLt() : imgHeightGt();
            }

            function imgWidthGt() {
                if(left >= 0){
                    movableElement.style.left = 0 +"px";
                }
                if(left < widthReduce){
                    movableElement.style.left = widthReduce + "px";
                }
            }

            function imgHeightGt() {
                if(top >= 0){
                    movableElement.style.top = 0+"px";
                }
                if(top < heightReduce){
                    movableElement.style.top = heightReduce + "px";
                }
            }

            function imgWidthLt() {
                if(left < 0){
                    movableElement.style.left = 0 +"px";
                }
                if(left > widthReduce){
                    movableElement.style.left = (widthReduce)+"px";
                }
            }

            function imgHeightLt() {
                if(top < 0){
                    movableElement.style.top = 0+"px";
                }
                if(top > heightReduce){
                    movableElement.style.top =(heightReduce)+"px";
                }
            }

            pos.x = clientX;
            pos.y = clientY;

            event.preventDefault ? event.preventDefault() : event.returnValue = false;
        }).bind("mouseup", function() {
            startMove = false;
        });

    };

    return KS;
});
/**
 * Created by fei on 2015/10/20.
 */
define('IMG',["jquery", "Drag"],function($, Drag) {

    var IMG = {};
    var containerWidth, containerHeight,
        $img, $imgContainer,
        initialWidth, initialHeight,
        isIEgt8,
        timer = null,
        ie8_deg = 0;

    var defaults = {
        deg      : 0,
        nPower   : 0,
        min_nPower : -15,
        max_nPower: 15
    };

    /**
     * 定位图片在缩小放大操作时始终居中
     * @param imgWidth
     * @param imgHeigh
     */
    function imgPosition(imgWidth,imgHeigh) {

        var $previewImage = $(".preview-image");
        //更改图片的大小
        $img.css("width", imgWidth + "px");
        $img.css("height", imgHeigh + "px");

        //获得图片与图片容器的高度差、宽度差
        var heightReduce = containerHeight - imgHeigh;
        var widthReduce = containerWidth - imgWidth;

        //居中定位图片
        $previewImage.css("top", (heightReduce / 2) + "px");
        $previewImage.css("left", (widthReduce / 2) + "px");
    }

    /**
     * 获取放大缩小的百分比
     * @param nPower
     */
    function imgPercent(nPower) {
        var $previewPercent = $(".preview-percent");
        var percent = parseInt(Math.pow(1.2,nPower) * 100) + "%";

        if($previewPercent.is(":hidden")) {
            $previewPercent.show();
        }

        $previewPercent.text(percent);

        if(timer) {
            clearTimeout(timer);
        }
        timer = setTimeout(function() {
            $(".preview-percent").hide();
        },1000);
    }

    /**
     * 图片旋转
     */
    function ie8_rotate() {
        ie8_deg = (ie8_deg + 1) % 4;
        _ie8_rotate(ie8_deg);
    }

    function _ie8_rotate(deg) {
        $img.get(0).style.filter = 'progid:DXImageTransform.Microsoft.BasicImage(rotation='+ deg + ')';
    }

    function rotate() {

        if(defaults.deg === 360){
            defaults.deg = 0;
        }
        $img.css("transform", "rotate(" + (defaults.deg += 90) + "deg)");
    }

    /**
     * 图片放大
     */
    function zoomIn() {
        if (defaults.nPower >= defaults.max_nPower) {return; }

        defaults.nPower++;
        imgPosition(initialWidth * Math.pow(1.2,defaults.nPower), initialHeight * Math.pow(1.2,defaults.nPower));
        imgPercent(defaults.nPower);
    }

    /**
     * 图片缩小
     */
    function zoomOut() {
        if (defaults.nPower <= defaults.min_nPower) {return; }

        defaults.nPower--;
        imgPosition(initialWidth * Math.pow(1.2,defaults.nPower), initialHeight * Math.pow(1.2,defaults.nPower));
        imgPercent(defaults.nPower);
    }

    /**
     * 在页面渲染出模态框
     */
    function getModal() {
        if ($("#preview-div").get(0)) return;
        var modalHtml = '<div id="preview-div" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static" style="padding-left: 0">\
                        <div style="text-align: center;">\
                            <div class="preview-container">\
                                <div class="preview-img-container">\
                                    <img class="preview-image" alt="" src="" id="img">\
        	   						<div class="preview-percent"></div>\
                                     <div class="preview-buttons">\
                                        <div class="preview-btn-group">\
                                            <span id="zoomIn" title="放大"></span>\
                                            <span id="zoomOut" title="缩小"></span>\
                                            <span id="rotate-btn" title="旋转"></span>\
                                        </div>\
                                     </div>\
                                </div>\
                                <div class="preview-close" data-dismiss="modal"></div>\
                            </div>\
                        </div>\
                    </div>';

        $("#chat_pane").append(modalHtml);

        var $rotateBtn = $("#rotate-btn");
        var $zoomIn = $("#zoomIn");
        var $zoomOut = $("#zoomOut");
        $img = $("#img");
        $imgContainer = $(".preview-img-container");

        //图片拖拽
        Drag.dragElement($img.get(0), $img.get(0), $imgContainer.get(0));

        //获得图片容器的实际尺寸
        containerWidth = $imgContainer.width();
        containerHeight = $imgContainer.height();

        //判断是不是IE8
        isIEgt8 = document.implementation.hasFeature("MouseEvents","2.0");

        if(!isIEgt8) {
            //图片旋转
            $rotateBtn.bind("dblclick", function() {
                ie8_rotate();
            });

            $rotateBtn.bind("click", function() {
                ie8_rotate();
            });

            //图片放大
            $zoomIn.bind("dblclick", function() {
                zoomIn();
            });

            //图片缩小
            $zoomOut.bind("dblclick", function() {
                zoomOut();
            });
        }

        //图片旋转
        $rotateBtn.bind("click", function() {
            rotate();
        });

        //图片放大
        $zoomIn.bind("click", function() {
            zoomIn();
        });

        //图片缩小
        $zoomOut.bind("click", function() {
            zoomOut();
        });

        /**
         * 图片滚轮事件
         * 五大浏览器（IE、Opera、Safari、Firefox、Chrome）中，firefox事件名为"DOMMouseScroll",其他浏览器事件名为"mousewheel".
         */
        $imgContainer.bind("mousewheel", zoomImageOnMouse).bind("DOMMouseScroll", zoomImageOnMouse);

        function zoomImageOnMouse(event) {

            //firefox使用detail，其余四类使用wheelDelta,Firefox向上滚 > 0，其他四个浏览器相反。
            var wheel = event.originalEvent.wheelDelta || -event.originalEvent.detail;
            wheel > 0 ? zoomIn() : zoomOut();
        }

        //按钮的隐藏与出现
        $imgContainer.bind("mouseover", function(){
            $(".preview-btn-group").show();
        }).bind("mouseout", function(){
            $(".preview-btn-group").hide();
        });

    }

    /**
     * 入口
     * @param imgUrl - 图片的url
     */
    IMG.show = function(imgUrl){

        defaults.deg = 0;
        defaults.nPower = 0;
        getModal();

        var image = new Image();
        image.onload = function () {
            var realWidth = initialWidth = image.width;
            var realHeight  = initialHeight = image.height;

            while((realWidth > containerWidth) || (realHeight > containerHeight)){
                defaults.nPower--;
                realWidth = initialWidth * Math.pow(1.2, defaults.nPower);
                realHeight = initialHeight * Math.pow(1.2, defaults.nPower);
            }

            imgPercent(defaults.nPower);
            imgPosition(realWidth, realHeight);
        };

        image.src = imgUrl;
        if(!isIEgt8) {
            ie8_deg = 0;
            _ie8_rotate(ie8_deg);
        }
        $img.css("transform", "rotate(0deg)"); //重新打开时deg
        $img.attr("src",imgUrl);

        //如果bootstrap是在全局引的，需要用window下的jQuery，因为modal是在window下的jQuery扩展的，否则用requuire内部的jQuery
        $("#preview-div").modal();

        //if(window.jQuery) {
        //    window.jQuery("#preview-div").modal();
        //} else {
        //    $("#preview-div").modal();
        //}

        $(".modal-backdrop").addClass("modal-background");
    }

    return IMG;
});
/**
 * Created by panfei on 2015/11/23.
 */

define('ViewModel',["jquery", "knockout", "util", "User", "require", "IMG", "RegisterEvent", "css!weixinEmojiC", "weixinEmojiJ", "weixinEmojiExtend"], function ($, ko, util, User, require, IMG, registerEvent) {
    return function () {
        var self = this;
        
        //检测url的正则
        var regUrl = new RegExp("(http://|https://|ftp://|www.)+\\S+", "g");
        var regPro = new RegExp("^(http://|https://|ftp://)"); //判断url里是否有协议
        
        //是否开启聊天记录共享
        this.isShareMessage = ko.observable("0");
        //是否已发送过请求评价
        //this.isSendEvalRequest = ko.observable(false);
        /**
         * 聊天窗体相关信息
         */
        this.username = ko.observable();
        //this.userList = ko.observableArray([new User("001", "002", "weixin")]);
        this.userList = ko.observableArray([]);
        this.currentUser = ko.observable(new User());
        this.inputText = ko.observable();
        this.nickContent = ko.observable({});
        this.isRegister = ko.observable(false);
        this.agentOnline = ko.observable(false);
        //消息发出后确认接收相关
        var ackMessageArr = [];
        this.msgSendFail = ko.observable(false);
        this.msgContent = ko.observable("");
        
        //是否开启敏感词提示框
        this.msgTip = ko.observable(false);
        this.msgWord = ko.observable("");
        this.msgWordHead = ko.observable("");
        
        //文本会话达到最大会话数，是否将状态置忙。默认为否
        this.isMaxTalkUpSetBusy = ko.observable(false);
        //文本会话最大会话数值
        this.maxTalkNum = ko.observable(0);
        
        //截图工具
        this.imPastePicDialog = ko.observable(false); //截图预览容器
        this.imCutToolDialog = ko.observable(false);//截图工具窗
        
        //截图发送取消事件
        this.pastePicCancel = function () {
            document.querySelector("#picDiv").innerHTML = "";
            self.imPastePicDialog(false);
        };
        
        // 快捷回复相关参数
        const commonWordList = JSON.parse(localStorage.getItem('commonWordList') || '[]');
        this.commonWordList = ko.observableArray(commonWordList);
        this.commonWordValue = ko.observable('');
        this.isShowCommonWordBtn = ko.observable(true);
        this.currentCommonWord = ko.observable();
        this.isShowCommonWordDialog =  ko.observable(false);
        
        // 存储到本地
        const saveCommonWordList = function (list) {
            localStorage.setItem('commonWordList', JSON.stringify(list));
        };
        
        // 新增常用语
        this.addCommonWord = function () {
            self.isShowCommonWordBtn(false);
        };
        
        // 删除常用语
        this.delCommonWord = function (index) {
            self.commonWordList.splice(index, 1);
            saveCommonWordList(self.commonWordList());
        };
        
        // 改变常用语状态
        this.handleChangeCommonWord = function (type) {
            if (type === 'submit') {
                if (self.commonWordValue().trim() === '') {
                    self.commonWordValue('');
                    return
                };
                self.commonWordList.push({
                    word: self.commonWordValue(),
                });
                saveCommonWordList(self.commonWordList());
            }
            self.commonWordValue('');
            self.isShowCommonWordBtn(true);
        };
        
        // 点击常用语发送信息
        this.sendCommonWord = function (index) {
            self.currentCommonWord(self.commonWordList()[index].word);
            self.sendMessage('commonWord');
            self.isShowCommonWordDialog(false);
        };
    
        // 展示常用语的弹框
        this.showCommonWordDialog = function () {
            self.isShowCommonWordDialog(true);
        }
        
        /**
         * 截图预览并返回发送接口事件
         * @param e 粘贴事件
         * @return function 截图发送事件
         * */
        this.pastePicFun = function (e) {
            var e = e.originalEvent; //使用jquery监听paste事件时加上此句，原生js不需要
            var cbd = e.clipboardData;
            var item = cbd.items[0];
            if (item.kind != "file") {
                return;
            }
            var blob = item.getAsFile();
            var size = blob.size;
            if (size == 0) {
                return;
            }
            /**
             * 图片预览
             */
            self.imPastePicDialog(true);
            //图片预览容器
            var picDiv = document.querySelector("#picDiv"),
                containerWidth = $("#picDiv").width(),
                containerHeight = $("#picDiv").height(),
                nPower = 0;
            
            var reader = new FileReader();
            var imgs = new Image();
            imgs.file = blob;
            reader.onload = (function (aImg) {
                return function (e) {
                    aImg.src = e.target.result;
                };
            }(imgs));
            
            //截图适应图片容器大小
            reader.onloadend = function () {
                var realWidth = imgs.width,
                    initialWidth = imgs.width,
                    realHeight = imgs.height,
                    initialHeight = imgs.height;
                while ( (realWidth > containerWidth) || (realHeight > containerHeight) ) {
                    nPower--;
                    realWidth = initialWidth * Math.pow(1.2, nPower);
                    realHeight = initialHeight * Math.pow(1.2, nPower);
                }
                imgs.setAttribute("width", realWidth + "px");
                imgs.setAttribute("height", realHeight + "px");
            };
            reader.readAsDataURL(blob);
            picDiv.appendChild(imgs);
            
            /**
             * 使用闭包，点击发送按钮，发送图片
             * */
            var sendPic = function () {
                var data = new FormData(); //IE下，textArea不支持图片粘贴，直接使用FormData不考虑兼容性问题
                data.append('file', blob);
                $.ajax({
                    url: WebAgent.config.FILE_UPLOAD_URL,
                    type: 'POST',
                    cache: false,
                    data: data,
                    processData: false,//  不处理发送的数据，因为data值是Formdata对象，不需要对数据做处理
                    contentType: false,//  不设置Content-type请求头
                    success: function (jsonObj) {
                        var res = JSON.parse(jsonObj);
                        if (res.ok == "1") {
                            var originalPath = res.originalImagePath;
                            var zoomUrl = res.zoomImageUrl;
                            self.sendMessage("image", originalPath, zoomUrl);
                        } else {
                            alert(res.error);
                        }
                        self.imPastePicDialog(false);
                        picDiv.innerHTML = "";
                    },
                    error: function (e) {
                        util.Log("log", e);
                        
                    }
                });
            };
            return sendPic;
        };
        
        //是否开启自动匹配
        this.openAutoMatch = ko.observable(false);
        
        //是否显示智能协助
        this.intellHelp = ko.observable(false);
        //是否开启智能协助（window）
        this.openIntellHelp = ko.observable(false);
        
        //企业ID
        this.agentEntId = ko.observable();
        
        //坐席ID
        this.agentId = ko.observable();
        
        //坐席超时未回复时间
        this.timeOut = ko.observable();
        
        //切换表情列表显示、隐藏
        this.emojiPaneDis = ko.observable(false);
        
        //短视频显示开关
        this.videoPlace = ko.observable(false);
        
        this.onlineVideo = ko.observable("");
        
        this.videoImg = ko.observable(WebAgent.baseUrl + "/Agent/images/video.png");
        
        //音/视频按钮显示
        this.webRTCVideo = false;
        this.webRTCAduio = false;
        
        //发送快捷键
        this.btnKeyListDis = ko.observable(false);
        
        //发送的快捷键选择列表
        this.btnKeyList = ko.observableArray([
            {
                key: "Enter",
                desc: "按Enter键发送消息",
                faCheck: ko.observable(localStorage.getItem("chat-sendKey") == "Enter" || localStorage.getItem("chat-sendKey") == null)
            },
            {
                key: "CtrlEnter",
                desc: "按Ctrl+Enter键发送消息",
                faCheck: ko.observable(localStorage.getItem("chat-sendKey") == "CtrlEnter")
            }
        ]);
        
        //置闲:状态为置忙时可用
        this.readyEnabled = ko.observable(false);
        
        //坐席列表
        this.agentList = ko.observableArray([]);

        //转坐席留言
        this.transferMsg = ko.observable();
        
        //进行中对话列表是否展开
        this.isOnlineListShow = ko.observable(true);
        
        //已结束对话列表是否展开
        this.isOfflineListShow = ko.observable(true);

        //内部沟通坐席列表是否展开
        this.isInternalChatListShow = ko.observable(false);

        //坐席列表是否展开
        this.isAgentAllListShow = ko.observable(false);
        
        //在线客服数
        this.onlineAgentNum = ko.observable(0);
        
        //排队客户数
        this.queueUserNum = ko.observable(0);
        
        //当前客户previousImSessionId
        this.currentImSessionId = ko.observable(); //当前客户previousImSessionId
        
        //上线提示音
        this.onlineTipMusic = ko.observable(WebAgent.baseUrl + '/Agent/tipMusic/onlineTip.mp3');
        
        //发送消息为空提示
        this.msgContentErrorDis = ko.observable(false);
        
        //消息提示音
        this.msgTipMusic = ko.observable(WebAgent.baseUrl + '/Agent/tipMusic/msgTip.mp3');
        
        /**
         * 设置声音提醒
         * @param param
         * onlineTip: boolean(默认false)
         * msgTip: boolean(默认false)
         */
        this.setChatSoundTip = ko.observable({ onlineTip: false, msgTip: false });
        
        
        //判断是否验证敏感词，默认为是
        this.isCheckWord = true;
        //验证敏感词
        this.checkWord = function () {
            if (!this.isCheckWord) {
                self.msgTip(false);
                self.sendMessage("text");
                $(".message-input").attr("disabled", false);
                return;
            }
            var url = WebAgent.config.quickSmartReplyPath_sensitive + "/sensitiveWords/checkSensitiveWords";
            var errorMsg = "";
            
            console.log("self.inputText():", self.inputText());
            if (self.inputText() == "" || self.inputText() == undefined || self.inputText() && $.trim(self.inputText()) == "") {
                errorMsg = "消息内容不能为空！";
            }
            if (self.inputText() && self.inputText().length > 1000) {
                errorMsg = "消息内容超出限制";
            }
            if (errorMsg) {
                self.msgContentErrorDis(errorMsg);
                setTimeout(function () {
                    self.msgContentErrorDis(false);
                }, 800);
                return;
            }
            
            if (self.inputText() == "" || self.inputText().trim() == "") {
                return;
            }
            var data = {
                message: self.inputText(),
                entId: self.agentEntId()
                //entId: "0103290014"
            };
            var callback = function (data) {
                switch ( data.code ) {
                    case "0": {
                        self.msgTip(false);
                        self.sendMessage("text");
                        $(".message-input").attr("disabled", false);
                        break;
                    }
                    case "-1": {
                        self.msgTip(true);
                        self.msgWordHead("你输入的内容包含敏感词，无法发送：");
                        self.msgWord(data.obj.join("/"));
                        $(".message-input").attr("disabled", true).css("background", "white");
                        break;
                    }
                    default: {
                        util.Log("error", data.desc);
                        
                    }
                }
            };
            util.ajaxHelper.post(url, data, callback);
        };
        
        //浏览器消息提示
        User.prototype.msgTip = function (tipMsg, isNewCustom) {
            var selfU = this;
            
            if (!('Notification' in window)) {
                alert('您的浏览器不支持桌面通知特性，请下载谷歌浏览器试用该功能');
                return;
            }
            
            Notification.requestPermission(function (status) {
                if (status === "granted") {
                    var notification = new Notification("提醒", {
                        body: tipMsg,
                        icon: WebAgent.baseUrl + '/Agent/images/qnsoft.png',
                        dir: 'auto',
                        tag: selfU.name
                    });
                    if (!isNewCustom) {
                        notification.onclick = function () {
                            self.selectUser(selfU);
                            notification.close();
                        };
                    }
                } else {
                    alert("不能弹出通知，status:" + status);
                }
            });
        };
        
        //切换列表
        this.toggleChatList = function (type) {
            //在线会话列表
            if (type == "online") {
                self.isOnlineListShow(!self.isOnlineListShow());
                $("#onlineChatList").slideToggle();
                return;
            }
            //下线会话列表
            if (type == "offline") {
                self.isOfflineListShow(!self.isOfflineListShow());
                $("#offlineChatList").slideToggle();
                return;
            }
            //坐席列表
            if(type == "agentAllList"){
                self.isAgentAllListShow(!self.isAgentAllListShow());
                $("#agentAllList").slideToggle();
                return;
            }
            //内部沟通列表
            if(type == "internalChatList"){
                self.isInternalChatListShow(!self.isInternalChatListShow());
                $("#internalChatList").slideToggle();
            }
        };
        
        //添加客户
        this.addUser = function (name, ent, channel) {
            var user = new User(name, ent, channel);
            self.userList.push(user);
            return user;
        };
        
        //切换用户
        this.selectUser = function (user) {
            var currentUser = self.currentUser();
            
            if (user.sessionId == currentUser.sessionId) {
                self.currentUser().msgNumber(0);
                return;
            } else {
                self.currentUser().inputText(self.inputText());
                self.transferMsg("");
                self.currentUser(user);
                self.currentUser().msgNumber(0);
                self.inputText(user.inputText());
                registerEvent.selectUser({
                    userId: user.name,
                    entId: user.ent,
                    channel: user.channel
                });
                
                if (user.isNewUser()) { //新客户被切换的时候，滚动条滚动到底部，老客户保持原状
                    user.isNewUser(false);
                    util.ScrollToBottom();
                }
            }
        };
        
        //判断在线的用户
        this.onlineArr = ko.computed(function () {
            return ko.utils.arrayFilter(self.userList(), function (item) {
                return item.online();
            });
        }, this);
        
        //判断不在线的用户
        this.offlineArr = ko.computed(function () {
            return ko.utils.arrayFilter(self.userList(), function (item) {
                //item.isTiming(false);  //下线之后超时清空
                return !item.online();
            });
        }, this);
        
        this.robotAgentList = ko.observableArray(WebAgent.vm.robotAgentList());

        this.agentAllList = ko.observableArray([]);

        this.selectedRobotAgent = ko.observable();
        //切换助手
        this.selectRobotAgent = function (user) {
            var currentUser = self.selectedRobotAgent();
            
            if (user.robotId == currentUser.robotId && user.robotName == currentUser.robotName) {
                return;
            } else {
                self.selectedRobotAgent(user);
            }
        };
        
        this.setReadyEnabled = ko.computed(function () {
            if (this.isMaxTalkUpSetBusy() && this.maxTalkNum() <= this.onlineArr().length && WebAgent.readyEnabled) {
                WebAgent.extend.setBusy();
            }
            return !(this.isMaxTalkUpSetBusy() && this.maxTalkNum() <= this.onlineArr().length);
        }, this);
        
        //未读消息总数
        this.msgTotal = ko.computed(function () {
            var msgTotal = 0;
            ko.utils.arrayFilter(self.userList(), function (user) {
                msgTotal += user.msgNumber();
            });
            registerEvent.unReadMsgNum({
                unReadMsgNum: msgTotal
            });
            return msgTotal;
        }, this);
        
        //设置客户姓名
        this.setNickName = function (nickName,sessionId) {
            var user = findUser(sessionId);
            user && user.nickName(nickName && nickName.substring(0, 10));
        };
        
        //置忙操作：置闲时可以用
        this.setBusy = function () {
            //if (self.busyEnabled()) {
            self.sendState("msgFromAgentSetStateBusy", "setBusy", "PC");
            //}
        };
        
        //置闲操作：置忙时可以用
        //告知dms坐席音/视频能力
        this.setReady = function () {
            if (WebAgent.callType == "webRTC") {
                self.webRTCAduio = window.CR.checkDevice().supportVoice;
                self.webRTCVideo = self.webRTCVideo && window.CR.checkDevice().supportVideo;
            }
            self.sendState("msgFromAgentSetStateFree", "setReady", "PC", {
                content: {
                    supportVoice:  WebAgent.sipUseWebRTC ? self.webRTCAduio : true,
                    supportVideo:  WebAgent.sipUseWebRTC ? self.webRTCVideo : true
                }
            });
        };
        
        //开启自动匹配，搜索常用语内容
        this.searchComLang = function (type) {
            if (self.openAutoMatch() && (require("VmQuickReply").quickReplyDis())) {
                registerEvent.autoMatchCallback();
                require("VmQuickReply").searchComLang(type);
            }
        };
        
        //后台是否开启智能协助
        this.getIntellOpen = function () {
            var url = WebAgent.config.quickSmartReplyPath_sensitive + "/intelligentQuery/getPowerInfo",
                data = {
                    entId: self.agentEntId()
                };
            var callback = function (data) {
                var isOpen;
                if (data.code == "0") {
                    isOpen = data.obj.intelligentQueryPower == "1" ? true : false;
                    self.intellHelp(isOpen);
                } else {
                    util.Log("error", data.desc);
                    
                }
            };
            util.ajaxHelper.post(url, data, callback);
        };
        
        //在快捷回复中搜索聊天内容
        this.searchSmartReply = function (data) {
            var reg = /^<img .*>$/;
            if (data.type == "text" && !reg.test(data.text)) {
                registerEvent.openIntellCallback();
                require("VmSmartReply").searchReply(data.text);
            }
        };
        /**
         * 发送chat闲忙、butel等状态
         * @param type
         * @param state
         */
        this.sendState = function (type, state, channel, data) {
            var bodyJson = null;
            switch ( type ) {
                case "msgFromAgentSetStateBusy":
                case "msgFromAgentButelLogin":
                case "msgFromAgentButelLogout":
                case "msgFromAgentCallStart":
                    bodyJson = { "type": type };
                    break;
                case "msgFromAgentButelAlerting":
                case "msgFromAgentButelConnected":
                case "msgFromAgentButelEnd":
                case "msgFromAgentButelAlertingAbort": {
                    bodyJson = { "type": type, "butelSessionId": data.butelSessionId };
                    break;
                }
                case "msgFromAgentSetStateFree":
                case "msgFromAgentCallEnd": {
                    bodyJson = {
                        "type": type,
                        "content": data.content
                    };
                    break;
                }
                case "msgFromAgentCreateMUC":{
                    bodyJson = {
                        "type": type,
                        "agentList": data
                    };
                }
                default:
                    break;
            }

            require("Login").sendState(state, self.agentEntId(), channel, JSON.stringify(bodyJson));
        };
        this.sendMUC = function(type,sessionId,data){
            var bodyJson;
            if(type == "msgFromAgentJoinMUC"){
                bodyJson={
                    type:type,
                    agentList:data.agentList,
                    customId:data.customId
                }
            }
            require("Login").sendMUC(sessionId, JSON.stringify(bodyJson));
        }
        
        //满意度调查
        this.sendSatisfy = function () {
            self.sendMessage("msgFromAgentSendSatisfy");
        };
        
        this.selectAgentForm=ko.observable({})
         //获得可添加坐席列表
         this.getAgentList = function (type){
            if(self.currentUser().chatType() != "chat"){
                return;
            }
            if(type == "transfer"){
                self.selectAgentForm({
                    title:"请选择需要转移的坐席",
                    type:"transfer"
                });
            }
            if(type == "addAgent"){
                self.selectAgentForm({
                    title:"请选择需要添加的群成员",
                    type:"customAddAgent"
                });
            }
            self.sendMessage("msgFromAgentGetAgentList");
           /*  self.agentEabledSelectLists(filterEnableCustomChatList("",self.currentUser().chatBoxType() == "custom-chat")); */
            self.hasSelectedAgents([]);
            $("#agentSection").show();
        }
        //坐席列表
        this.agentLists = ko.observableArray([]);
        //置闲坐席列表
        this.agentReadyLists = [];
        
        this.agentListsLength = ko.observable(0);
        //添加坐席--已选择坐席
        this.hasSelectedAgents = ko.observableArray([]);
        //添加坐席--可选坐席
        this.agentEabledSelectLists = ko.observableArray([]);
        //添加坐席--搜索内容绑定
        this.agentSearchText=ko.observable("");
        //添加坐席--处理搜索坐席
        this.searchText = function(type){
            if(type == "agentListSearch"){
                self.agentEabledSelectLists(filterEnableCustomChatList(self.agentSearchText(),self.currentUser().chatBoxType() == "custom-chat"))
            }
        }

        //内部聊天坐席列表
        this.internalChatList = ko.observableArray([]);

        //选择坐席进行聊天
        this.selectAgentChat = function (user) {
            var currentUser=self.internalChatList().length && self.internalChatList().find(function(item){
                return item.memberNum == 2 && item.membersAgentIdList.includes(user.agentId);
            })
            //所选坐席已存在沟通列表
            if(currentUser){
                self.currentUser(currentUser);
            }else{
                self.sendState("msgFromAgentCreateMUC", "msgFromAgentCreateMUC", "PC", user.agentId);
            }
        };
        
        //转接坐席
        this.confirmAgent = function () {
            var data,agentListStr;
            if (!self.hasSelectedAgents().length) {
                return false;
            }
            $("#agentSection").hide();
            //转移坐席
            if(self.selectAgentForm().type == "transfer"){
                data=self.hasSelectedAgents()[0];
                self.sendMessage("msgFromAgentTransferAgent", '{"destAgentId":"' + data.agentId + '","entId":"' + self.agentEntId() + '","skillGroupId":"' + data.skillGroupId + '","transferMessage":"' + self.transferMsg() + '"}');
                self.transferMsg("");

                //后期删除
                /* user.kickOff();
                self.sendMessage("tip", "", "", "该会话已经转接给客服" + self.hasSelectedAgents()[0].agentName, user); */
                return;
            }
            
            //添加坐席
            agentListStr  = self.currentUser().chatBoxType() == "custom-chat" ?
                            self.hasSelectedAgents()[0].agentId :
                            self.hasSelectedAgents().reduce(function(preItem,curItem){
                                return preItem + "," + curItem.agentId;
                            },"");

            require("Login").sendMUC(self.currentUser().sessionId,{
                type:"msgFromAgentJoinMUC",
                agentList:agentListStr,
                customId:self.currentUser().name+":"+self.agentEntId()+":"+self.currentUser().channel
            })
        };
        
        this.closeTip = function (type) {
            switch (type){
                case "agentSession":{
                    $("#agentSection").hide();
                    break;
                }
                case "sensitive":{
                    self.msgTip(false);
                    $(".message-input").attr("disabled", false);
                    break;
                }
                case "chatClose":{
                    self.keepChatTip({
                        keepchatTipShow:false,
                        beInvitedAgentId:""
                    });
                    break;
                }
                case "chatKeep":{
                    self.sendState("msgFromAgentCreateMUC", "msgFromAgentCreateMUC", "PC", self.keepChatTip().beInvitedAgentId);
                    self.keepChatTip({
                        keepchatTipShow:false,
                        beInvitedAgentId:""
                    });
                    break;
                }
            }
            
        };
        
        this.keepChatTip = ko.observable({
            keepchatTipShow:false,
            beInvitedAgentId:""
        });

        /**
         * 发送文本、图片、语音、文件消息
         * @param type
         * @param originalPath
         * @param zoomUrl
         * @returns {boolean}
         */
        this.sendMessage = function (type, originalPath, zoomUrl, tipText, user, isIntellHelp) {
            var reg = /.*<.+>.*/i;
            if (self.inputText() === '' && type === "text" && !tipText) {
                return false;
            }
            if (type == "text" && reg.test(self.inputText())) {
                self.msgContentErrorDis("您输入的内容存在非法字符");
                setTimeout(function () {
                    self.msgContentErrorDis(false);
                }, 1500);
                return;
            }
            //var user = self.currentUser();
            var user = user ? user : self.currentUser();
            var currName = user.name;
            var currEnt = user.ent;
            var currChannel = user.channel;
            var currResource = user.resource;
            
            var previousMessage = user.getLastMessage();
            var bodyJson = null;
            console.log("type:", type);
            switch ( type ) {
                case "text":
                    if (tipText) {
                        var text = tipText;
                        bodyJson = { "type": type, "content": tipText };
                    } else {
                        var text = self.inputText() && self.inputText().replace(/&/g, "&amp;")
                            .replace(/</g, "&lt;")
                            .replace(/>/g, "&gt;")
                            .replace(/\"/g, "&quot;");
                        text = WeixinEmojiExtend.replace(self.checkUrl(text));
                        bodyJson = { "type": type, "content": encodeURI(self.inputText()) };
                        self.inputText("");
                    }
                    
                    user.addMessage(text, "send", "text", new Date(),self.username());
                    break;
                case "tip":
                    bodyJson = { "type": type, "content": tipText };
                    user.addMessage(tipText, "tip", "text", new Date());
                    break;
                case "voice":
                    break;
                case "image":
                    bodyJson = { "type": type, "content": originalPath, "compressPicUrl": zoomUrl };
                    user.addMessage({
                        "original": replaceDownUrlIp(originalPath),
                        "zoom": replaceDownUrlIp(zoomUrl)
                    }, "send", "image", new Date(), self.username());
                    break;
                case "file":
                    bodyJson = { "type": type, "content": originalPath };
                    user.addMessage(replaceDownUrlIp(originalPath), "send", "file", new Date(), self.username());
                    break;
                case "msgFromAgentkickCustom":
                    bodyJson = { "type": type };
                    user.kickOff();
                    user.changeSessionTime('close');
                    
                    user.addMessage("您结束了会话", "tip", "text", new Date());
                    //self.sendMessage("tip", "", "", "您结束了会话", user);
                    
                    registerEvent.sessionQuit({
                        userId: user.name,
                        messages: user.messages()
                    });
                    break;
                case "msgFromAgentTransferAgent":
                    user.changeSessionTime('close');
                    bodyJson = { "type": type, "content": originalPath };
                    break;
                case "msgFromAgentSendSatisfy":
                case "msgFromAgentGetAgentList":
                case "msgFromAgentSatisfySend":
                case "msgFromAgentRefuseCall":
                case "msgFromAgentAcceptCall":
                case "msgFromAgentCallCustom":
                case "msgFromAgentAcceptVideo":
                case "msgFromAgentAskForVideo":
                case "msgFromAgentRefuseVideo":
                case "welcome":
                    bodyJson = { "type": type };
                    break;
                case "commonWord":
                    bodyJson = { "type": 'text', "content": encodeURI(self.currentCommonWord()) };
                    user.addMessage(self.currentCommonWord(), "send", "text", new Date());
                default:
                    break;
            }
            if (isIntellHelp != true) {
                user.msgNumber(0);
            }
            bodyJson.previousTime = previousMessage.previousTime ? previousMessage.previousTime : "";
            if (previousMessage.previousDirection === "recv") {
                bodyJson.previousDirection = '1';
            } else if (previousMessage.previousDirection === "send" || previousMessage.previousDirection === "tip") {
                bodyJson.previousDirection = '2';
            } else {
                bodyJson.previousDirection = '';
            }
            // bodyJson.previousDirection = previousMessage.previousDirection ? previousMessage.previousDirection : "";
            if (type == "text" || type == "image" || type == "file" || type == 'commonWord') {
                ackMessageArr.push({
                    username: currName,
                    content: bodyJson.content,
                    type: type == 'commonWord' ? 'text' : type,
                    index: ackMessageArr.length,
                    setTimeFun: function (isClear) {
                        if (isClear) {
                            clearTimeout(t);
                            return;
                        }
                        t = setTimeout(function () {
                            var msg = type == "text" ? text : (type == "image" ? "图片" : "文件");
                            ackMessageArr.splice(this.index, 1);
                            self.msgTip(true);
                            self.msgWordHead(currName.slice(0, 10) + "客户消息未发送成功:");
                            self.msgWord(msg);
                            $(".message-input").attr("disabled", true).css("background", "white");
                        }, 1500);
                    }
                });
                ackMessageArr[ackMessageArr.length - 1].setTimeFun(false);
            }
            if(user.chatBoxType() == "custom-chat" || type == "msgFromAgentGetAgentList"){
                require("Login").sendMessage(currName, currEnt, currChannel, JSON.stringify(bodyJson), currResource);
            }else{
                require("Login").sendMUC(user.sessionId, bodyJson);
            }
        };
        
        /**
         * ctrl+ enter键发送
         * @param data
         * @param event
         * @returns {boolean}
         */
        this.sendMessageByKey = function (data, event) {
            var chatSendKey = localStorage.getItem("chat-sendKey") || "Enter";
            
            if (self.imPastePicDialog()) {
                return;
            }
            switch ( chatSendKey ) {
                case "Enter":
                    if (event.keyCode === 13 && !event.ctrlKey) {
                        event.preventDefault();
                        
                        self.checkWord();
                        //self.sendMessage("text");
                    }
                    if (event.keyCode === 13 && event.ctrlKey) {
                        self.inputText(self.inputText() + "\n");
                    }
                    break;
                case "CtrlEnter":
                    if (event.keyCode === 13 && event.ctrlKey) {
                        self.checkWord();
                        //self.sendMessage("text");
                    }
                    break;
                default :
                    break;
                
            }
            
            return true;    // Allow event default behavior
        };
        
        /**
         * 切换发送快捷键列表
         */
        this.toggleBtnKeyList = function () {
            self.btnKeyListDis(!self.btnKeyListDis());
        };
        
        /**
         * 选择发送的快捷键
         * @param $data
         */
        this.choseSendKey = function ($data) {
            for (var i = 0; i < self.btnKeyList().length; i++) {
                if (self.btnKeyList()[i].key != $data.key) {
                    self.btnKeyList()[i].faCheck(false);
                } else {
                    self.btnKeyList()[i].faCheck(true);
                }
            }
            self.btnKeyListDis(false);
            localStorage.setItem("chat-sendKey", $data.key);
        };
        
        //将url地址转换为链接形式
        this.checkUrl = function (content) {
            
            if (content && content.match(regUrl)) {
                content = content.replace(regUrl, function (char) {
                    return "<a target='_blank' href='" + (regPro.exec(char) ? char : ("http://" + char)) + "'>" + char + "</a>";
                });
            }
            return content;
        };
        
        //替换文件下载地址ip
        var replaceDownUrlIp = function (url) {
            
            if (regPro.test(url)) {
                var urlArr = url.split('/');
                
                urlArr.splice(0, 3);
                url = WebAgent.config.DOWN_FILE_URL + urlArr.join('/');  // ip+截取的除ip之外字符串
            } else {
                url = WebAgent.config.DOWN_FILE_URL + url;
            }
            
            return url;
        };
        
        var formatTiming = function (timing) {
            if (timing < 60) {
                return timing + "秒";
            } else {
                var min = parseInt(timing / 60);
                var sec = timing % 60;
                
                return min + "分 " + sec + "秒";
            }
        };
        
        //重构转接坐席/机器人聊天记录
        this.refactorMsgs = function (historyChats) {
            var tmpMsg = null;
            var direction = null;
            var name = null;
            var refactorMsg = [];
            
            historyChats.forEach(function (item, index) {
                tmpMsg = null;
                
                //客户发送消息给坐席
                if (item.direction == "1") {
                    direction = "recv";
                    name = item.customId;
                }
                
                //坐席发送消息给客户
                if (item.direction == "2") {
                    direction = "send";
                    name = item.agentName;
                }
                
                //item.time = "2017-09-19 15:22:24";
                switch ( item.contentType ) {
                    case "1":  //文本
                        tmpMsg = {
                            msg: WeixinEmojiExtend.replace(self.checkUrl(item.content)),
                            direction: direction,
                            type: "text",
                            time: item.time,
                            timeMillis: item.timeMillis,
                            name: name,
                            imSessionId: item.imSessionId,
                            contentType: item.contentType
                        };
                        break;
                    case "2":  //图片
                        tmpMsg = {
                            msg: { "zoom": replaceDownUrlIp(item.content), "original": replaceDownUrlIp(item.content) },
                            direction: direction,
                            type: "image",
                            time: item.time,
                            timeMillis: item.timeMillis,
                            name: name,
                            imSessionId: item.imSessionId,
                            contentType: item.contentType
                        };
                        break;
                    case "3": //语音
                        tmpMsg = {
                            msg: replaceDownUrlIp(item.content),
                            direction: direction,
                            type: "voice",
                            time: item.time,
                            timeMillis: item.timeMillis,
                            name: name,
                            imSessionId: item.imSessionId,
                            contentType: item.contentType
                        };
                        break;
                    case "4": //文件
                        tmpMsg = {
                            msg: replaceDownUrlIp(item.content),
                            direction: direction,
                            type: "file",
                            time: item.time,
                            timeMillis: item.timeMillis,
                            name: name,
                            imSessionId: item.imSessionId,
                            contentType: item.contentType
                        };
                        break;
                    case "5": //访客信息
                        tmpMsg = {
                            timeMillis: item.timeMillis,
                            imSessionId: item.imSessionId,
                            contentType: item.contentType
                        };
                        break;
                    case "6": //欢迎语
                        tmpMsg = {
                            msg: item.content,
                            direction: "tip",
                            type: "text",
                            time: item.time,
                            timeMillis: item.timeMillis,
                            name: name,
                            imSessionId: item.imSessionId,
                            contentType: item.contentType
                        };
                        break;
                    case "7": //提示语
                        tmpMsg = {
                            msg: item.content,
                            direction: "tip",
                            type: "text",
                            time: item.time,
                            timeMillis: item.timeMillis,
                            name: name,
                            imSessionId: item.imSessionId,
                            previousImSessionId: item.previousImSessionId,
                            contentType: item.contentType
                        };
                        break;
                    default:
                        break;
                }
                
                if (tmpMsg) {
                    refactorMsg.push(tmpMsg);
                }
            });
            return refactorMsg;
        };
        
        /**
         * 转换channel为英文
         * @param channel
         * @returns {*}
         */
        var switchChannelToEng = function (channel) {
            switch ( channel ) {
                case "2":
                    return "webim";
                case "3":
                    return "weixin";
                case "4":
                    return "butel";
                case "5":
                    return "appim";
                case "7":
                    return "weixinim";
                default :
                    break;
            }
        };
        
        /**
         * 转换channel为数字
         * @param channel
         * @returns {*}
         */
        var switchChannelToNum = function (channel) {
            switch ( channel ) {
                case "webim":
                case "internal-chat":
                    return "2";
                case "weixin":
                    return "3";
                case "butel":
                    return "4";
                case "appim":
                    return "5";
                case "weixinim":
                    return "7";
                default :
                    break;
            }
        };
        
        /**
         * 查询在线客服数、排队客户数
         */
        this.getCuAmount = function () {
            var url = WebAgent.config.getProjectDataPath + "/cuAmount/getCuAmount.do";
            var data = {
                entId: self.agentEntId()
            };
            
            var callback = function (data) {
                switch ( data.code ) {
                    case "0":
                        if (data.result) {
                            self.onlineAgentNum(data.result.onLine);
                            self.queueUserNum(data.result.queue);
                        } else {
                            util.Log("info", "获取在线客服数/排队客户数结果为空");
                        }
                        break;
                    case "-1":
                        util.Log("error", "获取在线客服数/排队客户数接口异常，" + data.result);
                        break;
                    default :
                        break;
                }
            };
            util.ajaxHelper.post(url, data, callback);
        };
        
        /**
         * 获取当天下线客户列表
         */
        this.getOfflineList = function () {
            var url = WebAgent.config.getProjectDataPath + "/stateDetailForAgentId/queryForAgent.do";
            var data = {
                entId: self.agentEntId(),
                agentId: self.agentId()
            };
            
            var callback = function (data) {
                var code = data.code;
                var result = data.result;
                var user = null;
                
                switch ( code ) {
                    case "0":
                        util.Log("log", "下线客户列表：" + JSON.stringify(data));
                        if (result.length) {
                            result.forEach(function (item, index) {
                                user = self.addUser(item.customerId, item.entId, switchChannelToEng(item.channel));
                                user.online(false);
                                
                                getHistoryChats(user);
                            });
                        } else {
                            util.Log("info", "获取当天下线客户列表为空");
                        }
                        break;
                    case "-1":
                        util.Log("error", "获取当天下线客户列表接口异常，" + result);
                        break;
                    default :
                        break;
                }
            };
            
            util.ajaxHelper.post(url, data, callback);
        };
        
        /**
         * 获取历史消息（客户接入等方式）
         * @param user
         */
        function getHistoryChats(user, renderHistoryCallback) {
            var url = WebAgent.config.getProjectDataPath + "/chatLogInfo/queryChatLogInfo.do";
            
            //新用户到来、坐席转接坐席第一次获取消息记录的时候不传时间参数
            if (typeof renderHistoryCallback == "function") {
                user.getHistoryStartTime = "";
            } else { //下线客户列表第一次获取消息记录的时候传时间参数
                user.getHistoryStartTime = new Date().getTime();
            }
            console.log("chatBoxType:",user.chatBoxType());
            var data={
                entId: self.agentEntId(),
                customId: user.name,
                channel: switchChannelToNum(user.channel),
                agentId: self.isShareMessage() === "1" ||  user.chatBoxType() == "custom-group" ? "" : self.agentId(),
                pageSize: 10,
                time: user.getHistoryStartTime,
                imSessionId: user.chatBoxType() == "custom-group" ? user.sessionId : user.historySessionId
            }

            var callback = function (data) {
                var code = data.code;
                var result = data.result;
                
                switch ( code ) {
                    case "0":
                        if (result.length) {
                            user.messages([]);
                            user.hasMoreHistory(true);
                            
                            var refactorMsg = self.refactorMsgs(result);
                            
                            refactorMsg.forEach(function (item, index) {
                                if (index == (refactorMsg.length - 1)) {
                                    user.getHistoryStartTime = item.timeMillis;
                                    
                                    //获取更多消息时，当是“以上内容为机器人会话内容”，需要传previousImSessionId
                                    if (item.contentType == "7" && item.msg == "以上内容为机器人会话内容") {
                                        user.historySessionId = item.previousImSessionId;
                                    } else {
                                        user.historySessionId = item.imSessionId;
                                    }
                                }
                                
                                user.addMessage(item.msg, item.direction, item.type, item.time, item.direction == "recv" ? user.name.substring(0, 10) : item.name, "history");
                                
                            });
                            
                            if (typeof renderHistoryCallback == "function") {
                                renderHistoryCallback(true);
                                util.Log("log", user.name + "消息记录" + JSON.stringify(result, null, 4));
                            } else {
                                //user.addMessage("以上内容为历史消息", "tip", "text", new Date());
                                util.Log("log", "下线客户" + user.name + "消息记录" + JSON.stringify(result, null, 4));
                            }
                        } else {
                            user.hasMoreHistory(false);
                            renderHistoryCallback && renderHistoryCallback(false);
                            util.Log("info", user.name + "聊天记录为空");
                        }
                        break;
                    case "-1":
                        util.Log("error", "获取消息记录接口异常，" + result);
                        break;
                    default :
                        break;
                }
            };
            
            util.ajaxHelper.post(url, data, callback);
        };
        
        /**
         * 获取更多历史消息（点击获取）
         */
        this.getMoreHistoryChats = function () {
            var url = WebAgent.config.getProjectDataPath + "/chatLogInfo/queryChatLogInfo.do";
            var user = self.currentUser();
            var data={
                entId: self.agentEntId(),
                customId: user.name,
                channel: user.chatBoxType() == "custom-group" ? "":switchChannelToNum(user.channel),
                agentId: self.isShareMessage() === "1" ||  user.chatBoxType() == "custom-group" ? "" : self.agentId(),
                pageSize: 10,
                time: user.getHistoryStartTime,
                imSessionId: user.chatBoxType() == "custom-group" ? user.sessionId : user.historySessionId
            }
            //获取更多历史消息之前的滚动条高度
            var lastScrollHeighht = $('.scrollToBottom')[0].scrollHeight;
            
            var callback = function (data) {
                var code = data.code;
                var result = data.result;
                
                switch ( code ) {
                    case "0":
                        if (result.length) {
                            util.Log("log", user.name + "更多消息记录" + JSON.stringify(result, null, 4));
                            
                            user.hasMoreHistory(true);
                            
                            var refactorMsg = self.refactorMsgs(result);
                            
                            refactorMsg.forEach(function (item, index) {
                                if (index == (refactorMsg.length - 1)) {
                                    user.getHistoryStartTime = item.timeMillis;
                                    
                                    //获取更多消息时，当是“以上内容为机器人会话内容”，需要传previousImSessionId
                                    if (item.contentType == "7" && item.msg == "以上内容为机器人会话内容") {
                                        user.historySessionId = item.previousImSessionId;
                                    } else {
                                        user.historySessionId = item.imSessionId;
                                    }
                                }
                                user.addMessage(item.msg, item.direction, item.type, item.time, item.direction == "recv" ? user.name.substring(0, 10) : item.name, "history", true);
                            });
                            
                        } else {
                            user.hasMoreHistory(false);
                            user.addMessage("无更多消息记录", "tip", "text", new Date(), "", "history", true);
                        }
                        
                        //获取更多消息之后，设置滚动条位置，多显示一条消息
                        $('.scrollToBottom').scrollTop($('.scrollToBottom')[0].scrollHeight - lastScrollHeighht - 30);
                        
                        break;
                    case "-1":
                        util.Log("error", "获取更多消息记录接口异常，" + result);
                        break;
                    default :
                        break;
                }
                ;
            };
            
            util.ajaxHelper.post(url, data, callback);
        };
        
        /**
         * 获取聊天记录，暴露给cdesk
         * @param userName
         */
        this.getChatMsgs = function (userName) {
            var messages;
            
            if (self.userList().length) {
                self.userList().forEach(function (user, index) {
                    if (userName == user.name) {
                        messages = self.userList()[index].messages();
                    }
                });
                return messages;
            }
        };
        
        //整理坐席列表数据
        function filterAgentList(agentList){
            var skillGrounp = {},
                agent = {},
                agentsObj,
                skillGroupList=[];
            for (var agentListKey in agentList) {
                skillGrounp["skillGroupName"] = agentList[agentListKey]["skillGroupName"];
                skillGrounp["skillGroupId"] = agentListKey;
                skillGrounp["agents"] = [];
                agentsObj = agentList[agentListKey].agents;
                self.username()
                for (var agentKey in agentsObj) {
                    if(agentKey != self.agentId()){
                        agent = agentsObj[agentKey];
                        agent.agentId = agentKey;
                        agent.skillGroupId = agentListKey;
                        agent.skillGroupName = skillGrounp["skillGroupName"];
                        skillGrounp["agents"].push(agent);
                    }
                }
                if(skillGrounp["agents"].length){
                    skillGroupList.push(skillGrounp);
                }
                skillGrounp = {};
            }
            return skillGroupList;
        }

        //筛选出满足：坐席置闲且会话量未满的坐席
        function filterEnableCustomChatList(agentName="",isCustonChat=false){
            var agentListNew =[],
            agentList=self.agentReadyLists,
            exceptAgentIdList=self.currentUser().membersAgentIdList;
            console.log(self.currentUser());
            agentList.length && agentList.forEach(function(skillGrounp){
                var agents=[];
                agents=skillGrounp.agents.length && skillGrounp.agents.filter(function(agent){
                    if( exceptAgentIdList.length && exceptAgentIdList.includes(agent.agentId)){
                        return false;
                    }
                    return  isCustonChat ?
                    (agent.currentServiceNum < agent.maxServiceNum && agent.agentName.includes(agentName)) : agent.agentName.includes(agentName);
                });
                if(agents.length){
                    agentListNew.push({
                        "skillGroupName":skillGrounp.skillGroupName,
                        "skillGroupId":skillGrounp.skillGroupId,
                        "agents":agents
                    })
                }
            })
            return agentListNew;
        }
        function findUser(sessionId,name,ent,channel){
            var user,
            userList=self.internalChatList().concat(self.userList());
            user=userList.length && userList.find(function(item){
                if(name){
                    return  name === item.name && ent === item.ent && channel === item.channel || item.sessionId == sessionId;
                }else{
                    return item.sessionId == sessionId;
                }
            });
            return user ? user:false;
        }
        /* //判断用户是否在列表里
        this.isInUserList = function (sessionId,type) {
            var result = ko.utils.arrayFilter(self.userList(), function (item) {
                return name === item.name && ent === item.ent && channel === item.channel && sessionId == item.sessionId;
            });
            
            return result.length > 0 ? result[0] : false;
        }; */
        function getAgentListName(agentList){
            return agentList.reduce(function(pre,cur){
                return pre == "" ? cur.agentName : pre +","+ cur.agentName;
            },"")
        }
        function handleMUCMessage(type,msgBody, nickContent, resource){
            var sessionId = nickContent.split(":")[1],
            user=findUser(sessionId),
            name="",
            message="",
            beInvitedStr="",
            customIdMesg;
            msgBodyContent=msgBody.content,
            membersAgentIdList=[];
            //坐席间的聊天
            if(type == "msgFromDmsEnterMUC" && !msgBodyContent.customId){
                name=getAgentListName(msgBodyContent.members);
                if(!user){
                    user=new User(name, self.agentEntId(), "internal-chat", sessionId, "agent-chat");
                    user.resource=resource;
                    self.internalChatList.push(user);
                }else{
                    user.name=name;
                }
                user.nickName(name);
                user.memberNum=msgBodyContent.memberNum;
                user.beInvited=msgBodyContent.beInvited;
                user.members(msgBodyContent.members);
                user.membersAgentIdList=msgBodyContent.members.map(function(item){
                    return item.agentId;
                });
                if(msgBodyContent.memberNum > 2){
                    beInvitedStr=getAgentListName(msgBodyContent.beInvited);
                    user.chatBoxType("agent-group");
                    //邀请方
                    if(msgBodyContent.inviter.agentId == self.agentId() ){
                        user.addMessage(beInvitedStr+"已加入群聊", "tip", "text", new Date());
                    }
                    //被邀请方：获取群聊记录
                    else if(msgBodyContent.beInvited.some(function(item){
                        return item.agentId == self.agentId()
                    })){
                        user.addMessage(msgBodyContent.inviter.agentName+"邀请你加入群聊", "tip", "text", new Date());
                        user.msgNumber(1);
                    }
                    //已在群聊中
                    else{
                        user.addMessage(msgBodyContent.inviter.agentName+"邀请"+beInvitedStr+"加入群聊", "tip", "text", new Date());
                    }
                }

                return false;
            }
            //坐席和客户群聊
            if(type == "msgFromDmsEnterMUC" && msgBodyContent.customId){
                customIdMesg=msgBodyContent.customId.split(":");
                //user=self.isInUserList(customIdMesg[0],customIdMesg[1],customIdMesg[2]);
                if(msgBodyContent.inviter.agentId == self.agentId()){
                    user.addMessage(msgBodyContent.beInvited[0].agentName+"已加入群聊", "tip", "text", new Date());
                    user.chatBoxType("custom-group");
                }else{
                    if(!user){
                        user = self.addUser(customIdMesg[0],self.agentEntId(),msgBodyContent.customInfo.split(":")[2]);
                    }else{
                        user.online(true);
                        user.isNewUser(true);
                    }
                    user.sessionId=sessionId;
                    user.chatBoxType("custom-group");
                    getHistoryChats(user, function () {
                        user.addMessage(msgBodyContent.inviter.agentName+"邀请你加入群聊", "tip", "text", new Date());
                        user.msgNumber(1);
                    });
                    
                }
                user.memberNum=msgBodyContent.memberNum;
                user.beInvited=msgBodyContent.beInvited;
                user.members(msgBodyContent.members);
                return;
            }
            //一方退出群聊
            if(type == "msgFromDmsAgentQuitMUC" && user){
                if(user.memberNum == 2 && user.chatBoxType() == "agent-chat"){
                    self.internalChatList(self.internalChatList().filter(function(item){
                        return item.sessionId !== user.sessionId;
                    }));
                    self.currentUser().kickOff();
                    user.changeSessionTime('close');
                    return;
                }
                user.members(user.members().filter(function(item){
                    if(item.agentId !== msgBodyContent.agentId){
                        membersAgentIdList.push(item.agentId);
                        return true;
                    }else{
                        return false;
                    }
                }));
                if(user.chatBoxType() != "custom-group"){
                    name=getAgentListName(user.members());
                    user.nickName(name);
                }
                user.membersAgentIdList=membersAgentIdList;
                user.memberNum--;
                user.addMessage(msgBodyContent.agentName+"退出了群聊", "tip", "text", new Date());
                if(user.memberNum == 2){
                    user.chatBoxType(user.chatBoxType() == "custom-group" ? "custom-chat":"agent-chat");
                }
                return;
            }
            if(type == "msgFromDmsSessionIdChange" && user){
                user.sessionId = msgBodyContent;
                return;
            }
            //自个退出群聊
            if(type == "msgFromDmsQuitMUCSuccess" && user){
                if(user.chatBoxType() == "custom-group"){
                    self.userList(self.userList().filter(function(item){
                        return item.sessionId != sessionId;
                    }));
                }else{
                    self.internalChatList(self.internalChatList().filter(function(item){
                        return item.sessionId != user.sessionId;
                    }));
                }
                
                if(self.currentUser().sessionId == sessionId){
                    self.currentUser().name="";
                    self.currentUser().kickOff();
                    self.currentUser().changeSessionTime('close');
                    self.currentUser().sessionId="";
                }
                return;
            }
            if(type == "msgAck"){
                var index = -1;
                if(user){
                    for(var i = 0; i < ackMessageArr.length; i++){
                        if ((msgBodyContent.msgType == "text" && ackMessageArr[i].type == msgBodyContent.msgType && ackMessageArr[i].username == user.name && decodeURI(ackMessageArr[i].content).trim() == msgBodyContent.msgContent.trim()) || ((msgBodyContent.msgType == "image" || msgBodyContent.msgType == "file") && ackMessageArr[i].username == user.name)) {
                            ackMessageArr[i].setTimeFun(true);
                            index = i;
                            break;
                        }
                    }
                    if (index != -1) {
                        ackMessageArr.splice(index, 1);
                    }
                }
                return false;
            }
            //接收消息
            if(type == "text" || type == "image" || type == "file"){
                switch (type){
                    case "text":{
                        message = WeixinEmojiExtend.replace(self.checkUrl(msgBodyContent));
                        break;
                    }
                    case "image":{
                        message = {
                            "original": replaceDownUrlIp(msgBodyContent),
                            "zoom": replaceDownUrlIp(msgBodyContent)
                        };
                        break;
                    }
                    case "file":{
                        message = replaceDownUrlIp(msgBody.content);
                        break;
                    }
                }
                if(user){
                    user.addMessage(message, "recv", type, new Date(), msgBody.spokesman);
                    user.sessionId !== self.currentUser().sessionId && user.msgNumber(user.msgNumber() + 1);
                }
                return;
            }

            if(type == "msgFromDmsCreateMUCFailed" || type == "msgFromDmsJoinMUCFailed"){
                self.msgTip(true);
                self.msgWordHead("邀请坐席失败：");
                self.msgWord(msgBodyContent);
                $(".message-input").attr("disabled", true).css("background", "white");
                return;
            }
            
        }
        
        /**
         * 处理接收到的消息
         * @param msgBody
         * @param nickContent
         */
        this.handleMessage = function (msgBody, nickContent, resource) {
            
            util.Log("log", "msgBody, nickContent, resource:" + msgBody + "," + nickContent + "," + resource);
            var visitorBaseInfo = "";
            var nickArray = nickContent.split(":");
            console.log(nickArray);
            var name = nickArray[0];
            var ent = nickArray[1];
            var channel = nickArray[2];
            var sessionId = nickArray[3];
            var type = msgBody.type;
            if(name == "MUC" || type == "msgFromDmsEnterMUC"){
                handleMUCMessage(type,msgBody, nickContent, resource);
                return false;
            }
            
            //判断用户是否在列表里
            var user = findUser(sessionId,name,ent,channel);
            var newUserFlag = false;
            var newUserType = null;
            var message = null;
            
            if (channel === "butel") {
                return;
            }
            
            //发消息的用户在用户列表，先把原来位置删除，然后追加到前面
            if (user && (type != "msgFromDmsSetStateFreeSuccsess"
                && type != "msgFromDmsSetStateBusySuccess"
                && type != "msgFromDmsAgentLoginSuccess"
                && type != "msgAck"
                && type != "msgFromDmsGetAgentListResponse")) {
                self.userList().forEach(function (item, index) {
                    if (user == item) {
                        self.userList.splice(index, 1);
                        self.userList.unshift(user);
                    }
                });
            }

            if (!user && (type == "msgFromDmsNewCustomInter")) {
                user = self.addUser(name, ent, channel);
            }
            
            var visitorInfo = user && user.visitorInfo();
            var visitInfo = user && user.visitInfo();
            switch ( type ) {
                case "image":
                    message = {
                        "original": replaceDownUrlIp(msgBody.content),
                        "zoom": replaceDownUrlIp(msgBody.compressPicUrl)
                    };
                    break;
                case "text":
                    message = WeixinEmojiExtend.replace(self.checkUrl(msgBody.content));
                    break;
                case "msgFromCustomAskForCallFail": {
                    message = "客户要求与你进行语音电话失败";
                    type = "text";
                    break;
                }
                case "msgFromCustomAskForVideoFail": {
                    message = "客户要求与你进行视频电话失败";
                    type = "text";
                    break;
                }
                case "file":
                case "voice":
                case "shortvideo":
                    
                    message = replaceDownUrlIp(msgBody.content);
                    if (type == "file" && message.endsWith("mp4") || message.endsWith("MP4") || message.endsWith("webm") || message.endsWith("WEBM") || message.endsWith("ogg") || message.endsWith("OGG")) {
                        type = "shortvideo";
                    }
                    break;
                case "msgFromDmsNewCustomInter"://新客户接入
                    var info = JSON.parse(msgBody.content);
                    var cad = info.cad;
                    util.Log("log", "新用户到来随路数据info:" + msgBody.content);
                    
                    //是否开启消息共享
                    self.isShareMessage(cad.isShareMessage);
                    
                    newUserType = info.isTransfer; //客户接入方式
                    newUserFlag = true;
                    user.online(true);
                    user.webrtcNum(cad.webrtcNum);
                    user.chatBoxType("custom-chat");
                    if(WebAgent.sipUseWebRTC){
                        user.serviceVideo((cad.supportVideo == "true" || false) && self.webRTCVideo);
                        user.serviceAduio((cad.supportVoice == "true" || false) && self.webRTCAduio);
                    }else{
                        util.Log("log", "chpone开启摄像头和音频");
                        user.serviceVideo(cad.supportVideo == "true" || false);
                        user.serviceAduio(cad.supportVoice == "true" || false);
                    }
                    user.isNewUser(true);
                    user.skillGroupId(info.groupId);
                    user.skillName = info.groupName;
                    type = "text";
                    if (!user.timeOut1 || !user.timeOut2) {
                        user.timeOut1 = self.timeOut() && self.timeOut().agentFirstTimeout;
                        user.timeOut2 = self.timeOut() && self.timeOut().agentSecondTimeout;
                    }
                    
                    //客户在下线列表中作为当前用户，客户再上线的时候不再作为当前用户
                    var currentUser = self.currentUser();
                    
                    if (user.name == currentUser.name && user.ent == currentUser.ent && user.channel == currentUser.channel) {
                        self.currentUser(new User());
                    }
                    //if(user == self.currentUser()) {
                    //    self.currentUser(new User());
                    //}
                    
                    //机器人开启、坐席转接坐席，previousImSessionId存在，user.sessionId为previousImSessionId
                    //机器人不开启previousImSessionId为null，user.sessionId为info.sessionId
                    if (cad && cad.previousImSessionId) {
                        user.sessionId = cad.previousImSessionId;
                        user.historySessionId = cad.previousImSessionId;
                    } else {
                        user.sessionId = info.sessionId;
                        user.historySessionId = info.sessionId;
                    }
                    
                    switch ( newUserType ) {
                        case 0:   //
                            getHistoryChats(user, function (hasHistoryChats) {
                                newCustomInterTip(hasHistoryChats);   // 有聊天记录为true,否则为false
                            });
                            break;
                        case 1:  // 转接进来的客户
                            getHistoryChats(user, function () {
                                newCustomInterTip();
                            });
                            break;
                        default:
                            break;
                    }
                    
                    var newCustom = {
                        userId: user.name, //客户Id
                        userSource: cad && cad.source, //客户来源
                        skillGroupId: info.groupId, //技能组Id
                        skillGroupName: info.groupName, //技能组名
                        isTransfer: info.isTransfer, //是否转坐席
                        transferMessage: info.transferMessage, //转坐席留言
                        sessionId: info.sessionId, //会话ID
                        cesssionId: self.agentEntId() + ":" + user.channel + ":" + user.name,
                        channel: user.channel, // 客户渠道
                        attachment: info.attachment
                    };
                    
                    visitInfo.sessionAntecedents(info.sessionAntecedents);
                    visitInfo.geoLocation(info.geoLocation);
                    visitInfo.ipAddress(info.ipAddress);
                    visitInfo.browserType(info.browserType);
                    visitInfo.operatingSystem(info.operatingSystem);
                    
                    registerEvent.newCustomInter(newCustom);
                    
                    //user.msgTip("有新客户" + user.name.substring(0, 10) + "到达", true);
                    
                    //新用户到达提示音
                    if (self.setChatSoundTip() && self.setChatSoundTip().onlineTip) {
                        setTimeout(function () {
                            document.getElementById("chat_online_tip").play();
                        }, 100);
                    }
                    
                    user.resource = resource;
                    user.changeSessionTime('open');
                
                function newCustomInterTip(hasPreviousImSessionId) {
                    switch ( newUserType ) {
                        case 0: //技能组id接入，机器人转入
                            if (hasPreviousImSessionId) {
                                if (cad.robotPower == "1") {  //"1":开启机器人，"0":关闭机器人
                                    self.sendMessage("tip", "", "", "以上内容为机器人会话内容", user);
                                }
                            }
                            var newUserComeTip = "新客户到达，客服" + self.username() + "为客户服务";
                            var queueTime = formatTiming(parseInt(cad.queueTime / 1000));
                            self.sendMessage("tip", "", "", newUserComeTip, user);
                            
                            if (channel == "webim") {
                                visitorBaseInfo += "服务渠道：" + channel
                                    + "<br/>服务技能组：" + info.groupName
                                    + "<br/>城市来源：" + cad.geoLocation
                                    + "<br/>业务来源：" + cad.businessSource
                                    + "<br/>网站名称：" + cad.websiteName
                                    + "<br/>排队时长：" + queueTime
                                    + "<br/>发起页面：" + cad.sessionAntecedents;
                            }
                            
                            if (channel == "weixin" || channel == "weixinim") {
                                visitorBaseInfo += "服务渠道：" + channel
                                    + "<br/>服务技能组：" + info.groupName
                                    + "<br/>城市来源：" + cad.geoLocation
                                    //+ "<br/>浏览器类型：" + cad.browserType
                                    //+ "<br/>IP：" + cad.ipAddress
                                    //+ "<br/>操作系统：" + cad.operatingSystem
                                    + "<br/>业务来源：" + cad.businessSource
                                    + "<br/>公众号名称：" + cad.websiteName
                                    + "<br/>排队时长：" + queueTime;
                            }
                            
                            if (channel == "appim") {
                                visitorBaseInfo += "服务渠道：" + channel
                                    + "<br/>服务技能组：" + info.groupName
                                    + "<br/>城市来源：" + cad.geoLocation
                                    //+ "<br/>浏览器类型：" + cad.browserType
                                    //+ "<br/>IP：" + cad.ipAddress
                                    //+ "<br/>操作系统：" + cad.operatingSystem
                                    + "<br/>业务来源：" + cad.businessSource
                                    + "<br/>应用名称：" + cad.websiteName
                                    + "<br/>排队时长：" + queueTime;
                            }
                            
                            if (visitorBaseInfo) {
                                self.sendMessage("tip", "", "", visitorBaseInfo, user);
                            }
                            
                            if (cad.welcomeTip) {
                                user.addMessage(cad.welcomeTip, "send", "text", new Date()); //配置的欢迎语添加到消息列表
                                self.sendMessage("welcome", "", "", "", user); //配置的欢迎语给dms发送welcome事件
                            }
                            break;
                        case 1: //坐席转入
                            var transferTip = "以上内容为客服" + info.transferAgentName + "与客户的聊天内容<br/>"
                                + "该会话转接自客服" + info.transferAgentName + " <br/>转接留言：" + info.transferMessage;
                            self.sendMessage("tip", "", "", transferTip, user);
                            break;
                        default:
                            break;
                    }
                    user.msgNumber(1); //新用户到来，消息数为1，不算历史消息
                }
                    
                    break;
                case "msgFromCustomSessionQuit":
                    user.kickOff();
                    self.isShowCommonWordDialog(false);
                    user.addMessage("对方结束了会话", "tip", "text", new Date());
                    //self.sendMessage("tip", "", "", "对方结束了会话", user);
                    
                    self.emojiPaneDis(false);//隐藏表情选择框
                    
                    registerEvent.sessionQuit({
                        userId: user.name,
                        messages: user.messages()
                    });
                    user.changeSessionTime('close');
                    if(user.chatBoxType() == "custom-group"){
                        self.keepChatTip({
                            keepchatTipShow:true,
                            beInvitedAgentId:user.beInvited[0].agentId
                        });
                    }
                    break;
                case "visitorInformation":
                    var info = JSON.parse(msgBody.content);
                    visitorInfo.workOrderName(info.workOrderName && info.workOrderName.substring(0, 10));
                    visitorInfo.workOrderEmail(info.workOrderEmail);
                    visitorInfo.workOrderPhone(info.workOrderPhone);
                    break;
                case "msgFromDmsSetStateFreeSuccsess":
                    WebAgent.readyEnabled = true;
                    registerEvent.readyCallback();
                    if (this.isMaxTalkUpSetBusy() && this.maxTalkNum() <= this.onlineArr().length && WebAgent.readyEnabled) {
                        WebAgent.extend.setBusy();
                    }
                    return;
                case "msgFromDmsSetStateBusySuccess":
                    WebAgent.readyEnabled = false;
                    registerEvent.busyCallback();
                    return;
                case "msgFromDmsGetOnlineAgentListResponse":
                    var agentListRes = JSON.parse(msgBody.content);
                    self.agentLists(filterAgentList(agentListRes.agentsList));
                    self.agentListsLength(agentListRes.agentsNum-1);
                    break;
                case "msgFromDmsGetAgentListResponse":
                    var agentListRes = JSON.parse(msgBody.content);
                    self.agentReadyLists=filterAgentList(agentListRes);
                    self.agentEabledSelectLists(filterEnableCustomChatList("",self.currentUser().chatBoxType() == "custom-chat"));
                    break;
                case "msgFromDmsTransferAgentSuccess":
                    user = findUser("",name,ent,channel);
                    user.kickOff();
                    if(user.name == self.currentUser().name){
                        self.currentUser().kickOff();
                    }
                    self.sendMessage("tip", "", "", "该会话已经转接给客服" + self.hasSelectedAgents()[0].agentName, user);
                    break;
                case "msgFromDmsAgentLoginSuccess":
                    var content = JSON.parse(msgBody.content);
                    var agentFirstTimeout = content.agentTimeout && content.agentTimeout.agentFirstTimeout;
                    var agentSecondTimeout = content.agentTimeout && content.agentTimeout.agentSecondTimeout;
                    self.isMaxTalkUpSetBusy(content.agentAutoStatus == 2);
                    self.maxTalkNum(content.webChatCount);
                    self.webRTCVideo = content.availableVideo == "1" || false;
                    self.timeOut({
                        agentFirstTimeout: (agentFirstTimeout * 60) || (3 * 60), //默认三分钟
                        agentSecondTimeout: (agentSecondTimeout * 60) || (5 * 60) //默认五分钟
                    });
                    self.username(content.agentName);
                    util.Log("info", "坐席登录成功后，设置的超时未回复时间agentFirstTimeout:" + agentFirstTimeout + ",agentSecondTimeout:" + agentSecondTimeout);
                    
                    break;
                case "msgAck": {
                    var msgBody = JSON.parse(msgBody.content);
                    var index = -1;
                    for(var i = 0; i < ackMessageArr.length; i++){
                        if ((msgBody.msgType == "text" && ackMessageArr[i].type == msgBody.msgType && ackMessageArr[i].username == name && decodeURI(ackMessageArr[i].content).trim() == msgBody.msgContent.trim()) || ((msgBody.msgType == "image" || msgBody.msgType == "file") && ackMessageArr[i].username == name)) {
                            ackMessageArr[i].setTimeFun(true);
                            index = i;
                            break;
                        }
                    }
                    if (index != -1) {
                        ackMessageArr.splice(index, 1);
                    }
                    break;
                }
                //客户语音入呼
                case "msgFromCustomAskForCall": {
                    console.log("webrtcNum:", msgBody.webrtcNum);
                    //坐席当前状态不能外呼（eg:通话中）
                    if (!WebAgent.vm.callEnabled() && !WebAgent.vm.busyEnabled()) {
                        //当前状态不可执行外呼，直接拒绝
                        self.sendMessage("msgFromAgentRefuseCall", "", "", "", user);
                    } else {
                        user.webrtcNum(msgBody.webrtcNum);
                        user.chatType("audio");
                        self.callInUser(user);
                        registerEvent.callIn({
                            name: name,
                            type: "audio"
                        });
                    }
                    break;
                }
                //客户视频入呼
                case "msgFromCustomAskForVideo": {
                    if (!WebAgent.vm.callEnabled() && !WebAgent.vm.busyEnabled()) {
                        //当前状态不可执行外呼，直接拒绝
                        self.sendMessage("msgFromAgentRefuseVideo", "", "", "", user);
                    } else {
                        user.webrtcNum(msgBody.webrtcNum);
                        user.chatType("video");
                        self.callInUser(user);
                        registerEvent.callIn({
                            name: name,
                            type: "video"
                        });
                    }
                    break;
                }
                default:
                    break;
            }
            
            if (message) {
                if (!newUserFlag) {
                    user.addMessage(message, "recv", type, new Date(), user.nickName()
                        ? user.nickName() : user.name.substring(0, 10));
                }
                
                //智能协助
                if (self.openIntellHelp() && type == "text") {
                    require("VmSmartReply").searchReply(message, 0, user);
                }
                
                if (name != (self.currentUser() && self.currentUser().name)) {
                    user.msgNumber(user.msgNumber() + 1);
                }
                
                //消息提示音
                if (self.setChatSoundTip() && self.setChatSoundTip().msgTip) {
                    setTimeout(function () {
                        document.getElementById("chat_msg_tip").play();
                    }, 100);
                }
            }
        };
        
        this.kickoffUser = function () {
            if(self.currentUser().chatBoxType() == "custom-chat"){
                self.sendMessage("msgFromAgentkickCustom");
            }else{
                require("Login").sendMUC(self.currentUser().sessionId,{
                    type:"msgFromAgentQuitMUC"
                });
               /*  self.internalChatList(self.internalChatList().filter(function(item){
                    return item.sessionId != self.currentUser().sessionId;
                }));
                self.currentUser().name="";
                self.currentUser().kickOff();
                self.currentUser().changeSessionTime('close'); */
            }
        };
        
        //来电弹屏提示框隐藏显示
        this.callInTip = ko.observable(false);
        
        this.callInUser = ko.observable(new User());
        
        //客户入呼音频：拒接
        WebAgent.refusedCallIn = function () {
            if (self.callInUser().chatType() == "video") {
                self.sendMessage("msgFromAgentRefuseVideo", "", "", "", self.callInUser());
            } else {
                self.sendMessage("msgFromAgentRefuseCall", "", "", "", self.callInUser());
            }
            self.callInUser().chatType("chat");
        };
        
        /**
         * 呼叫
         * 根据类型判断获取外呼号码
         */
        //WebAgent.imMakeCall=self.makeCall;
        this.makeCallAudio = handleMakeCall.bind(handleMakeCall, "audioCallOut");
        this.makeCallVideo = handleMakeCall.bind(handleMakeCall, "videoCallOut");
        
        function handleMakeCall(type) {
            var user;
            if (type == "audioCallOut" || type == "videoCallOut") {
                user = self.currentUser();
                self.currentUser().chatType(type == "videoCallOut" ? "video" : "audio");
            } else {
                user = self.callInUser();
            }
            
            var setBusyCallBack = function () {
                user.isCalling = true;
                switch ( type ) {
                    case "callIn": {
                        self.callInUser().chatType() == "video" ? self.sendMessage("msgFromAgentAcceptVideo", "", "", "", self.callInUser()) : self.sendMessage("msgFromAgentAcceptCall", "", "", "", self.callInUser());
                        //self.callInUser().isCalling=true;
                        break;
                    }
                    case "audioCallOut": {
                        self.sendMessage("msgFromAgentCallCustom");
                        break;
                    }
                    case "videoCallOut": {
                        self.sendMessage("msgFromAgentAskForVideo");
                        break;
                    }
                    default: {
                        break;
                    }
                }
                util.Log("info", "IM侧发起外呼");
                
                WebAgent.extend.makeCall({
                    outCallNumber: "sip:" + user.webrtcNum(),
                    disNumber: WebAgent.vm.disNumber().match(/\d+/)[0],
                    userData: user.sessionId,
                    mediaType: user.chatType() == "video" ? "2" : "1",
                    ignoreTimeQuantumsCallLimit: "true"
                });
            };
            
            if (WebAgent.vm.disNumber() == "") {
                util.Log("error", "外呼失败，外显号码不存在");
                return;
            }
            if (WebAgent.vm.callEnabled()) {
                setBusyCallBack();
            } else if (WebAgent.vm.busyEnabled()) {
                WebAgent.extend.setBusy(setBusyCallBack);
            } else {
                util.Log("info", "当前状态不可呼叫");
            }
        }
        
        WebAgent.imMakeCall = function () {
            handleMakeCall("callIn");
        };
        
        this.callEnd = function (strDnis) {
            if (self.callInUser() && self.callInUser().isCalling) {
                self.callInUser().isCalling = false;
            } else if (self.currentUser() && self.currentUser().isCalling) {
                self.currentUser().isCalling = false;
            }
            self.sendState("msgFromAgentCallEnd", "msgFromAgentCallEnd", "PC", {
                content: {
                    number: strDnis
                }
            });
        };
        
        //请求评价
        this.requestEvaluate = function () {
            if (!self.currentUser().isSendEvalRequestBtnShow()) {
                return;
            }
            self.sendMessage("msgFromAgentSatisfySend");
            self.currentUser().hasSendEvalRequest(false);
            //self.isSendEvalRequest(true);
            self.currentUser().addMessage("已经向客户发起评价请求", "tip", "text", new Date());
        };
        
        this.previewImg = function (data) {
            IMG.show(data.text.original);
        };
        
        this.palyVideo = function (data, event) {
            
            //将原下载地址转变为可播放的地址
            var arrTmp = data.text.split("/");
            arrTmp.splice(3, 0, "play");
            var playUrl = arrTmp.join("/");
            
            var videoHtml = "<video width='400' height='300'  controls autoplay id='videoShow'>" +
                "<source src='" + playUrl + "' type='video/mp4'/>" +
                "<source src='" + playUrl + "' data-bind='attr: {src: onlineVideo}' type='video/webm'/>" +
                "<source src='" + playUrl + "' data-bind='attr: {src: onlineVideo}' type='video/ogg'/>" +
                "</video>";
            
            $("#videoPlay").html(videoHtml);
            
            $(event.currentTarget).parent(".videoImg").addClass("showLoading");
            
            $(".showLoading .video-loader-box").show();
            
            document.getElementById("videoShow").addEventListener("canplaythrough", function () {
                self.videoPlace(true);
                $(".video-loader-box").hide();
                $(event.currentTarget).parent(".videoImg").removeClass("showLoading");
            });
            
        };
        
        this.closeVideo = function () {
            self.videoPlace(false);
            $("#videoPlay").html("");
        };
        
        /**
         * 创建工单
         * @returns {boolean}
         */
        this.kchartCreate = function () {
            var currentUser = self.currentUser();
            var visitorInfo = currentUser.visitorInfo();
            
            if (!visitorInfo.workOrderEmail()) {
                alert("此访客未填写邮箱地址，无法创建工单！");
                return;
            }
            
            var params = {
                title: "来自" + visitorInfo.workOrderName() + "的聊天对话",
                content: currentUser.messages(),
                issue: currentUser.messages(),
                customServiceName: self.username(),
                creatorId: currentUser.name,
                creatorName: visitorInfo.workOrderName(),
                creatorEmail: visitorInfo.workOrderEmail(),
                email: visitorInfo.workOrderEmail(),
                telphone: visitorInfo.workOrderPhone()
            };
            registerEvent.kchartCreate(params);
            return true;
        };
    };
});

/**
 * Created by fei on 2015/11/25.
 */
define('Vm',["ViewModel"], function(ViewModel) {
    return new ViewModel();
});
/**
 * Created by panfei on 2017/5/12.
 */
define('ViewModelQuickReply',["jquery", "knockout", "User", "require", "util", "Vm"], function ($, ko, User, require, util, Vm) {
    "use strict";

    function ComLang(id, name, selected, type, typeGrop) {
        this.id = id;
        this.name = name;
        this.selected = ko.observable(selected);
        this.type = type;
        this.typeGrop = ko.observable(typeGrop);
    }

    function ajaxRequest(url, data, callback) {
        util.ajaxHelper.post(WebAgent.config.quickSmartReplyPath_sensitive + url, data, callback);
    }

    return function () {
        var self = this;

        this.Title = {
            1: "新增常用语分组",
            2: "编辑常用语分组",
            3: "新增常用语内容",
            4: "编辑常用语内容"
        };

        //操作提示语
        this.operateTip = ko.observable();

        this.quickReplySearchTxt = ko.observable();

        //选中的分组
        this.selectedGgroup = ko.observable();

        //搜索到的内容列表
        this.searchedContentList = ko.observableArray([]);

        //搜索类型
        this.searchType = ko.observable("commonSearch");

        //新增\编辑内容
        this.commLangContent = ko.observable("");

        //快捷搜索模块显示控制
        this.quickReplyDis = ko.observable(true);

        this.deleteConfirmDis = ko.observable(false);

        //新增\编辑Div显示控制
        this.commCreateDis = ko.observable(false);

        //当前新增\编辑窗 标题 key标识
        this.currentTitleKey = ko.observable();

        //当前新增\编辑窗 标题
        this.currentTitle = ko.observable();
        this.commSetTitle = ko.computed(function () {
            self.currentTitle(self.Title[self.currentTitleKey()]);
            return true;
        }, this);

        //常用语分组列表
        this.comLangGgroupList = ko.observableArray([]);

        //常用语内容列表
        this.comLangContentList = ko.observableArray([]);

        //无搜索结果下提示
        this.searchResultTip = ko.observable(false);

        //加载快捷回复页面
        this.loadQuickReplyModel = function () {
            self.quickReplyDis(true);
            self.refreshList();
        };


        //搜索常用语内容
        this.searchComLang = function (type) {
            var content;

            self.searchType(type);

            if (type == "commonSearch") {

                content = self.quickReplySearchTxt();
            }
            if (type == "autoMatch") {

                content = Vm.inputText();
            }


            //self.searchedContentList([]);

            var url = "/commonphrase/PAndSlistForSearch";
            //var data = {"entId": "7766115", "agentId":"001", "content": content};
            var data = {"entId": Vm.agentEntId(), "agentId": Vm.agentId(), "content": content};
            var callback = function (res) {
                if (res.code == 0) {
                    if (res.obj.length > 0) {
                        if (type == "autoMatch") {
                            require("RegisterEvent").autoMatchCallback();
                        }
                        self.searchedContentList([]);
                        self.searchedContentList(res.obj);
                    } else {
                        if (self.searchedContentList().length == 0) {
                            self.searchResultTip(true);
                        }
                    }
                }
            };

            if (content.trim().length > 1) { //两个字起开始匹配查找,keydown会产生一个空格，必须尾部去空格
                ajaxRequest(url, data, callback);
            }
            if (content == "") {
                self.searchedContentList([]);
                self.searchResultTip(false);
            }
        };

        //展示搜索结果
        this.searchResultShow = ko.computed(function () {
            return self.searchResultTip() || self.searchedContentList().length > 0;
        }, this);

        //选中搜索到的常用语内容
        this.handleSearchedContent = function ($data) {
            var selectedSearchContent = $data.name || $data.sentenceDto.content;

            /*if (self.searchType() == "commonSearch") {//追加
             if(Vm.inputText() != undefined){
             Vm.inputText(Vm.inputText() + selectedSearchContent);
             } else{
             Vm.inputText(selectedSearchContent);
             }
             } else if (self.searchType() == "autoMatch") {//替换
             Vm.inputText(selectedSearchContent);
             }*/

            if(Vm.currentUser().online()){
                Vm.inputText(selectedSearchContent); //替换

                if (!vm.openAutoMatch()) {
                    Vm.checkWord();
                }else {
                    $(".message-input").focus();
                }
            }else {
                util.Log("info","用户当前处于离线状态");
            }

        };

        //刷新列表
        this.refreshList = function () {
            self.getGroupListForAgent();
            self.quickReplySearchTxt("");
            self.searchedContentList([]);
            self.searchResultTip(false);
        };

        //操作设置
        this.handleSetting = function () {
            var comLangGgroupList = self.comLangGgroupList();

            self.quickReplyDis(false);
            self.selectedGgroup(null);
            self.cacheValue(null);
            self.searchedContentList([]);
            self.quickReplySearchTxt("");
            //新加
            self.searchResultTip(false);

            self.comLangContentList([]);

            comLangGgroupList = comLangGgroupList.filter(function (p1, p2, p3) {
                return !p1.typeGrop();
            });

            comLangGgroupList = comLangGgroupList.map(function (item, index) {
                return item.selected(false);
            });

            self.comLangGgroupList(comLangGgroupList);

            if(comLangGgroupList.length){
                self.getContentListForAgent(comLangGgroupList[0].id);
            }


        };

        //获取分组列表
        this.getGroupListForAgent = function () {

            var urlSet = "/group/listForAgent", urlSearch = "/commonphrasegroup/commonAndAgentlist";

            //var data = {"entId": "7766115", "agentId":"001"};
            var data = {"entId": Vm.agentEntId(), "agentId": Vm.agentId()};
            var callbackSet = function (res) {
                self.comLangGgroupList([]);
                if (res.code == 0) {
                    var tmpG, selectedGgroupId;
                    if (self.selectedGgroup() != null) {
                        selectedGgroupId = self.selectedGgroup().id;
                    }
                    res.obj.forEach(function (item, index) {
                        if (item.id == selectedGgroupId) {
                            tmpG = new ComLang(item.id, item.groupName, true, "group");
                        } else {
                            tmpG = new ComLang(item.id, item.groupName, false, "group");
                        }
                        self.comLangGgroupList.push(tmpG);
                    });

                }
            };
            var callbackSearch = function (res) {
                self.comLangGgroupList([]);
                if (res.code == 0) {
                    var tmpG, firstGroupId, isCommon, isCommonFirst;
                    if(res.obj.length){
                        res.obj.forEach(function (item, index) {
                            isCommon = item.type == "0" ? true : false;
                            if (index == 0) {
                                isCommonFirst = isCommon;
                                firstGroupId = item.group.id;
                                tmpG = new ComLang(item.group.id, item.group.groupName, true, "group", isCommon);
                            } else {
                                tmpG = new ComLang(item.group.id, item.group.groupName, false, "group", isCommon);
                            }
                            self.comLangGgroupList.push(tmpG);
                        });
                        self.getContentListForAgent(firstGroupId, isCommonFirst);
                    }
                }
            };
            if (self.quickReplyDis()) {
                ajaxRequest(urlSearch, data, callbackSearch);
            } else {
                ajaxRequest(urlSet, data, callbackSet);
            }
        };


        //获取内容列表
        this.getContentListForAgent = function (gid, isCommon) {
            self.comLangContentList([]);
            var url = "/sentence/listByGid";
            var urlCommon = "/commonphrase/listByGid";
            //var data = {"entId": "7766115", "agentId":"001", "gid": gid};
            var data = {"entId": Vm.agentEntId(), "agentId": Vm.agentId(), "gid": gid};
            var callback = function (res) {
                if (res.code == 0) {
                    res.obj.forEach(function (item, index) {
                        var tmpC = new ComLang(item.id, item.content, false, "content");
                        self.comLangContentList.push(tmpC);
                    });
                }
            };

            if (isCommon) {
                ajaxRequest(urlCommon, data, callback);
            } else {
                ajaxRequest(url, data, callback);
            }
        };

        //切换分组
        this.switchComLangGgroup = function ($data) {
            var comLangGgroupList = self.comLangGgroupList();
            comLangGgroupList = comLangGgroupList.map(function (item, index) {
                return item.selected(false);
            });
            self.comLangGgroupList(comLangGgroupList);
            $data.selected(true);
            self.selectedGgroup($data);
            self.cacheValue($data);
            self.getContentListForAgent($data.id, $data.typeGrop());
        };

        //暂存点击过的列表内容
        this.cacheValue = ko.observable(null);
        this.handleCacheValue = function ($data) {
            var comLangContentList = self.comLangContentList();
            comLangContentList = comLangContentList.map(function (item, index) {
                return item.selected(false);
            });
            self.comLangContentList(comLangContentList);
            $data.selected(true);
            self.cacheValue($data);
        };

        //打开新增常用语分组
        this.createCommLangG = function () {
            self.commCreateDis(true);
            self.currentTitleKey(1);
        };

        //打开新增常用语内容
        this.createCommLangC = function () {
            self.commCreateDis(true);
            self.currentTitleKey(3);
        };

        //编辑
        this.handleEdit = function () {
            if (self.cacheValue().type == "group") {
                self.currentTitleKey(2);
            } else {
                self.currentTitleKey(4);
            }
            self.commCreateDis(true);
            self.commLangContent(self.cacheValue().name);
        };

        this.handleDelete = function () {
            self.deleteConfirmDis(true);
        }

        this.handleReturn = function () {
            self.quickReplyDis(true);
        }
        //删除
        this.confirmDelete = function () {
            var id = self.cacheValue().id;
            var gid = self.selectedGgroup().id;
            var url = null;
            var data = {"entId": Vm.agentEntId(), "agentId": Vm.agentId(), "id": id};

            if (self.cacheValue().type == "group") {
                url = "/group/remove";
            } else {
                url = "/sentence/remove";
            }
            var callback = function (res) {
                self.deleteConfirmDis(false);

                if (res.code == 0) {
                    if (self.cacheValue().type == "group") { //删除分组，刷新分组列表
                        self.getGroupListForAgent();
                        self.comLangContentList([]);
                        self.cacheValue(null);
                    } else { //删除内容，刷新内容列表
                        self.getContentListForAgent(gid);
                        self.cacheValue(null);
                    }
                }
            };
            ajaxRequest(url, data, callback);
        };

        //新增\编辑\删除 取消操作
        this.handleCancel = function () {
            self.commCreateDis(false);
            self.commLangContent("");

            self.deleteConfirmDis(false);
        };

        var timer = "";
        var time = 3000;
        //新增\编辑 保存操作
        this.handleSave = function () {
            var content = self.commLangContent().trim();
            var type = self.currentTitleKey();
            var url = null, data = null;
            var callback = function (res) {
                if (res.code == 0) {
                    self.commCreateDis(false);
                    self.commLangContent("");
                    if (type == 1 || type == 2) { //编辑，新增分组，只刷新分组
                        self.getGroupListForAgent();
                    } else if (type == 3 || type == 4) {  //编辑，新增内容，只刷新内容
                        self.getContentListForAgent(self.selectedGgroup().id);
                    }
                } else {
                    self.operateTip(res.desc);
                    setTimeout(function () {
                        self.operateTip(null);
                    }, 2000)
                }
            };

            switch (type) {
                case 1:     //增加分组
                    url = "/group/save";
                    data = {"entId": Vm.agentEntId(), "agentId": Vm.agentId(), "groupName": content};
                    break;
                case 2:     //编辑分组
                    url = "/group/update";
                    data = {
                        "entId": Vm.agentEntId(),
                        "agentId": Vm.agentId(),
                        "id": self.selectedGgroup().id,
                        "groupName": content
                    };
                    break;
                case 3:     //增加内容
                    url = "/sentence/save";
                    data = {
                        "entId": Vm.agentEntId(),
                        "agentId": Vm.agentId(),
                        "gid": self.selectedGgroup().id,
                        "content": content
                    };
                    break;
                case 4:     //编辑内容
                    url = "/sentence/update";
                    data = {
                        "entId": Vm.agentEntId(),
                        "agentId": Vm.agentId(),
                        "gid": self.selectedGgroup().id,
                        "id": self.cacheValue().id,
                        "content": content
                    };
                    break;
                default :
                    break;
            }
            ajaxRequest(url, data, callback);

            //3秒内，只提交一次
            $("#handleSave").unbind("click");
            timer = setTimeout(function () {
                $("#handleSave").click(self.handleSave);
            }, time);

        };

        //模板下载
        this.downLoadUrl = WebAgent.config.quickSmartReplyPath_sensitive + "/template/sentence/SentenceAdd.xlsx";

        //导出
        this.handleExport = function () {
            var url = WebAgent.config.quickSmartReplyPath_sensitive + "/sentence/exportSentence?entId=" + Vm.agentEntId() + "&agentId=" + Vm.agentId();
            //window.location.href = WebAgent.config.quickSmartReplyPath_sensitive + "/sentence/exportSentence?entId=" + self.entId() + "&agentId=" + self.agentId();
            window.open(url);
        }

        //导出
        //this.exportUrl = WebAgent.config.quickSmartReplyPath_sensitive + "/sentence/exportSentence?entId=" + self.entId() + "&agentId=" + self.agentId();
    }
});
/**
 * Created by panfei on 2017/5/12.
 */
define('VmQuickReply',["ViewModelQuickReply"], function(ViewModelQuickReply) {
    return new ViewModelQuickReply();
});
/**
 * Created by yinghan on 2017/8/29.
 */
define('ViewModelSmartReply',["jquery", "knockout", "User", "require", "util", "Vm"], function ($, ko, User, require, util, Vm) {
    "use strict";

    return function () {
        var self = this;

        this.smartReplySearchTxt = ko.observable("");
        this.smartReply = ko.observableArray([]);
        this.smartContent = ko.observable(false);
        this.smartTip = ko.observable("暂无内容");
        this.photoName = ko.observable(1);

        //查询
        this.searchReply = function (dataQuery,resultType,user) {
            resultType = resultType==0 ? 0 : 1;
            dataQuery = (typeof dataQuery) == "string" ? dataQuery:self.smartReplySearchTxt();

            var data = {
                question:dataQuery,
                resultType: resultType,
                entId: require('Vm').agentEntId()
            };

            if(resultType==1){
                self.smartReplySearchTxt(dataQuery);
            }

            var callback = function (data) {
                if(data.code == "0" && data.obj.answerType == "1"){
                    if(resultType == 1){
                        self.smartReply(data.obj.msg4TextResult);
                        self.smartContent(true);
                    }else {
                        self.sendSmartReply(data.obj.msg4TextResult[0],user);
                    }
                }else {
                    if(resultType==1){
                        self.photoName(-1);
                        self.smartTip("你的问题我还无法回答，请完善我的知识库");
                        self.smartContent(false);
                    }
                    console.log("[webAgent-smartReply]:",data.code == "0" ? "未找到答案":data.desc);
                }

            };
            util.ajaxHelper.post(WebAgent.config.quickSmartReplyPath_sensitive + "/intelligentQuery/query", data, callback);
        };

        //刷新
        this.reflash = function () {
            self.photoName(1);
            self.smartReply([]);
            self.smartReplySearchTxt("");
            self.smartContent(false);
            self.smartTip("暂无内容");
        };

        //发送答案
        this.sendSmartReply = function (smartAnswer,user) {

            user=user.ent ? user : Vm.currentUser();

            if(user.online()){
                //发送数据
                Vm.sendMessage("text","","",smartAnswer.answer,user,true);
                //发送图片
                /*if (smartAnswer.msgtype == "1") {
                    Vm.sendMessage("image", smartAnswer.msg4ImageTextresult,smartAnswer.msg4ImageTextresult,"",user);
                }*/
            }else {
                util.Log("warm","用户当前处于离线状态");
            }
        }
    }
});
/**
 * Created by yinghan on 2017/8/29.
 */
define('VmSmartReply',["ViewModelSmartReply"], function(ViewModelSmartReply) {
    return new ViewModelSmartReply();
});
JSJAC_HAVEKEYS = true;          // whether to use keys
JSJAC_NKEYS = 16;            // number of keys to generate
JSJAC_INACTIVITY = 300;         // qnd hack to make suspend/resume
                                // work more smoothly with polling

JSJAC_ERR_COUNT = 10;           // number of retries in case of
                                // connection errors

JSJAC_ALLOW_PLAIN = true;       // whether to allow plaintext logins

JSJAC_ALLOW_SCRAM = false;      // allow usage of SCRAM-SHA-1
                                // authentication; please note that it
                                // is quite slow so it is disable by
                                // default

JSJAC_CHECKQUEUEINTERVAL = 100; // msecs to poll send queue
JSJAC_CHECKINQUEUEINTERVAL = 100; // msecs to poll incoming queue
JSJAC_TIMERVAL = 2000;          // default polling interval

JSJAC_RETRYDELAY = 5000;        // msecs to wait before trying next
                                // request after error

JSJAC_REGID_TIMEOUT = 20000;    // time in msec until registered
                                // callbacks for ids timeout

/* Options specific to HTTP Binding (BOSH) */
JSJACHBC_MAX_HOLD = 1;          // default for number of connctions
                                // held by connection manager

JSJACHBC_MAX_WAIT = 300;        // default 'wait' param - how long an
                                // idle connection should be held by
                                // connection manager

JSJACHBC_BOSH_VERSION = "1.10";
JSJACHBC_USE_BOSH_VER = true;

JSJACHBC_MAXPAUSE = 120;        // how long a suspend/resume cycle may
                                // take
JSJACPING_INTERVAL = 25000;
/*** END CONFIG ***/
var NS_DISCO_ITEMS = "http://jabber.org/protocol/disco#items";
var NS_DISCO_INFO = "http://jabber.org/protocol/disco#info";
var NS_VCARD = "vcard-temp";
var NS_VCARD_UPDATE = "vcard-temp:x:update";
var NS_AUTH = "jabber:iq:auth";
var NS_AUTH_ERROR = "jabber:iq:auth:error";
var NS_REGISTER = "jabber:iq:register";
var NS_SEARCH = "jabber:iq:search";
var NS_ROSTER = "jabber:iq:roster";
var NS_PRIVACY = "jabber:iq:privacy";
var NS_PRIVATE = "jabber:iq:private";
var NS_VERSION = "jabber:iq:version";
var NS_TIME = "jabber:iq:time";
var NS_TIME_NEW = "urn:xmpp:time";
var NS_LAST = "jabber:iq:last";
var NS_XDATA = "jabber:x:data";
var NS_IQDATA = "jabber:iq:data";
var NS_DELAY = "jabber:x:delay";
var NS_DELAY_NEW = "urn:xmpp:delay";
var NS_EXPIRE = "jabber:x:expire";
var NS_EVENT = "jabber:x:event";
var NS_XCONFERENCE = "jabber:x:conference";
var NS_PING = "urn:xmpp:ping";
var NS_BOOKSMARKS = "storage:bookmarks";
var NS_FORWARD_0 = "urn:xmpp:forward:0";
var NS_CARBONS_2 = "urn:xmpp:carbons:2";
var NS_CHAT_STATES = "http://jabber.org/protocol/chatstates";
var NS_STATS = "http://jabber.org/protocol/stats";
var NS_MUC = "http://jabber.org/protocol/muc";
var NS_MUC_USER = "http://jabber.org/protocol/muc#user";
var NS_MUC_ADMIN = "http://jabber.org/protocol/muc#admin";
var NS_MUC_OWNER = "http://jabber.org/protocol/muc#owner";
var NS_PUBSUB = "http://jabber.org/protocol/pubsub";
var NS_PUBSUB_EVENT = "http://jabber.org/protocol/pubsub#event";
var NS_PUBSUB_OWNER = "http://jabber.org/protocol/pubsub#owner";
var NS_PUBSUB_ERRORS = "http://jabber.org/protocol/pubsub#errors";
var NS_PUBSUB_NMI = "http://jabber.org/protocol/pubsub#node-meta-info";
var NS_COMMANDS = "http://jabber.org/protocol/commands";
var NS_CAPS = "http://jabber.org/protocol/caps";
var NS_STREAM = "http://etherx.jabber.org/streams";
var NS_FRAMING = "urn:ietf:params:xml:ns:xmpp-framing";
var NS_CLIENT = "jabber:client";
var NS_BOSH = "http://jabber.org/protocol/httpbind";
var NS_XBOSH = "urn:xmpp:xbosh";
var NS_STANZAS = "urn:ietf:params:xml:ns:xmpp-stanzas";
var NS_STREAMS = "urn:ietf:params:xml:ns:xmpp-streams";
var NS_TLS = "urn:ietf:params:xml:ns:xmpp-tls";
var NS_SASL = "urn:ietf:params:xml:ns:xmpp-sasl";
var NS_SESSION = "urn:ietf:params:xml:ns:xmpp-session";
var NS_BIND = "urn:ietf:params:xml:ns:xmpp-bind";
var NS_FEATURE_IQAUTH = "http://jabber.org/features/iq-auth";
var NS_FEATURE_IQREGISTER = "http://jabber.org/features/iq-register";
var NS_FEATURE_COMPRESS = "http://jabber.org/features/compress";
var NS_COMPRESS = "http://jabber.org/protocol/compress";

function STANZA_ERROR(c, b, a) {
    if (window == this) {
        return new STANZA_ERROR(c, b, a);
    }
    this.code = c;
    this.type = b;
    this.cond = a;
}

var ERR_BAD_REQUEST = STANZA_ERROR("400", "modify", "bad-request");
var ERR_CONFLICT = STANZA_ERROR("409", "cancel", "conflict");
var ERR_FEATURE_NOT_IMPLEMENTED = STANZA_ERROR("501", "cancel", "feature-not-implemented");
var ERR_FORBIDDEN = STANZA_ERROR("403", "auth", "forbidden");
var ERR_GONE = STANZA_ERROR("302", "modify", "gone");
var ERR_INTERNAL_SERVER_ERROR = STANZA_ERROR("500", "wait", "internal-server-error");
var ERR_ITEM_NOT_FOUND = STANZA_ERROR("404", "cancel", "item-not-found");
var ERR_JID_MALFORMED = STANZA_ERROR("400", "modify", "jid-malformed");
var ERR_NOT_ACCEPTABLE = STANZA_ERROR("406", "modify", "not-acceptable");
var ERR_NOT_ALLOWED = STANZA_ERROR("405", "cancel", "not-allowed");
var ERR_NOT_AUTHORIZED = STANZA_ERROR("401", "auth", "not-authorized");
var ERR_PAYMENT_REQUIRED = STANZA_ERROR("402", "auth", "payment-required");
var ERR_RECIPIENT_UNAVAILABLE = STANZA_ERROR("404", "wait", "recipient-unavailable");
var ERR_REDIRECT = STANZA_ERROR("302", "modify", "redirect");
var ERR_REGISTRATION_REQUIRED = STANZA_ERROR("407", "auth", "registration-required");
var ERR_REMOTE_SERVER_NOT_FOUND = STANZA_ERROR("404", "cancel", "remote-server-not-found");
var ERR_REMOTE_SERVER_TIMEOUT = STANZA_ERROR("504", "wait", "remote-server-timeout");
var ERR_RESOURCE_CONSTRAINT = STANZA_ERROR("500", "wait", "resource-constraint");
var ERR_SERVICE_UNAVAILABLE = STANZA_ERROR("503", "cancel", "service-unavailable");
var ERR_SUBSCRIPTION_REQUIRED = STANZA_ERROR("407", "auth", "subscription-required");
var ERR_UNEXPECTED_REQUEST = STANZA_ERROR("400", "wait", "unexpected-request");
var hexcase = 0;
var b64pad = "=";

function hex_sha1(a) {
    return rstr2hex(rstr_sha1(str2rstr_utf8(a)));
}

function b64_sha1(a) {
    return rstr2b64(rstr_sha1(str2rstr_utf8(a)));
}

function any_sha1(a, b) {
    return rstr2any(rstr_sha1(str2rstr_utf8(a)), b);
}

function hex_hmac_sha1(a, b) {
    return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a), str2rstr_utf8(b)));
}

function b64_hmac_sha1(a, b) {
    return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a), str2rstr_utf8(b)));
}

function any_hmac_sha1(a, c, b) {
    return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a), str2rstr_utf8(c)), b);
}

function sha1_vm_test() {
    return hex_sha1("abc").toLowerCase() == "a9993e364706816aba3e25717850c26c9cd0d89d";
}

function rstr_sha1(a) {
    return binb2rstr(binb_sha1(rstr2binb(a), a.length * 8));
}

function rstr_hmac_sha1(c, f) {
    var e = rstr2binb(c);
    if (e.length > 16) {
        e = binb_sha1(e, c.length * 8);
    }
    var a = Array(16), d = Array(16);
    for (var b = 0; b < 16; b++) {
        a[b] = e[b] ^ 909522486;
        d[b] = e[b] ^ 1549556828;
    }
    var g = binb_sha1(a.concat(rstr2binb(f)), 512 + f.length * 8);
    return binb2rstr(binb_sha1(d.concat(g), 512 + 160));
}

function rstr2binb(b) {
    var a = Array(b.length >> 2);
    for (var c = 0; c < a.length; c++) {
        a[c] = 0;
    }
    for (var c = 0; c < b.length * 8; c += 8) {
        a[c >> 5] |= (b.charCodeAt(c / 8) & 255) << (24 - c % 32);
    }
    return a;
}

function binb2rstr(b) {
    var a = "";
    for (var c = 0; c < b.length * 32; c += 8) {
        a += String.fromCharCode((b[c >> 5] >>> (24 - c % 32)) & 255);
    }
    return a;
}

function binb_sha1(v, o) {
    v[o >> 5] |= 128 << (24 - o % 32);
    v[((o + 64 >> 9) << 4) + 15] = o;
    var y = Array(80);
    var u = 1732584193;
    var s = -271733879;
    var r = -1732584194;
    var q = 271733878;
    var p = -1009589776;
    for (var l = 0; l < v.length; l += 16) {
        var n = u;
        var m = s;
        var k = r;
        var h = q;
        var f = p;
        for (var g = 0; g < 80; g++) {
            if (g < 16) {
                y[g] = v[l + g];
            } else {
                y[g] = bit_rol(y[g - 3] ^ y[g - 8] ^ y[g - 14] ^ y[g - 16], 1);
            }
            var z = safe_add(safe_add(bit_rol(u, 5), sha1_ft(g, s, r, q)), safe_add(safe_add(p, y[g]), sha1_kt(g)));
            p = q;
            q = r;
            r = bit_rol(s, 30);
            s = u;
            u = z;
        }
        u = safe_add(u, n);
        s = safe_add(s, m);
        r = safe_add(r, k);
        q = safe_add(q, h);
        p = safe_add(p, f);
    }
    return Array(u, s, r, q, p);
}

function sha1_ft(e, a, g, f) {
    if (e < 20) {
        return (a & g) | ((~a) & f);
    }
    if (e < 40) {
        return a ^ g ^ f;
    }
    if (e < 60) {
        return (a & g) | (a & f) | (g & f);
    }
    return a ^ g ^ f;
}

function sha1_kt(a) {
    return (a < 20) ? 1518500249 : (a < 40) ? 1859775393 : (a < 60) ? -1894007588 : -899497514;
}

function hex_md5(a) {
    return rstr2hex(rstr_md5(str2rstr_utf8(a)));
}

function b64_md5(a) {
    return rstr2b64(rstr_md5(str2rstr_utf8(a)));
}

function any_md5(a, b) {
    return rstr2any(rstr_md5(str2rstr_utf8(a)), b);
}

function hex_hmac_md5(a, b) {
    return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a), str2rstr_utf8(b)));
}

function b64_hmac_md5(a, b) {
    return rstr2b64(rstr_hmac_md5(str2rstr_utf8(a), str2rstr_utf8(b)));
}

function any_hmac_md5(a, c, b) {
    return rstr2any(rstr_hmac_md5(str2rstr_utf8(a), str2rstr_utf8(c)), b);
}

function md5_vm_test() {
    return hex_md5("abc").toLowerCase() == "900150983cd24fb0d6963f7d28e17f72";
}

function rstr_md5(a) {
    return binl2rstr(binl_md5(rstr2binl(a), a.length * 8));
}

function rstr_hmac_md5(c, f) {
    var e = rstr2binl(c);
    if (e.length > 16) {
        e = binl_md5(e, c.length * 8);
    }
    var a = Array(16), d = Array(16);
    for (var b = 0; b < 16; b++) {
        a[b] = e[b] ^ 909522486;
        d[b] = e[b] ^ 1549556828;
    }
    var g = binl_md5(a.concat(rstr2binl(f)), 512 + f.length * 8);
    return binl2rstr(binl_md5(d.concat(g), 512 + 128));
}

function rstr2hex(c) {
    try {
        hexcase;
    } catch (g) {
        hexcase = 0;
    }
    var f = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
    var b = "";
    var a;
    for (var d = 0; d < c.length; d++) {
        a = c.charCodeAt(d);
        b += f.charAt((a >>> 4) & 15) + f.charAt(a & 15);
    }
    return b;
}

function rstr2b64(c) {
    try {
        b64pad;
    } catch (h) {
        b64pad = "";
    }
    var g = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var b = "";
    var a = c.length;
    for (var f = 0; f < a; f += 3) {
        var k = (c.charCodeAt(f) << 16) | (f + 1 < a ? c.charCodeAt(f + 1) << 8 : 0) | (f + 2 < a ? c.charCodeAt(f + 2) : 0);
        for (var d = 0; d < 4; d++) {
            if (f * 8 + d * 6 > c.length * 8) {
                b += b64pad;
            } else {
                b += g.charAt((k >>> 6 * (3 - d)) & 63);
            }
        }
    }
    return b;
}

function rstr2any(m, c) {
    var b = c.length;
    var l, f, a, n, e;
    var k = Array(Math.ceil(m.length / 2));
    for (l = 0; l < k.length; l++) {
        k[l] = (m.charCodeAt(l * 2) << 8) | m.charCodeAt(l * 2 + 1);
    }
    var h = Math.ceil(m.length * 8 / (Math.log(c.length) / Math.log(2)));
    var g = Array(h);
    for (f = 0; f < h; f++) {
        e = Array();
        n = 0;
        for (l = 0; l < k.length; l++) {
            n = (n << 16) + k[l];
            a = Math.floor(n / b);
            n -= a * b;
            if (e.length > 0 || a > 0) {
                e[e.length] = a;
            }
        }
        g[f] = n;
        k = e;
    }
    var d = "";
    for (l = g.length - 1; l >= 0; l--) {
        d += c.charAt(g[l]);
    }
    return d;
}

function str2rstr_utf8(c) {
    var b = "";
    var d = -1;
    var a, e;
    while ( ++d < c.length ) {
        a = c.charCodeAt(d);
        e = d + 1 < c.length ? c.charCodeAt(d + 1) : 0;
        if (55296 <= a && a <= 56319 && 56320 <= e && e <= 57343) {
            a = 65536 + ((a & 1023) << 10) + (e & 1023);
            d++;
        }
        if (a <= 127) {
            b += String.fromCharCode(a);
        } else {
            if (a <= 2047) {
                b += String.fromCharCode(192 | ((a >>> 6) & 31), 128 | (a & 63));
            } else {
                if (a <= 65535) {
                    b += String.fromCharCode(224 | ((a >>> 12) & 15), 128 | ((a >>> 6) & 63), 128 | (a & 63));
                } else {
                    if (a <= 2097151) {
                        b += String.fromCharCode(240 | ((a >>> 18) & 7), 128 | ((a >>> 12) & 63), 128 | ((a >>> 6) & 63), 128 | (a & 63));
                    }
                }
            }
        }
    }
    return b;
}

function str2rstr_utf16le(b) {
    var a = "";
    for (var c = 0; c < b.length; c++) {
        a += String.fromCharCode(b.charCodeAt(c) & 255, (b.charCodeAt(c) >>> 8) & 255);
    }
    return a;
}

function str2rstr_utf16be(b) {
    var a = "";
    for (var c = 0; c < b.length; c++) {
        a += String.fromCharCode((b.charCodeAt(c) >>> 8) & 255, b.charCodeAt(c) & 255);
    }
    return a;
}

function rstr2binl(b) {
    var a = Array(b.length >> 2);
    for (var c = 0; c < a.length; c++) {
        a[c] = 0;
    }
    for (var c = 0; c < b.length * 8; c += 8) {
        a[c >> 5] |= (b.charCodeAt(c / 8) & 255) << (c % 32);
    }
    return a;
}

function binl2rstr(b) {
    var a = "";
    for (var c = 0; c < b.length * 32; c += 8) {
        a += String.fromCharCode((b[c >> 5] >>> (c % 32)) & 255);
    }
    return a;
}

function binl_md5(p, k) {
    p[k >> 5] |= 128 << ((k) % 32);
    p[(((k + 64) >>> 9) << 4) + 14] = k;
    var o = 1732584193;
    var n = -271733879;
    var m = -1732584194;
    var l = 271733878;
    for (var g = 0; g < p.length; g += 16) {
        var j = o;
        var h = n;
        var f = m;
        var e = l;
        o = md5_ff(o, n, m, l, p[g + 0], 7, -680876936);
        l = md5_ff(l, o, n, m, p[g + 1], 12, -389564586);
        m = md5_ff(m, l, o, n, p[g + 2], 17, 606105819);
        n = md5_ff(n, m, l, o, p[g + 3], 22, -1044525330);
        o = md5_ff(o, n, m, l, p[g + 4], 7, -176418897);
        l = md5_ff(l, o, n, m, p[g + 5], 12, 1200080426);
        m = md5_ff(m, l, o, n, p[g + 6], 17, -1473231341);
        n = md5_ff(n, m, l, o, p[g + 7], 22, -45705983);
        o = md5_ff(o, n, m, l, p[g + 8], 7, 1770035416);
        l = md5_ff(l, o, n, m, p[g + 9], 12, -1958414417);
        m = md5_ff(m, l, o, n, p[g + 10], 17, -42063);
        n = md5_ff(n, m, l, o, p[g + 11], 22, -1990404162);
        o = md5_ff(o, n, m, l, p[g + 12], 7, 1804603682);
        l = md5_ff(l, o, n, m, p[g + 13], 12, -40341101);
        m = md5_ff(m, l, o, n, p[g + 14], 17, -1502002290);
        n = md5_ff(n, m, l, o, p[g + 15], 22, 1236535329);
        o = md5_gg(o, n, m, l, p[g + 1], 5, -165796510);
        l = md5_gg(l, o, n, m, p[g + 6], 9, -1069501632);
        m = md5_gg(m, l, o, n, p[g + 11], 14, 643717713);
        n = md5_gg(n, m, l, o, p[g + 0], 20, -373897302);
        o = md5_gg(o, n, m, l, p[g + 5], 5, -701558691);
        l = md5_gg(l, o, n, m, p[g + 10], 9, 38016083);
        m = md5_gg(m, l, o, n, p[g + 15], 14, -660478335);
        n = md5_gg(n, m, l, o, p[g + 4], 20, -405537848);
        o = md5_gg(o, n, m, l, p[g + 9], 5, 568446438);
        l = md5_gg(l, o, n, m, p[g + 14], 9, -1019803690);
        m = md5_gg(m, l, o, n, p[g + 3], 14, -187363961);
        n = md5_gg(n, m, l, o, p[g + 8], 20, 1163531501);
        o = md5_gg(o, n, m, l, p[g + 13], 5, -1444681467);
        l = md5_gg(l, o, n, m, p[g + 2], 9, -51403784);
        m = md5_gg(m, l, o, n, p[g + 7], 14, 1735328473);
        n = md5_gg(n, m, l, o, p[g + 12], 20, -1926607734);
        o = md5_hh(o, n, m, l, p[g + 5], 4, -378558);
        l = md5_hh(l, o, n, m, p[g + 8], 11, -2022574463);
        m = md5_hh(m, l, o, n, p[g + 11], 16, 1839030562);
        n = md5_hh(n, m, l, o, p[g + 14], 23, -35309556);
        o = md5_hh(o, n, m, l, p[g + 1], 4, -1530992060);
        l = md5_hh(l, o, n, m, p[g + 4], 11, 1272893353);
        m = md5_hh(m, l, o, n, p[g + 7], 16, -155497632);
        n = md5_hh(n, m, l, o, p[g + 10], 23, -1094730640);
        o = md5_hh(o, n, m, l, p[g + 13], 4, 681279174);
        l = md5_hh(l, o, n, m, p[g + 0], 11, -358537222);
        m = md5_hh(m, l, o, n, p[g + 3], 16, -722521979);
        n = md5_hh(n, m, l, o, p[g + 6], 23, 76029189);
        o = md5_hh(o, n, m, l, p[g + 9], 4, -640364487);
        l = md5_hh(l, o, n, m, p[g + 12], 11, -421815835);
        m = md5_hh(m, l, o, n, p[g + 15], 16, 530742520);
        n = md5_hh(n, m, l, o, p[g + 2], 23, -995338651);
        o = md5_ii(o, n, m, l, p[g + 0], 6, -198630844);
        l = md5_ii(l, o, n, m, p[g + 7], 10, 1126891415);
        m = md5_ii(m, l, o, n, p[g + 14], 15, -1416354905);
        n = md5_ii(n, m, l, o, p[g + 5], 21, -57434055);
        o = md5_ii(o, n, m, l, p[g + 12], 6, 1700485571);
        l = md5_ii(l, o, n, m, p[g + 3], 10, -1894986606);
        m = md5_ii(m, l, o, n, p[g + 10], 15, -1051523);
        n = md5_ii(n, m, l, o, p[g + 1], 21, -2054922799);
        o = md5_ii(o, n, m, l, p[g + 8], 6, 1873313359);
        l = md5_ii(l, o, n, m, p[g + 15], 10, -30611744);
        m = md5_ii(m, l, o, n, p[g + 6], 15, -1560198380);
        n = md5_ii(n, m, l, o, p[g + 13], 21, 1309151649);
        o = md5_ii(o, n, m, l, p[g + 4], 6, -145523070);
        l = md5_ii(l, o, n, m, p[g + 11], 10, -1120210379);
        m = md5_ii(m, l, o, n, p[g + 2], 15, 718787259);
        n = md5_ii(n, m, l, o, p[g + 9], 21, -343485551);
        o = safe_add(o, j);
        n = safe_add(n, h);
        m = safe_add(m, f);
        l = safe_add(l, e);
    }
    return Array(o, n, m, l);
}

function md5_cmn(h, e, d, c, g, f) {
    return safe_add(bit_rol(safe_add(safe_add(e, h), safe_add(c, f)), g), d);
}

function md5_ff(g, f, k, j, e, i, h) {
    return md5_cmn((f & k) | ((~f) & j), g, f, e, i, h);
}

function md5_gg(g, f, k, j, e, i, h) {
    return md5_cmn((f & j) | (k & (~j)), g, f, e, i, h);
}

function md5_hh(g, f, k, j, e, i, h) {
    return md5_cmn(f ^ k ^ j, g, f, e, i, h);
}

function md5_ii(g, f, k, j, e, i, h) {
    return md5_cmn(k ^ (f | (~j)), g, f, e, i, h);
}

function safe_add(a, d) {
    var c = (a & 65535) + (d & 65535);
    var b = (a >> 16) + (d >> 16) + (c >> 16);
    return (b << 16) | (c & 65535);
}

function bit_rol(a, b) {
    return (a << b) | (a >>> (32 - b));
}

function utf8t2d(a) {
    a = a.replace(/\r\n/g, "\n");
    var b = new Array;
    var g = String.fromCharCode(237);
    if (g.charCodeAt(0) < 0) {
        for (var f = 0; f < a.length; f++) {
            var e = a.charCodeAt(f);
            if (e > 0) {
                b[b.length] = e;
            } else {
                b[b.length] = (((256 + e) >> 6) | 192);
                b[b.length] = (((256 + e) & 63) | 128);
            }
        }
    } else {
        for (var f = 0; f < a.length; f++) {
            var e = a.charCodeAt(f);
            if (e < 128) {
                b[b.length] = e;
            } else {
                if ((e > 127) && (e < 2048)) {
                    b[b.length] = ((e >> 6) | 192);
                    b[b.length] = ((e & 63) | 128);
                } else {
                    b[b.length] = ((e >> 12) | 224);
                    b[b.length] = (((e >> 6) & 63) | 128);
                    b[b.length] = ((e & 63) | 128);
                }
            }
        }
    }
    return b;
}

function utf8d2t(c) {
    var b = new Array;
    var a = 0;
    while ( a < c.length ) {
        if (c[a] < 128) {
            b[b.length] = String.fromCharCode(c[a]);
            a++;
        } else {
            if ((c[a] > 191) && (c[a] < 224)) {
                b[b.length] = String.fromCharCode(((c[a] & 31) << 6) | (c[a + 1] & 63));
                a += 2;
            } else {
                b[b.length] = String.fromCharCode(((c[a] & 15) << 12) | ((c[a + 1] & 63) << 6) | (c[a + 2] & 63));
                a += 3;
            }
        }
    }
    return b.join("");
}

function b64arrays() {
    var b = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    b64 = new Array();
    f64 = new Array();
    for (var a = 0; a < b.length; a++) {
        b64[a] = b.charAt(a);
        f64[b.charAt(a)] = a;
    }
}

function b64d2t(f) {
    var e = new Array;
    var c = 0;
    var a = f.length;
    if ((a % 3) == 1) {
        f[f.length] = 0;
        f[f.length] = 0;
    }
    if ((a % 3) == 2) {
        f[f.length] = 0;
    }
    while ( c < f.length ) {
        e[e.length] = b64[f[c] >> 2];
        e[e.length] = b64[((f[c] & 3) << 4) | (f[c + 1] >> 4)];
        e[e.length] = b64[((f[c + 1] & 15) << 2) | (f[c + 2] >> 6)];
        e[e.length] = b64[f[c + 2] & 63];
        c += 3;
    }
    if ((a % 3) == 1) {
        e[e.length - 1] = e[e.length - 2] = "=";
    }
    if ((a % 3) == 2) {
        e[e.length - 1] = "=";
    }
    var b = e.join("");
    return b;
}

function b64t2d(b) {
    var c = new Array;
    var a = 0;
    b = b.replace(/\n|\r/g, "");
    b = b.replace(/=/g, "");
    while ( a < b.length ) {
        c[c.length] = (f64[b.charAt(a)] << 2) | (f64[b.charAt(a + 1)] >> 4);
        c[c.length] = (((f64[b.charAt(a + 1)] & 15) << 4) | (f64[b.charAt(a + 2)] >> 2));
        c[c.length] = (((f64[b.charAt(a + 2)] & 3) << 6) | (f64[b.charAt(a + 3)]));
        a += 4;
    }
    if (b.length % 4 == 2) {
        c = c.slice(0, c.length - 2);
    }
    if (b.length % 4 == 3) {
        c = c.slice(0, c.length - 1);
    }
    return c;
}

if (typeof (atob) == "undefined" || typeof (btoa) == "undefined") {
    b64arrays();
}
if (typeof (atob) == "undefined") {
    b64decode = function (a) {
        return utf8d2t(b64t2d(a));
    };
    b64decode_bin = function (c) {
        var d = b64t2d(c);
        var a = "";
        for (var b = 0; b < d.length; b++) {
            a += String.fromCharCode(d[b]);
        }
        return a;
    };
} else {
    b64decode = function (a) {
        return decodeURIComponent(escape(atob(a)));
    };
    b64decode_bin = atob;
}
if (typeof (btoa) == "undefined") {
    b64encode = function (a) {
        return b64d2t(utf8t2d(a));
    };
} else {
    b64encode = function (a) {
        return btoa(unescape(encodeURIComponent(a)));
    };
}

function XmlHttp() {
}

XmlHttp.create = function () {
    try {
        if (window.XMLHttpRequest) {
            var b = new XMLHttpRequest();
            if (b.readyState === null) {
                b.readyState = 1;
                b.addEventListener("load", function () {
                    b.readyState = 4;
                    if (typeof b.onreadystatechange == "function") {
                        b.onreadystatechange();
                    }
                }, false);
            }
            return b;
        }
        if (window.ActiveXObject) {
            return new ActiveXObject(XmlHttp.getPrefix() + ".XmlHttp");
        }
    } catch (a) {
    }
    throw new Error("Your browser does not support XmlHttp objects");
};
XmlHttp.getPrefix = function () {
    if (XmlHttp.prefix) {
        return XmlHttp.prefix;
    }
    var c = ["MSXML2", "Microsoft", "MSXML", "MSXML3"];
    var d;
    for (var b = 0; b < c.length; b++) {
        try {
            d = new ActiveXObject(c[b] + ".XmlHttp");
            return XmlHttp.prefix = c[b];
        } catch (a) {
        }
    }
    throw new Error("Could not find an installed XML parser");
};

function XmlDocument() {
}

XmlDocument.create = function (b, d) {
    b = b || "foo";
    d = d || "";
    try {
        var e;
        if (document.implementation && document.implementation.createDocument) {
            e = document.implementation.createDocument(d, b, null);
            if (e.readyState === null) {
                e.readyState = 1;
                e.addEventListener("load", function () {
                    e.readyState = 4;
                    if (typeof e.onreadystatechange == "function") {
                        e.onreadystatechange();
                    }
                }, false);
            }
        } else {
            if (window.ActiveXObject) {
                e = new ActiveXObject(XmlDocument.getPrefix() + ".DomDocument");
            }
        }
        if (!e.documentElement || e.documentElement.tagName != b || (e.documentElement.namespaceURI && e.documentElement.namespaceURI != d)) {
            try {
                if (d !== "") {
                    e.appendChild(e.createElement(b)).setAttribute("xmlns", d);
                } else {
                    e.appendChild(e.createElement(b));
                }
            } catch (a) {
                e = document.implementation.createDocument(d, b, null);
                if (e.documentElement === null) {
                    e.appendChild(e.createElement(b));
                }
                if (d !== "" && e.documentElement.getAttribute("xmlns") != d) {
                    e.documentElement.setAttribute("xmlns", d);
                }
            }
        }
        return e;
    } catch (c) {
    }
    throw new Error("Your browser does not support XmlDocument objects");
};
XmlDocument.getPrefix = function () {
    if (XmlDocument.prefix) {
        return XmlDocument.prefix;
    }
    var c = ["MSXML2", "Microsoft", "MSXML", "MSXML3"];
    var d;
    for (var b = 0; b < c.length; b++) {
        try {
            d = new ActiveXObject(c[b] + ".DomDocument");
            return XmlDocument.prefix = c[b];
        } catch (a) {
        }
    }
    throw new Error("Could not find an installed XML parser");
};
if (typeof (Document) != "undefined" && window.DOMParser) {
    Document.prototype.loadXML = function (b) {
        var c = (new DOMParser()).parseFromString(b, "text/xml");
        while ( this.hasChildNodes() ) {
            this.removeChild(this.lastChild);
        }
        for (var a = 0; a < c.childNodes.length; a++) {
            this.appendChild(this.importNode(c.childNodes[a], true));
        }
    };
}
if (window.XMLSerializer && window.Node && Node.prototype && Node.prototype.__defineGetter__) {
    XMLDocument.prototype.__defineGetter__("xml", function () {
        return (new XMLSerializer()).serializeToString(this);
    });
    Document.prototype.__defineGetter__("xml", function () {
        return (new XMLSerializer()).serializeToString(this);
    });
    Node.prototype.__defineGetter__("xml", function () {
        return (new XMLSerializer()).serializeToString(this);
    });
}
if (window.XDomainRequest) {
    window.ieXDRToXHR = function (b) {
        var a = b.XMLHttpRequest;
        b.XMLHttpRequest = function () {
            this.onreadystatechange = Object;
            this.xhr = null;
            this.xdr = null;
            this.readyState = 0;
            this.status = "";
            this.statusText = null;
            this.responseText = null;
            this.getResponseHeader = null;
            this.getAllResponseHeaders = null;
            this.setRequestHeader = null;
            this.abort = null;
            this.send = null;
            this.isxdr = false;
            var c = this;
            c.xdrLoadedBinded = function () {
                c.xdrLoaded();
            };
            c.xdrErrorBinded = function () {
                c.xdrError();
            };
            c.xdrProgressBinded = function () {
                c.xdrProgress();
            };
            c.xhrReadyStateChangedBinded = function () {
                c.xhrReadyStateChanged();
            };
        };
        XMLHttpRequest.prototype.open = function (h, d, e, c, f) {
            var g = document.createElement("a");
            g.href = d;
            if (g.hostname != document.domain) {
                if (this.xdr === null) {
                    this.xdr = new b.XDomainRequest();
                }
                this.isxdr = true;
                this.setXDRActive();
                this.xdr.open(h, d);
            } else {
                if (this.xhr === null) {
                    this.xhr = new a();
                }
                this.isxdr = false;
                this.setXHRActive();
                this.xhr.open(h, d, e, c, f);
            }
        };
        XMLHttpRequest.prototype.xdrGetResponseHeader = function (c) {
            if (c === "Content-Type" && this.xdr.contentType > "") {
                return this.xdr.contentType;
            }
            return "";
        };
        XMLHttpRequest.prototype.xdrGetAllResponseHeaders = function () {
            return (this.xdr.contentType > "") ? "Content-Type: " + this.xdr.contentType : "";
        };
        XMLHttpRequest.prototype.xdrSetRequestHeader = function (c, d) {
        };
        XMLHttpRequest.prototype.xdrLoaded = function () {
            if (this.onreadystatechange !== null) {
                this.readyState = 4;
                this.status = 200;
                this.statusText = "OK";
                this.responseText = this.xdr.responseText;
                if (b.ActiveXObject) {
                    var c = new ActiveXObject("Microsoft.XMLDOM");
                    c.async = "false";
                    c.loadXML(this.responseText);
                    this.responseXML = c;
                }
                this.onreadystatechange();
            }
        };
        XMLHttpRequest.prototype.xdrError = function () {
            if (this.onreadystatechange !== null) {
                this.readyState = 4;
                this.status = 0;
                this.statusText = "";
                this.responseText = "";
                this.onreadystatechange();
            }
        };
        XMLHttpRequest.prototype.xdrProgress = function () {
            if (this.onreadystatechange !== null && this.status !== 3) {
                this.readyState = 3;
                this.status = 3;
                this.statusText = "";
                this.onreadystatechange();
            }
        };
        XMLHttpRequest.prototype.finalXDRRequest = function () {
            var c = this.xdr;
            delete c.onload;
            delete c.onerror;
            delete c.onprogress;
        };
        XMLHttpRequest.prototype.sendXDR = function (d) {
            var c = this.xdr;
            c.onload = this.xdrLoadedBinded;
            c.onerror = this.xdr.ontimeout = this.xdrErrorBinded;
            c.onprogress = this.xdrProgressBinded;
            this.responseText = null;
            this.xdr.send(d);
        };
        XMLHttpRequest.prototype.abortXDR = function () {
            this.finalXDRRequest();
            this.xdr.abort();
        };
        XMLHttpRequest.prototype.setXDRActive = function () {
            this.send = this.sendXDR;
            this.abort = this.abortXDR;
            this.getResponseHeader = this.xdrGetResponseHeader;
            this.getAllResponseHeaders = this.xdrGetAllResponseHeaders;
            this.setRequestHeader = this.xdrSetRequestHeader;
        };
        XMLHttpRequest.prototype.xhrGetResponseHeader = function (c) {
            return this.xhr.getResponseHeader(c);
        };
        XMLHttpRequest.prototype.xhrGetAllResponseHeaders = function () {
            return this.xhr.getAllResponseHeaders();
        };
        XMLHttpRequest.prototype.xhrSetRequestHeader = function (c, d) {
            return this.xhr.setRequestHeader(c, d);
        };
        XMLHttpRequest.prototype.xhrReadyStateChanged = function () {
            if (this.onreadystatechange !== null && this.readyState !== this.xhr.readyState) {
                var c = this.xhr;
                this.readyState = c.readyState;
                if (this.readyState === 4) {
                    this.status = c.status;
                    this.statusText = c.statusText;
                    this.responseText = c.responseText;
                    this.responseXML = c.responseXML;
                    this.responseBody = c.responseBody;
                }
                this.onreadystatechange();
            }
        };
        XMLHttpRequest.prototype.finalXHRRequest = function () {
            delete this.xhr.onreadystatechange;
        };
        XMLHttpRequest.prototype.abortXHR = function () {
            this.finalXHRRequest();
            this.xhr.abort();
        };
        XMLHttpRequest.prototype.sendXHR = function (c) {
            this.xhr.onreadystatechange = this.xhrReadyStateChangedBinded;
            this.xhr.send(c);
        };
        XMLHttpRequest.prototype.setXHRActive = function () {
            this.send = this.sendXHR;
            this.abort = this.abortXHR;
            this.getResponseHeader = this.xhrGetResponseHeader;
            this.getAllResponseHeaders = this.xhrGetAllResponseHeaders;
            this.setRequestHeader = this.xhrSetRequestHeader;
        };
        b.ieXDRToXHR = undefined;
    };
    window.ieXDRToXHR(window);
}
String.prototype.htmlEnc = function () {
    if (!this) {
        return this;
    }
    var a = this.replace(/&/g, "&amp;");
    a = a.replace(/</g, "&lt;");
    a = a.replace(/>/g, "&gt;");
    a = a.replace(/\"/g, "&quot;");
    a = a.replace(/\n/g, "<br />");
    return a;
};
String.prototype.revertHtmlEnc = function () {
    if (!this) {
        return this;
    }
    var a = this.replace(/&amp;/gi, "&");
    a = a.replace(/&lt;/gi, "<");
    a = a.replace(/&gt;/gi, ">");
    a = a.replace(/&quot;/gi, '"');
    a = a.replace(/<br( )?(\/)?>/gi, "\n");
    return a;
};
Date.jab2date = function (b) {
    var a = new Date(Date.UTC(b.substr(0, 4), b.substr(5, 2) - 1, b.substr(8, 2), b.substr(11, 2), b.substr(14, 2), b.substr(17, 2)));
    if (b.substr(b.length - 6, 1) != "Z") {
        var c = new Date();
        c.setTime(0);
        c.setUTCHours(b.substr(b.length - 5, 2));
        c.setUTCMinutes(b.substr(b.length - 2, 2));
        if (b.substr(b.length - 6, 1) == "+") {
            a.setTime(a.getTime() - c.getTime());
        } else {
            if (b.substr(b.length - 6, 1) == "-") {
                a.setTime(a.getTime() + c.getTime());
            }
        }
    }
    return a;
};
Date.hrTime = function (a) {
    return Date.jab2date(a).toLocaleString();
};
Date.prototype.jabberDate = function () {
    var b = function (c) {
        if (c < 10) {
            return "0" + c;
        }
        return c;
    };
    var a = this.getUTCFullYear() + "-";
    a += b(this.getUTCMonth() + 1) + "-";
    a += b(this.getUTCDate()) + "T";
    a += b(this.getUTCHours()) + ":";
    a += b(this.getUTCMinutes()) + ":";
    a += b(this.getUTCSeconds()) + "Z";
    return a;
};
Number.max = function (a, b) {
    return (a > b) ? a : b;
};
Number.min = function (a, b) {
    return (a < b) ? a : b;
};
var JSJaC = {
    Version: "1.4", require: function (a) {
        document.write('<script type="text/javascript" src="' + a + '"><\/script>');
    }, load: function () {
        var c = ["xmlextras", "jsextras", "crypt", "JSJaCConfig", "JSJaCConstants", "JSJaCCookie", "JSJaCJSON", "JSJaCJID", "JSJaCUtils", "JSJaCBuilder", "JSJaCPacket", "JSJaCError", "JSJaCKeys", "JSJaCConnection", "JSJaCHttpPollingConnection", "JSJaCHttpBindingConnection", "JSJaCConsoleLogger", "JSJaCWebSocketConnection"];
        var a = document.getElementsByTagName("script");
        var d = "./", b;
        for (b = 0; b < a.length; b++) {
            if (a.item(b).src && a.item(b).src.match(/JSJaC\.js$/)) {
                d = a.item(b).src.replace(/JSJaC.js$/, "");
                break;
            }
        }
        for (b = 0; b < c.length; b++) {
            this.require(d + c[b] + ".js");
        }
    }, bind: function (b, c, a) {
        return function (d) {
            return b.apply(c, [d, a]);
        };
    }
};
if (typeof JSJaCConnection == "undefined") {
    JSJaC.load();
}
var JSJaCBuilder = {
    buildNode: function (e, b) {
        var c, d = arguments[4];
        if (arguments[2]) {
            if (JSJaCBuilder._isStringOrNumber(arguments[2]) || (arguments[2] instanceof Array)) {
                c = this._createElement(e, b, d);
                JSJaCBuilder._children(e, c, arguments[2]);
            } else {
                d = arguments[2]["xmlns"] || d;
                c = this._createElement(e, b, d);
                for (var a in arguments[2]) {
                    if (arguments[2].hasOwnProperty(a) && a != "xmlns") {
                        c.setAttribute(a, arguments[2][a]);
                    }
                }
            }
        } else {
            c = this._createElement(e, b, d);
        }
        if (arguments[3]) {
            JSJaCBuilder._children(e, c, arguments[3], d);
        }
        return c;
    }, _createElement: function (e, a, d) {
        try {
            if (d) {
                return e.createElementNS(d, a);
            }
        } catch (b) {
        }
        var c = e.createElement(a);
        if (d) {
            c.setAttribute("xmlns", d);
        }
        return c;
    }, _text: function (a, b) {
        return a.createTextNode(b);
    }, _children: function (h, c, b, d) {
        if (typeof b == "object") {
            for (var a in b) {
                if (b.hasOwnProperty(a)) {
                    var g = b[a];
                    if (typeof g == "object") {
                        if (g instanceof Array) {
                            var f = JSJaCBuilder.buildNode(h, g[0], g[1], g[2], d);
                            c.appendChild(f);
                        } else {
                            c.appendChild(g);
                        }
                    } else {
                        if (JSJaCBuilder._isStringOrNumber(g)) {
                            c.appendChild(JSJaCBuilder._text(h, g));
                        }
                    }
                }
            }
        } else {
            if (JSJaCBuilder._isStringOrNumber(b)) {
                c.appendChild(JSJaCBuilder._text(h, b));
            }
        }
    }, _attributes: function (a) {
        var b = [];
        for (var c in a) {
            if (a.hasOwnProperty(c)) {
                b.push(c + '="' + a[c].toString().htmlEnc() + '"');
            }
        }
        return b.join(" ");
    }, _isStringOrNumber: function (a) {
        return (typeof a == "string" || typeof a == "number");
    }
};

function JSJaCConnection(a) {
    if (a && a.httpbase) {
        this._httpbase = a.httpbase;
    }
    if (a && a.oDbg && a.oDbg.log) {
        this.oDbg = a.oDbg;
    } else {
        this.oDbg = {
            log: function () {
            }
        };
    }
    if (a && a.timerval) {
        this.setPollInterval(a.timerval);
    } else {
        this.setPollInterval(JSJAC_TIMERVAL);
    }
    if (a && a.cookie_prefix) {
        this._cookie_prefix = a.cookie_prefix;
    } else {
        this._cookie_prefix = "";
    }
    this._connected = false;
    this._events = [];
    this._keys = null;
    this._ID = 0;
    this._inQ = [];
    this._pQueue = [];
    this._regIDs = [];
    this._req = [];
    this._status = "intialized";
    this._errcnt = 0;
    this._inactivity = JSJAC_INACTIVITY;
    this._sendRawCallbacks = [];
}

JSJaCConnection.prototype.connect = function (a) {
    this._setStatus("connecting");
    this.domain = a.domain || "localhost";
    this.username = a.username;
    this.resource = a.resource;
    this.pass = a.password || a.pass;
    this.authzid = a.authzid || "";
    this.register = a.register;
    this.authhost = a.authhost || a.host || a.domain;
    this.authtype = a.authtype || "sasl";
    if (a.xmllang && a.xmllang !== "") {
        this._xmllang = a.xmllang;
    } else {
        this._xmllang = "en";
    }
    if (a.allow_plain) {
        this._allow_plain = a.allow_plain;
    } else {
        this._allow_plain = JSJAC_ALLOW_PLAIN;
    }
    if (a.allow_scram) {
        this._allow_scram = a.allow_scram;
    } else {
        this._allow_scram = JSJAC_ALLOW_SCRAM;
    }
    this.host = a.host;
    this.port = a.port || 5222;
    this.jid = this.username + "@" + this.domain;
    this.fulljid = this.jid + "/" + this.resource;
    this._rid = Math.round(100000.5 + (((900000.49999) - (100000.5)) * Math.random()));
    var c = this._getFreeSlot();
    this._req[c] = this._setupRequest(true);
    var b = this._getInitialRequestString();
    this.oDbg.log(b, 4);
    this._req[c].r.onreadystatechange = JSJaC.bind(function () {
        var d = this._req[c].r;
        if (d.readyState == 4) {
            this.oDbg.log("async recv: " + d.responseText, 4);
            this._handleInitialResponse(d);
        }
    }, this);
    if (typeof (this._req[c].r.onerror) != "undefined") {
        this._req[c].r.onerror = JSJaC.bind(function () {
            this.oDbg.log("XmlHttpRequest error", 1);
        }, this);
    }
    this._req[c].r.send(b);
};
JSJaCConnection.prototype.connected = function () {
    return this._connected;
};
JSJaCConnection.prototype.disconnect = function () {
    this._setStatus("disconnecting");
    if (!this.connected()) {
        return;
    }
    this._connected = false;
    clearInterval(this._interval);
    clearInterval(this._inQto);
    if (this._timeout) {
        clearTimeout(this._timeout);
    }
    var c = this._getFreeSlot();
    this._req[c] = this._setupRequest(false);
    var a = this._getRequestString(false, true);
    this.oDbg.log("Disconnecting: " + a, 4);
    try {
        this._req[c].r.send(a);
    } catch (b) {
    }
    this.oDbg.log("disconnected");
    try {
        JSJaCCookie.read(this._cookie_prefix + "JSJaC_State").erase();
    } catch (b) {
    }
    this._handleEvent("ondisconnect");
};
JSJaCConnection.prototype.getPollInterval = function () {
    return this._timerval;
};
JSJaCConnection.prototype.registerHandler = function (b) {
    b = b.toLowerCase();
    var a = { handler: arguments[arguments.length - 1], childName: "*", childNS: "*", type: "*" };
    if (arguments.length > 2) {
        a.childName = arguments[1];
    }
    if (arguments.length > 3) {
        a.childNS = arguments[2];
    }
    if (arguments.length > 4) {
        a.type = arguments[3];
    }
    if (!this._events[b]) {
        this._events[b] = [a];
    } else {
        this._events[b] = this._events[b].concat(a);
    }
    this._events[b] = this._events[b].sort(function (e, d) {
        var f = 0;
        var c = 0;
        if (e.type == "*") {
            f++;
        }
        if (e.childNS == "*") {
            f++;
        }
        if (e.childName == "*") {
            f++;
        }
        if (d.type == "*") {
            c++;
        }
        if (d.childNS == "*") {
            c++;
        }
        if (d.childName == "*") {
            c++;
        }
        if (f > c) {
            return 1;
        }
        if (f < c) {
            return -1;
        }
        return 0;
    });
    this.oDbg.log("registered handler for event '" + b + "'", 2);
    return this;
};
JSJaCConnection.prototype.unregisterHandler = function (e, d) {
    e = e.toLowerCase();
    if (!this._events[e]) {
        return this;
    }
    var a = this._events[e], c = [];
    for (var b = 0; b < a.length; b++) {
        if (a[b].handler != d) {
            c.push(a[b]);
        }
    }
    if (a.length != c.length) {
        this._events[e] = c;
        this.oDbg.log("unregistered handler for event '" + e + "'", 2);
    }
    return this;
};
JSJaCConnection.prototype.registerIQGet = function (a, b, c) {
    return this.registerHandler("iq", a, b, "get", c);
};
JSJaCConnection.prototype.registerIQSet = function (a, b, c) {
    return this.registerHandler("iq", a, b, "set", c);
};
JSJaCConnection.prototype.resume = function () {
    try {
        var a = JSJaCCookie.read(this._cookie_prefix + "JSJaC_State").getValue();
        this.oDbg.log("read cookie: " + a, 2);
        JSJaCCookie.read(this._cookie_prefix + "JSJaC_State").erase();
        return this.resumeFromData(JSJaCJSON.parse(a));
    } catch (b) {
    }
    return false;
};
JSJaCConnection.prototype.resumeFromData = function (d) {
    try {
        for (var c in d) {
            if (d.hasOwnProperty(c)) {
                this[c] = d[c];
            }
        }
        if (this._keys) {
            this._keys2 = new JSJaCKeys();
            var b = this._keys2._getSuspendVars();
            for (var a = 0; a < b.length; a++) {
                this._keys2[b[a]] = this._keys[b[a]];
            }
            this._keys = this._keys2;
        }
        if (this._connected) {
            this._setStatus("resuming");
            this._handleEvent("onresume");
            setTimeout(JSJaC.bind(this._resume, this), this.getPollInterval());
            this._interval = setInterval(JSJaC.bind(this._checkQueue, this), JSJAC_CHECKQUEUEINTERVAL);
            this._inQto = setInterval(JSJaC.bind(this._checkInQ, this), JSJAC_CHECKINQUEUEINTERVAL);
        } else {
            this._setStatus("terminated");
        }
        return (this._connected === true);
    } catch (f) {
        if (f.message) {
            this.oDbg.log("Resume failed: " + f.message, 1);
        } else {
            this.oDbg.log("Resume failed: " + f, 1);
        }
        return false;
    }
};
JSJaCConnection.prototype.send = function (c, b, a) {
    if (!c || !c.pType) {
        this.oDbg.log("no packet: " + c, 1);
        return false;
    }
    if (!this.connected()) {
        return false;
    }
    if (b) {
        if (!c.getID()) {
            c.setID("JSJaCID_" + this._ID++);
        }
        this._registerPID(c, b, a);
    }
    this._pQueue = this._pQueue.concat(c.xml());
    this._handleEvent(c.pType() + "_out", c);
    this._handleEvent("packet_out", c);
    return true;
};
JSJaCConnection.prototype.sendIQ = function (e, c, a) {
    if (!e || e.pType() != "iq") {
        return false;
    }
    c = c || {};
    var b = c.error_handler || JSJaC.bind(function (g) {
        this.oDbg.log(g.xml(), 1);
    }, this);
    var d = c.result_handler || JSJaC.bind(function (g) {
        this.oDbg.log(g.xml(), 2);
    }, this);
    var f = function (h, g) {
        switch ( h.getType() ) {
            case"error":
                b(h);
                break;
            case"result":
                d(h, g);
                break;
        }
    };
    return this.send(e, f, a);
};
JSJaCConnection.prototype.setPollInterval = function (a) {
    if (a && !isNaN(a)) {
        this._timerval = a;
    }
    return this._timerval;
};
JSJaCConnection.prototype.status = function () {
    return this._status;
};
JSJaCConnection.prototype.suspend = function () {
    var b = this.suspendToData();
    try {
        var f = new JSJaCCookie(this._cookie_prefix + "JSJaC_State", JSJaCJSON.toString(b));
        this.oDbg.log("writing cookie: " + f.getValue() + "\n(length:" + f.getValue().length + ")", 2);
        f.write();
        var a = JSJaCCookie.get(this._cookie_prefix + "JSJaC_State");
        if (f.getValue() != a) {
            this.oDbg.log("Suspend failed writing cookie.\nread: " + a, 1);
            f.erase();
            return false;
        }
        return true;
    } catch (d) {
        this.oDbg.log("Failed creating cookie '" + this._cookie_prefix + "JSJaC_State': " + d.message, 1);
    }
    return false;
};
JSJaCConnection.prototype.suspendToData = function () {
    clearTimeout(this._timeout);
    clearInterval(this._interval);
    clearInterval(this._inQto);
    this._suspend();
    var c = ("_connected,_keys,_ID,_xmllang,_inQ,_pQueue,_regIDs,_errcnt,_inactivity,domain,username,resource,jid,fulljid,_sid,_httpbase,_timerval,_is_polling").split(",");
    c = c.concat(this._getSuspendVars());
    var e = {};
    for (var d = 0; d < c.length; d++) {
        if (!this[c[d]]) {
            continue;
        }
        var f = {};
        if (this[c[d]]._getSuspendVars) {
            var a = this[c[d]]._getSuspendVars();
            for (var b = 0; b < a.length; b++) {
                f[a[b]] = this[c[d]][a[b]];
            }
        } else {
            f = this[c[d]];
        }
        e[c[d]] = f;
    }
    this._connected = false;
    this._setStatus("suspending");
    return e;
};
JSJaCConnection.prototype._abort = function () {
    clearTimeout(this._timeout);
    clearInterval(this._inQto);
    clearInterval(this._interval);
    this._connected = false;
    this._setStatus("aborted");
    this.oDbg.log("Disconnected.", 1);
    this._handleEvent("ondisconnect");
    this._handleEvent("onerror", JSJaCError("500", "cancel", "service-unavailable"));
};
JSJaCConnection.prototype._checkInQ = function () {
    for (var a = 0; a < this._inQ.length && a < 10; a++) {
        var b = this._inQ[0];
        this._inQ = this._inQ.slice(1, this._inQ.length);
        var c = JSJaCPacket.wrapNode(b);
        if (!c) {
            return;
        }
        this._handleEvent("packet_in", c);
        if (c.pType && !this._handlePID(c)) {
            this._handleEvent(c.pType() + "_in", c);
            this._handleEvent(c.pType(), c);
        }
    }
};
JSJaCConnection.prototype._checkQueue = function () {
    if (this._pQueue.length > 0) {
        this._process();
    }
    return true;
};
JSJaCConnection.prototype._doAuth = function () {
    if (this.has_sasl && this.authtype == "nonsasl") {
        this.oDbg.log("Warning: SASL present but not used", 1);
    }
    if (!this._doSASLAuth() && !this._doLegacyAuth()) {
        this.oDbg.log("Auth failed for authtype " + this.authtype, 1);
        this.disconnect();
        return false;
    }
    return true;
};
JSJaCConnection.prototype._doInBandReg = function () {
    if (this.authtype == "saslanon" || this.authtype == "anonymous") {
        return;
    }
    var a = new JSJaCIQ();
    a.setType("set");
    a.setID("reg1");
    a.appendNode("query", { xmlns: NS_REGISTER }, [["username", this.username], ["password", this.pass]]);
    this.send(a, this._doInBandRegDone);
};
JSJaCConnection.prototype._doInBandRegDone = function (a) {
    if (a && a.getType() == "error") {
        this.oDbg.log("registration failed for " + this.username, 0);
        this._handleEvent("onerror", a.getChild("error"));
        return;
    }
    this.oDbg.log(this.username + " registered succesfully", 0);
    this._doAuth();
};
JSJaCConnection.prototype._doLegacyAuth = function () {
    if (this.authtype != "nonsasl" && this.authtype != "anonymous") {
        return false;
    }
    var a = new JSJaCIQ();
    a.setIQ(null, "get", "auth1");
    a.appendNode("query", { xmlns: NS_AUTH }, [["username", this.username]]);
    this.send(a, this._doLegacyAuth2);
    return true;
};
JSJaCConnection.prototype._doLegacyAuth2 = function (d) {
    if (!d || d.getType() != "result") {
        if (d && d.getType() == "error") {
            this._handleEvent("onerror", d.getChild("error"));
        }
        this.disconnect();
        return;
    }
    var a = (d.getChild("digest") !== null);
    var c = new JSJaCIQ();
    c.setIQ(null, "set", "auth2");
    var b = c.appendNode("query", { xmlns: NS_AUTH }, [["username", this.username], ["resource", this.resource]]);
    if (a) {
        b.appendChild(c.buildNode("digest", { xmlns: NS_AUTH }, hex_sha1(this.streamid + this.pass)));
    } else {
        if (this._allow_plain) {
            b.appendChild(c.buildNode("password", { xmlns: NS_AUTH }, this.pass));
        } else {
            this.oDbg.log("no valid login mechanism found", 1);
            this.disconnect();
            return;
        }
    }
    this.send(c, this._doLegacyAuthDone);
};
JSJaCConnection.prototype._doLegacyAuthDone = function (a) {
    if (a.getType() != "result") {
        if (a.getType() == "error") {
            this._handleEvent("onerror", a.getChild("error"));
        }
        this.disconnect();
    } else {
        this._handleEvent("onconnect");
    }
};
JSJaCConnection.prototype._doSASLAuth = function () {
    if (this.authtype == "nonsasl" || this.authtype == "anonymous") {
        return false;
    }
    if (this.authtype == "saslanon") {
        if (this.mechs.ANONYMOUS) {
            this.oDbg.log("SASL using mechanism 'ANONYMOUS'", 2);
            return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='ANONYMOUS'/>", this._doSASLAuthDone);
        }
        this.oDbg.log("SASL ANONYMOUS requested but not supported", 1);
    } else {
        if (this._allow_scram && this.mechs["SCRAM-SHA-1"]) {
            this.oDbg.log("SASL using mechanism 'SCRAM-SHA-1'", 2);
            this._clientFirstMessageBare = "n=" + this.username.replace(/=/g, "=3D").replace(/,/g, "=2C") + ",r=" + JSJaCUtils.cnonce(16);
            var b;
            if (this.authzid) {
                b = "n,a=" + this.authzid.replace(/=/g, "=3D").replace(/,/g, "=2C") + ",";
            } else {
                b = "n,,";
            }
            var a = b + this._clientFirstMessageBare;
            return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='SCRAM-SHA-1'>" + b64encode(a) + "</auth>", this._doSASLAuthScramSha1S1);
        } else {
            if (this.mechs["DIGEST-MD5"]) {
                this.oDbg.log("SASL using mechanism 'DIGEST-MD5'", 2);
                return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='DIGEST-MD5'/>", this._doSASLAuthDigestMd5S1);
            } else {
                if (this._allow_plain && this.mechs.PLAIN) {
                    this.oDbg.log("SASL using mechanism 'PLAIN'", 2);
                    var c = this.authzid + String.fromCharCode(0) + this.username + String.fromCharCode(0) + this.pass;
                    this.oDbg.log("authenticating with '" + c + "'", 2);
                    c = b64encode(c);
                    return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='PLAIN'>" + c + "</auth>", this._doSASLAuthDone);
                }
            }
        }
        this.oDbg.log("No SASL mechanism applied", 1);
        this.authtype = "nonsasl";
    }
    return false;
};
JSJaCConnection.prototype._doSASLAuthScramSha1S1 = function (d) {
    if (d.nodeName != "challenge") {
        this.oDbg.log("challenge missing", 1);
        this._handleEvent("onerror", JSJaCError("401", "auth", "not-authorized"));
        this.disconnect();
    } else {
        var f = b64decode(d.firstChild.nodeValue);
        this.oDbg.log("got challenge: " + f, 2);
        var t = {};
        var n = f.split(",");
        for (var c in n) {
            if (n.hasOwnProperty(c)) {
                var v = n[c].substring(2);
                t[n[c].substring(0, 1)] = v;
            }
        }
        var b = str2rstr_utf8(this.pass);
        var l = b64decode_bin(t.s) + "\x00\x00\x00\x01";
        var r, p = parseInt(t.i, 10);
        for (var o = 0; o < p; o++) {
            l = rstr_hmac_sha1(b, l);
            r = JSJaCUtils.xor(r, l);
        }
        var s;
        if (this.authzid) {
            s = "n,a=" + this.authzid.replace(/=/g, "=3D").replace(/,/g, "=2C") + ",";
        } else {
            s = "n,,";
        }
        var k = "c=" + b64encode(s) + ",r=" + t.r;
        this._saltedPassword = r;
        var a = rstr_hmac_sha1(this._saltedPassword, "Client Key");
        var m = rstr_sha1(a);
        this._authMessage = this._clientFirstMessageBare + "," + f + "," + k;
        var q = rstr_hmac_sha1(m, str2rstr_utf8(this._authMessage));
        var e = JSJaCUtils.xor(a, q);
        var g = k + ",p=" + rstr2b64(e);
        this.oDbg.log("response: " + g, 2);
        this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>" + b64encode(g) + "</response>", this._doSASLAuthScramSha1S2);
    }
};
JSJaCConnection.prototype._doSASLAuthScramSha1S2 = function (a) {
    if (a.nodeName != "success") {
        this.oDbg.log("auth failed", 1);
        this._handleEvent("onerror", JSJaCError("401", "auth", "not-authorized"));
        this.disconnect();
    } else {
        var d = b64decode(a.firstChild.nodeValue);
        this.oDbg.log("got success: " + d, 2);
        var c = {};
        var f = d.split(",");
        for (var h in f) {
            if (f.hasOwnProperty(h)) {
                var b = f[h].substring(2);
                c[f[h].substring(0, 1)] = b;
            }
        }
        var i = rstr_hmac_sha1(this._saltedPassword, "Server Key");
        var e = rstr_hmac_sha1(i, str2rstr_utf8(this._authMessage));
        var g = b64decode_bin(c.v);
        if (e !== g) {
            this.oDbg.log("server auth failed", 1);
            this._handleEvent("onerror", JSJaCError("401", "auth", "not-authorized"));
            this.disconnect();
        } else {
            this._reInitStream(JSJaC.bind(this._doStreamBind, this));
        }
    }
};
JSJaCConnection.prototype._doSASLAuthDigestMd5S1 = function (c) {
    if (c.nodeName != "challenge") {
        this.oDbg.log("challenge missing", 1);
        this._handleEvent("onerror", JSJaCError("401", "auth", "not-authorized"));
        this.disconnect();
    } else {
        var i = b64decode(c.firstChild.nodeValue), g;
        this.oDbg.log("got challenge: " + i, 2);
        g = i.indexOf('nonce="');
        if (g !== -1) {
            this._nonce = i.substring(g + 7);
            this._nonce = this._nonce.substring(0, this._nonce.indexOf('"'));
            this.oDbg.log("nonce: " + this._nonce, 2);
        } else {
            this.oDbg.log("no valid nonce found, aborting", 1);
            this.disconnect();
            return;
        }
        g = i.indexOf('realm="');
        if (g !== -1) {
            this._realm = i.substring(g + 7);
            this._realm = this._realm.substring(0, this._realm.indexOf('"'));
        }
        this._realm = this._realm || this.domain;
        this.oDbg.log("realm: " + this._realm, 2);
        this._digest_uri = "xmpp/" + this.domain;
        this._cnonce = JSJaCUtils.cnonce(14);
        this._nc = "00000001";
        var b = this.username + ":" + this._realm + ":" + this.pass;
        var a = rstr_md5(str2rstr_utf8(b));
        var e = a + ":" + this._nonce + ":" + this._cnonce;
        if (this.authzid) {
            e = e + ":" + this.authzid;
        }
        var k = rstr2hex(rstr_md5(e));
        var d = "AUTHENTICATE:" + this._digest_uri;
        var j = hex_md5(d);
        var f = hex_md5(k + ":" + this._nonce + ":" + this._nc + ":" + this._cnonce + ":auth:" + j);
        var h = 'username="' + this.username + '",realm="' + this._realm + '",nonce="' + this._nonce + '",cnonce="' + this._cnonce + '",nc=' + this._nc + ',qop=auth,digest-uri="' + this._digest_uri + '",response=' + f + ",charset=utf-8";
        if (this.authzid) {
            h = 'authzid="' + this.authzid + '",' + h;
        }
        this.oDbg.log("response: " + h, 2);
        this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>" + b64encode(h) + "</response>", this._doSASLAuthDigestMd5S2);
    }
};
JSJaCConnection.prototype._doSASLAuthDigestMd5S2 = function (c) {
    if (c.nodeName == "failure") {
        if (c.xml) {
            this.oDbg.log("auth error: " + c.xml, 1);
        } else {
            this.oDbg.log("auth error", 1);
        }
        this._handleEvent("onerror", JSJaCError("401", "auth", "not-authorized"));
        this.disconnect();
        return;
    }
    var f = b64decode(c.firstChild.nodeValue);
    this.oDbg.log("response: " + f, 2);
    var g = f.substring(f.indexOf("rspauth=") + 8);
    this.oDbg.log("rspauth: " + g, 2);
    var b = this.username + ":" + this._realm + ":" + this.pass;
    var a = rstr_md5(str2rstr_utf8(b));
    var e = a + ":" + this._nonce + ":" + this._cnonce;
    if (this.authzid) {
        e = e + ":" + this.authzid;
    }
    var i = rstr2hex(rstr_md5(e));
    var d = ":" + this._digest_uri;
    var h = hex_md5(d);
    var j = hex_md5(i + ":" + this._nonce + ":" + this._nc + ":" + this._cnonce + ":auth:" + h);
    this.oDbg.log("rsptest: " + j, 2);
    if (j != g) {
        this.oDbg.log("SASL Digest-MD5: server repsonse with wrong rspauth", 1);
        this.disconnect();
        return;
    }
    if (c.nodeName == "success") {
        this._reInitStream(JSJaC.bind(this._doStreamBind, this));
    } else {
        this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>", this._doSASLAuthDone);
    }
};
JSJaCConnection.prototype._doSASLAuthDone = function (a) {
    if (a.nodeName != "success") {
        this.oDbg.log("auth failed", 1);
        this._handleEvent("onerror", JSJaCError("401", "auth", "not-authorized"));
        this.disconnect();
    } else {
        this._reInitStream(JSJaC.bind(this._doStreamBind, this));
    }
};
JSJaCConnection.prototype._doStreamBind = function () {
    var a = new JSJaCIQ();
    a.setIQ(null, "set", "bind_1");
    a.appendNode("bind", { xmlns: NS_BIND }, [["resource", this.resource]]);
    this.oDbg.log(a.xml());
    this.send(a, this._doXMPPSess);
};
JSJaCConnection.prototype._doXMPPSess = function (a) {
    if (a.getType() != "result" || a.getType() == "error") {
        this.disconnect();
        if (a.getType() == "error") {
            this._handleEvent("onerror", a.getChild("error"));
        }
        return;
    }
    this.fulljid = a.getChildVal("jid");
    this.jid = this.fulljid.substring(0, this.fulljid.lastIndexOf("/"));
    a = new JSJaCIQ();
    a.setIQ(null, "set", "sess_1");
    a.appendNode("session", { xmlns: NS_SESSION }, []);
    this.oDbg.log(a.xml());
    this.send(a, this._doXMPPSessDone);
};
JSJaCConnection.prototype._doXMPPSessDone = function (a) {
    if (a.getType() != "result" || a.getType() == "error") {
        this.disconnect();
        if (a.getType() == "error") {
            this._handleEvent("onerror", a.getChild("error"));
        }
        return;
    } else {
        this._handleEvent("onconnect");
    }
};
JSJaCConnection.prototype._handleEvent = function (d, a) {
    d = d.toLowerCase();
    this.oDbg.log("incoming event '" + d + "'", 3);
    if (!this._events[d]) {
        return;
    }
    this.oDbg.log("handling event '" + d + "'", 2);
    for (var b = 0; b < this._events[d].length; b++) {
        var c = this._events[d][b];
        if (typeof c.handler == "function") {
            if (a) {
                if (a.pType) {
                    if ((!a.getNode().hasChildNodes() && c.childName != "*") || (a.getNode().hasChildNodes() && !a.getChild(c.childName, c.childNS))) {
                        continue;
                    }
                    if (c.type != "*" && a.getType() != c.type) {
                        continue;
                    }
                    this.oDbg.log(c.childName + "/" + c.childNS + "/" + c.type + " => match for handler " + c.handler, 3);
                }
                if (c.handler(a)) {
                    break;
                }
            } else {
                if (c.handler()) {
                    break;
                }
            }
        }
    }
};
JSJaCConnection.prototype._handlePID = function (c) {
    if (!c.getID()) {
        return false;
    }
    var a = c.getFrom() || this.jid;
    if (c.getFrom() == this.domain) {
        a = this.jid;
    }
    var d = c.getID();
    if (this._regIDs[a] && this._regIDs[a][d]) {
        this.oDbg.log("handling id " + d, 3);
        var b = this._regIDs[a][d];
        if (b.cb.call(this, c, b.arg) === false) {
            return false;
        } else {
            delete this._regIDs[a][d];
            return true;
        }
    } else {
        this.oDbg.log("not handling id '" + d + "' from jid " + a, 1);
        return false;
    }
};
JSJaCConnection.prototype._handleResponse = function (d) {
    var c = this._parseResponse(d);
    if (!c) {
        return;
    }
    for (var b = 0; b < c.childNodes.length; b++) {
        if (this._sendRawCallbacks.length) {
            var a = this._sendRawCallbacks[0];
            this._sendRawCallbacks = this._sendRawCallbacks.slice(1, this._sendRawCallbacks.length);
            a.fn.call(this, c.childNodes.item(b), a.arg);
            continue;
        }
        this._inQ = this._inQ.concat(c.childNodes.item(b));
    }
};
JSJaCConnection.prototype._parseStreamFeatures = function (f) {
    if (!f) {
        this.oDbg.log("nothing to parse ... aborting", 1);
        return false;
    }
    var e, b;
    if (f.getElementsByTagNameNS) {
        e = f.getElementsByTagNameNS(NS_STREAM, "error").item(0);
    } else {
        var g = f.getElementsByTagName("error");
        for (b = 0; b < g.length; b++) {
            if (g.item(b).namespaceURI == NS_STREAM || g.item(b).getAttribute("xmlns") == NS_STREAM) {
                e = g.item(b);
                break;
            }
        }
    }
    if (e) {
        this._setStatus("internal_server_error");
        clearTimeout(this._timeout);
        clearInterval(this._interval);
        clearInterval(this._inQto);
        this._handleEvent("onerror", JSJaCError("503", "cancel", "session-terminate"));
        this._connected = false;
        this.oDbg.log("Disconnected.", 1);
        this._handleEvent("ondisconnect");
        return false;
    }
    this.mechs = {};
    var d = f.getElementsByTagName("mechanisms");
    if (!d.length) {
        return false;
    }
    this.has_sasl = false;
    for (b = 0; b < d.length; b++) {
        if (d.item(b).getAttribute("xmlns") == NS_SASL) {
            this.has_sasl = true;
            var c = d.item(b).getElementsByTagName("mechanism");
            for (var a = 0; a < c.length; a++) {
                this.mechs[c.item(a).firstChild.nodeValue] = true;
            }
            break;
        }
    }
    if (this.has_sasl) {
        this.oDbg.log("SASL detected", 2);
    } else {
        this.oDbg.log("No support for SASL detected", 2);
        return true;
    }
    return true;
};
JSJaCConnection.prototype._process = function (a) {
    if (!this.connected()) {
        this.oDbg.log("Connection lost ...", 1);
        if (this._interval) {
            clearInterval(this._interval);
        }
        return;
    }
    this.setPollInterval(a);
    if (this._timeout) {
        clearTimeout(this._timeout);
    }
    var d = this._getFreeSlot();
    if (d < 0) {
        return;
    }
    if (typeof (this._req[d]) != "undefined" && typeof (this._req[d].r) != "undefined" && this._req[d].r.readyState != 4) {
        this.oDbg.log("Slot " + d + " is not ready");
        return;
    }
    if (!this.isPolling() && this._pQueue.length === 0 && this._req[(d + 1) % 2] && this._req[(d + 1) % 2].r.readyState != 4) {
        this.oDbg.log("all slots busy, standby ...", 2);
        return;
    }
    if (!this.isPolling()) {
        this.oDbg.log("Found working slot at " + d, 2);
    }
    this._req[d] = this._setupRequest(true);
    this._req[d].r.onreadystatechange = JSJaC.bind(function () {
        if (!this.connected()) {
            return;
        }
        if (this._req[d].r.readyState == 4) {
            this.oDbg.log("async recv: " + this._req[d].r.responseText, 4);
            this._handleResponse(this._req[d]);
            this._setStatus("processing");
            if (this._pQueue.length) {
                this._timeout = setTimeout(JSJaC.bind(this._process, this), 100);
            } else {
                this.oDbg.log("scheduling next poll in " + this.getPollInterval() + " msec", 4);
                this._timeout = setTimeout(JSJaC.bind(this._process, this), this.getPollInterval());
            }
        }
    }, this);
    try {
        this._req[d].r.onerror = JSJaC.bind(function () {
            if (!this.connected()) {
                return;
            }
            this._errcnt++;
            this.oDbg.log("XmlHttpRequest error (" + this._errcnt + ")", 1);
            if (this._errcnt > JSJAC_ERR_COUNT) {
                this._abort();
                return;
            }
            this._setStatus("onerror_fallback");
            setTimeout(JSJaC.bind(this._repeat, this), JSJAC_RETRYDELAY);
            return;
        }, this);
    } catch (b) {
    }
    var c = this._getRequestString();
    if (typeof (this._rid) != "undefined") {
        this._req[d].rid = this._rid;
    }
    this.oDbg.log("sending: " + c, 4);
    this._req[d].r.send(c);
};
JSJaCConnection.prototype._registerPID = function (d, b, a) {
    this.oDbg.log("registering id for packet " + d.xml(), 3);
    var e = d.getID();
    if (!e) {
        this.oDbg.log("id missing", 1);
        return false;
    }
    if (typeof b != "function") {
        this.oDbg.log("callback is not a function", 1);
        return false;
    }
    var c = d.getTo() || this.jid;
    if (d.getTo() == this.domain) {
        c = this.jid;
    }
    if (!this._regIDs[c]) {
        this._regIDs[c] = {};
    }
    if (this._regIDs[c][e] != null) {
        this.oDbg.log("id already registered: " + e, 1);
        return false;
    }
    this._regIDs[c][e] = { cb: b, arg: a, ts: JSJaCUtils.now() };
    this.oDbg.log("registered id " + e, 3);
    this._cleanupRegisteredPIDs();
    return true;
};
JSJaCConnection.prototype._cleanupRegisteredPIDs = function () {
    var a = Date.now();
    for (var b in this._regIDs) {
        if (this._regIDs.hasOwnProperty(b)) {
            for (var c in this._regIDs[b]) {
                if (this._regIDs[b].hasOwnProperty(c)) {
                    if (this._regIDs[b][c].ts + JSJAC_REGID_TIMEOUT < a) {
                        this.oDbg.log("deleting registered id '" + c + "' due to timeout", 1);
                        delete this._regIDs[b][c];
                    }
                }
            }
        }
    }
};
JSJaCConnection.prototype._prepSendEmpty = function (a, b) {
    return function () {
        b._sendEmpty(JSJaC.bind(a, b));
    };
};
JSJaCConnection.prototype._sendEmpty = function (a) {
    var c = this._getFreeSlot();
    this._req[c] = this._setupRequest(true);
    this._req[c].r.onreadystatechange = JSJaC.bind(function () {
        if (this._req[c].r.readyState == 4) {
            this.oDbg.log("async recv: " + this._req[c].r.responseText, 4);
            a(this._req[c].r);
        }
    }, this);
    if (typeof (this._req[c].r.onerror) != "undefined") {
        this._req[c].r.onerror = JSJaC.bind(function () {
            this.oDbg.log("XmlHttpRequest error", 1);
        }, this);
    }
    var b = this._getRequestString();
    this.oDbg.log("sending: " + b, 4);
    this._req[c].r.send(b);
};
JSJaCConnection.prototype._sendRaw = function (c, b, a) {
    if (b) {
        this._sendRawCallbacks.push({ fn: b, arg: a });
    }
    this._pQueue.push(c);
    this._process();
    return true;
};
JSJaCConnection.prototype._setStatus = function (a) {
    if (!a || a === "") {
        return;
    }
    if (a != this._status) {
        this._status = a;
        this._handleEvent("onstatuschanged", a);
        this._handleEvent("status_changed", a);
    }
};

function JSJaCConsoleLogger(a) {
    this.level = a || 4;
    this.start = function () {
    };
    this.log = function (d, e) {
        e = e || 0;
        if (e > this.level) {
            return;
        }
        if (typeof (console) == "undefined") {
            return;
        }
        try {
            switch ( e ) {
                case 0:
                    console.warn(d);
                    break;
                case 1:
                    console.error(d);
                    break;
                case 2:
                    console.info(d);
                    break;
                case 4:
                    console.debug(d);
                    break;
                default:
                    console.log(d);
                    break;
            }
        } catch (c) {
            try {
                console.log(d);
            } catch (b) {
            }
        }
    };
    this.setLevel = function (b) {
        this.level = b;
        return this;
    };
    this.getLevel = function () {
        return this.level;
    };
}

function JSJaCCookieException(a) {
    this.message = a;
    this.name = "CookieException";
}

function JSJaCCookie(a, d, b, c, e) {
    if (window == this) {
        return new JSJaCCookie(a, d, b, c, e);
    }
    this.name = a;
    this.value = d;
    this.secs = b;
    this.domain = c;
    this.path = e;
    this.write = function () {
        var f;
        if (this.secs) {
            var g = new Date();
            g.setTime(g.getTime() + (this.secs * 1000));
            f = "; expires=" + g.toGMTString();
        } else {
            f = "";
        }
        var h = this.domain ? "; domain=" + this.domain : "";
        var i = this.path ? "; path=" + this.path : "; path=/";
        document.cookie = this.getName() + "=" + JSJaCCookie._escape(this.getValue()) + f + h + i;
    };
    this.erase = function () {
        var f = new JSJaCCookie(this.getName(), "", -1);
        f.write();
    };
    this.getName = function () {
        return this.name;
    };
    this.setName = function (f) {
        this.name = f;
        return this;
    };
    this.getValue = function () {
        return this.value;
    };
    this.setValue = function (f) {
        this.value = f;
        return this;
    };
    this.setDomain = function (f) {
        this.domain = f;
        return this;
    };
    this.setPath = function (f) {
        this.path = f;
        return this;
    };
}

JSJaCCookie.read = function (b) {
    var e = b + "=";
    var a = document.cookie.split(";");
    for (var d = 0; d < a.length; d++) {
        var f = a[d];
        while ( f.charAt(0) == " " ) {
            f = f.substring(1, f.length);
        }
        if (f.indexOf(e) === 0) {
            return new JSJaCCookie(b, JSJaCCookie._unescape(f.substring(e.length, f.length)));
        }
    }
    throw new JSJaCCookieException("Cookie not found");
};
JSJaCCookie.get = function (a) {
    return JSJaCCookie.read(a).getValue();
};
JSJaCCookie.remove = function (a) {
    JSJaCCookie.read(a).erase();
};
JSJaCCookie._escape = function (a) {
    return a.replace(/;/g, "%3AB");
};
JSJaCCookie._unescape = function (a) {
    return a.replace(/%3AB/g, ";");
};

function JSJaCDebugger() {
}

JSJaCDebugger.prototype.log = function (a, b) {
};

function JSJaCError(c, b, d) {
    var a = XmlDocument.create("error", "jsjac");
    a.documentElement.setAttribute("code", c);
    a.documentElement.setAttribute("type", b);
    if (d) {
        a.documentElement.appendChild(a.createElement(d)).setAttribute("xmlns", NS_STANZAS);
    }
    return a.documentElement;
}

function JSJaCHttpBindingConnection(a) {
    this.base = JSJaCConnection;
    this.base(a);
    this._hold = JSJACHBC_MAX_HOLD;
    this._inactivity = 0;
    this._last_requests = {};
    this._last_rid = 0;
    this._min_polling = 0;
    this._pause = 0;
    this._wait = a.wait || JSJACHBC_MAX_WAIT;
}

JSJaCHttpBindingConnection.prototype = new JSJaCConnection();
JSJaCHttpBindingConnection.prototype.inherit = function (a) {
    if (a.jid) {
        var b = new JSJaCJID(a.jid);
        this.domain = b.getDomain();
        this.username = b.getNode();
        this.resource = b.getResource();
    } else {
        this.domain = a.domain || "localhost";
        this.username = a.username;
        this.resource = a.resource;
    }
    this._sid = a.sid;
    this._rid = a.rid;
    this._min_polling = a.polling;
    this._inactivity = a.inactivity;
    this._setHold(a.requests - 1);
    this.setPollInterval(this._timerval);
    if (a.wait) {
        this._wait = a.wait;
    }
    this._connected = true;
    this._handleEvent("onconnect");
    this._interval = setInterval(JSJaC.bind(this._checkQueue, this), JSJAC_CHECKQUEUEINTERVAL);
    this._inQto = setInterval(JSJaC.bind(this._checkInQ, this), JSJAC_CHECKINQUEUEINTERVAL);
    this._timeout = setTimeout(JSJaC.bind(this._process, this), this.getPollInterval());
};
JSJaCHttpBindingConnection.prototype.setPollInterval = function (a) {
    if (a && !isNaN(a)) {
        if (!this.isPolling()) {
            this._timerval = 100;
        } else {
            if (this._min_polling && a < this._min_polling * 1000) {
                this._timerval = this._min_polling * 1000;
            } else {
                if (this._inactivity && a > this._inactivity * 1000) {
                    this._timerval = this._inactivity * 1000;
                } else {
                    this._timerval = a;
                }
            }
        }
    }
    return this._timerval;
};
JSJaCHttpBindingConnection.prototype.isPolling = function () {
    return (this._hold === 0);
};
JSJaCHttpBindingConnection.prototype._getFreeSlot = function () {
    for (var a = 0; a < this._hold + 1; a++) {
        if (typeof (this._req[a]) == "undefined" || typeof (this._req[a].r) == "undefined" || this._req[a].r.readyState == 4) {
            return a;
        }
    }
    return -1;
};
JSJaCHttpBindingConnection.prototype._getHold = function () {
    return this._hold;
};
JSJaCHttpBindingConnection.prototype._getRequestString = function (b, e) {
    b = b || "";
    var f = "";
    if (this._rid <= this._last_rid && typeof (this._last_requests[this._rid]) != "undefined") {
        f = this._last_requests[this._rid].xml;
    } else {
        var a = "";
        while ( this._pQueue.length ) {
            var d = this._pQueue[0];
            a += d;
            this._pQueue = this._pQueue.slice(1, this._pQueue.length);
        }
        f = "<body rid='" + this._rid + "' sid='" + this._sid + "' xmlns='http://jabber.org/protocol/httpbind'";
        if (JSJAC_HAVEKEYS) {
            f += " key='" + this._keys.getKey() + "'";
            if (this._keys.lastKey()) {
                this._keys = new JSJaCKeys(hex_sha1, this.oDbg);
                f += " newkey='" + this._keys.getKey() + "'";
            }
        }
        if (e) {
            f += " type='terminate'";
        } else {
            if (this._reinit) {
                if (JSJACHBC_USE_BOSH_VER) {
                    f += " xml:lang='" + this._xmllang + "' xmpp:restart='true' xmlns:xmpp='urn:xmpp:xbosh' to='" + this.domain + "'";
                }
                this._reinit = false;
            }
        }
        if (a !== "" || b !== "") {
            f += ">" + b + a + "</body>";
        } else {
            f += "/>";
        }
        this._last_requests[this._rid] = {};
        this._last_requests[this._rid].xml = f;
        this._last_rid = this._rid;
        for (var c in this._last_requests) {
            if (this._last_requests.hasOwnProperty(c) && c < this._rid - this._hold) {
                delete (this._last_requests[c]);
            }
        }
    }
    return f;
};
JSJaCHttpBindingConnection.prototype._getInitialRequestString = function () {
    var b = "<body content='text/xml; charset=utf-8' hold='" + this._hold + "' xmlns='http://jabber.org/protocol/httpbind' to='" + this.authhost + "' wait='" + this._wait + "' rid='" + this._rid + "'";
    if (this.host && this.port) {
        b += " route='xmpp:" + this.host + ":" + this.port + "'";
    }
    if (JSJAC_HAVEKEYS) {
        this._keys = new JSJaCKeys(hex_sha1, this.oDbg);
        var a = this._keys.getKey();
        b += " newkey='" + a + "'";
    }
    b += " xml:lang='" + this._xmllang + "'";
    if (JSJACHBC_USE_BOSH_VER) {
        b += " ver='" + JSJACHBC_BOSH_VERSION + "'";
        b += " xmlns:xmpp='urn:xmpp:xbosh'";
        if (this.authtype == "sasl" || this.authtype == "saslanon") {
            b += " xmpp:version='1.0'";
        }
    }
    b += "/>";
    return b;
};
JSJaCHttpBindingConnection.prototype._getStreamID = function (b) {
    this.oDbg.log(b.responseText, 4);
    if (!b.responseXML || !b.responseXML.documentElement) {
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    var a = b.responseXML.documentElement;
    if (a.getAttribute("type") == "terminate") {
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    if (a.getAttribute("authid")) {
        this.streamid = a.getAttribute("authid");
        this.oDbg.log("got streamid: " + this.streamid, 2);
    }
    if (!this._parseStreamFeatures(a)) {
        this._sendEmpty(JSJaC.bind(this._getStreamID, this));
        return;
    }
    this._timeout = setTimeout(JSJaC.bind(this._process, this), this.getPollInterval());
    if (this.register) {
        this._doInBandReg();
    } else {
        this._doAuth();
    }
};
JSJaCHttpBindingConnection.prototype._getSuspendVars = function () {
    return ("host,port,_rid,_last_rid,_wait,_min_polling,_inactivity,_hold,_last_requests,_pause").split(",");
};
JSJaCHttpBindingConnection.prototype._handleInitialResponse = function (c) {
    try {
        this.oDbg.log(c.getAllResponseHeaders(), 4);
        this.oDbg.log(c.responseText, 4);
    } catch (b) {
        this.oDbg.log("No response", 4);
    }
    if (c.status != 200 || !c.responseXML) {
        this.oDbg.log("initial response broken (status: " + c.status + ")", 1);
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    var a = c.responseXML.documentElement;
    if (!a || a.tagName != "body" || a.namespaceURI != NS_BOSH) {
        this.oDbg.log("no body element or incorrect body in initial response", 1);
        this._handleEvent("onerror", JSJaCError("500", "wait", "internal-service-error"));
        return;
    }
    if (a.getAttribute("type") == "terminate") {
        this.oDbg.log("invalid response:\n" + c.responseText, 1);
        clearTimeout(this._timeout);
        this._connected = false;
        this.oDbg.log("Disconnected.", 1);
        this._handleEvent("ondisconnect");
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    this._sid = a.getAttribute("sid");
    this.oDbg.log("got sid: " + this._sid, 2);
    if (a.getAttribute("polling")) {
        this._min_polling = a.getAttribute("polling");
    }
    if (a.getAttribute("inactivity")) {
        this._inactivity = a.getAttribute("inactivity");
    }
    if (a.getAttribute("requests")) {
        this._setHold(a.getAttribute("requests") - 1);
    }
    this.oDbg.log("set hold to " + this._getHold(), 2);
    if (a.getAttribute("ver")) {
        this._bosh_version = a.getAttribute("ver");
    }
    if (a.getAttribute("maxpause")) {
        this._pause = Number.min(a.getAttribute("maxpause"), JSJACHBC_MAXPAUSE);
    }
    this.setPollInterval(this._timerval);
    this._connected = true;
    this._inQto = setInterval(JSJaC.bind(this._checkInQ, this), JSJAC_CHECKINQUEUEINTERVAL);
    this._interval = setInterval(JSJaC.bind(this._checkQueue, this), JSJAC_CHECKQUEUEINTERVAL);
    this._getStreamID(c);
};
JSJaCHttpBindingConnection.prototype._parseResponse = function (d) {
    if (!this.connected() || !d) {
        return null;
    }
    var c = d.r;
    try {
        if (c.status == 404 || c.status == 403) {
            this._abort();
            return null;
        }
        if (c.status != 200 || !c.responseXML) {
            this._errcnt++;
            var h = "invalid response (" + c.status + "):\n" + c.getAllResponseHeaders() + "\n" + c.responseText;
            if (!c.responseXML) {
                h += "\nResponse failed to parse!";
            }
            this.oDbg.log(h, 1);
            if (this._errcnt > JSJAC_ERR_COUNT) {
                this._abort();
                return null;
            }
            if (this.connected()) {
                this.oDbg.log("repeating (" + this._errcnt + ")", 1);
                this._setStatus("proto_error_fallback");
                setTimeout(JSJaC.bind(this._repeat, this), this.getPollInterval());
            }
            return null;
        }
    } catch (f) {
        this.oDbg.log("XMLHttpRequest error: status not available", 1);
        this._errcnt++;
        if (this._errcnt > JSJAC_ERR_COUNT) {
            this._abort();
        } else {
            if (this.connected()) {
                this.oDbg.log("repeating (" + this._errcnt + ")", 1);
                this._setStatus("proto_error_fallback");
                setTimeout(JSJaC.bind(this._repeat, this), this.getPollInterval());
            }
        }
        return null;
    }
    var a = c.responseXML.documentElement;
    if (!a || a.tagName != "body" || a.namespaceURI != NS_BOSH) {
        this.oDbg.log("invalid response:\n" + c.responseText, 1);
        clearTimeout(this._timeout);
        clearInterval(this._interval);
        clearInterval(this._inQto);
        this._connected = false;
        this.oDbg.log("Disconnected.", 1);
        this._handleEvent("ondisconnect");
        this._setStatus("internal_server_error");
        this._handleEvent("onerror", JSJaCError("500", "wait", "internal-server-error"));
        return null;
    }
    if (typeof (d.rid) != "undefined" && this._last_requests[d.rid]) {
        if (this._last_requests[d.rid].handled) {
            this.oDbg.log("already handled " + d.rid, 2);
            return null;
        } else {
            this._last_requests[d.rid].handled = true;
        }
    }
    if (a.getAttribute("type") == "terminate") {
        var g = a.getAttribute("condition");
        this.oDbg.log("session terminated:\n" + c.responseText, 1);
        clearTimeout(this._timeout);
        clearInterval(this._interval);
        clearInterval(this._inQto);
        try {
            JSJaCCookie.read(this._cookie_prefix + "JSJaC_State").erase();
        } catch (f) {
        }
        this._connected = false;
        if (g == "remote-stream-error") {
            if (a.getElementsByTagName("conflict").length > 0) {
                this._setStatus("session-terminate-conflict");
            } else {
                this._setStatus("terminated");
            }
        } else {
            this._setStatus("terminated");
        }
        if (g === null) {
            g = "session-terminate";
        }
        this._handleEvent("onerror", JSJaCError("503", "cancel", g));
        this.oDbg.log("Aborting remaining connections", 4);
        for (var b = 0; b < this._hold + 1; b++) {
            try {
                if (this._req[b] && this._req[b] != d) {
                    this._req[b].r.abort();
                }
            } catch (f) {
                this.oDbg.log(f, 1);
            }
        }
        this.oDbg.log("parseResponse done with terminating", 3);
        this.oDbg.log("Disconnected.", 1);
        this._handleEvent("ondisconnect");
        return null;
    }
    this._errcnt = 0;
    return c.responseXML.documentElement;
};
JSJaCHttpBindingConnection.prototype._reInitStream = function (a) {
    this._reinit = true;
    this._sendEmpty(this._prepReInitStreamWait(a));
};
JSJaCHttpBindingConnection.prototype._prepReInitStreamWait = function (a) {
    return JSJaC.bind(function (b) {
        this._reInitStreamWait(b, a);
    }, this);
};
JSJaCHttpBindingConnection.prototype._reInitStreamWait = function (f, a) {
    this.oDbg.log("checking for stream features");
    var g = f.responseXML.documentElement, e, h;
    this.oDbg.log(g);
    if (g.getElementsByTagNameNS) {
        this.oDbg.log("checking with namespace");
        e = g.getElementsByTagNameNS(NS_STREAM, "features").item(0);
        if (e) {
            h = e.getElementsByTagNameNS(NS_BIND, "bind").item(0);
        }
    } else {
        var c = g.getElementsByTagName("stream:features"), d, b;
        for (d = 0, b = c.length; d < b; d++) {
            if (c.item(d).namespaceURI == NS_STREAM || c.item(d).getAttribute("xmlns") == NS_STREAM) {
                e = c.item(d);
                break;
            }
        }
        if (e) {
            h = e.getElementsByTagName("bind");
            for (d = 0, b = h.length; d < b; d++) {
                if (h.item(d).namespaceURI == NS_BIND || h.item(d).getAttribute("xmlns") == NS_BIND) {
                    h = h.item(d);
                    break;
                }
            }
        }
    }
    this.oDbg.log(e);
    this.oDbg.log(h);
    if (e) {
        if (h) {
            a();
        } else {
            this.oDbg.log("no bind feature - giving up", 1);
            this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
            this._connected = false;
            this.oDbg.log("Disconnected.", 1);
            this._handleEvent("ondisconnect");
        }
    } else {
        this._sendEmpty(this._prepReInitStreamWait(a));
    }
};
JSJaCHttpBindingConnection.prototype._repeat = function () {
    if (this._rid >= this._last_rid) {
        this._rid = this._last_rid - 1;
    }
    this._process();
};
JSJaCHttpBindingConnection.prototype._resume = function () {
    if (this._pause === 0) {
        this._repeat();
    } else {
        this._process();
    }
};
JSJaCHttpBindingConnection.prototype._setHold = function (a) {
    if (!a || isNaN(a) || a < 0) {
        a = 0;
    } else {
        if (a > JSJACHBC_MAX_HOLD) {
            a = JSJACHBC_MAX_HOLD;
        }
    }
    this._hold = a;
    return this._hold;
};
JSJaCHttpBindingConnection.prototype._setupRequest = function (a) {
    var c = {};
    var b = XmlHttp.create();
    try {
        b.open("POST", this._httpbase, a);
        b.setRequestHeader("Content-Type", "text/xml; charset=utf-8");
    } catch (d) {
        this.oDbg.log(d, 1);
    }
    c.r = b;
    this._rid++;
    c.rid = this._rid;
    return c;
};
JSJaCHttpBindingConnection.prototype._suspend = function () {
    if (this._pause === 0) {
        return;
    }
    var c = this._getFreeSlot();
    this._req[c] = this._setupRequest(false);
    var b = "<body pause='" + this._pause + "' xmlns='http://jabber.org/protocol/httpbind' sid='" + this._sid + "' rid='" + this._rid + "'";
    if (JSJAC_HAVEKEYS) {
        b += " key='" + this._keys.getKey() + "'";
        if (this._keys.lastKey()) {
            this._keys = new JSJaCKeys(hex_sha1, this.oDbg);
            b += " newkey='" + this._keys.getKey() + "'";
        }
    }
    b += ">";
    while ( this._pQueue.length ) {
        var a = this._pQueue[0];
        b += a;
        this._pQueue = this._pQueue.slice(1, this._pQueue.length);
    }
    b += "</body>";
    this.oDbg.log("Disconnecting: " + b, 4);
    this._req[c].r.send(b);
};

function JSJaCHttpPollingConnection(a) {
    this.base = JSJaCConnection;
    this.base(a);
    JSJACPACKET_USE_XMLNS = false;
}

JSJaCHttpPollingConnection.prototype = new JSJaCConnection();
JSJaCHttpPollingConnection.prototype.isPolling = function () {
    return true;
};
JSJaCHttpPollingConnection.prototype._getFreeSlot = function () {
    if (typeof (this._req[0]) == "undefined" || typeof (this._req[0].r) == "undefined" || this._req[0].r.readyState == 4) {
        return 0;
    } else {
        return -1;
    }
};
JSJaCHttpPollingConnection.prototype._getInitialRequestString = function () {
    var c = "0";
    if (JSJAC_HAVEKEYS) {
        this._keys = new JSJaCKeys(b64_sha1, this.oDbg);
        var a = this._keys.getKey();
        c += ";" + a;
    }
    var b = this.domain;
    if (this.authhost) {
        b = this.authhost;
    }
    c += ",<stream:stream to='" + b + "' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'";
    if (this.authtype == "sasl" || this.authtype == "saslanon") {
        c += " version='1.0'";
    }
    c += ">";
    return c;
};
JSJaCHttpPollingConnection.prototype._getRequestString = function (a, b) {
    var c = this._sid;
    if (JSJAC_HAVEKEYS) {
        c += ";" + this._keys.getKey();
        if (this._keys.lastKey()) {
            this._keys = new JSJaCKeys(b64_sha1, this.oDbg);
            c += ";" + this._keys.getKey();
        }
    }
    c += ",";
    if (a) {
        c += a;
    }
    while ( this._pQueue.length ) {
        c += this._pQueue[0];
        this._pQueue = this._pQueue.slice(1, this._pQueue.length);
    }
    if (b) {
        c += "</stream:stream>";
    }
    return c;
};
JSJaCHttpPollingConnection.prototype._getStreamID = function () {
    if (this._req[0].r.responseText === "") {
        this.oDbg.log("waiting for stream id", 2);
        this._timeout = setTimeout(JSJaC.bind(this._sendEmpty, this), 1000);
        return;
    }
    this.oDbg.log(this._req[0].r.responseText, 4);
    if (this._req[0].r.responseText.match(/id=[\'\"]([^\'\"]+)[\'\"]/)) {
        this.streamid = RegExp.$1;
    }
    this.oDbg.log("got streamid: " + this.streamid, 2);
    var c;
    try {
        var a = this._req[0].r.responseText;
        if (!a.match(/<\/stream:stream>\s*$/)) {
            a += "</stream:stream>";
        }
        c = XmlDocument.create("doc");
        c.loadXML(a);
        if (!this._parseStreamFeatures(c)) {
            this.authtype = "nonsasl";
            return;
        }
    } catch (b) {
        this.oDbg.log("loadXML: " + b.toString(), 1);
    }
    this._connected = true;
    if (this.register) {
        this._doInBandReg();
    } else {
        this._doAuth();
    }
    this._process(this._timerval);
};
JSJaCHttpPollingConnection.prototype._getSuspendVars = function () {
    return [];
};
JSJaCHttpPollingConnection.prototype._handleInitialResponse = function () {
    this.oDbg.log(this._req[0].r.getAllResponseHeaders(), 4);
    var c = this._req[0].r.getResponseHeader("Set-Cookie");
    c = c.split(";");
    for (var b = 0; b < c.length; b++) {
        var a = c[b].split("=");
        if (a[0] == "ID") {
            this._sid = a[1];
        }
    }
    this.oDbg.log("got sid: " + this._sid, 2);
    this._connected = true;
    this._interval = setInterval(JSJaC.bind(this._checkQueue, this), JSJAC_CHECKQUEUEINTERVAL);
    this._inQto = setInterval(JSJaC.bind(this._checkInQ, this), JSJAC_CHECKINQUEUEINTERVAL);
    this._getStreamID();
};
JSJaCHttpPollingConnection.prototype._parseResponse = function (a) {
    var h = a.r;
    if (!this.connected()) {
        return null;
    }
    if (h.status != 200) {
        this.oDbg.log("invalid response (" + h.status + "):" + h.responseText + "\n" + h.getAllResponseHeaders(), 1);
        this._setStatus("internal_server_error");
        clearTimeout(this._timeout);
        clearInterval(this._interval);
        clearInterval(this._inQto);
        this._connected = false;
        this.oDbg.log("Disconnected.", 1);
        this._handleEvent("ondisconnect");
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return null;
    }
    this.oDbg.log(h.getAllResponseHeaders(), 4);
    var b, j = h.getResponseHeader("Set-Cookie");
    if (j === null) {
        b = "-1:0";
    } else {
        j = j.split(";");
        for (var d = 0; d < j.length; d++) {
            var g = j[d].split("=");
            if (g[0] == "ID") {
                b = g[1];
            }
        }
    }
    if (typeof (b) != "undefined" && b.indexOf(":0") != -1) {
        switch ( b.substring(0, b.indexOf(":0")) ) {
            case"0":
                this.oDbg.log("invalid response:" + h.responseText, 1);
                break;
            case"-1":
                this.oDbg.log("Internal Server Error", 1);
                break;
            case"-2":
                this.oDbg.log("Bad Request", 1);
                break;
            case"-3":
                this.oDbg.log("Key Sequence Error", 1);
                break;
        }
        this._setStatus("internal_server_error");
        clearTimeout(this._timeout);
        clearInterval(this._interval);
        clearInterval(this._inQto);
        this._handleEvent("onerror", JSJaCError("500", "wait", "internal-server-error"));
        this._connected = false;
        this.oDbg.log("Disconnected.", 1);
        this._handleEvent("ondisconnect");
        return null;
    }
    if (!h.responseText) {
        return null;
    }
    try {
        var c = h.responseText.replace(/<\?xml.+\?>/, "");
        if (c.match(/<stream:stream/)) {
            c += "</stream:stream>";
        }
        var k = JSJaCHttpPollingConnection._parseTree("<body>" + c + "</body>");
        if (!k || k.tagName == "parsererror") {
            this.oDbg.log("parsererror", 1);
            k = JSJaCHttpPollingConnection._parseTree("<stream:stream xmlns:stream='http://etherx.jabber.org/streams'>" + h.responseText);
            if (k && k.tagName != "parsererror") {
                this.oDbg.log("stream closed", 1);
                if (k.getElementsByTagName("conflict").length > 0) {
                    this._setStatus("session-terminate-conflict");
                }
                clearTimeout(this._timeout);
                clearInterval(this._interval);
                clearInterval(this._inQto);
                this._handleEvent("onerror", JSJaCError("503", "cancel", "session-terminate"));
                this._connected = false;
                this.oDbg.log("Disconnected.", 1);
                this._handleEvent("ondisconnect");
            } else {
                this.oDbg.log("parsererror:" + k, 1);
            }
            return k;
        }
        return k;
    } catch (f) {
        this.oDbg.log("parse error:" + f.message, 1);
    }
    return null;
};
JSJaCHttpPollingConnection.prototype._reInitStream = function (a) {
    var b = this.authhost ? this.authhost : this.domain;
    this._sendRaw("<stream:stream xmlns:stream='http://etherx.jabber.org/streams' xmlns='jabber:client' to='" + b + "' version='1.0'>", a);
};
JSJaCHttpPollingConnection.prototype._repeat = function () {
    this._resume();
};
JSJaCHttpPollingConnection.prototype._resume = function () {
    this._process(this._timerval);
};
JSJaCHttpPollingConnection.prototype._setupRequest = function (a) {
    var c = XmlHttp.create();
    try {
        c.open("POST", this._httpbase, a);
        if (c.overrideMimeType) {
            c.overrideMimeType("text/plain; charset=utf-8");
        }
        c.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    } catch (d) {
        this.oDbg.log(d, 1);
    }
    var b = {};
    b.r = c;
    return b;
};
JSJaCHttpPollingConnection.prototype._suspend = function () {
};
JSJaCHttpPollingConnection._parseTree = function (a) {
    try {
        var b = XmlDocument.create("body", "foo");
        if (typeof (b.loadXML) != "undefined") {
            b.loadXML(a);
            return b.documentElement;
        } else {
            if (window.DOMParser) {
                return (new DOMParser()).parseFromString(a, "text/xml").documentElement;
            }
        }
    } catch (c) {
    }
    return null;
};

function JSJaCJIDInvalidException(a) {
    this.message = a;
    this.name = "JSJaCJIDInvalidException";
}

var JSJACJID_FORBIDDEN = ['"', " ", "&", "'", "/", ":", "<", ">", "@"];

function JSJaCJID(a) {
    this._node = "";
    this._domain = "";
    this._resource = "";
    if (typeof (a) == "string") {
        if (a.indexOf("@") != -1) {
            this.setNode(a.substring(0, a.indexOf("@")));
            a = a.substring(a.indexOf("@") + 1);
        }
        if (a.indexOf("/") != -1) {
            this.setResource(a.substring(a.indexOf("/") + 1));
            a = a.substring(0, a.indexOf("/"));
        }
        this.setDomain(a);
    } else {
        this.setNode(a.node);
        this.setDomain(a.domain);
        this.setResource(a.resource);
    }
}

JSJaCJID.prototype.getBareJID = function () {
    return this.getNode() + "@" + this.getDomain();
};
JSJaCJID.prototype.getNode = function () {
    return this._node;
};
JSJaCJID.prototype.getDomain = function () {
    return this._domain;
};
JSJaCJID.prototype.getResource = function () {
    return this._resource;
};
JSJaCJID.prototype.setNode = function (a) {
    JSJaCJID._checkNodeName(a);
    this._node = a || "";
    return this;
};
JSJaCJID.prototype.setDomain = function (a) {
    if (!a || a === "") {
        throw new JSJaCJIDInvalidException("domain name missing");
    }
    JSJaCJID._checkNodeName(a);
    this._domain = a;
    return this;
};
JSJaCJID.prototype.setResource = function (a) {
    this._resource = a || "";
    return this;
};
JSJaCJID.prototype.toString = function () {
    var a = "";
    if (this.getNode() && this.getNode() !== "") {
        a = this.getNode() + "@";
    }
    a += this.getDomain();
    if (this.getResource() && this.getResource() !== "") {
        a += "/" + this.getResource();
    }
    return a;
};
JSJaCJID.prototype.removeResource = function () {
    return this.setResource();
};
JSJaCJID.prototype.clone = function () {
    return new JSJaCJID(this.toString());
};
JSJaCJID.prototype.isEntity = function (a) {
    if (typeof a == "string") {
        a = (new JSJaCJID(a));
    } else {
        a = a.clone();
    }
    a.removeResource();
    return (this.clone().removeResource().toString() === a.toString());
};
JSJaCJID._checkNodeName = function (a) {
    if (!a || a === "") {
        return;
    }
    for (var b = 0; b < JSJACJID_FORBIDDEN.length; b++) {
        if (a.indexOf(JSJACJID_FORBIDDEN[b]) != -1) {
            throw new JSJaCJIDInvalidException("forbidden char in nodename: " + JSJACJID_FORBIDDEN[b]);
        }
    }
};

function JSJaCJSON() {
}

JSJaCJSON.toString = function (c) {
    var a = { "\b": "\\b", "\t": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "\\": "\\\\" }, b = {
        array: function (g) {
            var j = ["["], d, n, m, h = g.length, k;
            for (m = 0; m < h; m += 1) {
                k = g[m];
                n = b[typeof k];
                if (n) {
                    try {
                        k = n(k);
                        if (typeof k == "string") {
                            if (d) {
                                j[j.length] = ",";
                            }
                            j[j.length] = k;
                            d = true;
                        }
                    } catch (o) {
                    }
                }
            }
            j[j.length] = "]";
            return j.join("");
        }, "boolean": function (d) {
            return String(d);
        }, "null": function () {
            return "null";
        }, number: function (d) {
            return isFinite(d) ? String(d) : "null";
        }, object: function (g) {
            if (g) {
                if (g instanceof Array) {
                    return b.array(g);
                }
                var h = [], d, l, k, j;
                h.push("{");
                for (k in g) {
                    if (g.hasOwnProperty(k)) {
                        j = g[k];
                        l = b[typeof j];
                        if (l) {
                            try {
                                j = l(j);
                                if (typeof j == "string") {
                                    if (d) {
                                        h[h.length] = ",";
                                    }
                                    h.push(b.string(k), ":", j);
                                    d = true;
                                }
                            } catch (m) {
                            }
                        }
                    }
                }
                h[h.length] = "}";
                return h.join("");
            }
            return "null";
        }, string: function (d) {
            if (/["\\\x00-\x1f]/.test(d)) {
                d = d.replace(/([\x00-\x1f\\"])/g, function (f, e) {
                    var g = a[e];
                    if (g) {
                        return g;
                    }
                    g = e.charCodeAt();
                    return "\\u00" + Math.floor(g / 16).toString(16) + (g % 16).toString(16);
                });
            }
            return '"' + d + '"';
        }
    };
    switch ( typeof (c) ) {
        case"object":
            return b.object(c);
        case"array":
            return b.array(c);
    }
};
JSJaCJSON.parse = function (str) {
    try {
        return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(str.replace(/"(\\.|[^"\\])*"/g, ""))) && eval("(" + str + ")");
    } catch (e) {
        return false;
    }
};

function JSJaCKeys(d, c) {
    var a = Math.random();
    this._k = [];
    this._k[0] = a.toString();
    if (c) {
        this.oDbg = c;
    } else {
        this.oDbg = {};
        this.oDbg.log = function () {
        };
    }
    if (d) {
        for (var b = 1; b < JSJAC_NKEYS; b++) {
            this._k[b] = d(this._k[b - 1]);
            c.log(b + ": " + this._k[b], 4);
        }
    }
    this._indexAt = JSJAC_NKEYS - 1;
    this.getKey = function () {
        return this._k[this._indexAt--];
    };
    this.lastKey = function () {
        return (this._indexAt === 0);
    };
    this.size = function () {
        return this._k.length;
    };
    this._getSuspendVars = function () {
        return ("_k,_indexAt").split(",");
    };
}

var JSJACPACKET_USE_XMLNS = true;

function JSJaCPacket(a) {
    this.name = a;
    if (typeof (JSJACPACKET_USE_XMLNS) != "undefined" && JSJACPACKET_USE_XMLNS) {
        this.doc = XmlDocument.create(a, NS_CLIENT);
    } else {
        this.doc = XmlDocument.create(a, "");
    }
}

JSJaCPacket.prototype.pType = function () {
    return this.name;
};
JSJaCPacket.prototype.getDoc = function () {
    return this.doc;
};
JSJaCPacket.prototype.getNode = function () {
    if (this.getDoc() && this.getDoc().documentElement) {
        return this.getDoc().documentElement;
    } else {
        return null;
    }
};
JSJaCPacket.prototype.setTo = function (a) {
    if (!a) {
        this.getNode().removeAttribute("to");
    } else {
        if (typeof (a) == "string") {
            this.getNode().setAttribute("to", a);
        } else {
            this.getNode().setAttribute("to", a.toString());
        }
    }
    return this;
};
JSJaCPacket.prototype.setFrom = function (a) {
    if (!a) {
        this.getNode().removeAttribute("from");
    } else {
        if (typeof (a) == "string") {
            this.getNode().setAttribute("from", a);
        } else {
            this.getNode().setAttribute("from", a.toString());
        }
    }
    return this;
};
JSJaCPacket.prototype.setID = function (a) {
    if (!a) {
        this.getNode().removeAttribute("id");
    } else {
        this.getNode().setAttribute("id", a);
    }
    return this;
};
JSJaCPacket.prototype.setType = function (a) {
    if (!a) {
        this.getNode().removeAttribute("type");
    } else {
        this.getNode().setAttribute("type", a);
    }
    return this;
};
JSJaCPacket.prototype.setXMLLang = function (a) {
    if (!a) {
        this.getNode().removeAttribute("xml:lang");
    } else {
        this.getNode().setAttribute("xml:lang", a);
    }
    return this;
};
JSJaCPacket.prototype.getTo = function () {
    return this.getNode().getAttribute("to");
};
JSJaCPacket.prototype.getFrom = function () {
    return this.getNode().getAttribute("from");
};
JSJaCPacket.prototype.getToJID = function () {
    return new JSJaCJID(this.getTo());
};
JSJaCPacket.prototype.getFromJID = function () {
    return new JSJaCJID(this.getFrom());
};
JSJaCPacket.prototype.getID = function () {
    return this.getNode().getAttribute("id");
};
JSJaCPacket.prototype.getType = function () {
    return this.getNode().getAttribute("type");
};
JSJaCPacket.prototype.getXMLLang = function () {
    return this.getNode().getAttribute("xml:lang");
};
JSJaCPacket.prototype.getXMLNS = function () {
    return this.getNode().namespaceURI || this.getNode().getAttribute("xmlns");
};
JSJaCPacket.prototype.getChild = function (b, d) {
    if (!this.getNode()) {
        return null;
    }
    b = b || "*";
    d = d || "*";
    if (this.getNode().getElementsByTagNameNS) {
        return this.getNode().getElementsByTagNameNS(d, b).item(0);
    }
    var a = this.getNode().getElementsByTagName(b);
    if (d != "*") {
        for (var c = 0; c < a.length; c++) {
            if (a.item(c).namespaceURI == d || a.item(c).getAttribute("xmlns") == d) {
                return a.item(c);
            }
        }
    } else {
        return a.item(0);
    }
    return null;
};
JSJaCPacket.prototype.getChildVal = function (b, d) {
    var e = this.getChild(b, d);
    var a = "";
    if (e && e.hasChildNodes()) {
        for (var c = 0; c < e.childNodes.length; c++) {
            if (e.childNodes.item(c).nodeValue) {
                a += e.childNodes.item(c).nodeValue;
            }
        }
    }
    return a;
};
JSJaCPacket.prototype.clone = function () {
    return JSJaCPacket.wrapNode(this.getNode());
};
JSJaCPacket.prototype.isError = function () {
    return (this.getType() == "error");
};
JSJaCPacket.prototype.errorReply = function (a) {
    var b = this.clone();
    b.setTo(this.getFrom());
    b.setFrom();
    b.setType("error");
    b.appendNode("error", { code: a.code, type: a.type }, [[a.cond, { xmlns: NS_STANZAS }]]);
    return b;
};
JSJaCPacket.prototype.xml = typeof XMLSerializer != "undefined" ? function () {
    var a = (new XMLSerializer()).serializeToString(this.getNode());
    if (typeof (a) == "undefined") {
        a = (new XMLSerializer()).serializeToString(this.doc);
    }
    return a;
} : function () {
    return this.getDoc().xml;
};
JSJaCPacket.prototype._getAttribute = function (a) {
    return this.getNode().getAttribute(a);
};
if (!document.ELEMENT_NODE) {
    document.ELEMENT_NODE = 1;
    document.ATTRIBUTE_NODE = 2;
    document.TEXT_NODE = 3;
    document.CDATA_SECTION_NODE = 4;
    document.ENTITY_REFERENCE_NODE = 5;
    document.ENTITY_NODE = 6;
    document.PROCESSING_INSTRUCTION_NODE = 7;
    document.COMMENT_NODE = 8;
    document.DOCUMENT_NODE = 9;
    document.DOCUMENT_TYPE_NODE = 10;
    document.DOCUMENT_FRAGMENT_NODE = 11;
    document.NOTATION_NODE = 12;
}
JSJaCPacket.prototype._importNode = function (f, b) {
    switch ( f.nodeType ) {
        case document.ELEMENT_NODE:
            var e;
            if (this.getDoc().createElementNS) {
                e = this.getDoc().createElementNS(f.namespaceURI, f.nodeName);
            } else {
                e = this.getDoc().createElement(f.nodeName);
            }
            var d, c;
            if (f.attributes && f.attributes.length > 0) {
                for (d = 0, c = f.attributes.length; d < c; d++) {
                    var a = f.attributes.item(d);
                    if (a.nodeName == "xmlns" && (e.getAttribute("xmlns") !== null || e.namespaceURI)) {
                        continue;
                    }
                    if (e.setAttributeNS && a.namespaceURI) {
                        e.setAttributeNS(a.namespaceURI, a.name, a.value);
                    } else {
                        e.setAttribute(a.name, a.value);
                    }
                }
            }
            if (b && f.childNodes && f.childNodes.length > 0) {
                for (d = 0, c = f.childNodes.length; d < c; d++) {
                    e.appendChild(this._importNode(f.childNodes.item(d), b));
                }
            }
            return e;
        case document.TEXT_NODE:
        case document.CDATA_SECTION_NODE:
        case document.COMMENT_NODE:
            return this.getDoc().createTextNode(f.nodeValue);
    }
};
JSJaCPacket.prototype._setChildNode = function (g, b) {
    var a = this.getChild(g);
    var d = this.getDoc().createTextNode(b);
    if (a) {
        try {
            a.replaceChild(d, a.firstChild);
        } catch (f) {
        }
    } else {
        try {
            a = this.getDoc().createElementNS(this.getNode().namespaceURI, g);
        } catch (c) {
            a = this.getDoc().createElement(g);
        }
        this.getNode().appendChild(a);
        a.appendChild(d);
    }
    return a;
};
JSJaCPacket.prototype.buildNode = function (a) {
    return JSJaCBuilder.buildNode(this.getDoc(), a, arguments[1], arguments[2], arguments[3]);
};
JSJaCPacket.prototype.appendNode = function (a) {
    if (typeof a == "object") {
        this.getNode().appendChild(a);
    } else {
        this.getNode().appendChild(this.buildNode(a, arguments[1], arguments[2], this.getNode().namespaceURI));
    }
    return this;
};

function JSJaCPresence() {
    this.base = JSJaCPacket;
    this.base("presence");
}

JSJaCPresence.prototype = new JSJaCPacket();
JSJaCPresence.prototype.setStatus = function (a) {
    this._setChildNode("status", a);
    return this;
};
JSJaCPresence.prototype.setShow = function (a) {
    if (a == "chat" || a == "away" || a == "xa" || a == "dnd") {
        this._setChildNode("show", a);
    }
    return this;
};
JSJaCPresence.prototype.setPriority = function (a) {
    this._setChildNode("priority", a);
    return this;
};
JSJaCPresence.prototype.setPresence = function (b, a, c) {
    if (b) {
        this.setShow(b);
    }
    if (a) {
        this.setStatus(a);
    }
    if (c) {
        this.setPriority(c);
    }
    return this;
};
JSJaCPresence.prototype.getStatus = function () {
    return this.getChildVal("status");
};
JSJaCPresence.prototype.getShow = function () {
    return this.getChildVal("show");
};
JSJaCPresence.prototype.getPriority = function () {
    return this.getChildVal("priority");
};

function JSJaCIQ() {
    this.base = JSJaCPacket;
    this.base("iq");
}

JSJaCIQ.prototype = new JSJaCPacket();
JSJaCIQ.prototype.setIQ = function (c, a, b) {
    if (c) {
        this.setTo(c);
    }
    if (a) {
        this.setType(a);
    }
    if (b) {
        this.setID(b);
    }
    return this;
};
JSJaCIQ.prototype.setQuery = function (c) {
    var a;
    try {
        a = this.getDoc().createElementNS(c, "query");
    } catch (b) {
        a = this.getDoc().createElement("query");
        a.setAttribute("xmlns", c);
    }
    this.getNode().appendChild(a);
    return a;
};
JSJaCIQ.prototype.getQuery = function () {
    return this.getNode().getElementsByTagName("query").item(0);
};
JSJaCIQ.prototype.getQueryXMLNS = function () {
    if (this.getQuery()) {
        return this.getQuery().namespaceURI || this.getQuery().getAttribute("xmlns");
    } else {
        return null;
    }
};
JSJaCIQ.prototype.reply = function (d) {
    var b = this.clone();
    b.setTo(this.getFrom());
    b.setFrom();
    b.setType("result");
    if (d) {
        if (typeof d == "string") {
            b.getChild().appendChild(b.getDoc().loadXML(d));
        } else {
            if (d.constructor == Array) {
                var c = b.getChild();
                for (var a = 0; a < d.length; a++) {
                    if (typeof d[a] == "string") {
                        c.appendChild(b.getDoc().loadXML(d[a]));
                    } else {
                        if (typeof d[a] == "object") {
                            c.appendChild(d[a]);
                        }
                    }
                }
            } else {
                if (typeof d == "object") {
                    b.getChild().appendChild(d);
                }
            }
        }
    }
    return b;
};

function JSJaCMessage() {
    this.base = JSJaCPacket;
    this.base("message");
}

JSJaCMessage.prototype = new JSJaCPacket();
JSJaCMessage.prototype.setBody = function (a) {
    this._setChildNode("body", a);
    return this;
};
JSJaCMessage.prototype.setSubject = function (a) {
    this._setChildNode("subject", a);
    return this;
};
JSJaCMessage.prototype.setThread = function (a) {
    this._setChildNode("thread", a);
    return this;
};
JSJaCMessage.prototype.getThread = function () {
    return this.getChildVal("thread");
};
JSJaCMessage.prototype.getBody = function () {
    return this.getChildVal("body");
};
JSJaCMessage.prototype.getSubject = function () {
    return this.getChildVal("subject");
};
JSJaCPacket.wrapNode = function (b) {
    var a = null;
    switch ( b.nodeName.toLowerCase() ) {
        case"presence":
            a = new JSJaCPresence();
            break;
        case"message":
            a = new JSJaCMessage();
            break;
        case"iq":
            a = new JSJaCIQ();
            break;
    }
    if (a) {
        a.getDoc().replaceChild(a._importNode(b, true), a.getNode());
    }
    return a;
};
var JSJaCUtils = {
    xor: function (d, b) {
        if (!d) {
            return b;
        }
        if (!b) {
            return d;
        }
        var a = "";
        for (var c = 0; c < d.length; c++) {
            a += String.fromCharCode(d.charCodeAt(c) ^ b.charCodeAt(c));
        }
        return a;
    }, cnonce: function (b) {
        var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        var d = "";
        for (var a = 0; a < b; a++) {
            d += c.charAt(Math.round(Math.random(new Date().getTime()) * (c.length - 1)));
        }
        return d;
    }, now: function () {
        if (Date.now && typeof Date.now == "function") {
            return Date.now();
        } else {
            return new Date().getTime();
        }
    }
};

function JSJaCWebSocketConnection(a) {
    this.base = JSJaCConnection;
    this.base(a);
    this._ws = null;
    this.registerHandler("onerror", JSJaC.bind(this._cleanupWebSocket, this));
}

JSJaCWebSocketConnection.prototype = new JSJaCConnection();
JSJaCWebSocketConnection.prototype._cleanupWebSocket = function () {
    if (this._ws !== null) {
        this._ws.onclose = null;
        this._ws.onerror = null;
        this._ws.onopen = null;
        this._ws.onmessage = null;
        this._ws.close();
        this._ws = null;
    }
};
JSJaCWebSocketConnection.prototype.connect = function (a) {
    this._setStatus("connecting");
    this.domain = a.domain || "localhost";
    this.username = a.username;
    this.resource = a.resource;
    this.pass = a.password || a.pass;
    this.authzid = a.authzid || "";
    this.register = a.register;
    this.authhost = a.authhost || this.domain;
    this.authtype = a.authtype || "sasl";
    this.jid = this.username + "@" + this.domain;
    this.fulljid = this.jid + "/" + this.resource;
    if (a.allow_plain) {
        this._allow_plain = a.allow_plain;
    } else {
        this._allow_plain = JSJAC_ALLOW_PLAIN;
    }
    if (a.allow_scram) {
        this._allow_scram = a.allow_scram;
    } else {
        this._allow_scram = JSJAC_ALLOW_SCRAM;
    }
    if (a.xmllang && a.xmllang !== "") {
        this._xmllang = a.xmllang;
    } else {
        this._xmllang = "en";
    }
    if (typeof WebSocket === "undefined") {
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    this._ws = new WebSocket(this._httpbase, "xmpp");
    this._ws.onclose = JSJaC.bind(this._onclose, this);
    this._ws.onerror = JSJaC.bind(this._onerror, this);
    this._ws.onopen = JSJaC.bind(this._onopen, this);
};
JSJaCWebSocketConnection.prototype._onopen = function () {
    var a = this._getInitialRequestString();
    this.oDbg.log(a, 4);
    this._ws.onmessage = JSJaC.bind(this._handleOpenStream, this);
    this._ws.send(a);
    this.setPing(this);
};
JSJaCWebSocketConnection.prototype.setPing = function (a) {
    if (a.pingIntervalTimer) {
        clearTimeout(a.pingIntervalTimer);
    }
    a.pingIntervalTimer = setTimeout(function () {
        if (a._ws) {
            a._ws.send("<iq type='get'><ping xmlns='urn:xmpp:ping'/></iq>");
            a.setPing(a);
        }
    }, JSJACPING_INTERVAL);
};
JSJaCWebSocketConnection.prototype._handleOpenStream = function (b) {
    var a, c;
    this.oDbg.log(b.data, 4);
    a = b.data;
    c = this._parseXml(a);
    if (!c) {
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    this.streamid = c.getAttribute("id");
    this.oDbg.log("got streamid: " + this.streamid, 2);
    this._ws.onmessage = JSJaC.bind(this._handleInitialResponse, this);
};
JSJaCWebSocketConnection.prototype._handleInitialResponse = function (a) {
    var b = this._parseXml(a.data);
    if (!this._parseStreamFeatures(b)) {
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
        return;
    }
    this._connected = true;
    if (this.register) {
        this._doInBandReg();
    } else {
        this._doAuth();
    }
};
JSJaCWebSocketConnection.prototype.disconnect = function () {
    this._setStatus("disconnecting");
    if (!this.connected()) {
        return;
    }
    this._connected = false;
    this.oDbg.log("Disconnecting", 4);
    this._sendRaw('<close xmlns="' + NS_FRAMING + '"/>', JSJaC.bind(this._cleanupWebSocket, this));
    this.oDbg.log("Disconnected", 2);
    this._handleEvent("ondisconnect");
};
JSJaCWebSocketConnection.prototype._onclose = function () {
    this.oDbg.log("websocket closed", 2);
    if (this._status !== "disconnecting") {
        this._connected = false;
        this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
    }
};
JSJaCWebSocketConnection.prototype._onerror = function () {
    this.oDbg.log("websocket error", 1);
    this._connected = false;
    this._handleEvent("onerror", JSJaCError("503", "cancel", "service-unavailable"));
};
JSJaCWebSocketConnection.prototype._onmessage = function (b) {
    var d, a, c;
    d = b.data;
    this._setStatus("processing");
    if (!d || d === "") {
        return;
    }
    a = this._parseXml(d);
    if (a.namespaceURI === NS_STREAM && a.localName === "error") {
        if (a.getElementsByTagNameNS(NS_STREAMS, "conflict").length > 0) {
            this._setStatus("session-terminate-conflict");
        }
        this._connected = false;
        this._handleEvent("onerror", JSJaCError("503", "cancel", "remote-stream-error"));
        return;
    }
    c = JSJaCPacket.wrapNode(a);
    if (!c) {
        return;
    }
    this.oDbg.log("async recv: " + b.data, 4);
    this._handleEvent("packet_in", c);
    if (c.pType && !this._handlePID(c)) {
        this._handleEvent(c.pType() + "_in", c);
        this._handleEvent(c.pType(), c);
    }
};
JSJaCWebSocketConnection.prototype._parseXml = function (a) {
    var c;
    this.oDbg.log("Parsing: " + a, 4);
    try {
        c = XmlDocument.create("stream", NS_STREAM);
        if (a.lastIndexOf("<close ", 0) === 0) {
            this.oDbg.log("session terminated", 1);
            clearTimeout(this._timeout);
            clearInterval(this._interval);
            clearInterval(this._inQto);
            try {
                JSJaCCookie.read(this._cookie_prefix + "JSJaC_State").erase();
            } catch (b) {
            }
            this._connected = false;
            this._handleEvent("onerror", JSJaCError("503", "cancel", "session-terminate"));
            this.oDbg.log("Disconnected.", 1);
            this._handleEvent("ondisconnect");
            return null;
        } else {
            c.loadXML(a);
            return c.documentElement;
        }
    } catch (b) {
        this.oDbg.log("Error: " + b);
        this._connected = false;
        this._handleEvent("onerror", JSJaCError("500", "wait", "internal-service-error"));
    }
    return null;
};
JSJaCWebSocketConnection.prototype._getInitialRequestString = function () {
    var a, b;
    a = this.domain;
    if (this.authhost) {
        a = this.authhost;
    }
    b = '<open xmlns="' + NS_FRAMING + '" to="' + a + '" version="1.0"/>';
    return b;
};
JSJaCWebSocketConnection.prototype.send = function (d, b, a) {
    if (!this.connected()) {
        return false;
    }
    if (!d || !d.pType) {
        this.oDbg.log("no packet: " + d, 1);
        return false;
    }
    this._ws.onmessage = JSJaC.bind(this._onmessage, this);
    if (b) {
        if (!d.getID()) {
            d.setID("JSJaCID_" + this._ID++);
        }
        this._registerPID(d, b, a);
    }
    try {
        this._handleEvent(d.pType() + "_out", d);
        this._handleEvent("packet_out", d);
        this._ws.send(d.xml());
    } catch (c) {
        this.oDbg.log(c.toString(), 1);
        return false;
    }
    return true;
};
JSJaCWebSocketConnection.prototype.resume = function () {
    return false;
};
JSJaCWebSocketConnection.prototype.suspend = function () {
    return false;
};
JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S1 = function (b) {
    var a = this._parseXml(b.data);
    return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S1, this)(a);
};
JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S2 = function (b) {
    var a = this._parseXml(b.data);
    return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S2, this)(a);
};
JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S1 = function (b) {
    var a = this._parseXml(b.data);
    return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S1, this)(a);
};
JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S2 = function (b) {
    var a = this._parseXml(b.data);
    return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S2, this)(a);
};
JSJaCWebSocketConnection.prototype._doSASLAuthDone = function (b) {
    var a = this._parseXml(b.data);
    return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDone, this)(a);
};
JSJaCWebSocketConnection.prototype._reInitStream = function (a) {
    var c, b = this.domain;
    if (this.authhost) {
        b = this.authhost;
    }
    c = '<open xmlns="' + NS_FRAMING + '" to="' + b + '" version="1.0"/>';
    this._sendRaw(c, a);
};
JSJaCWebSocketConnection.prototype._sendRaw = function (c, b, a) {
    if (!this._ws) {
        return false;
    }
    if (b) {
        this._ws.onmessage = JSJaC.bind(b, this, a);
    }
    this._ws.send(c);
    return true;
};

define("jsjac", function(){});

/**
 * Created by panfei on 2015/11/23.
 */
define('Login',["jquery", "jsjac", "require", "RegisterEvent", "util", "User"], function($, jsjac, require, registerEvent, util, User) {
    "use strict";

    var con;

    var globalUsername;

    var oFormObj;

    var logoutFlag = false; //登出标识

    var timeError; //异常登出记时

    WebAgent.isNormalError=false; //判断是否为互踢导致的异常

    var presence = {}; //在线好友列表

    var friendName = 'cchat001@ccod';
    //var friendName = 'test1@ccod';

    var queryAgentUserT = null;

    function handleConnected() {
        con.send(new JSJaCPresence()); //发送空的JSJaCPresence，表明登录成功

        if(timeError){
            clearTimeout(timeError);
            //重连成功。若后台与
            if(WebAgent.readyEnabled){
                require('Vm').setReady();
            }
            return;
        }
        require('Vm').agentOnline(true);

        //请求好友列表
        var iq = new JSJaCIQ();
        iq.setType("get").setQuery("jabber:iq:roster");
        con.send(iq);

        //查询在线客服数、排队客户数
        if(!queryAgentUserT) {
            queryAgentUserT = setInterval(function() {
                require("Vm").getCuAmount();
            }, 30000);
        }

        //获取下线客户列表
        require("Vm").getOfflineList();

        util.Log("log", "登入成功") ;

        //查询后台是否开启智能协助
        require("Vm").getIntellOpen();
    }

    function handleDisconnected() {
        // console.log("error:",error);

        //正常登出时
        if(logoutFlag){
            require('Vm').agentOnline(false);
            //清除查询在线客服数、排队客户数
            clearInterval(queryAgentUserT);

        }

        util.Log("warn","disconnected后台传输数据："+JSON.stringify(arguments));
        // console.log("[webAgent-IM-disconnect]:",new Date().toLocaleString());

        /*vm.userList().forEach(function (p1, p2, p3) {
            if(p1.online()){
                p1.online(false);
            }
        });*/
        /*console.log("currentState:",WebAgent.vm.currentState());
        if(WebAgent.vm.currentState().key != "LOGOUT" ){
            WebAgent.multiChannelLogout();
        }*/

    }

    function handleError(e) {
        registerEvent.loginFailCallback({type: "loginFail", error: e});

        util.Log("error","error后台传输数据："+JSON.stringify(arguments));

        if(WebAgent.isNormalError){
            WebAgent.isNormalError=false;
        }else {
            loginAction("reconnect");

            timeError=setTimeout(function () {
                if(!logoutFlag) {
                    registerEvent.openfireDisconnect();
                    logoutFlag = true;
                }
            },15000);
        }



        // handleDisconnected();

        // if (con.connected()) {
        //     con.disconnect();
        // }
    }

    function handlePresence(oJSJaCPacket) {
        var user = oJSJaCPacket.getFromJID();
        var userFullName = user.toString();
        var userFirstName = userFullName.split("/")[0];
        var count = 0;

        if(Object.keys(presence).indexOf(userFirstName) == -1) {
            presence[userFirstName] = {};
        }
        presence[userFirstName][userFullName] = {type: oJSJaCPacket.getType(), show: oJSJaCPacket.getShow(), status: oJSJaCPacket.getStatus()};

        util.Log("log", "openfire好友状态列表：" + JSON.stringify(presence, null, 4));
        if((userFirstName == friendName) && (presence[friendName][userFullName].type == 'unavailable')) {
            for(var i in presence[friendName]) {
                if(presence[friendName][i].type != 'unavailable') {
                    return;
                } else {
                    count++;
                    if(count == Object.keys(presence[friendName]).length) {
                        util.Log("info", "openfire-"+userFirstName + "下线了");
                        logout();
                        registerEvent.openfireDisconnect();
                    }
                }
            }
        }
    }

    function handleIqRoster(iq) {
        var item = iq.getChild("query").innerHTML || $(iq.getChild("query")).text();
        util.Log("log","openfire好友列表：" + item);

        if(Object.keys(presence).indexOf(friendName) == -1) {
            util.Log("log", friendName + "不在线");
            logout();
            registerEvent.openfireDisconnect();
        } else {
            //登录成功自定义注册函数
            registerEvent.loginCallback();
        }
    }


    function doLogin(reconnect) {

        if (oFormObj.http_base.substring(0,5) === 'ws://' || oFormObj.http_base.substr(0, 6) === 'wss://') {
            con = new JSJaCWebSocketConnection({
                httpbase: oFormObj.http_base
            });
        } else {
            con = new JSJaCHttpBindingConnection({
                httpbase: oFormObj.http_base,
                oDbg : new JSJaCConsoleLogger(4)
            });
        }
        setupCon(con);

        // setup args for connect method
        var oArgs = {}; //创建一个对象
        oArgs.domain = oFormObj && oFormObj.domain; //获得服务器的域名
        oArgs.username = oFormObj && oFormObj.openfireUsername();  //获得用户名
        oArgs.resource =reconnect ? "reconnect" : "PC";  //判断登入标识
        oArgs.pass = oFormObj && oFormObj.password;  //获得登录密码
        oArgs.register = false;  //判断是否注册
       // oArgs.authtype = "nonsasl"; //不安全登录
        con.connect(oArgs); //连接服务器


        //require('Vm').username(oArgs.username);
    }

    function loginAction(reconnect) {
        $.ajax({
            url: WebAgent.config.ADD_AGENT_URL,
            dataType:'json',
            data: {
                username: oFormObj.entId + "_" + oFormObj.agentId
            },
            success: function(data) {
                doLogin(reconnect);
            }
        });
    }
    /**
     * 登录
     * @param params
     * @returns {boolean}
     */
    function login(params) {
        //若openfire已登入，就不做登录处理
        if(require('Vm').agentOnline()){
            registerEvent.loginCallback();
            return;
        }
        oFormObj = {
            entId: params.entId,
            agentId: params.agentId,
            password: params.password,
            domain: WebAgent.config.HTTP_SERVER,
            http_base: WebAgent.config.HTTP_BASE,
            openfireUsername: function() {
                return this.entId + "_" + this.agentId;
            }
        };

        require('Vm').agentEntId(params.entId);
        require('Vm').agentId(params.agentId);
        require('Vm').userList([]);
        require('Vm').currentUser(new User()); //登录时清空当前用户

        loginAction();

        logoutFlag = false;
        return false;
    }

    function setupCon(oCon) {
        oCon.registerHandler('message', handleMessage);  //接收消息
        oCon.registerHandler('onconnect', handleConnected);  //登录成功
        oCon.registerHandler('ondisconnect', handleDisconnected);   //断开连接
        oCon.registerHandler('onerror', handleError);  //登录失败

        oCon.registerHandler('iq', 'query', 'jabber:iq:roster', handleIqRoster);  //请求好友列表回调
        oCon.registerHandler('presence', handlePresence); //好友列表状态回调

    }

    /**
     * 发送消息
     * @param name
     * @param ent
     * @param channel
     * @param text
     * @param resource
     * @returns {boolean}
     */
    function sendMessage(name, ent, channel, text, resource) {
        var oMsg = new JSJaCMessage();
        util.Log("log", "上一条数据信息：" + text);
        //一个dms宕机，发消息给其他在线的dms
        if (presence[friendName]
            && presence[friendName][friendName + '/' + resource]
            && presence[friendName][friendName + '/' + resource].type == 'unavailable') {
            for(var j in presence[friendName]) {
                if(presence[friendName][j].type != 'unavailable') {
                    resource = j.split("/")[1];
                    break;
                }
            }
        }

        oMsg.setTo(new JSJaCJID(globalUsername + "@" + con.domain + "/" + resource));
        oMsg.setBody(text);

       /* var nickNode = document.createElement("nick");
        nickNode.setAttribute("xmlns", "http://jabber.org/protocol/nick");*/
        var nickNode = document.createElementNS('http://jabber.org/protocol/nick', 'nick');
        /*nickNode.setAttribute("xmlns", "http://www.baidu.com");*/
        nickNode.appendChild(document.createTextNode(name + ":" + ent + ":" + channel));

        oMsg.appendNode(nickNode);

        con.send(oMsg);

        return false;
    }

    /**
     * 发送状态
     * @param name
     * @param ent
     * @param channel
     * @param text
     * @returns {boolean}
     */
    function sendState(name, ent, channel, text) {
        var oMsg = new JSJaCMessage();
        util.Log("log", "发送状态：" + text);
        oMsg.setTo(new JSJaCJID("cchat001@" + con.domain));
        oMsg.setBody(text);

        //var nickNode = document.createElement("nick");
        //nickNode.setAttribute("xmlns", "http://jabber.org/protocol/nick");
        //nickNode.appendChild(document.createTextNode(name + ":" + ent + ":" + channel));
        //oMsg.appendNode(nickNode);

        oMsg.appendNode('nick', {'xmlns': 'http://jabber.org/protocol/nick'}, (name + ':' + ent + ':' + channel));

        con.send(oMsg);
        return false;
    }

    function sendMUC(sessionId,text){
        console.log("sendMUC");
        var oMsg = new JSJaCMessage();
        oMsg.setTo(new JSJaCJID("cchat001@" + con.domain));
        oMsg.setBody(JSON.stringify(text));

        oMsg.appendNode('nick', {'xmlns': 'http://jabber.org/protocol/nick'}, ('MUC:' + sessionId));

        con.send(oMsg);
        return false;
    }

    /**
     * 接收消息
     * @param oJSJaCPacket
     */
    function handleMessage(oJSJaCPacket) {
        var userName = oJSJaCPacket.getFromJID()["_node"];
        var resource = oJSJaCPacket.getFromJID().toString().split('/')[1];

        if (!globalUsername) {
            globalUsername = userName;
        }

        //去掉空格，替换\n和\r
        var msgBody = oJSJaCPacket.getBody().trim().replace(/\n/g,"\\\\n").replace(/\r/g,"\\\\r");
        msgBody = JSON.parse(msgBody);

        var nickNode = oJSJaCPacket.getChild("nick");
        require('Vm').handleMessage(msgBody, nickNode.innerHTML || $(nickNode).text(), resource);
    }

    /**
     * 登出
     */
    function logout() {
        var p = new JSJaCPresence();
        p.setType("unavailable");
        p.setStatus("normalLogout"); //标识正常登出
        con.send(p);
        logoutFlag = true;
        con.disconnect();

        handleDisconnected();

        clearTimeout(timeError);
        timeError="";
        registerEvent.logOutCallback({type: "logOut"});
    }

    return {
        login: login,
        sendMessage: sendMessage,
        sendState: sendState,
        sendMUC: sendMUC,
        logout: logout
    }
});
/**
 * Created by fei on 2015/11/26.
 */
define('FileUpload',["jquery", "Vm", "VmQuickReply", "util"], function($, Vm, VmQuickReply, util) {

    var percentComplete;
    function uploadFile(file) {

        var target = file;
        var targetId = file.id;
        var isIE = /msie/i.test(navigator.userAgent) && !window.opera;
        var fileSize = 0;

        var filepath = target.value;
        var fileMaxSize = 1024 * 5;//5M

        //允许发送的图片类型
        var imgRegx = new RegExp("\.(jpg|png|gif|jpeg|bmp|tif|tiff|wbmp|ico|svg)$", "g");

        //允许发送的文件类型
        var fileRegx = new RegExp("\.(zip|rar|7z|doc|docx|xlsx|xls|amr|wav|mp3|txt)$", "g");

        //只有webim和appim渠道可以发送文件
        if( (!filepath.match(imgRegx) && !filepath.match(fileRegx)) ||
            (!filepath.match(imgRegx) && (Vm.currentUser().channel != "webim" && Vm.currentUser().channel != "appim"))
           ) {
            alert("该类型文件不允许发送，请重新选择");
            return false;
        }

        if (isIE && !target.files) {
            try {
                var filePath = target.value;
                var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
                if (!fileSystem.FileExists(filePath)) {
                    alert("附件不存在，请重新输入！");
                    return false;
                }
                var file = fileSystem.GetFile(filePath);
                fileSize = file.Size;
            } catch (e) {
                util.Log("error",e);
                return;
            }
        } else {
            fileSize = target.files[0].size;
        }

        var size = fileSize / 1024;
        if (size > fileMaxSize) {
            alert("文件超过5M，无法发送!");
            target.value = "";
            return false;
        }
        if (size <= 0) {
            alert("文件大小不能为0!");
            target.value = "";
            return false;
        }

        var fd = new FormData();
        fd.append("fileToUpload", document.getElementById('fileToUpload').files[0]);
        var xhr = new XMLHttpRequest();
        xhr.upload.addEventListener("progress", uploadProgress, false);
        xhr.addEventListener("load", uploadComplete, false);
        xhr.addEventListener("error", uploadFailed, false);
        xhr.addEventListener("abort", uploadCanceled, false);
        //xhr.open("post", Config.FILE_UPLOAD_URL, true);
        xhr.open("post", WebAgent.config.FILE_UPLOAD_URL, true);
        xhr.send(fd);
    }

    function uploadProgress(evt) {
        var done = evt.position || evt.loaded;
        var total = evt.totalSize || evt.total;
        if (evt.lengthComputable) {
            percentComplete = Math.round(done / total * 100) + "%";
            $("#progressNumber").show();
            $("#progressNumber").text(percentComplete);
        }
        else {
            document.getElementById('progressNumber').innerHTML = 'unable to compute';
        }
    }

    function uploadComplete(evt) {
        /* This event is raised when the server send back a response */
        if($("#progressNumber").text() === "100%") {
            $("#progressNumber").hide();
        }
        var responseText = JSON.parse(evt.target.responseText);

        switch(responseText.ok.toString()) {
            case "0":
                alert(responseText.error);
                break;
            case "1":
                var originalPath = responseText.originalImagePath || responseText.originalFilePath;
                var zoomUrl = responseText.zoomImageUrl || "";

                var type = zoomUrl ? "image" : "file";

                Vm.sendMessage(type, originalPath, zoomUrl);
                break;
            case "2":
                alert(responseText.error);
                break;
            default:
                break;
        }
    }

    function uploadFailed(evt) {
        alert("There was an error attempting to upload the file.");
    }

    function uploadCanceled(evt) {
        alert("The upload has been canceled by the user or the browser dropped the connection.");
    }

    function fileSelected() {
        percentComplete = 0;
        $("#fileToUpload").val("");
        $("#fileToUpload").trigger("click");
    }

    function commLangSelected(){
        $("#commLangToUpload").val("");
        $("#commLangToUpload").trigger("click");
    }
    function uploadCommLang(){
        var formData = new FormData(),
            fileCont = document.getElementById("commLangToUpload").files[0];
        // 建立一个upload表单项，值为上传的文件
        formData.append("file", fileCont);

        var xhr = new XMLHttpRequest();
        var url = WebAgent.config.quickSmartReplyPath_sensitive +"/sentence/importSentence?entId=" + Vm.agentEntId() + "&agentId=" + Vm.agentId();
        xhr.open('POST', url);
        // 定义上传完成后的回调函数
        xhr.onload = function (evt) {
            var res = JSON.parse(evt.target.responseText);
            util.Log("info",res);
            if(res.code == 0) {
                //VmQuickReply.getGroupListForAgent();
                VmQuickReply.operateTip(res.desc);
                setTimeout(function(){
                    VmQuickReply.operateTip(null);
                    VmQuickReply.getGroupListForAgent();
                },3000)
            } else {
                VmQuickReply.operateTip(res.desc);
                setTimeout(function(){
                    VmQuickReply.operateTip(null);
                },2000)
            }
        };
        xhr.error = function(evt) {
            alert("There was an error attempting to upload the file.");
        };
        xhr.send(formData);
    }

    return {
        fileSelected: fileSelected,
        uploadFile: uploadFile,
        commLangSelected:commLangSelected,
        uploadCommLang:uploadCommLang
    };
});
/**
 * Created by panfei on 2016/3/16.
 */
define('ButelEvent',["RegisterEvent", "Vm"], function(registerEvent, vm) {
    var butelEvent = {};
    butelEvent.msgFromAgentButelAlerting = function(Cad, butelSessionId) {
        registerEvent.getButelState({type: "msgFromAgentButelAlerting"});
        if(Cad && Cad.CustomId) {
            vm.sendState("msgFromAgentButelAlerting", Cad.CustomId, "butel", {
                butelSessionId:butelSessionId
            });
            //console.log("[WebAgent] 坐席发送butel呼叫振铃事件");
        }
    };

    butelEvent.msgFromAgentButelConnected = function(Cad, butelSessionId) {
        registerEvent.getButelState({type: "msgFromAgentButelConnected"});
        if(Cad && Cad.CustomId) {
            vm.sendState("msgFromAgentButelConnected", Cad.CustomId, "butel",  {
                butelSessionId:butelSessionId
            });
            //console.log("[WebAgent] 坐席发送butel呼叫接通事件");
        }
    };

    butelEvent.msgFromAgentButelEnd = function(Cad, butelSessionId) {
        registerEvent.getButelState({type: "msgFromAgentButelEnd"});
        if(Cad && Cad.CustomId) {
            vm.sendState("msgFromAgentButelEnd", Cad.CustomId, "butel",  {
                butelSessionId:butelSessionId
            });
            //console.log("[WebAgent] 坐席发送butel呼叫结束事件");
        }
    };

    butelEvent.msgFromAgentButelAlertingAbort = function(Cad, butelSessionId) {
        registerEvent.getButelState({type: "msgFromAgentButelAlertingAbort"});
        if(Cad && Cad.CustomId) {
            vm.sendState("msgFromAgentButelAlertingAbort", Cad.CustomId, "butel",  {
                butelSessionId:butelSessionId
            });
            //console.log("[WebAgent] 坐席发送butel呼叫振铃取消事件");
        }
    };

    butelEvent.msgFromAgentButelLogin = function(errorCode) {
        registerEvent.getButelState({type: "msgFromAgentButelLogin", errorCode: errorCode});
        // vm.sendState("msgFromAgentButelLogin", "ButelLogin", "butel");
        //console.log("[WebAgent] 坐席视频登录成功");
    };

    butelEvent.msgFromAgentButelLogout = function(errorCode) {
        registerEvent.getButelState({type: "msgFromAgentButelLogout", errorCode: errorCode});
        vm.sendState("msgFromAgentButelLogout", "ButelLogout", "butel");
        //console.log("[WebAgent] 坐席视频登出成功");
    };

    butelEvent.msgFromAgentButelLogoutFail = function(errorCode) {
        registerEvent.getButelState({type: "msgFromAgentButelLogoutFail" , errorCode: errorCode});
        //console.log("[WebAgent] 坐席视频登出失败");
    };

    butelEvent.msgFromAgentButelLoginFail = function(errorCode) {
        registerEvent.getButelState({type: "msgFromAgentButelLoginFail" , errorCode: errorCode});
        //console.log("[WebAgent] 坐席视频登录失败");
    };

    return butelEvent;

});
/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    'use strict';

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.14',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.lastIndexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config && config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config && config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            // Do not load if it is an empty: url
            if (url.indexOf('empty:') === 0) {
                onLoad();
                return;
            }

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'] &&
            !process.versions['atom-shell'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file[0] === '\uFEFF') {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                if (errback) {
                    errback(e);
                }
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status || 0;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        if (errback) {
                            errback(err);
                        }
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes;
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});


define('text!dom',[],function () { return '<div id="chat_pane">\n\n    <div class="chat-users">\n        <div class="queue-info">\n            <span>在线客服数:<span class="queue-info-data" data-bind="text: onlineAgentNum">253</span></span>\n            <span>排队客户数:<span class="queue-info-data" data-bind="text: queueUserNum">162</span></span>\n        </div>\n        <div class="users-online">\n            <div class="chat-users-title">\n                <span>进行中对话(<span data-bind="text: onlineArr() && onlineArr().length"></span>)</span>\n                <span\n                    data-bind="css: {\'chat-users-arrow-down\': !isOnlineListShow(), \'chat-users-arrow-up\': isOnlineListShow()}, click: function(data){toggleChatList(\'online\',data, event);}"></span>\n            </div>\n            <div id="onlineChatList" data-bind="template: {name:\'userList\', foreach: onlineArr}"></div>\n        </div>\n\n        <div class="users-online">\n            <div class="chat-users-title">\n                <span>已结束对话(<span data-bind="text: offlineArr() && offlineArr().length"></span>)</span>\n                <span\n                    data-bind="css: {\'chat-users-arrow-down\': !isOfflineListShow(), \'chat-users-arrow-up\': isOfflineListShow()},click: function(data){toggleChatList(\'offline\', data, event);}"></span>\n            </div>\n            <div id="offlineChatList" data-bind="template: {name:\'userList\', foreach: offlineArr}"></div>\n        </div>\n\n        <div class="users-online">\n            <div class="chat-users-title">\n                <span>内部沟通坐席(<span data-bind="text: internalChatList() && internalChatList().length"></span>)</span>\n                <span\n                    data-bind="css: {\'chat-users-arrow-down\': !isInternalChatListShow(), \'chat-users-arrow-up\': isInternalChatListShow()},click: function(data){toggleChatList(\'internalChatList\', data, event);}"></span>\n            </div>\n            <div id="internalChatList" data-bind="template: {name:\'userList\', foreach: internalChatList}"></div>\n        </div>\n\n        <div class="users-offline">\n            <div class="chat-users-title">\n                <span>坐席列表(<span data-bind="text: agentListsLength()"></span>)</span>\n                <span\n                    data-bind="css: {\'chat-users-arrow-down\': isAgentAllListShow(), \'chat-users-arrow-up\': !isAgentAllListShow()},click: function(data){toggleChatList(\'agentAllList\', data, event);}"></span>\n            </div>\n            <div id="agentAllList" data-bind="template: {name:\'agentLists\', foreach: agentLists}"></div>\n        </div>\n    </div>\n\n    <div class="chat-content-info" data-bind="visible: !userList().length || !currentUser().ent">\n        <div class="chat-tip">\n            <i class="fa fa-comment"></i>\n\n            <p>欢迎使用</p>\n        </div>\n    </div>\n\n    <div class="chat-content-info" data-bind="visible: currentUser().name">\n        <div class="chat-content">\n            <!-- ko foreach: userList().concat(internalChatList()) -->\n            <div class="chat-discussion"\n                data-bind="visible: $data == $root.currentUser(),css:{scrollToBottom:$data == $root.currentUser()}">\n                <div class="chatTip" data-bind="visible: hasMoreHistory">\n                    <p style="background: #fff">\n                        <a href="javascript:void(0);" style="color: #5bc1df"\n                            data-bind="click: $root.getMoreHistoryChats">查看更多消息</a>\n                    </p>\n                </div>\n                <!-- ko foreach: messages -->\n                <div class="chat-message">\n                    <!--ko if:direction == \'recv\'||direction == \'send\'-->\n                    <div data-bind="css: \'time \' + direction">\n                        <span\n                            data-bind="text: name ? name : (direction == \'recv\' ? name : $root.username)"></span>&nbsp;<span\n                        data-bind="text: time()"></span>\n                    </div>\n                    <!--<img data-bind="css: \'message-avatar \' + direction" src="images/head.jpg" alt="">-->\n                    <div data-bind="css: \'message \' + direction ">\n                        <span data-bind="css: \'arrow \' + direction"></span>\n\n                        <span class="message-content">\n                            <!-- ko if: type == "text" -->\n                              <span data-bind="html: text , click: $root.searchSmartReply.bind(text)"></span>\n                            <!-- /ko -->\n\n                            <!-- ko if: type == "image"-->\n                             <span>\n                                  <img class="chat-send-recv-img" alt=""\n                                      data-bind="attr:{src:text.zoom || text.original}, click:$root.previewImg"\n                                      width="200"/>\n                             </span>\n                            <!-- /ko -->\n\n                            <!-- ko if: type == "file" -->\n                             <span>\n                                  <a data-bind="attr:{href:text}" target="_blank">点击下载</a>\n                             </span>\n                            <!-- /ko -->\n\n                            <!-- ko if: type == "voice" -->\n                             <span>\n                                  <a data-bind="attr:{href:text}" target="_blank">点击下载</a>\n                             </span>\n                            <!-- /ko -->\n\n                            <!-- ko if: type == "shortvideo" -->\n                             <span class="videoImg">\n                                 <img class="chat-send-recv-img" alt=""\n                                     data-bind="attr:{src:$root.videoImg} , click:$root.palyVideo"\n                                     width="200"/>\n                                 </br>\n                                 <div class="video-loader-box">\n                                     <div class="video-loader"></div>\n                                 </div>\n                                  <a data-bind="attr:{href:text}" target="_blank">点击下载</a>\n\n                             </span>\n                            <!-- /ko -->\n                        </span>\n                    </div>\n                    <!-- /ko -->\n\n                    <!--ko if:direction == \'tip\' -->\n                    <div class="chatTip">\n                        <p data-bind="html: text"></p>\n                    </div>\n                    <!-- /ko -->\n                </div>\n                <!-- /ko -->\n            </div>\n            <!-- /ko -->\n\n            <div class="chat-message-form">\n                <div id="emojiPane" data-bind="visible: emojiPaneDis">\n                    <span\n                        class="i">/::)</span><span>/::~</span><span>/::B</span><span>/::|</span><span>/::<</span><span>/::$</span><span>/::X</span><span>/::Z</span><span>/::@</span><span>/::P</span><span>/::D</span><span>/::O</span><span>/::(</span><span>/::+</span><span>/::d</span><span>/::Q</span><span>/::T</span><span>/::g</span><span>/::8</span><span>/::!</span><span>/::L</span><span>/:xx</span><span>/::></span><span>/:8-)</span><span>/::\'(</span><span>/::-|</span><span>/:,@P</span><span>/:--b</span><span>/:,@o</span><span>/:|-)</span><span>/::,@</span><span>/:,@f</span><span>/::-S</span><span>/:,@x</span><span>/:,@@</span><span>/::-O</span><span>/:>-|</span><span>/:P-(</span><span>/::\'|</span><span>/:X-)</span><span>/:,@!</span><span>/:!!!</span><span>/:bye</span><span>/:<@</span><span>/:@></span><span>/::*</span><span>/:@x</span><span>/:8*</span><span>/:pd</span><span>/:?</span><span>/:,@-D</span><span>/:wipe</span><span>/:dig</span><span>/:handclap</span><span>/:&-(</span><span>/:B-)</span><span>/:&lt;W&gt;</span><span>/:oo</span><span>/:li</span><span>/:@)</span><span>/:jj</span><span>/:@@</span><span>/:kn</span><span>/:no</span><span>/:ok</span><span>/:oY</span><span>/:eat</span><span>/:pig</span><span>/:sun</span><span>/:&lt;L&gt;</span><span>/:&lt;O&gt;</span><span>/:hug</span><span>/:bad</span><span>/:lvu</span><span>/:cake</span><span>/:shit</span><span>/:moon</span><span>/:bome</span><span>/:rose</span><span>/:gift</span><span>/:weak</span><span>/:fade</span><span>/:beer</span><span>/:turn</span><span>/:skip</span><span>/:love</span><span>/:jump</span><span>/:heart</span><span>/:break</span><span>/:share</span><span>/:footb</span><span>/:kotow</span><span>/:shake</span><span>/:coffee</span><span>/:strong</span><span>/:circle</span><span>/:basketb</span><span>/:ladybug</span><span>/:showlove</span><span>/:v</span><span>/:#-0</span><span>/:hiphot</span><span>/:kiss</span><span>/:&lt;&amp;</span><span>/:&amp;&gt;</span>\n                </div>\n                <div class="top-bar">\n                    <span id="expressBtn" data-bind="click:function() {emojiPaneDis(!emojiPaneDis())}">\n                        <i id="emojiBtn"></i>\n                    </span>\n                    <span id="uploadBtn">\n                    </span>\n                    <input type="file" name="fileToUpload" id="fileToUpload"/>\n                    <span id=\'progressNumber\'></span>\n                    <span data-bind="visible: currentUser().serviceAduio() && currentUser().chatBoxType() ==\'custom-chat\', click:makeCallAudio"\n                        class="callOut-audio-icon">\n                    </span>\n                    <span data-bind="visible: currentUser().serviceVideo() && currentUser().chatBoxType() ==\'custom-chat\', click:makeCallVideo"\n                        class="callOut-video-icon">\n                    </span>\n                    <span id="send-request"\n                        data-bind="visible: currentUser().isSendEvalRequestBtnShow(),css: {\'isSendEvalRequest\': !currentUser().isSendEvalRequestBtnShow()},click: requestEvaluate">\n                    </span>\n\n                    <div class="chat-checked">\n                        <span id="openAutoMatchTipIcon" class="tipIcon">\n                        <i class="fa fa-exclamation" style="font-size: 3px;vertical-align: super; color: red;"></i>\n                    </span>\n                        <span>\n                        <input type="checkbox" style="vertical-align: top;margin-right: 5px;"\n                               data-bind="checked: openAutoMatch"/>自动匹配常用语\n                        </span>\n                        <div class="openAutoMatchTip">开启时,系统会根据输入内容自动匹配常用语内容并呈现,点击常用语内容会插入到输入框，关闭时点击常用语内容直接发送给客户</div>\n                    </div>\n\n                    <div data-bind="visible: intellHelp" class="chat-checked" style="margin-right: 15px">\n                        <span id="openIntellTipIcons" class="tipIcon">\n                        <i class="fa fa-exclamation" style="font-size: 3px;vertical-align: super; color: red;"></i>\n                    </span>\n                        <span>\n                        <input type="checkbox" style="vertical-align: top;margin-right: 5px;"\n                            data-bind="checked: openIntellHelp"/>智能协助\n                    </span>\n                        <div class="openIntellTip">开启智能协作时，机器人将自动回答客户问题</div>\n                    </div>\n                </div>\n\n                <p id="error" class="error" data-bind="visible:msgContentErrorDis,text:msgContentErrorDis"></p>\n\n                <textarea class="message-input" id="textArea"\n                    data-bind="textInput: inputText, event: {keydown: sendMessageByKey, keyup: function(data, event){searchComLang(\'autoMatch\', data, event)}}"\n                    placeholder="输入消息内容,请用空格分隔多个链接地址"></textarea>\n\n                <div class="bottom-bar">\n                    <a class="kickoffUser" data-bind="click: kickoffUser">结束会话</a>\n                    <a data-bind="visible: currentUser().isTransferAgentBtnShow(),click: getAgentList.bind($data,\'transfer\')">转接坐席</a>\n                    <a data-bind="visible: currentUser().isAddAgentBtnShow(),click: getAgentList.bind($data,\'addAgent\')">添加坐席</a>\n                    <span class="session-time" data-bind="visible : currentUser().online()">\n                        会话时长\n                        <span data-bind="text: currentUser().showSessionTime()"></span>\n                    </span>\n                    <!--<a data-bind="click: sendSatisfy">满意度调查</a>-->\n                    <!--<button class="send-btn" data-bind="click: function(){$root.sendMessage(\'text\')}">发送</button>-->\n                </div>\n            </div>\n            <div id="send-btn-group">\n                <button id="btn-send" data-bind="click: checkWord">发送</button>\n                <button id="btn-caret" data-bind="click: toggleBtnKeyList">\n                    <span class="fa fa-caret-up"></span>\n                </button>\n                <ul id="btn-key-list" data-bind="visible: btnKeyListDis, foreach: btnKeyList, event: {blur: blur}">\n                    <li data-bind="click: $parent.choseSendKey">\n                        <div style="display: inline-block;width: 15px;">\n                            <span class="fa fa-check" data-bind="visible: faCheck"></span>\n                        </div>\n                        <span data-bind="text: desc"></span>\n                    </li>\n                </ul>\n            </div>\n            <div id="chat-message-form-shadow" data-bind="visible: !currentUser().online()"></div>\n            <div class="chat-box-tip" data-bind="visible:msgTip()">\n                <div class="sensitiveTip">\n                    <span data-bind="html:msgWordHead"></span>\n                    <div data-bind="html:msgWord"></div>\n                    <button data-bind="click:closeTip.bind($data,\'sensitive\')">知道了</button>\n                </div>\n            </div>\n            <div class="chat-box-tip" data-bind="visible:keepChatTip().keepchatTipShow">\n                <div class="keep-chat-tip">\n                    <div>客户已结束对话，是否关闭聊天窗口</div>\n                    <button class="red-skin" data-bind="click:closeTip.bind($data,\'chatClose\')">关闭</button>\n                    <button data-bind="click:closeTip.bind($data,\'chatKeep\')">取消</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div id="agentSection" data-bind="style:{width:currentUser().chatBoxType() == \'agent-group\'? \'675px\':\'450px\'}">\n        <p class="title" data-bind="text:selectAgentForm().title"></p>\n        <div class="agent-lists" >\n            <div class="agent-lists-left">\n                <div>\n                    <div class="serach-input">\n                        <span><i class="fa fa-search"></i></span>\n                        <input type="text" placeholder="搜索" data-bind="textInput: agentSearchText, event: {keyup: function(){searchText(\'agentListSearch\')}}"/>\n<!--                         <span><i class="fa  fa-times-circle" style="font-size: 12px;"></i></span>\n -->                    </div>                    \n                </div> \n                <ul class="agent-select-list" data-bind="visible:agentEabledSelectLists().length>0,foreach:agentEabledSelectLists">\n                    <li>\n                        <div class="skill-name">\n                            <span class="icon chat-users-arrow-down"></span>\n                            <span data-bind="text:skillGroupName"></span>\n                        </div>\n                        <ul data-bind="foreach: agents" class="agent-list">\n                            <li class="agent-list-item">\n                                <label data-bind="for:agentId, text:agentName"></label>\n                                <input type="checkbox" class="select-agent" data-bind="value:$data,checked: $root.hasSelectedAgents">\n                            </li>\n                        </ul>\n                    </li>\n                </ul>\n                <p class="none-agent-tip" data-bind="visible:!agentEabledSelectLists().length">暂无可选坐席</p>\n            </div>\n            <div class="agent-lists-right">\n                <p class="right-title">已选择坐席\n                    <span class="select-tip" data-bind="visible:currentUser().chatBoxType() == \'custom-chat\'">(仅能选择一个坐席，优先选择第一个坐席)</span>\n                </p>\n                <ul data-bind="foreach:hasSelectedAgents">\n                    <li style="margin:0 0 5px 10px">\n                        <span data-bind="text:agentName"></span>\n                        (<span data-bind="text:skillGroupName"></span>)\n                    </li>\n                </ul>\n                <textarea class="leave_words" placeholder="请输入转接留言" data-bind="visible:selectAgentForm().type == \'transfer\',textInput: transferMsg"></textarea>\n            </div>\n            <div class="agent-lists-side" data-bind="visible:currentUser().chatBoxType() == \'agent-group\'">\n                <p class="right-title">群成员-\n                    <span data-bind="text:currentUser().members.length"></span>\n                </p>\n                <ul data-bind="foreach:currentUser().members">\n                    <li style="margin:0 0 5px 10px">\n                        <span data-bind="text:agentName"></span>\n                    </li>\n                </ul>\n            </div>\n        </div>\n        <div class="btns">\n            <button class="cancle_btn" data-bind="click: closeTip.bind($data,\'agentSession\')">取消</button>\n            <button class="transfer_btn" data-bind="click: $root.confirmAgent">确定</button>\n        </div>\n    </div>\n    <audio id="chat_online_tip" data-bind="attr: {src: onlineTipMusic}"></audio>\n    <audio id="chat_msg_tip" data-bind="attr: {src: msgTipMusic}"></audio>\n\n    <div class="video-place" data-bind="visible: videoPlace">\n        <div data-bind="click: closeVideo" class="close-video">X</div>\n        <div id="videoPlay"></div>\n    </div>\n\n    <div class="im-dialog" data-bind="visible: imPastePicDialog">\n        <div id="im-pastePic-dialog">\n            <div class="im-pastePic-content" id="picDiv"></div>\n            <div class="im-pastePic-footer">\n                <button type="button" id="sendPic" class="im-btn im-btn-info">发送</button>\n                <button type="button"\n                    class="im-btn im-btn-default"\n                    style="color:#000"\n                    data-bind="click:pastePicCancel">取消\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n<script type="text/html" id="userList">\n    <div class="chat-user" data-bind="click:$root.selectUser, css: {\'selected\': $data == $root.currentUser()}">\n\n        <!-- ko if: channel == "weixin" || channel == "weixinim" -->\n        <span class="chat-avatar"\n            data-bind="css:{\'chat-avatar-weixin-on\': online(), \'chat-avatar-weixin-off\': !online(), \'chat-avatar-weixin-timeout1\': timeOutBack() == \'yellow\',  \'chat-avatar-weixin-timeout2\': timeOutBack() == \'red\'}">\n            <span class="chat-user-msgNumber" data-bind="text: msgNumber, visible: msgNumber()"></span>\n        </span>\n        <!-- /ko -->\n\n        <!-- ko if: channel == "webim" -->\n        <span class="chat-avatar"\n            data-bind="css:{\'chat-avatar-webim-on\': online(), \'chat-avatar-webim-off\': !online(), \'chat-avatar-webim-timeout1\': timeOutBack() == \'yellow\',  \'chat-avatar-webim-timeout2\': timeOutBack() == \'red\'}">\n            <span class="chat-user-msgNumber" data-bind="text: msgNumber, visible: msgNumber()"></span>\n        </span>\n        <!-- /ko -->\n\n        <!-- ko if: channel == "appim" -->\n        <span class="chat-avatar"\n            data-bind="css:{\'chat-avatar-app-on\': online(), \'chat-avatar-app-off\': !online(),\'chat-avatar-app-timeout1\': timeOutBack() == \'yellow\',  \'chat-avatar-app-timeout2\': timeOutBack() == \'red\'}">\n              <span class="chat-user-msgNumber" data-bind="text:msgNumber, visible: msgNumber()"></span>\n        </span>\n        <!-- /ko -->\n\n        <!-- ko if: channel == "internal-chat" -->\n        <span class="chat-avatar chat-avatar-webim-on">\n            <span class="chat-user-msgNumber" data-bind="text: msgNumber, visible: msgNumber()"></span>\n        </span>\n        <!-- /ko -->        \n\n        <div class="chat-user-name">\n            <a href="#">\n                <span data-bind="text: nickName() || visitorInfo().workOrderName()"></span>\n                <span class="chat-user-timing" data-bind="text: timing, visible: !!timing() && online()"></span>\n            </a>\n            <span class="lastMsg" data-bind="html:lastMsg"></span>\n        </div>\n    </div>\n</script>\n<script type="text/html" id="agentLists">\n    <li>\n        <div class="skill-name">\n            <span class="icon chat-users-arrow-down"></span>\n            <span data-bind="text:skillGroupName"></span>\n        </div>\n        <ul data-bind="foreach: agents" class="agent-list">\n            <li class="agent-list-item" data-bind="click:$root.selectAgentChat">\n                <div data-bind="text:agentName"></div>\n                <div>\n                    <span data-bind="text:currentServiceNum"></span>人\n                </div>\n            </li>\n        </ul>\n    </li>\n</script>\n';});


define('text!quickReplyDom',[],function () { return '<div id="chat_quick_reply">\n    <div id="quick_reply" data-bind="visible:quickReplyDis">\n        <div id="handle_bar">\n            <div class="serach_input">\n                <!--<input type="text" data-bind="textInput: quickReplySearchTxt, event: {keyup: function(){searchComLang(\'commonSearch\')}}"/>-->\n                <input type="text" data-bind="textInput: quickReplySearchTxt, event: {keyup: function(){searchComLang(\'commonSearch\')}}"/>\n\n                <span><i class="fa fa-search"></i></span>\n            </div>\n            <div class="handle_button">\n                <span><i class="fa fa-refresh" data-bind="click: refreshList"></i></span>\n                <span><i class="fa fa-cog" data-bind="click: handleSetting"></i></span>\n            </div>\n        </div>\n        <div data-bind="template: {name: \'quickReplyContent\'}"></div>\n    </div>\n\n    <div id="common_Language_set" data-bind="visible: !quickReplyDis()">\n        <div id="comLang_title">\n            <span>设置常用语</span>\n            <div class="edit-btns" data-bind="visible: !!cacheValue()">\n                <button type="button" class="qn-button primary" data-bind="click:handleEdit">编辑</button>\n                <button type="button" class="qn-button danger" data-bind="click:handleDelete">删除</button>\n            </div>\n        </div>\n        <div data-bind="template: {name: \'quickReplyContent\'}"></div>\n        <div class="bottom-btns">\n            <form hidden encType="multipart/form-data" target="upload">\n                <input type="file" name="file" id="commLangToUpload"/>\n            </form>\n            <button type="button" class="qn-button primary" id="commLangUploadBtn">导入</button>\n            <button type="button" class="qn-button primary" data-bind="click:handleExport">导出</button>\n            <button type="button" class="qn-button primary">\n                <a data-bind="attr:{href:downLoadUrl}" target="_blank">模板下载</a>\n            </button>\n            <button type="button" class="qn-button primary" data-bind="click:handleReturn">返回</button>\n        </div>\n        <div class="common-Language-create" data-bind="visible:commCreateDis">\n            <div class="commLang-create-title">\n                <span data-bind="text:currentTitle"></span>\n            </div>\n            <div class="commLang-create-content">\n                <!--ko if:currentTitleKey() == 1 || currentTitleKey() == 2-->\n                <textarea data-bind="textInput:commLangContent" maxlength="10"></textarea>\n                <p>\n                    <span data-bind="text:commLangContent().length"></span>\n                    <span>/10</span>\n                </p>\n                <!--/ko-->\n                <!--ko if:currentTitleKey() == 3 || currentTitleKey() == 4-->\n                <textarea data-bind="textInput:commLangContent"></textarea>\n                <!--/ko-->\n            </div>\n            <div style="text-align: right">\n                <button type="button" class="qn-button default" data-bind="click:handleCancel">取消</button>\n                <button type="button" class="qn-button primary" id="handleSave" data-bind="click:handleSave">保存</button>\n            </div>\n        </div>\n        <div class="operateTip" data-bind="visible:!!operateTip()">\n            <span data-bind="text:operateTip"></span>\n        </div>\n        <div class="deleteConfirm" data-bind="visible:deleteConfirmDis">\n            <!--ko if:cacheValue() && cacheValue().type == \'group\' -->\n            <p>如果删除分组，该分组下的常用语内容将全部删除，并且不可恢复，是否确定删除?</p>\n            <!--/ko-->\n            <!--ko if:cacheValue() && cacheValue().type == \'content\' -->\n            <p>确定删除该条常用语内容?</p>\n            <!--/ko-->\n            <div style="text-align: right">\n                <button type="button" style="margin-right:10px;" class="qn-button default" data-bind="click:handleCancel">取消</button>\n                <button type="button" class="qn-button danger" data-bind="click:confirmDelete">删除</button>\n            </div>\n        </div>\n    </div>\n\n</div>\n<script type="text/html" id="quickReplyContent">\n    <div id="content_area">\n        <div class="com_language_group" data-bind="visible: !searchResultShow()">\n            <p>常用语分组\n                <button class="create_icon"\n                        data-bind="visible: !quickReplyDis(),click:createCommLangG,enable:comLangGgroupList().length < 20"><i\n                        class="fa fa-plus-square-o"></i></button>\n            </p>\n            <ul data-bind="foreach: comLangGgroupList">\n                <li data-bind="click: $parent.switchComLangGgroup,css:{\'selectedGroupActive\': selected()}">\n                    <span class="selected-group-style"\n                          data-bind="style: {visibility: selected() ? \'visible\' : \'hidden\'}"></span>\n                    <span data-bind="text: name"></span>\n                    <span class="iconComm" data-bind="style: {visibility: typeGrop() ? \'visible\' : \'hidden\'}"></span>\n                </li>\n            </ul>\n        </div>\n        <div class="com_language_content" data-bind="visible: !searchResultShow()">\n            <p>常用语内容\n                <button class="create_icon" data-bind="visible: !quickReplyDis(), click:createCommLangC,enable: !!selectedGgroup()">\n                    <i class="fa fa-plus-square-o" data-bind="style: {color: !!selectedGgroup() ? \'#07968a\' : \'#ddd\'}"></i>\n                </button>\n            </p>\n            <ul data-bind="foreach: comLangContentList">\n\n                <!--ko if:$root.quickReplyDis()-->\n                <li data-bind="text: name,click: $root.handleSearchedContent,css:{\'selectedContentActive\': selected()}"></li>\n                <!--/ko-->\n\n                <!--ko if:!$root.quickReplyDis()-->\n                <li data-bind="text: name,click: $root.handleCacheValue,css:{\'selectedContentActive\': selected()}"></li>\n                <!--/ko-->\n\n            </ul>\n        </div>\n        <div class="com_language_content search_result" data-bind="visible: searchResultShow">\n           <!--ko if:searchedContentList().length > 0-->\n            <ul data-bind="foreach: searchedContentList">\n                <li data-bind="text: sentenceDto.content,css:{\'iconCom_show\':type==\'0\'},click: $parent.handleSearchedContent">\n                </li>\n            </ul>\n            <!--/ko-->\n            <div class ="search_result_none" data-bind="visible:searchResultTip">\n                <p>没有搜索结果</p>\n            </div>\n        </div>\n    </div>\n</script>';});


define('text!smartReplyDom',[],function () { return '<div id="chat_smart_reply">\n    <!--搜索框-->\n    <div class="handle_bar">\n        <div class="serach_input">\n            <input type="text" placeholder="请输入您要问的问题" data-bind="textInput: smartReplySearchTxt"/>\n        </div>\n        <div class="handle_button">\n            <span><i class="fa fa-search" data-bind="click: searchReply"></i></span>\n            <span><i class="fa fa-refresh" data-bind="click: reflash"></i></span>\n        </div>\n    </div>\n    <!--搜索结果-->\n    <div class="content_bar">\n        <div data-bind="visible: smartContent">\n            <ul data-bind="foreach:smartReply">\n                <li>\n                    <p data-bind="text:question">\n                    </p>\n                    <p>\n                        <span data-bind="text: answer "></span>\n                        <span  data-bind="click: $parent.sendSmartReply.bind($index())"></span>\n                        <!--<span data-bind=\'visible:msgtype=="1"\'>[图片]</span>-->\n                    </p>\n                </li>\n            </ul>\n        </div>\n        <div class="no-content" data-bind="visible: !smartContent()">\n            <!-- <img data-bind="attr:{ src: \'../images/\' + photoName() }" height="64" width="80"/>-->\n            <!--<div data-bind="style:{background:url(\'../images/\'+photoName())}"></div>-->\n            <div data-bind="css: {mostar: photoName()<0}"></div>\n            <p data-bind="text:smartTip"></p>\n        </div>\n\n    </div>\n</div>';});


define('css!bsf',[],function(){});
/**
 * Created by panfei on 2015/11/23.
 */
(function(urlArgs, baseUrl, initParams) {
    requirejs.config({
        urlArgs: urlArgs,
        baseUrl: baseUrl,
        paths: {
            "jquery"           : "MultiChannel/windowJquery",
            "jsjac"        : "Agent/lib/jsjac-2.1",
            // "jsjac"        : "Agent/lib/jsjac-1.4",
            "font"         : "public_css/font-awesome.min",
            //"agent"        : "Agent/scss/agent",
            "agent"        : "Agent/scss/agent-cdesk",
            "bsf"          : "Agent/css/bsf",
            //"dom"          : "Agent/app/Agent-ui.html",
            "dom"          : "Agent/app/Agent-ui-desk.html",
            "quickReplyDom": "Agent/app/Quick-reply-ui.html",
            "smartReplyDom": "Agent/app/Smart-reply-ui.html",
            //"Config"       : "Agent/app/Config",
            "FileUpload"   : "Agent/app/FileUpload",
            "Login"        : "Agent/app/Login",
            "Message"      : "Agent/app/Message",
            "User"         : "Agent/app/User",
            "ViewModel"    : "Agent/app/ViewModel",
            "Vm"           : "Agent/app/Vm",
            "ViewModelQuickReply"   : "Agent/app/ViewModelQuickReply",
            "ViewModelSmartReply"   : "Agent/app/ViewModelSmartReply",
            "VmQuickReply"           : "Agent/app/VmQuickReply",
            "VmSmartReply"           : "Agent/app/VmSmartReply",
            "IMG"          : "Agent/component/IMG",
            "Drag"         : "Agent/component/ks-drag",
            "RegisterEvent": "Agent/app/RegisterEvent",
            "ButelEvent"   : "Agent/app/ButelEvent",
            "weixinEmojiC" : "Agent/css/weixinEmoji",
            "weixinEmojiJ" : "Agent/lib/weixinEmoji",
            "weixinEmojiExtend": "Agent/lib/weixinEmojiExtend",
            "util": "Agent/lib/util"
        }
    });

    require(["jquery", "knockout", "Vm", "VmQuickReply","VmSmartReply", "Login", "FileUpload", "Drag", "RegisterEvent", "ButelEvent", "text!dom", "text!quickReplyDom","text!smartReplyDom", "css!bsf"], function($, ko, Vm, VmQuickReply, VmSmartReply, Login, FileUpload, Drag, RegisterEvent, ButelEvent, dom, quickReplyDom, smartReplyDom) {
        "use strict";

        window.vm = Vm;
        var initCallback = initParams.callback;
        var selectorName = initParams.selectorName;
        var isCheckWord = initParams.isCheckWord;
        if("isCheckWord" in initParams){
            Vm.isCheckWord=initParams.isCheckWord;
        }
        //在这里引用css文件，不会被打包到main.min.js
        require(["css!font", "css!agent"], function() {
            //把聊天窗体代码添加到body最后节点
            $(selectorName || document.body).append(dom);

            //转义表情符号
            var emojiPane = $("#emojiPane").html();
            emojiPane = emojiPane.replace(/&amp;/g,"&")
                                 .replace(/&lt;/g,"<")
                                 .replace(/&gt;/g,">")
                                 .replace(/&quot;/g,"\"");

            //转换表情
            $("#emojiPane").html(WeixinEmojiExtend.replace(emojiPane));

            //给表情绑定事件
            $("#emojiPane img").click(function() {
                var src = $(this).attr("src");
                var emojiNum = src.split("/")[src.split("/").length-1].split(".")[0];
                var emojiStr = WeixinEmojiExtend.getInverseStr(emojiNum);
                if(Vm.inputText()) {
                    Vm.inputText(Vm.inputText() + emojiStr);
                } else {
                    Vm.inputText(emojiStr);
                }
                Vm.emojiPaneDis(false);
                $("textarea.message-input").focus();
            });

            //点击表情框以外地方隐藏表情框
            $(document).click(function(event) {
                if(event.target.id != 'expressBtn') {
                    Vm.emojiPaneDis(false);
                }
                if(event.target.id != 'chat-common-word'){
                    Vm.isShowCommonWordDialog(false);
                }
            });

            //切换转接坐席列表的展示
            $(document).delegate("span.icon", "click",function() {
                if($(this).hasClass("chat-users-arrow-up")) {
                    $(this).removeClass("chat-users-arrow-up").addClass("chat-users-arrow-down");
                    $(this).parent().next().slideDown();
                    return;
                }
                if($(this).hasClass("chat-users-arrow-down")) {
                    $(this).removeClass("chat-users-arrow-down").addClass("chat-users-arrow-up");
                    $(this).parent().next().slideUp();
                    return;
                }
                if($(this).hasClass("fa-plus")) {
                    $(this).removeClass("fa-plus").addClass("fa-minus");
                    $(this).parent().next().slideDown();
                    return;
                }
                if($(this).hasClass("fa-minus")) {
                    $(this).removeClass("fa-minus").addClass("fa-plus");
                    $(this).parent().next().slideUp();
                }
            });

            //截图粘贴事件
            var sendPic = null;
            $(document).on("paste","#textArea",function(e){
                sendPic = null;
                sendPic = Vm.pastePicFun(e);
            });
            //截图发送事件
            $(document).on("click","#sendPic",function(){
                sendPic();
            })

            //选择自动快捷回复提示图标
            $("#openAutoMatchTipIcon").hover(function(){
                $(".openAutoMatchTip").css("display","block");
            },function(){
                $(".openAutoMatchTip").css("display","none");
            });

            //选择智能协助提示图标
            $("#openIntellTipIcons").hover(function(){
                $(".openIntellTip").css("display","block");
            },function(){
                $(".openIntellTip").css("display","none");
            });

            //登录、退出接口暴露出去
            WebAgent.ChatLogin = Login.login;
            WebAgent.ChatLogout = Login.logout;

            //设置状态接口
            WebAgent.ChatSetBusy = Vm.setBusy;
            WebAgent.ChatSetReady = Vm.setReady;

            //跟踪坐席状态：用于容错时保持两端状态一致
            WebAgent.readyEnabled=false;
            //跟踪坐席是否登入，避免openfire重复登入
            WebAgent.agentOnline = Vm.agentOnline();
            //设置客户姓名
            WebAgent.setNickName = Vm.setNickName;

            //butel事件接口
            WebAgent.butelEvent = ButelEvent;

            //获取可转坐席列表
            WebAgent.getAgentList = Vm.getAgentList;
            WebAgent.transferAgent = Vm.transferAgent;

            //获取聊天记录
            WebAgent.getChatMsgs = Vm.getChatMsgs;

            //设置声音提醒
            WebAgent.setChatSoundTip = Vm.setChatSoundTip;

            //加载快捷回复DOM到指定位置
            WebAgent.loadQuickReplyDom = function(appendDom){
                $(appendDom).append(quickReplyDom);
                ko.applyBindings(VmQuickReply, $("#chat_quick_reply")[0]);
            };

            if(initParams.quickReplySelector){
                $(initParams.quickReplySelector).append(quickReplyDom);
                ko.applyBindings(VmQuickReply, $("#chat_quick_reply")[0]);
            }

            //加载快捷回复的数据
            WebAgent.loadQuickReplyData = VmQuickReply.loadQuickReplyModel;

            //加载智能回复DOM到指定位置
            if(initParams.smartReply){
                $(initParams.smartReply).append(smartReplyDom);
                ko.applyBindings(VmSmartReply, $("#chat_smart_reply")[0]);
            }

            WebAgent.loadSmartReplyDom = function(appendDom){
                $(appendDom).append(smartReplyDom);
                ko.applyBindings(VmSmartReply, $("#chat_smart_reply")[0]);
            }

            //快捷回复上传文件
            $(document).delegate("#commLangUploadBtn","click",function(){
                console.log("you have clicked commLangUploadBtn");
                FileUpload.commLangSelected();
            });
            $(document).delegate("#commLangToUpload","change",function(){
                FileUpload.uploadCommLang();
            });

            //注册事件
            WebAgent.ChatRegisterEvent = RegisterEvent.registerEvent;

            //移除事件
            WebAgent.ChatRemoveEvent = RegisterEvent.removeEvent;

            //chat置忙成功回调
            WebAgent.ChatBusyCallback = RegisterEvent.busyCallback;

            //chat置闲成功的回调
            WebAgent.ChatReadyCallback = RegisterEvent.readyCallback;

            WebAgent.ChatWorkOrderCallback = function(params){
                Vm.currentUser().workOrder.push({workId: params.workId,title: params.title, onclick: params.onclick});
            };
            WebAgent.ChatUpdateOrAddUser = RegisterEvent.updateOrAddUser;
            WebAgent.ChatKchartCreate = RegisterEvent.kchartCreate;


            //窗体显示/隐藏切换
            WebAgent.ChatToggle = function() {
                $("#chat_pane").toggle();
            }

            //初始化后的回调
            if(typeof initCallback === "function") {
                initCallback();
                WebAgent.chatInitFinished = true;
            }

            //上传文件
            $("#uploadBtn").click(function() {
                FileUpload.fileSelected();
            });

            $("#fileToUpload").change(function() {
                var file = this;
                FileUpload.uploadFile(file);
            });


            //隐藏窗体
            $("#hideChat").click(function(){
                $("#chat_pane").hide();
            })

            //窗体拖拽
            Drag.dragElement($(".ibox-title").get(0), $("#chat_pane").get(0));

            //绑定聊天框viewModel
            ko.applyBindings(Vm, $("#chat_pane")[0]);
        });

    });
})(WebAgent.urlArgs, WebAgent.baseUrl, WebAgent.ChatParams)
;
define("main", function(){});


(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})
('.weixinEmoji {\n    background: transparent url(css/weixinEmoji.png) no-repeat 0 0;\n    width: 20px;\n    height: 20px;\n    display: -moz-inline-stack;\n    display: inline-block;\n    vertical-align: middle;\n    margin-top: -0.2em;\n    zoom:1;\n    *display: inline\n}\n\n\n.weixinEmoji-2600 {\n    background-position: 0 -260px\n}\n\n.weixinEmoji-2601 {\n    background-position: 0 -20px\n}\n\n.weixinEmoji-2614 {\n    background-position: 0 -40px\n}\n\n.weixinEmoji-26c4 {\n    background-position: 0 -60px\n}\n\n.weixinEmoji-26a1 {\n    background-position: 0 -80px\n}\n\n.weixinEmoji-1f300 {\n    background-position: 0 -100px\n}\n\n.weixinEmoji-1f301 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f302 {\n    background-position: 0 -120px\n}\n\n.weixinEmoji-1f303 {\n    background-position: 0 -920px\n}\n\n.weixinEmoji-1f304 {\n    background-position: 0 -160px\n}\n\n.weixinEmoji-1f305 {\n    background-position: 0 -180px\n}\n\n.weixinEmoji-1f306 {\n    background-position: 0 -200px\n}\n\n.weixinEmoji-1f307 {\n    background-position: 0 -220px\n}\n\n.weixinEmoji-1f308 {\n    background-position: 0 -240px\n}\n\n.weixinEmoji-2744 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-26c5 {\n    background-position: 0 -260px\n}\n\n.weixinEmoji-1f309 {\n    background-position: 0 -920px\n}\n\n.weixinEmoji-1f30a {\n    background-position: 0 -900px\n}\n\n.weixinEmoji-1f30b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f30c {\n    background-position: 0 -920px\n}\n\n.weixinEmoji-1f30f {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f311 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f314 {\n    background-position: 0 -360px\n}\n\n.weixinEmoji-1f313 {\n    background-position: 0 -360px\n}\n\n.weixinEmoji-1f319 {\n    background-position: 0 -360px\n}\n\n.weixinEmoji-1f315 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f31b {\n    background-position: 0 -360px\n}\n\n.weixinEmoji-1f31f {\n    background-position: 0 -10740px\n}\n\n.weixinEmoji-1f320 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f550 {\n    background-position: 0 -380px\n}\n\n.weixinEmoji-1f551 {\n    background-position: 0 -400px\n}\n\n.weixinEmoji-1f552 {\n    background-position: 0 -420px\n}\n\n.weixinEmoji-1f553 {\n    background-position: 0 -440px\n}\n\n.weixinEmoji-1f554 {\n    background-position: 0 -460px\n}\n\n.weixinEmoji-1f555 {\n    background-position: 0 -480px\n}\n\n.weixinEmoji-1f556 {\n    background-position: 0 -500px\n}\n\n.weixinEmoji-1f557 {\n    background-position: 0 -520px\n}\n\n.weixinEmoji-1f558 {\n    background-position: 0 -540px\n}\n\n.weixinEmoji-1f559 {\n    background-position: 0 -620px\n}\n\n.weixinEmoji-1f55a {\n    background-position: 0 -580px\n}\n\n.weixinEmoji-1f55b {\n    background-position: 0 -600px\n}\n\n.weixinEmoji-231a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-231b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-23f0 {\n    background-position: 0 -620px\n}\n\n.weixinEmoji-23f3 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2648 {\n    background-position: 0 -640px\n}\n\n.weixinEmoji-2649 {\n    background-position: 0 -660px\n}\n\n.weixinEmoji-264a {\n    background-position: 0 -680px\n}\n\n.weixinEmoji-264b {\n    background-position: 0 -700px\n}\n\n.weixinEmoji-264c {\n    background-position: 0 -720px\n}\n\n.weixinEmoji-264d {\n    background-position: 0 -740px\n}\n\n.weixinEmoji-264e {\n    background-position: 0 -760px\n}\n\n.weixinEmoji-264f {\n    background-position: 0 -780px\n}\n\n.weixinEmoji-2650 {\n    background-position: 0 -800px\n}\n\n.weixinEmoji-2651 {\n    background-position: 0 -820px\n}\n\n.weixinEmoji-2652 {\n    background-position: 0 -840px\n}\n\n.weixinEmoji-2653 {\n    background-position: 0 -860px\n}\n\n.weixinEmoji-26ce {\n    background-position: 0 -880px\n}\n\n.weixinEmoji-1f340 {\n    background-position: 0 -1220px\n}\n\n.weixinEmoji-1f337 {\n    background-position: 0 -960px\n}\n\n.weixinEmoji-1f331 {\n    background-position: 0 -1220px\n}\n\n.weixinEmoji-1f341 {\n    background-position: 0 -1000px\n}\n\n.weixinEmoji-1f338 {\n    background-position: 0 -1020px\n}\n\n.weixinEmoji-1f339 {\n    background-position: 0 -1040px\n}\n\n.weixinEmoji-1f342 {\n    background-position: 0 -1060px\n}\n\n.weixinEmoji-1f343 {\n    background-position: 0 -1080px\n}\n\n.weixinEmoji-1f33a {\n    background-position: 0 -1100px\n}\n\n.weixinEmoji-1f33b {\n    background-position: 0 -1200px\n}\n\n.weixinEmoji-1f334 {\n    background-position: 0 -1140px\n}\n\n.weixinEmoji-1f335 {\n    background-position: 0 -1160px\n}\n\n.weixinEmoji-1f33e {\n    background-position: 0 -1180px\n}\n\n.weixinEmoji-1f33d {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f344 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f330 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f33c {\n    background-position: 0 -1200px\n}\n\n.weixinEmoji-1f33f {\n    background-position: 0 -1220px\n}\n\n.weixinEmoji-1f352 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f34c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f34e {\n    background-position: 0 -1360px\n}\n\n.weixinEmoji-1f34a {\n    background-position: 0 -1260px\n}\n\n.weixinEmoji-1f353 {\n    background-position: 0 -1280px\n}\n\n.weixinEmoji-1f349 {\n    background-position: 0 -1300px\n}\n\n.weixinEmoji-1f345 {\n    background-position: 0 -1320px\n}\n\n.weixinEmoji-1f346 {\n    background-position: 0 -1340px\n}\n\n.weixinEmoji-1f348 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f34d {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f347 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f351 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f34f {\n    background-position: 0 -1360px\n}\n\n.weixinEmoji-1f440 {\n    background-position: 0 -1380px\n}\n\n.weixinEmoji-1f442 {\n    background-position: 0 -1400px\n}\n\n.weixinEmoji-1f443 {\n    background-position: 0 -1420px\n}\n\n.weixinEmoji-1f444 {\n    background-position: 0 -1440px\n}\n\n.weixinEmoji-1f445 {\n    background-position: 0 -3000px\n}\n\n.weixinEmoji-1f484 {\n    background-position: 0 -1480px\n}\n\n.weixinEmoji-1f485 {\n    background-position: 0 -1500px\n}\n\n.weixinEmoji-1f486 {\n    background-position: 0 -1520px\n}\n\n.weixinEmoji-1f487 {\n    background-position: 0 -1540px\n}\n\n.weixinEmoji-1f488 {\n    background-position: 0 -1560px\n}\n\n.weixinEmoji-1f464 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f466 {\n    background-position: 0 -1580px\n}\n\n.weixinEmoji-1f467 {\n    background-position: 0 -1600px\n}\n\n.weixinEmoji-1f468 {\n    background-position: 0 -1620px\n}\n\n.weixinEmoji-1f469 {\n    background-position: 0 -1640px\n}\n\n.weixinEmoji-1f46a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f46b {\n    background-position: 0 -1660px\n}\n\n.weixinEmoji-1f46e {\n    background-position: 0 -1680px\n}\n\n.weixinEmoji-1f46f {\n    background-position: 0 -1700px\n}\n\n.weixinEmoji-1f470 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f471 {\n    background-position: 0 -1720px\n}\n\n.weixinEmoji-1f472 {\n    background-position: 0 -1740px\n}\n\n.weixinEmoji-1f473 {\n    background-position: 0 -1760px\n}\n\n.weixinEmoji-1f474 {\n    background-position: 0 -1780px\n}\n\n.weixinEmoji-1f475 {\n    background-position: 0 -1800px\n}\n\n.weixinEmoji-1f476 {\n    background-position: 0 -1820px\n}\n\n.weixinEmoji-1f477 {\n    background-position: 0 -1840px\n}\n\n.weixinEmoji-1f478 {\n    background-position: 0 -1860px\n}\n\n.weixinEmoji-1f479 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f47a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f47b {\n    background-position: 0 -1880px\n}\n\n.weixinEmoji-1f47c {\n    background-position: 0 -1900px\n}\n\n.weixinEmoji-1f47d {\n    background-position: 0 -1920px\n}\n\n.weixinEmoji-1f47e {\n    background-position: 0 -1940px\n}\n\n.weixinEmoji-1f47f {\n    background-position: 0 -1960px\n}\n\n.weixinEmoji-1f480 {\n    background-position: 0 -1980px\n}\n\n.weixinEmoji-1f481 {\n    background-position: 0 -2000px\n}\n\n.weixinEmoji-1f482 {\n    background-position: 0 -2020px\n}\n\n.weixinEmoji-1f483 {\n    background-position: 0 -2040px\n}\n\n.weixinEmoji-1f40c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f40d {\n    background-position: 0 -2620px\n}\n\n.weixinEmoji-1f40e {\n    background-position: 0 -6680px\n}\n\n.weixinEmoji-1f414 {\n    background-position: 0 -2640px\n}\n\n.weixinEmoji-1f417 {\n    background-position: 0 -2660px\n}\n\n.weixinEmoji-1f42b {\n    background-position: 0 -2680px\n}\n\n.weixinEmoji-1f418 {\n    background-position: 0 -2480px\n}\n\n.weixinEmoji-1f428 {\n    background-position: 0 -2500px\n}\n\n.weixinEmoji-1f412 {\n    background-position: 0 -2520px\n}\n\n.weixinEmoji-1f411 {\n    background-position: 0 -2540px\n}\n\n.weixinEmoji-1f419 {\n    background-position: 0 -2340px\n}\n\n.weixinEmoji-1f41a {\n    background-position: 0 -2360px\n}\n\n.weixinEmoji-1f41b {\n    background-position: 0 -2460px\n}\n\n.weixinEmoji-1f41c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f41d {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f41e {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f420 {\n    background-position: 0 -2420px\n}\n\n.weixinEmoji-1f421 {\n    background-position: 0 -7360px\n}\n\n.weixinEmoji-1f422 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f424 {\n    background-position: 0 -2140px\n}\n\n.weixinEmoji-1f425 {\n    background-position: 0 -2140px\n}\n\n.weixinEmoji-1f426 {\n    background-position: 0 -2400px\n}\n\n.weixinEmoji-1f423 {\n    background-position: 0 -2140px\n}\n\n.weixinEmoji-1f427 {\n    background-position: 0 -2160px\n}\n\n.weixinEmoji-1f429 {\n    background-position: 0 -2720px\n}\n\n.weixinEmoji-1f41f {\n    background-position: 0 -7360px\n}\n\n.weixinEmoji-1f42c {\n    background-position: 0 -2380px\n}\n\n.weixinEmoji-1f42d {\n    background-position: 0 -2280px\n}\n\n.weixinEmoji-1f42f {\n    background-position: 0 -2240px\n}\n\n.weixinEmoji-1f431 {\n    background-position: 0 -2080px\n}\n\n.weixinEmoji-1f433 {\n    background-position: 0 -2300px\n}\n\n.weixinEmoji-1f434 {\n    background-position: 0 -2200px\n}\n\n.weixinEmoji-1f435 {\n    background-position: 0 -2320px\n}\n\n.weixinEmoji-1f436 {\n    background-position: 0 -2720px\n}\n\n.weixinEmoji-1f437 {\n    background-position: 0 -2780px\n}\n\n.weixinEmoji-1f43b {\n    background-position: 0 -2260px\n}\n\n.weixinEmoji-1f439 {\n    background-position: 0 -2440px\n}\n\n.weixinEmoji-1f43a {\n    background-position: 0 -2560px\n}\n\n.weixinEmoji-1f42e {\n    background-position: 0 -2580px\n}\n\n.weixinEmoji-1f430 {\n    background-position: 0 -2600px\n}\n\n.weixinEmoji-1f438 {\n    background-position: 0 -2700px\n}\n\n.weixinEmoji-1f43e {\n    background-position: 0 -6460px\n}\n\n.weixinEmoji-1f432 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f43c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f43d {\n    background-position: 0 -2780px\n}\n\n.weixinEmoji-1f620 {\n    background-position: 0 -2800px\n}\n\n.weixinEmoji-1f629 {\n    background-position: 0 -3860px\n}\n\n.weixinEmoji-1f632 {\n    background-position: 0 -2840px\n}\n\n.weixinEmoji-1f61e {\n    background-position: 0 -2860px\n}\n\n.weixinEmoji-1f635 {\n    background-position: 0 -3540px\n}\n\n.weixinEmoji-1f630 {\n    background-position: 0 -2900px\n}\n\n.weixinEmoji-1f612 {\n    background-position: 0 -2920px\n}\n\n.weixinEmoji-1f60d {\n    background-position: 0 -3660px\n}\n\n.weixinEmoji-1f624 {\n    background-position: 0 -3720px\n}\n\n.weixinEmoji-1f61c {\n    background-position: 0 -2980px\n}\n\n.weixinEmoji-1f61d {\n    background-position: 0 -3000px\n}\n\n.weixinEmoji-1f60b {\n    background-position: 0 -3220px\n}\n\n.weixinEmoji-1f618 {\n    background-position: 0 -3640px\n}\n\n.weixinEmoji-1f61a {\n    background-position: 0 -3060px\n}\n\n.weixinEmoji-1f637 {\n    background-position: 0 -3080px\n}\n\n.weixinEmoji-1f633 {\n    background-position: 0 -3100px\n}\n\n.weixinEmoji-1f603 {\n    background-position: 0 -3580px\n}\n\n.weixinEmoji-1f605 {\n    background-position: 0 -3260px\n}\n\n.weixinEmoji-1f606 {\n    background-position: 0 -3380px\n}\n\n.weixinEmoji-1f601 {\n    background-position: 0 -3720px\n}\n\n.weixinEmoji-1f602 {\n    background-position: 0 -3620px\n}\n\n.weixinEmoji-1f60a {\n    background-position: 0 -3220px\n}\n\n.weixinEmoji-263a {\n    background-position: 0 -3240px\n}\n\n.weixinEmoji-1f604 {\n    background-position: 0 -3260px\n}\n\n.weixinEmoji-1f622 {\n    background-position: 0 -3680px\n}\n\n.weixinEmoji-1f62d {\n    background-position: 0 -3300px\n}\n\n.weixinEmoji-1f628 {\n    background-position: 0 -3320px\n}\n\n.weixinEmoji-1f623 {\n    background-position: 0 -3540px\n}\n\n.weixinEmoji-1f621 {\n    background-position: 0 -3880px\n}\n\n.weixinEmoji-1f60c {\n    background-position: 0 -3380px\n}\n\n.weixinEmoji-1f616 {\n    background-position: 0 -10520px\n}\n\n.weixinEmoji-1f614 {\n    background-position: 0 -3860px\n}\n\n.weixinEmoji-1f631 {\n    background-position: 0 -3440px\n}\n\n.weixinEmoji-1f62a {\n    background-position: 0 -3460px\n}\n\n.weixinEmoji-1f60f {\n    background-position: 0 -3480px\n}\n\n.weixinEmoji-1f613 {\n    background-position: 0 -3500px\n}\n\n.weixinEmoji-1f625 {\n    background-position: 0 -3520px\n}\n\n.weixinEmoji-1f62b {\n    background-position: 0 -3540px\n}\n\n.weixinEmoji-1f609 {\n    background-position: 0 -3560px\n}\n\n.weixinEmoji-1f63a {\n    background-position: 0 -3580px\n}\n\n.weixinEmoji-1f638 {\n    background-position: 0 -3720px\n}\n\n.weixinEmoji-1f639 {\n    background-position: 0 -3620px\n}\n\n.weixinEmoji-1f63d {\n    background-position: 0 -3640px\n}\n\n.weixinEmoji-1f63b {\n    background-position: 0 -3660px\n}\n\n.weixinEmoji-1f63f {\n    background-position: 0 -3680px\n}\n\n.weixinEmoji-1f63e {\n    background-position: 0 -3880px\n}\n\n.weixinEmoji-1f63c {\n    background-position: 0 -3720px\n}\n\n.weixinEmoji-1f640 {\n    background-position: 0 -3860px\n}\n\n.weixinEmoji-1f645 {\n    background-position: 0 -3760px\n}\n\n.weixinEmoji-1f646 {\n    background-position: 0 -3780px\n}\n\n.weixinEmoji-1f647 {\n    background-position: 0 -3800px\n}\n\n.weixinEmoji-1f648 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f64a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f649 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f64b {\n    background-position: 0 -11240px\n}\n\n.weixinEmoji-1f64c {\n    background-position: 0 -3840px\n}\n\n.weixinEmoji-1f64d {\n    background-position: 0 -3860px\n}\n\n.weixinEmoji-1f64e {\n    background-position: 0 -3880px\n}\n\n.weixinEmoji-1f64f {\n    background-position: 0 -3900px\n}\n\n.weixinEmoji-1f3e0 {\n    background-position: 0 -3940px\n}\n\n.weixinEmoji-1f3e1 {\n    background-position: 0 -3940px\n}\n\n.weixinEmoji-1f3e2 {\n    background-position: 0 -3960px\n}\n\n.weixinEmoji-1f3e3 {\n    background-position: 0 -3980px\n}\n\n.weixinEmoji-1f3e5 {\n    background-position: 0 -4000px\n}\n\n.weixinEmoji-1f3e6 {\n    background-position: 0 -4020px\n}\n\n.weixinEmoji-1f3e7 {\n    background-position: 0 -4040px\n}\n\n.weixinEmoji-1f3e8 {\n    background-position: 0 -4060px\n}\n\n.weixinEmoji-1f3e9 {\n    background-position: 0 -4080px\n}\n\n.weixinEmoji-1f3ea {\n    background-position: 0 -4100px\n}\n\n.weixinEmoji-1f3eb {\n    background-position: 0 -4120px\n}\n\n.weixinEmoji-26ea {\n    background-position: 0 -4140px\n}\n\n.weixinEmoji-26f2 {\n    background-position: 0 -4160px\n}\n\n.weixinEmoji-1f3ec {\n    background-position: 0 -4180px\n}\n\n.weixinEmoji-1f3ef {\n    background-position: 0 -4200px\n}\n\n.weixinEmoji-1f3f0 {\n    background-position: 0 -4220px\n}\n\n.weixinEmoji-1f3ed {\n    background-position: 0 -4240px\n}\n\n.weixinEmoji-2693 {\n    background-position: 0 -6920px\n}\n\n.weixinEmoji-1f3ee {\n    background-position: 0 -8800px\n}\n\n.weixinEmoji-1f5fb {\n    background-position: 0 -4300px\n}\n\n.weixinEmoji-1f5fc {\n    background-position: 0 -4320px\n}\n\n.weixinEmoji-1f5fd {\n    background-position: 0 -4340px\n}\n\n.weixinEmoji-1f5fe {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f5ff {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f45e {\n    background-position: 0 -4400px\n}\n\n.weixinEmoji-1f45f {\n    background-position: 0 -4400px\n}\n\n.weixinEmoji-1f460 {\n    background-position: 0 -4420px\n}\n\n.weixinEmoji-1f461 {\n    background-position: 0 -4440px\n}\n\n.weixinEmoji-1f462 {\n    background-position: 0 -4460px\n}\n\n.weixinEmoji-1f463 {\n    background-position: 0 -6460px\n}\n\n.weixinEmoji-1f453 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f455 {\n    background-position: 0 -4620px\n}\n\n.weixinEmoji-1f456 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f451 {\n    background-position: 0 -4500px\n}\n\n.weixinEmoji-1f454 {\n    background-position: 0 -4520px\n}\n\n.weixinEmoji-1f452 {\n    background-position: 0 -4540px\n}\n\n.weixinEmoji-1f457 {\n    background-position: 0 -4560px\n}\n\n.weixinEmoji-1f458 {\n    background-position: 0 -4580px\n}\n\n.weixinEmoji-1f459 {\n    background-position: 0 -4600px\n}\n\n.weixinEmoji-1f45a {\n    background-position: 0 -4620px\n}\n\n.weixinEmoji-1f45b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f45c {\n    background-position: 0 -4960px\n}\n\n.weixinEmoji-1f45d {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4b0 {\n    background-position: 0 -4720px\n}\n\n.weixinEmoji-1f4b1 {\n    background-position: 0 -4660px\n}\n\n.weixinEmoji-1f4b9 {\n    background-position: 0 -6380px\n}\n\n.weixinEmoji-1f4b2 {\n    background-position: 0 -4720px\n}\n\n.weixinEmoji-1f4b3 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4b4 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4b5 {\n    background-position: 0 -4720px\n}\n\n.weixinEmoji-1f4b8 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f1e81f1f3 {\n    background-position: 0 -4740px\n}\n\n.weixinEmoji-1f1e91f1ea {\n    background-position: 0 -4760px\n}\n\n.weixinEmoji-1f1ea1f1f8 {\n    background-position: 0 -4780px\n}\n\n.weixinEmoji-1f1eb1f1f7 {\n    background-position: 0 -4800px\n}\n\n.weixinEmoji-1f1ec1f1e7 {\n    background-position: 0 -4820px\n}\n\n.weixinEmoji-1f1ee1f1f9 {\n    background-position: 0 -4840px\n}\n\n.weixinEmoji-1f1ef1f1f5 {\n    background-position: 0 -4860px\n}\n\n.weixinEmoji-1f1f01f1f7 {\n    background-position: 0 -4880px\n}\n\n.weixinEmoji-1f1f71f1fa {\n    background-position: 0 -4900px\n}\n\n.weixinEmoji-1f1fa1f1f8 {\n    background-position: 0 -4920px\n}\n\n.weixinEmoji-1f525 {\n    background-position: 0 -5040px\n}\n\n.weixinEmoji-1f526 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f527 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f528 {\n    background-position: 0 -4360px\n}\n\n.weixinEmoji-1f529 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f52a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f52b {\n    background-position: 0 -5020px\n}\n\n.weixinEmoji-1f52e {\n    background-position: 0 -5080px\n}\n\n.weixinEmoji-1f52f {\n    background-position: 0 -5080px\n}\n\n.weixinEmoji-1f530 {\n    background-position: 0 -9660px\n}\n\n.weixinEmoji-1f531 {\n    background-position: 0 -9680px\n}\n\n.weixinEmoji-1f489 {\n    background-position: 0 -5300px\n}\n\n.weixinEmoji-1f48a {\n    background-position: 0 -5320px\n}\n\n.weixinEmoji-1f170 {\n    background-position: 0 -5340px\n}\n\n.weixinEmoji-1f171 {\n    background-position: 0 -5360px\n}\n\n.weixinEmoji-1f18e {\n    background-position: 0 -5380px\n}\n\n.weixinEmoji-1f17e {\n    background-position: 0 -5400px\n}\n\n.weixinEmoji-1f380 {\n    background-position: 0 -5420px\n}\n\n.weixinEmoji-1f381 {\n    background-position: 0 -6080px\n}\n\n.weixinEmoji-1f382 {\n    background-position: 0 -5460px\n}\n\n.weixinEmoji-1f384 {\n    background-position: 0 -5480px\n}\n\n.weixinEmoji-1f385 {\n    background-position: 0 -5500px\n}\n\n.weixinEmoji-1f38c {\n    background-position: 0 -5520px\n}\n\n.weixinEmoji-1f386 {\n    background-position: 0 -5540px\n}\n\n.weixinEmoji-1f388 {\n    background-position: 0 -5560px\n}\n\n.weixinEmoji-1f389 {\n    background-position: 0 -5580px\n}\n\n.weixinEmoji-1f38d {\n    background-position: 0 -5600px\n}\n\n.weixinEmoji-1f38e {\n    background-position: 0 -5620px\n}\n\n.weixinEmoji-1f393 {\n    background-position: 0 -5640px\n}\n\n.weixinEmoji-1f392 {\n    background-position: 0 -5660px\n}\n\n.weixinEmoji-1f38f {\n    background-position: 0 -5680px\n}\n\n.weixinEmoji-1f387 {\n    background-position: 0 -5700px\n}\n\n.weixinEmoji-1f390 {\n    background-position: 0 -5720px\n}\n\n.weixinEmoji-1f383 {\n    background-position: 0 -5740px\n}\n\n.weixinEmoji-1f38a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f38b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f391 {\n    background-position: 0 -5760px\n}\n\n.weixinEmoji-1f4df {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-260e {\n    background-position: 0 -5800px\n}\n\n.weixinEmoji-1f4de {\n    background-position: 0 -5800px\n}\n\n.weixinEmoji-1f4f1 {\n    background-position: 0 -5820px\n}\n\n.weixinEmoji-1f4f2 {\n    background-position: 0 -5840px\n}\n\n.weixinEmoji-1f4dd {\n    background-position: 0 -6440px\n}\n\n.weixinEmoji-1f4e0 {\n    background-position: 0 -5880px\n}\n\n.weixinEmoji-2709 {\n    background-position: 0 -11200px\n}\n\n.weixinEmoji-1f4e8 {\n    background-position: 0 -11200px\n}\n\n.weixinEmoji-1f4e9 {\n    background-position: 0 -11200px\n}\n\n.weixinEmoji-1f4ea {\n    background-position: 0 -5980px\n}\n\n.weixinEmoji-1f4eb {\n    background-position: 0 -5980px\n}\n\n.weixinEmoji-1f4ee {\n    background-position: 0 -6000px\n}\n\n.weixinEmoji-1f4f0 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4e2 {\n    background-position: 0 -6020px\n}\n\n.weixinEmoji-1f4e3 {\n    background-position: 0 -6040px\n}\n\n.weixinEmoji-1f4e1 {\n    background-position: 0 -6060px\n}\n\n.weixinEmoji-1f4e4 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4e5 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4e6 {\n    background-position: 0 -6080px\n}\n\n.weixinEmoji-1f4e7 {\n    background-position: 0 -11200px\n}\n\n.weixinEmoji-1f520 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f521 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f522 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f523 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f524 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2712 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4ba {\n    background-position: 0 -6100px\n}\n\n.weixinEmoji-1f4bb {\n    background-position: 0 -6120px\n}\n\n.weixinEmoji-270f {\n    background-position: 0 -6440px\n}\n\n.weixinEmoji-1f4ce {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4bc {\n    background-position: 0 -6160px\n}\n\n.weixinEmoji-1f4bd {\n    background-position: 0 -6200px\n}\n\n.weixinEmoji-1f4be {\n    background-position: 0 -6200px\n}\n\n.weixinEmoji-1f4bf {\n    background-position: 0 -7800px\n}\n\n.weixinEmoji-1f4c0 {\n    background-position: 0 -7820px\n}\n\n.weixinEmoji-2702 {\n    background-position: 0 -6220px\n}\n\n.weixinEmoji-1f4cd {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4c3 {\n    background-position: 0 -6440px\n}\n\n.weixinEmoji-1f4c4 {\n    background-position: 0 -6440px\n}\n\n.weixinEmoji-1f4c5 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4c1 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4c2 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4d3 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4d6 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4d4 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4d5 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4d7 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4d8 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4d9 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4da {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4db {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4dc {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4cb {\n    background-position: 0 -6440px\n}\n\n.weixinEmoji-1f4c6 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4ca {\n    background-position: 0 -6380px\n}\n\n.weixinEmoji-1f4c8 {\n    background-position: 0 -6380px\n}\n\n.weixinEmoji-1f4c9 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4c7 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4cc {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4d2 {\n    background-position: 0 -6420px\n}\n\n.weixinEmoji-1f4cf {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4d0 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4d1 {\n    background-position: 0 -6440px\n}\n\n.weixinEmoji-1f3bd {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-26be {\n    background-position: 0 -6480px\n}\n\n.weixinEmoji-26f3 {\n    background-position: 0 -6500px\n}\n\n.weixinEmoji-1f3be {\n    background-position: 0 -6520px\n}\n\n.weixinEmoji-26bd {\n    background-position: 0 -6540px\n}\n\n.weixinEmoji-1f3bf {\n    background-position: 0 -6560px\n}\n\n.weixinEmoji-1f3c0 {\n    background-position: 0 -6580px\n}\n\n.weixinEmoji-1f3c1 {\n    background-position: 0 -6600px\n}\n\n.weixinEmoji-1f3c2 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3c3 {\n    background-position: 0 -6620px\n}\n\n.weixinEmoji-1f3c4 {\n    background-position: 0 -6640px\n}\n\n.weixinEmoji-1f3c6 {\n    background-position: 0 -6660px\n}\n\n.weixinEmoji-1f3c8 {\n    background-position: 0 -6700px\n}\n\n.weixinEmoji-1f3ca {\n    background-position: 0 -6720px\n}\n\n.weixinEmoji-1f683 {\n    background-position: 0 -6740px\n}\n\n.weixinEmoji-1f687 {\n    background-position: 0 -6780px\n}\n\n.weixinEmoji-24c2 {\n    background-position: 0 -6780px\n}\n\n.weixinEmoji-1f684 {\n    background-position: 0 -6800px\n}\n\n.weixinEmoji-1f685 {\n    background-position: 0 -6820px\n}\n\n.weixinEmoji-1f697 {\n    background-position: 0 -6840px\n}\n\n.weixinEmoji-1f699 {\n    background-position: 0 -6860px\n}\n\n.weixinEmoji-1f68c {\n    background-position: 0 -6880px\n}\n\n.weixinEmoji-1f68f {\n    background-position: 0 -6900px\n}\n\n.weixinEmoji-1f6a2 {\n    background-position: 0 -6920px\n}\n\n.weixinEmoji-2708 {\n    background-position: 0 -6940px\n}\n\n.weixinEmoji-26f5 {\n    background-position: 0 -6960px\n}\n\n.weixinEmoji-1f689 {\n    background-position: 0 -7000px\n}\n\n.weixinEmoji-1f680 {\n    background-position: 0 -7020px\n}\n\n.weixinEmoji-1f6a4 {\n    background-position: 0 -7040px\n}\n\n.weixinEmoji-1f695 {\n    background-position: 0 -7060px\n}\n\n.weixinEmoji-1f69a {\n    background-position: 0 -7100px\n}\n\n.weixinEmoji-1f692 {\n    background-position: 0 -7120px\n}\n\n.weixinEmoji-1f691 {\n    background-position: 0 -7140px\n}\n\n.weixinEmoji-1f693 {\n    background-position: 0 -7260px\n}\n\n.weixinEmoji-26fd {\n    background-position: 0 -7180px\n}\n\n.weixinEmoji-1f17f {\n    background-position: 0 -7200px\n}\n\n.weixinEmoji-1f6a5 {\n    background-position: 0 -7220px\n}\n\n.weixinEmoji-1f6a7 {\n    background-position: 0 -9720px\n}\n\n.weixinEmoji-1f6a8 {\n    background-position: 0 -7260px\n}\n\n.weixinEmoji-2668 {\n    background-position: 0 -7280px\n}\n\n.weixinEmoji-26fa {\n    background-position: 0 -7300px\n}\n\n.weixinEmoji-1f3a0 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3a1 {\n    background-position: 0 -7320px\n}\n\n.weixinEmoji-1f3a2 {\n    background-position: 0 -7340px\n}\n\n.weixinEmoji-1f3a3 {\n    background-position: 0 -7360px\n}\n\n.weixinEmoji-1f3a4 {\n    background-position: 0 -7380px\n}\n\n.weixinEmoji-1f3a5 {\n    background-position: 0 -7400px\n}\n\n.weixinEmoji-1f3a6 {\n    background-position: 0 -7420px\n}\n\n.weixinEmoji-1f3a7 {\n    background-position: 0 -7440px\n}\n\n.weixinEmoji-1f3a8 {\n    background-position: 0 -7460px\n}\n\n.weixinEmoji-1f3a9 {\n    background-position: 0 -7540px\n}\n\n.weixinEmoji-1f3aa {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3ab {\n    background-position: 0 -7500px\n}\n\n.weixinEmoji-1f3ac {\n    background-position: 0 -7520px\n}\n\n.weixinEmoji-1f3ad {\n    background-position: 0 -7540px\n}\n\n.weixinEmoji-1f3ae {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f004 {\n    background-position: 0 -7560px\n}\n\n.weixinEmoji-1f3af {\n    background-position: 0 -7580px\n}\n\n.weixinEmoji-1f3b0 {\n    background-position: 0 -7600px\n}\n\n.weixinEmoji-1f3b1 {\n    background-position: 0 -7620px\n}\n\n.weixinEmoji-1f3b2 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3b3 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3b4 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f0cf {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3b5 {\n    background-position: 0 -7640px\n}\n\n.weixinEmoji-1f3b6 {\n    background-position: 0 -7740px\n}\n\n.weixinEmoji-1f3b7 {\n    background-position: 0 -7680px\n}\n\n.weixinEmoji-1f3b8 {\n    background-position: 0 -7700px\n}\n\n.weixinEmoji-1f3b9 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3ba {\n    background-position: 0 -7720px\n}\n\n.weixinEmoji-1f3bb {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f3bc {\n    background-position: 0 -7740px\n}\n\n.weixinEmoji-303d {\n    background-position: 0 -7760px\n}\n\n.weixinEmoji-1f4f7 {\n    background-position: 0 -4940px\n}\n\n.weixinEmoji-1f4f9 {\n    background-position: 0 -7400px\n}\n\n.weixinEmoji-1f4fa {\n    background-position: 0 -7780px\n}\n\n.weixinEmoji-1f4fb {\n    background-position: 0 -7840px\n}\n\n.weixinEmoji-1f4fc {\n    background-position: 0 -7860px\n}\n\n.weixinEmoji-1f48b {\n    background-position: 0 -7900px\n}\n\n.weixinEmoji-1f48c {\n    background-position: 0 -11200px\n}\n\n.weixinEmoji-1f48d {\n    background-position: 0 -7940px\n}\n\n.weixinEmoji-1f48e {\n    background-position: 0 -7960px\n}\n\n.weixinEmoji-1f48f {\n    background-position: 0 -7980px\n}\n\n.weixinEmoji-1f490 {\n    background-position: 0 -8000px\n}\n\n.weixinEmoji-1f491 {\n    background-position: 0 -8020px\n}\n\n.weixinEmoji-1f492 {\n    background-position: 0 -8040px\n}\n\n.weixinEmoji-1f51e {\n    background-position: 0 -9860px\n}\n\n.weixinEmoji-a9 {\n    background-position: 0 -9900px\n}\n\n.weixinEmoji-ae {\n    background-position: 0 -9920px\n}\n\n.weixinEmoji-2122 {\n    background-position: 0 -9940px\n}\n\n.weixinEmoji-2139 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2320e3 {\n    background-position: 0 -8060px\n}\n\n.weixinEmoji-3120e3 {\n    background-position: 0 -8080px\n}\n\n.weixinEmoji-3220e3 {\n    background-position: 0 -8100px\n}\n\n.weixinEmoji-3320e3 {\n    background-position: 0 -8120px\n}\n\n.weixinEmoji-3420e3 {\n    background-position: 0 -8140px\n}\n\n.weixinEmoji-3520e3 {\n    background-position: 0 -8160px\n}\n\n.weixinEmoji-3620e3 {\n    background-position: 0 -8180px\n}\n\n.weixinEmoji-3720e3 {\n    background-position: 0 -8200px\n}\n\n.weixinEmoji-3820e3 {\n    background-position: 0 -8220px\n}\n\n.weixinEmoji-3920e3 {\n    background-position: 0 -8240px\n}\n\n.weixinEmoji-3020e3 {\n    background-position: 0 -8260px\n}\n\n.weixinEmoji-1f51f {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4f6 {\n    background-position: 0 -8280px\n}\n\n.weixinEmoji-1f4f3 {\n    background-position: 0 -8300px\n}\n\n.weixinEmoji-1f4f4 {\n    background-position: 0 -8320px\n}\n\n.weixinEmoji-1f354 {\n    background-position: 0 -8340px\n}\n\n.weixinEmoji-1f359 {\n    background-position: 0 -8360px\n}\n\n.weixinEmoji-1f370 {\n    background-position: 0 -8380px\n}\n\n.weixinEmoji-1f35c {\n    background-position: 0 -8400px\n}\n\n.weixinEmoji-1f35e {\n    background-position: 0 -8420px\n}\n\n.weixinEmoji-1f373 {\n    background-position: 0 -8440px\n}\n\n.weixinEmoji-1f366 {\n    background-position: 0 -8460px\n}\n\n.weixinEmoji-1f35f {\n    background-position: 0 -8480px\n}\n\n.weixinEmoji-1f361 {\n    background-position: 0 -8500px\n}\n\n.weixinEmoji-1f358 {\n    background-position: 0 -8520px\n}\n\n.weixinEmoji-1f35a {\n    background-position: 0 -8540px\n}\n\n.weixinEmoji-1f35d {\n    background-position: 0 -8560px\n}\n\n.weixinEmoji-1f35b {\n    background-position: 0 -8580px\n}\n\n.weixinEmoji-1f362 {\n    background-position: 0 -8600px\n}\n\n.weixinEmoji-1f363 {\n    background-position: 0 -8620px\n}\n\n.weixinEmoji-1f371 {\n    background-position: 0 -8640px\n}\n\n.weixinEmoji-1f372 {\n    background-position: 0 -8660px\n}\n\n.weixinEmoji-1f367 {\n    background-position: 0 -8680px\n}\n\n.weixinEmoji-1f356 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f365 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f360 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f355 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f357 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f368 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f369 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f36a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f36b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f36c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f36d {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f36e {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f36f {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f364 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f374 {\n    background-position: 0 -8700px\n}\n\n.weixinEmoji-2615 {\n    background-position: 0 -8720px\n}\n\n.weixinEmoji-1f378 {\n    background-position: 0 -8860px\n}\n\n.weixinEmoji-1f37a {\n    background-position: 0 -8760px\n}\n\n.weixinEmoji-1f375 {\n    background-position: 0 -8780px\n}\n\n.weixinEmoji-1f376 {\n    background-position: 0 -8800px\n}\n\n.weixinEmoji-1f377 {\n    background-position: 0 -8860px\n}\n\n.weixinEmoji-1f37b {\n    background-position: 0 -8840px\n}\n\n.weixinEmoji-1f379 {\n    background-position: 0 -8860px\n}\n\n.weixinEmoji-2197 {\n    background-position: 0 -8960px\n}\n\n.weixinEmoji-2198 {\n    background-position: 0 -8980px\n}\n\n.weixinEmoji-2196 {\n    background-position: 0 -8920px\n}\n\n.weixinEmoji-2199 {\n    background-position: 0 -8940px\n}\n\n.weixinEmoji-2934 {\n    background-position: 0 -8960px\n}\n\n.weixinEmoji-2935 {\n    background-position: 0 -8980px\n}\n\n.weixinEmoji-2194 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2195 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2b06 {\n    background-position: 0 -9000px\n}\n\n.weixinEmoji-2b07 {\n    background-position: 0 -9020px\n}\n\n.weixinEmoji-27a1 {\n    background-position: 0 -9040px\n}\n\n.weixinEmoji-2b05 {\n    background-position: 0 -11180px\n}\n\n.weixinEmoji-25b6 {\n    background-position: 0 -9080px\n}\n\n.weixinEmoji-25c0 {\n    background-position: 0 -9100px\n}\n\n.weixinEmoji-23e9 {\n    background-position: 0 -9120px\n}\n\n.weixinEmoji-23ea {\n    background-position: 0 -9140px\n}\n\n.weixinEmoji-23eb {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-23ec {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f53a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f53b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f53c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f53d {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2b55 {\n    background-position: 0 -9800px\n}\n\n.weixinEmoji-274c {\n    background-position: 0 -10340px\n}\n\n.weixinEmoji-274e {\n    background-position: 0 -10340px\n}\n\n.weixinEmoji-2757 {\n    background-position: 0 -9160px\n}\n\n.weixinEmoji-2049 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-203c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2753 {\n    background-position: 0 -9180px\n}\n\n.weixinEmoji-2754 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2755 {\n    background-position: 0 -9220px\n}\n\n.weixinEmoji-3030 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-27b0 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-27bf {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2764 {\n    background-position: 0 -9240px\n}\n\n.weixinEmoji-1f493 {\n    background-position: 0 -9480px\n}\n\n.weixinEmoji-1f494 {\n    background-position: 0 -9280px\n}\n\n.weixinEmoji-1f495 {\n    background-position: 0 -9480px\n}\n\n.weixinEmoji-1f496 {\n    background-position: 0 -9480px\n}\n\n.weixinEmoji-1f497 {\n    background-position: 0 -9340px\n}\n\n.weixinEmoji-1f498 {\n    background-position: 0 -9360px\n}\n\n.weixinEmoji-1f499 {\n    background-position: 0 -9380px\n}\n\n.weixinEmoji-1f49a {\n    background-position: 0 -9400px\n}\n\n.weixinEmoji-1f49b {\n    background-position: 0 -9420px\n}\n\n.weixinEmoji-1f49c {\n    background-position: 0 -9440px\n}\n\n.weixinEmoji-1f49d {\n    background-position: 0 -9460px\n}\n\n.weixinEmoji-1f49e {\n    background-position: 0 -9480px\n}\n\n.weixinEmoji-1f49f {\n    background-position: 0 -9500px\n}\n\n.weixinEmoji-2665 {\n    background-position: 0 -9520px\n}\n\n.weixinEmoji-2660 {\n    background-position: 0 -9540px\n}\n\n.weixinEmoji-2666 {\n    background-position: 0 -9560px\n}\n\n.weixinEmoji-2663 {\n    background-position: 0 -9580px\n}\n\n.weixinEmoji-1f6ac {\n    background-position: 0 -9600px\n}\n\n.weixinEmoji-1f6ad {\n    background-position: 0 -9620px\n}\n\n.weixinEmoji-267f {\n    background-position: 0 -9640px\n}\n\n.weixinEmoji-1f6a9 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-26a0 {\n    background-position: 0 -9700px\n}\n\n.weixinEmoji-26d4 {\n    background-position: 0 -9720px\n}\n\n.weixinEmoji-267b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f6b2 {\n    background-position: 0 -6980px\n}\n\n.weixinEmoji-1f6b6 {\n    background-position: 0 -7080px\n}\n\n.weixinEmoji-1f6b9 {\n    background-position: 0 -9740px\n}\n\n.weixinEmoji-1f6ba {\n    background-position: 0 -9760px\n}\n\n.weixinEmoji-1f6c0 {\n    background-position: 0 -5220px\n}\n\n.weixinEmoji-1f6bb {\n    background-position: 0 -5240px\n}\n\n.weixinEmoji-1f6bd {\n    background-position: 0 -5260px\n}\n\n.weixinEmoji-1f6be {\n    background-position: 0 -5280px\n}\n\n.weixinEmoji-1f6bc {\n    background-position: 0 -9780px\n}\n\n.weixinEmoji-1f6aa {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f6ab {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2714 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f191 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f192 {\n    background-position: 0 -10020px\n}\n\n.weixinEmoji-1f193 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f194 {\n    background-position: 0 -11020px\n}\n\n.weixinEmoji-1f195 {\n    background-position: 0 -9980px\n}\n\n.weixinEmoji-1f196 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f197 {\n    background-position: 0 -9880px\n}\n\n.weixinEmoji-1f198 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f199 {\n    background-position: 0 -10000px\n}\n\n.weixinEmoji-1f19a {\n    background-position: 0 -9960px\n}\n\n.weixinEmoji-1f201 {\n    background-position: 0 -10060px\n}\n\n.weixinEmoji-1f202 {\n    background-position: 0 -10080px\n}\n\n.weixinEmoji-1f232 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f233 {\n    background-position: 0 -10100px\n}\n\n.weixinEmoji-1f234 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f235 {\n    background-position: 0 -10120px\n}\n\n.weixinEmoji-1f236 {\n    background-position: 0 -10140px\n}\n\n.weixinEmoji-1f21a {\n    background-position: 0 -10160px\n}\n\n.weixinEmoji-1f237 {\n    background-position: 0 -10180px\n}\n\n.weixinEmoji-1f238 {\n    background-position: 0 -10200px\n}\n\n.weixinEmoji-1f239 {\n    background-position: 0 -10220px\n}\n\n.weixinEmoji-1f22f {\n    background-position: 0 -10240px\n}\n\n.weixinEmoji-1f23a {\n    background-position: 0 -10260px\n}\n\n.weixinEmoji-3299 {\n    background-position: 0 -10280px\n}\n\n.weixinEmoji-3297 {\n    background-position: 0 -10300px\n}\n\n.weixinEmoji-1f250 {\n    background-position: 0 -10320px\n}\n\n.weixinEmoji-1f251 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2795 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2796 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2716 {\n    background-position: 0 -10340px\n}\n\n.weixinEmoji-2797 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4a0 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4a1 {\n    background-position: 0 -10360px\n}\n\n.weixinEmoji-1f4a2 {\n    background-position: 0 -10380px\n}\n\n.weixinEmoji-1f4a3 {\n    background-position: 0 -10400px\n}\n\n.weixinEmoji-1f4a4 {\n    background-position: 0 -10420px\n}\n\n.weixinEmoji-1f4a5 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4a6 {\n    background-position: 0 -10460px\n}\n\n.weixinEmoji-1f4a7 {\n    background-position: 0 -10460px\n}\n\n.weixinEmoji-1f4a8 {\n    background-position: 0 -10480px\n}\n\n.weixinEmoji-1f4a9 {\n    background-position: 0 -5000px\n}\n\n.weixinEmoji-1f4aa {\n    background-position: 0 -10500px\n}\n\n.weixinEmoji-1f4ab {\n    background-position: 0 -10520px\n}\n\n.weixinEmoji-1f4ac {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2728 {\n    background-position: 0 -11000px\n}\n\n.weixinEmoji-2734 {\n    background-position: 0 -10560px\n}\n\n.weixinEmoji-2733 {\n    background-position: 0 -10580px\n}\n\n.weixinEmoji-26aa {\n    background-position: 0 -10640px\n}\n\n.weixinEmoji-26ab {\n    background-position: 0 -10640px\n}\n\n.weixinEmoji-1f534 {\n    background-position: 0 -10640px\n}\n\n.weixinEmoji-1f535 {\n    background-position: 0 -10900px\n}\n\n.weixinEmoji-1f532 {\n    background-position: 0 -10900px\n}\n\n.weixinEmoji-1f533 {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-2b50 {\n    background-position: 0 -10720px\n}\n\n.weixinEmoji-2b1c {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-2b1b {\n    background-position: 0 -10900px\n}\n\n.weixinEmoji-25ab {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-25aa {\n    background-position: 0 -10900px\n}\n\n.weixinEmoji-25fd {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-25fe {\n    background-position: 0 -10900px\n}\n\n.weixinEmoji-25fb {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-25fc {\n    background-position: 0 -10900px\n}\n\n.weixinEmoji-1f536 {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-1f537 {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-1f538 {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-1f539 {\n    background-position: 0 -10980px\n}\n\n.weixinEmoji-2747 {\n    background-position: 0 -11000px\n}\n\n.weixinEmoji-1f4ae {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f4af {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-21a9 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-21aa {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f503 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f50a {\n    background-position: 0 -7880px\n}\n\n.weixinEmoji-1f50b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f50c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f50d {\n    background-position: 0 -11060px\n}\n\n.weixinEmoji-1f50e {\n    background-position: 0 -11060px\n}\n\n.weixinEmoji-1f512 {\n    background-position: 0 -11140px\n}\n\n.weixinEmoji-1f513 {\n    background-position: 0 -11100px\n}\n\n.weixinEmoji-1f50f {\n    background-position: 0 -11140px\n}\n\n.weixinEmoji-1f510 {\n    background-position: 0 -11140px\n}\n\n.weixinEmoji-1f511 {\n    background-position: 0 -11160px\n}\n\n.weixinEmoji-1f514 {\n    background-position: 0 -4980px\n}\n\n.weixinEmoji-2611 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f518 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f516 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f517 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f519 {\n    background-position: 0 -11180px\n}\n\n.weixinEmoji-1f51a {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f51b {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f51c {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-1f51d {\n    background-position: 0 -10040px\n}\n\n.weixinEmoji-2003 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2002 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2005 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-2705 {\n    background-position: 0 -9200px\n}\n\n.weixinEmoji-270a {\n    background-position: 0 -11220px\n}\n\n.weixinEmoji-270b {\n    background-position: 0 -11240px\n}\n\n.weixinEmoji-270c {\n    background-position: 0 -11260px\n}\n\n.weixinEmoji-1f44a {\n    background-position: 0 -11280px\n}\n\n.weixinEmoji-1f44d {\n    background-position: 0 -11300px\n}\n\n.weixinEmoji-261d {\n    background-position: 0 -11320px\n}\n\n.weixinEmoji-1f446 {\n    background-position: 0 -11340px\n}\n\n.weixinEmoji-1f447 {\n    background-position: 0 -11360px\n}\n\n.weixinEmoji-1f448 {\n    background-position: 0 -11380px\n}\n\n.weixinEmoji-1f449 {\n    background-position: 0 -11400px\n}\n\n.weixinEmoji-1f44b {\n    background-position: 0 -11420px\n}\n\n.weixinEmoji-1f44f {\n    background-position: 0 -11440px\n}\n\n.weixinEmoji-1f44c {\n    background-position: 0 -11460px\n}\n\n.weixinEmoji-1f44e {\n    background-position: 0 -11480px\n}\n\n.weixinEmoji-1f450 {\n    background-position: 0 -11500px\n}\n@CHARSET \"UTF-8\";\n.modal-background{\n\twidth: 700px;\n\theight: 580px;\n\tposition: absolute;\n\tmargin: 0 auto;\n\tmargin-top: 70px;\n\tbackground: #2c2c2c;\n\topacity: 0.8;\n\tz-index: 0;\n}\n\n.preview-container {\n\tdisplay: inline-block;\n\tposition: relative;\n\tmargin: 0px auto;\n\tmargin-top: 70px;\n}\n\n.preview-close {\n\tposition: absolute;\n\ttop: 2px;\n\tright: 2px;\n\twidth: 30px;\n\theight: 30px;\n\t/*background: url(\'images/zoomImg/close1.png\');*/\n\tbackground: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAeCAYAAABwmH1PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAklSURBVHja5Jl9bFVnHcc/z3POuYd7by9t6RujFKit4qBsnaVsBJPF9yxZ1GyJxqnJFsqGiyHqNuMsRtQsIRkmmiVAl+AyNcRE6nSs8s8mQ1YJtLTYMZiO9Y4OFLbSst7b3nvueXn8Y8/Vs8u5ban4l7+k6b33nPN8n+/v/fkdoZTi/0nM67y/EWgFVgJV+rcMcAE4B7wFzKlB5bpcPXAAVSiAEPPBrQRWAE36swzhjgHjN5KwBdwOfBK4GViiAaW+Hui/DPB34M/AK0D2BhhkHfAJ/X8pEAPCGnI12bPAy8AA4M+2oJjDpduA+4FbAQNw9IKlDwmtgOKG3gB+rYkvxMIrgK8DG4GkJuZqXBXCLBotpq//FfglcPp6CQvgi8ADQAUwMx9XDUlcK+Z3wC/0ZuZL+FPAg0CDxvXniSmABDCtlf1b7XlzurQANgP3AQXtmuI6XXFGr/0VoAb4qfaOueRLQFcoN1yPKL1XC9gK1AO7SxUmIx68B/gqkNOWEQuIPaGBssDntMXmWufTwBb9nLPAmBeApxV+D/C10htKCa/VMZuPcocFSFHrXwA+M8t9rcDDGtO9AbiBNth9wMfLEY7pmE1qLZVu3C+TsIri6+dUBHigk1BtmUpxP1CtQ+jfniCEULZp+otM05dCROLGDMNfZJqeIURpNvI1vwdCJfQDhG/X2XimlKzneezbt2/tzp07O7LZrFkSFwpw+/r6mp944onOiYmJRRHe4QDLgc9G7Hk90KmTDSGyGEIEz50507pvaGidGwTCkjIIKyNhmu4rY2PLnh4cvHXadc3wdS15oFmHyweSltTZ0YiwkL9///6b9+/f3wqQy+Wsxx57bLCiosLTz3kHDx5s7enpactms2Jqasrevn37QCqV8iJq5p3A70NKFRrX0tb9j+Wk9J87e/bDvzp1ao2vFBnHsbZ2dp6ypAy8IJBxy/IOj46ueHpwsP29fN6YmJmJf/OOO4Zsw/B9pcK4nq7lfUCuaOEmHb/5KLeRUmIYBqlUimPHjjU8+eSTHZlMxgSc559/vmXv3r1thmEI27bJZrMx3/dFhOIKur62hH6r0bX+miQlhFBXcznbV4pULMaRdLpp7+BguxcEImXbzuHR0aaegYF2PwgM2zB4e2oqlXNdQ1zr+gVt5VUAxo4dOwDu0FqIShiira1t3HEcc2RkZEkikSCdTleMj49XXL58Ofnss8+2CSFEoVCgubk5093dPVhfXz+jvaVUFgFvEwSn82fOgO+vQYi7o3ADpcTa+vrxq/l8/I0rVyoTlsWbExOV2ULBfs9xYvtOnmz3gsD0g4DaZDK3bePGwabKymk3CGQZ3AvAWNGlV5UpUQBCSsnmzZtPA/T29rYkk0n6+/uXHT16dJllWbiuy8qVKzPbt28/sXz58intolEZW+pYLsrKcriBUiJmGMFD69efUkrx8ltvNSVMk8Ojo6sOp9OrpBAEQUBNIpH79qZNJ9bW1k5Mu+5suC3A0iLh6lkIF0nLrq6u07Zt+wcOHPiIYRiYponneaxevXry8ccfP9nQ0JAtQzYMboe+LynjCe8HfRBIS8pga2fnqUWm6R9Op1dJwwClCJSicfHizMMbNgx/tDzZcKWoBJbIkmw9a/sohPC1uyohBEIIlFJUVla6VVVVuXk2KUZEp6dmI73Ytgura2vHgUAohRQCPwhYlkplW2pqJgq+b8wDVwKySDSrQcUslvFeeOGFlt27d98ipRSe55HP57EsixMnTtTv3Lmzc3p62pyj9xUl2Xh6NlwBJGIx98U331z5zPBwuxRCBkqR9zxs02Tg4sWbdh8/3uGXlKwySznAdJHwP+borPy+vr6WPXv23AJIx3FobW29etddd50vFArYtk1/f//SXbt2dWQyGavMWsXMHT67Xp4NN2FZ7pF0umnPwEB73vNM1/dpqKjIdjY2XnI8D8sweGl0tOnpgYF2LwiEIaUqg1vEGi+61Ou6JMmIDfiHDh1a1dPT02aapnAchxUrVmQfffTRwcbGxinbtoPe3t7mRCJBf3//Uinlxx555JGhRCLhR1jO02fXooxqi1+DGzMM/+V0ennP4OBtgVJGEARUx+P5b2zYMNS6ZMnkU8ePdxxJp5cnLYs/pdNNQspgc0fHq4YQKvhgHS7G8Gng3aKFz2nwWJSmT5482TA1NSUdxylm4+ONjY0ZwOrq6hq59957R/P5PL7vMzY2lnIcJ6qBMYEJ4G+h3y7oKYl1zeFaCHX0/PkVV/N5w1eK6ng8951Nm07cXFd3BSHE1s7O4Tubmy/kXBeEYOTSpfqM48QiWlATmNSKds1QC9avJwvXuMSWLVtem5yctGdmZozu7u6hcOmRUoqurq7TQgg1NDRUs23btlerq6vzEdnXBgZLXDoHHAPWhJsPBfhBIL+8bt3Zf2azybznyW9t3Di4pq7uyozOxpaUwUOdncMC1KvvvFPz4Pr1I7WJRC4igdnAUeCd0gFALfAzoK60zQP8TCYT831fVlVVRZFRuu004vG4F1HiDJ3MvgucLRkALAV+rsuGW+rWl7PZhK+UWJZKTZeSMaUMHM+TmULBrk8mZyLIGtphvg8Mlx4exoHfaBcojQEjlUq5VVVVTpm6KQARj8f9MvU8AfyxJH6LcgnoLanP7584fN+or6jILUulosjgBYG0DEPVJZO5MqUpAbwEnCp3Hj4EvKjHOpF1bB4H8FJJAiN61lRO/gD8BUiFY18Aru/Lgu+XxQ2UEu6115Umew7YF15TRpxpd2vzL17gtKOU7AVgV+nxL+L4+JQe/qVuwAAgAVzRo6XJuUY87wE/Bo7oDVsLADT0xs8AP9Sz47nkErBDu19qtpZzjm6qQiv5R1EhVM5VJoGfAM/oTBomrkpKTvi7oe8FeA7oBtLXseGLwA/0tFPotYxZ2s/wyDauT0VHgO8Bry1kLl2cN92tj5C1oY4pCIEZ+vsUMKQP28P/5ZuHDuDzwG0hJXohBctQL+5oax7UhNVCB/FhqdN1ul2/cqnQRKd1a/qaJnnxBr9q+RCwQQ8obtK5pTgKvqy7xOM6/uccAF7Pu6V39euMUT0hqdJufhU4r4nm/wfvv0Y19uv6TFutvWpKd2nndIKal/xrAL3Sz3TZH9G9AAAAAElFTkSuQmCC\');\n\tbackground-position: 0 0;\n}\n\n.preview-close:hover {\n\tbackground-position: 30px 0;\n\tcursor: pointer;\n}\n\n.preview-img-container {\n    margin: 0 auto;\n\twidth: 700px;\n\theight: 580px;\n    border: 0px;\n\tborder-style: ridge;\n    overflow: hidden;\n    position: relative;\n\tcursor: pointer;\n\tbackground-color: rgba(0,0,0,0.5);\n}\n\n.preview-img-container::selection {\n\toutline: none;\n}\n\n.preview-image {\n    position: absolute;\n    cursor: pointer;\n}\n\n.preview-buttons {\n\tposition: absolute;\n\tbottom: 0px;\n\twidth: 100%;\n\tz-index: 1060;\n}\n\n.preview-btn-group {\n\twidth: 180px;\n\tmargin: 0 auto;\n\tpadding: 8px 6px 2px 6px;\n\tbackground-color: #090909;\n\tborder: 0px;\n\tborder-style: ridge;\n\tborder-bottom: none;\n\tborder-radius: 10px 10px 0px 0px;\n\topacity: 0.6;\n\tdisplay: none;\n}\n\n.preview-buttons::selection, .preview-btn-group::selection {\n\toutline: none;\n}\n\n.preview-btn {\n\tmargin-left: 15px;\n\tfont-size: 22px;\n\tcolor: #ffffff;\n}\n\n/*.preview-btn:hover {*/\n\t/*color: darkorange;*/\n/*}*/\n\n\n.preview-percent {\n\twidth: 80px;\n\theight: 35px;\n\ttext-align: center;\n\tline-height: 35px;\n\tfont-size: 16px;\n\tcolor: #ffffff;\n\tborder-radius: 5px;\n\tposition: relative;\n\tmargin: 0 auto;\n\tmargin-top: 272px;\n\tbackground: #2c2c2c;\n\topacity: 0.6;\n\tfilter: alpha(opacity=60);\n\tdisplay: none;\n\tbox-shadow: 0px 0px 5px;\n\tz-index: 1050;\n}\n\n#zoomIn, #zoomOut, #rotate-btn {\n    display: inline-block;\n    height:22px;\n    margin-right:15px;\n}\n        \n#zoomIn {\n    width: 23px;\n    /*background:url(\"images/zoomImg/zoomIn.png\");*/\n\tbackground:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0OUY2QkZBODY5QUMxMUU1QjVCQThDMDc2RkQzMDQwOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0OUY3ODhENDY5QUMxMUU1QjVCQThDMDc2RkQzMDQwOSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ5RjZCRkE2NjlBQzExRTVCNUJBOEMwNzZGRDMwNDA5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjQ5RjZCRkE3NjlBQzExRTVCNUJBOEMwNzZGRDMwNDA5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+JpiXLgAAAdNJREFUeNqs1E8oBFEcB/DBJiRLwkp2lZuNnJSUA4sTdzfZ2hw2pSQXJRftkbI3Llrk5urgT1uUP4WLHLAbLQ6iaLXYHd/HV73Gm90d7a8+zcz783tv3rw3mq7rmoIbAnAKb/ABEVgEj0mfP4wFRbAAST19bEGdleQlEGbnFKzDALigFtr5Ni9sE4PmbJOH2OkRuqVyO9RLz+L+kG2voCxT8i42fucM5UYHkACHVFYJl+wTyJR8gw3nFY2irDMuQT/Ln/mtlMltEGfDFgvJ87nuIjpVyfM1TauBYkjAGdTBJhyRQ/uJNT7vQy+k4Jh1jZoibFDB+1de3dCjaNsk3fdyAnE+l5olj/G+ko1EpzawszwE1eCDa0jCHuucvD6okv+uzwXXbtDCmovd88kz4TJbcxGrvE5BoXF8XpOG8hkogDBE0828HO44wxXuoN86H8wZyoY5YxHT2ZxQDw+LiB1oVXSogqCUWOd/yJvNj6sPnqSOJ7AMS7DNE6yKFN8wbXLByWRmiXa5TKoBRuRced8jqEPs/w5o4CG75QGKsH4SZhUf3w9B+YP+14TJG/jNlsWqcZMBvLlILowZdpCI+1wlF0YNA0RymVwYghs4F7/hLwEGAJTkKcoXsEO9AAAAAElFTkSuQmCC\");\n}\n        \n#zoomOut {\n    width:22px;\n    /*background:url(\"images/zoomImg/zoomOut.png\");*/\n\tbackground:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4NUFENkE3MkNGMjQ2ODExODIyQUYyRUU3MDBGMTA5QiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4NzFCNDZFNTc5NDAxMUU1QTc4MkFGQzlFMDIxREI0QiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4NzFCNDZFNDc5NDAxMUU1QTc4MkFGQzlFMDIxREI0QiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDQ4MDExNzQwNzIwNjgxMTgyMkFGNzE2NkRGNDMxQjQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6ODVBRDZBNzJDRjI0NjgxMTgyMkFGMkVFNzAwRjEwOUIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7ACFUPAAABnElEQVR42qzUPywDURwH8NfGotRCqMTgX0JiIBYLg8XUQRoJkxhsahcDkSYmIZGIVTqYOpsaiYk2BAlhsoiIVBgUkVTP98e3yeX63t1V+0s+6V3u9769e/feKcuylEM7rEIW3uAb7mEfJiGoGVPGfhKAZchb7nUK/X6DJXTPNvgQpqAXIjACCXjldfkd8hO8xAFfMOsyoBWO2CvT0+IWLHP6zuZpH/MXgiv2b7kFr7Ap7eel0BjHfECTKTjDppkKgsUtx0V11+uUUt3qr44hBEnoVPoqwAakIAt90KVrlOAwj/MQgRgElLmiDP7keYMp+JF3KM5gENoMoZg8leFxB39z+k7LSnGu1iqY3zBfnNSA6eXF2PDCdeonOMExF27LLchtWtpxjR6h8r0osH/Ta+fJ1n1m8yWMGh5/3RYqVYQFr4/QMLdpqW4gCbtwYNudztKGO/+pmdvUFHLOxy96hQd+08urHsahh+tUltQJXPN6HLYd612CFmGntNz+K+5259UEu4XPVRtsCs/VIlgXflerYDEPT/AAEz8CDAC5mCgsfjPeiQAAAABJRU5ErkJggg==\");\n}\n        \n#rotate-btn {\n    width: 20px;\n    /*background:url(\"images/zoomImg/rotate.png\");*/\n\tbackground:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0OUY1NjhDRjY5QUMxMUU1QjVCQThDMDc2RkQzMDQwOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0OUY1NjhEMDY5QUMxMUU1QjVCQThDMDc2RkQzMDQwOSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA0MTRBNEJBNjkwMTExRTVCNUJBOEMwNzZGRDMwNDA5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjQ5RjU2OENFNjlBQzExRTVCNUJBOEMwNzZGRDMwNDA5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Fi2Q/wAAAa5JREFUeNqs1c0rRFEYx/FrRmRChigkb2ElK2VBFMlCGWRhFpSNlPwHlNWsrYmFFVEWssQOC2woC42F15K3puR1ru9Tz+S67jDuOPXpzpw59zfn3DnnGcM0TcOFetyh3/6Zx/i9ZaAClcjSvihyEEL6l9FxZlCAcezjzfxsURwhhD3tG7Xeaw9KwRgilpBTbGIDYfN7u0CGU2AaFnTQM6ZQ4zD7cv0C66xrnALndcAxauM8imysW8K20Oy05AFLWPEPv241XnGIbn1E0l+GqligrP8c72hIYMvkw2vrO8AtMmXb9KAIS9hOYBtd493Wtws/ghIY0M4Zw32b1WunPIMwL0p00z65DMxEBGcS+MiLBxQaybUb+GTJKXJgjP9pLxJ4iQI9s25bHnJxKoF78KIpicBWve5I4Iq+GU4icESvy7EzfK5nssVFbezVUyab2xPrDGqnBJf+IawO9zqZdntxmNbQMzQmEBbQMGkTTtVGzuecDpBzvYg2a62DH11Ys5SuyZ8KrBjElaVEvWoRvbcVVqlMHfb74y3HhyGs4lJnLH8FJ1qE+5DqdO+HAAMAJ+95rTZroJgAAAAASUVORK5CYII=\");\n    margin-right: 0px;\n}');
