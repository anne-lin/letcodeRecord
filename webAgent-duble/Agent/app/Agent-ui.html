
<div id="chat_pane">

    <div class="ibox-title">
        <div class="chat-admin">
            <!--<img class="admin-img" src="../images/admin.jpg" alt=""/>-->
            <span class="admin-img"></span>
            <div style="float: left">
                <div style="margin: 5px 0px" data-bind="text: username"></div>
                <div data-bind="text:agentOnline() ? '在线': '离线'"></div>
            </div>
        </div>
        <div class="chat-close">
            <a href="#" id="hideChat">
                <i class="fa fa-close"></i>
            </a>
        </div>
    </div>

    <div class="chat-users">
        <div class="users-online"  data-bind="template: {name:'userList', foreach: onlineArr}"></div>
        <div class="chat-tip" data-bind="visible: !onlineArr().length">
            <i class="fa fa-comment"></i>
            <p>暂无进行中对话</p>
        </div>
        <div class="end">已结束</div>
        <div class="users-offline" data-bind="template: {name:'userList', foreach: offlineArr}"></div>
        <div class="chat-tip" data-bind="visible: !offlineArr().length" style="border-bottom:1px solid #e2eaec">
            <i class="fa fa-comment"></i>
            <p>暂无已结束对话</p>
        </div>
    </div>

    <div class="chat-content-info" data-bind="visible: !userList().length">
        <div class="chat-tip" data-bind="visible: !userList().length">
            <i class="fa fa-comment"></i>
            <p>欢迎使用CChat Agent Web App</p>
        </div>
    </div>

    <div class="chat-content-info" data-bind="visible: userList().length">
        <div class="chat-content">
            <!-- ko foreach: userList -->
            <div class="chat-discussion" data-bind="visible: $data == $root.currentUser(),css:{scrollToBottom:$data == $root.currentUser()}">
                <!-- ko foreach: messages -->
                <div class="chat-message">
                    <div data-bind="css: 'time ' + direction">
                        <span data-bind="text: direction == 'recv' ? $parent.visitorInfo().workOrderName : $root.username"></span>&nbsp;<span data-bind="text: time()"></span>
                    </div>
                    <!--<img data-bind="css: 'message-avatar ' + direction" src="images/head.jpg" alt="">-->
                    <div data-bind="css: 'message ' + direction">
                        <span data-bind="css: 'arrow ' + direction"></span>

                        <span class="message-content">
                            <!-- ko if: type == "text" -->
                              <span data-bind="html: text"></span>
                            <!-- /ko -->

                            <!-- ko if: type == "image"-->
                             <span>
                                  <img alt="" data-bind="attr:{src:text.zoom}, click:$root.previewImg"/>
                             </span>
                            <!-- /ko -->

                            <!-- ko if: type == "file" -->
                             <span>
                                  <a data-bind="attr:{href:text}" target="_blank">点击下载</a>
                             </span>
                            <!-- /ko -->

                             <!-- ko if: type == "voice" -->
                             <span>
                                  <a data-bind="attr:{href:text}" target="_blank">点击下载</a>
                             </span>
                            <!-- /ko -->

                             <!-- ko if: type == "shortvideo" -->
                             <span>
                                  <a data-bind="attr:{href:text}" target="_blank">点击下载</a>
                             </span>
                            <!-- /ko -->
                        </span>

                    </div>
                </div>
                <!-- /ko -->
            </div>
            <!-- /ko -->

            <div class="chat-message-form">
                <div class="top-bar">
                <span id="uploadBtn">
                    <i class="fa fa-folder-o" style="font-size: 24px"></i>
                </span>
                    <input type="file" name="fileToUpload" id="fileToUpload"/>
                    <span id='progressNumber'></span>
                </div>
                <textarea class="message-input" data-bind="textInput: inputText, event: {keydown: sendMessageByKey}" placeholder="输入消息内容，按Ctrl+Enter发送" data-bind="value: transferMsg"></textarea>
                <div class="bottom-bar">
                    <a class="kickoffUser" data-bind="click: kickoffUser">结束会话</a>
                    <a data-bind="click: getAgentList">转接坐席</a>
                    <!--<a data-bind="click: sendSatisfy">满意度调查</a>-->
                    <button class="send-btn" data-bind="click: function(){$root.sendMessage('text')}">发送</button>
                </div>
            </div>
            <div id="chat-message-form-shadow" data-bind="visible: !currentUser().online()"></div>
        </div>

        <div class="chat-user-info" data-bind="with: currentUser">
            <dl class="ember-view" data-bind="with: visitorInfo">
                <dt>访客信息</dt>
                <dd><input class="ember-view ember-text-field" placeholder="昵称" type="text" disabled="disabled" data-bind="value: workOrderName"></dd>
                <dd><input class="ember-view ember-text-field" placeholder="邮箱" type="text" disabled="disabled"  data-bind="value: workOrderEmail"></dd>
                <dd><input class="ember-view ember-text-field" placeholder="手机号码" type="text" disabled="disabled"  data-bind="value: workOrderPhone"></dd>
            </dl>
            <!-- ko with: visitInfo -->
            <dl>
                <dt>访问信息</dt>
                <dd>持续时间：<span></span></dd>
                <dd>
                    会话来路：<span  data-bind="text: sessionAntecedents"></span>
                </dd>
            </dl>
            <!-- /ko -->
            <dl>
                <dt>
                    工单跟进
                    <a class="btn" href="#" data-bind="click:$root.kchartCreate">创建工单</a>
                </dt>
                <!-- ko foreach:workOrder -->
                <dd>
                    <a href="#" data-bind="click:onclick">
                        <span class="status" data-bind="text:workId"></span>
                        <span data-bind="text: title"></span>
                    </a>
                </dd>
                <!-- /ko -->
            </dl>
            <!-- ko with: visitInfo -->
            <dl>
                <dt>其他信息</dt>
                <dd>地理位置：<span data-bind="text: geoLocation"></span></dd>
                <dd>ip地址：<span data-bind="text: ipAddress"></span></dd>
                <dd>访问环境：<span data-bind="text: browserType"></span></dd>
                <dd>操作系统：<span data-bind="text: operatingSystem"></span></dd>
            </dl>
            <!-- /ko -->
        </div>
    </div>
    <div id="agentSection">
        <p id="agentSection_title">
            <span>转接坐席列表</span>
            <span id="closeTransfer" data-bind="click: closeTransfer">&times;</span>
        </p>
        <textarea name="" id="" style="height: 120px;width: 100%;" placeholder="请输入转接留言，然后转接"></textarea>
        <table class="table" id="agentSection-list" data-bind="foreach:agentList">
            <tr>
                <th colspan="3">
                    <span data-bind="text:skillGroupName"></span>
                    <!--<a data-bind="text:skillGroupId"></a>-->
                </th>
            </tr>
            <tr data-bind="visible: !transferAgentNum">
                <td colspan="3" style="text-align: center">
                    <span>当前技能组没有可转接坐席</span>
                </td>
            </tr>
            <!-- ko foreach: agents -->
            <tr data-bind="visible: $parent.transferAgentNum">
                <td data-bind="text: id"></td>
                <td data-bind="text: name"></td>
                <td data-bind="click: $root.transferAgent"><a>转接</a></td>
            </tr>
            <!-- /ko -->

            <!--<tr>-->
            <!--<td data-bind="text: id"></td>-->
            <!--<td data-bind="text: name"></td>-->
            <!--<td data-bind="click: $root.transferAgent"><a data-bind="handle"></a></td>-->
            <!--</tr>-->
        </table>
    </div>
</div>

<script type="text/html" id="userList">
    <div class="chat-user" data-bind="click:$root.selectUser, css: {'selected': $data == $root.currentUser()}">

        <!-- ko if: source == "weixin" -->
        <span class="chat-avatar" data-bind="style:{background: online() ? '#3cb65d' : '#c6c6c6'}">
            <i class="fa fa-weixin"></i>
        </span>
        <!-- /ko -->

        <!-- ko if: source == "webim" -->
        <span class="chat-avatar" data-bind="style:{background: online() ? '#1989ff' : '#c6c6c6'}">
            <i class="fa fa-desktop"></i>
        </span>
        <!-- /ko -->

        <div class="chat-user-name">
            <a href="#">
                <span data-bind="text: visitorInfo().workOrderName"></span>
            </a>
            <span class="lastMsg" data-bind="html:lastMsg"></span>
            <span class="chat-user-msgNumber" data-bind="text:msgNumber, visible:msgNumber()"></span>
        </div>
    </div>
</script>